(()=>{"use strict";var t={amdO:{},d:(e,i)=>{for(var n in i)t.o(i,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:i[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};let e=function(){let t={iChemLabs:{},informatics:{},io:{},lib:{},notations:{},structures:{PID:0}};return t.structures.d2={},t.structures.d3={},t.getVersion=function(){return"9.5.0"},t}();var n,r,o,a,l,h,u,c,f,d;!function(e,i,n){(function(e,i){var s=[],r=e.document,o=s.slice,a=s.concat,l=s.push,h=s.indexOf,u={},c=u.toString,f=u.hasOwnProperty,d={},m="2.2.4",p=function(t,e){return new p.fn.init(t,e)},g=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,x=/^-ms-/,_=/-([\da-z])/gi,b=function(t,e){return e.toUpperCase()};function y(t){var e=!!t&&"length"in t&&t.length,i=p.type(t);return"function"!==i&&!p.isWindow(t)&&("array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t)}p.fn=p.prototype={jquery:m,constructor:p,selector:"",length:0,toArray:function(){return o.call(this)},get:function(t){return null!=t?t<0?this[t+this.length]:this[t]:o.call(this)},pushStack:function(t){var e=p.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t){return p.each(this,t)},map:function(t){return this.pushStack(p.map(this,(function(e,i){return t.call(e,i,e)})))},slice:function(){return this.pushStack(o.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(t<0?e:0);return this.pushStack(i>=0&&i<e?[this[i]]:[])},end:function(){return this.prevObject||this.constructor()},push:l,sort:s.sort,splice:s.splice},p.extend=p.fn.extend=function(){var t,e,i,s,r,o,a=arguments[0]||{},l=1,h=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[l]||{},l++),"object"==typeof a||p.isFunction(a)||(a={}),l===h&&(a=this,l--);l<h;l++)if(null!=(t=arguments[l]))for(e in t)i=a[e],a!==(s=t[e])&&(u&&s&&(p.isPlainObject(s)||(r=p.isArray(s)))?(r?(r=!1,o=i&&p.isArray(i)?i:[]):o=i&&p.isPlainObject(i)?i:{},a[e]=p.extend(u,o,s)):s!==n&&(a[e]=s));return a},p.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===p.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){var e=t&&t.toString();return!p.isArray(t)&&e-parseFloat(e)+1>=0},isPlainObject:function(t){var e;if("object"!==p.type(t)||t.nodeType||p.isWindow(t))return!1;if(t.constructor&&!f.call(t,"constructor")&&!f.call(t.constructor.prototype||{},"isPrototypeOf"))return!1;for(e in t);return e===n||f.call(t,e)},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?u[c.call(t)]||"object":typeof t},globalEval:function(t){var e,i=eval;(t=p.trim(t))&&(1===t.indexOf("use strict")?((e=r.createElement("script")).text=t,r.head.appendChild(e).parentNode.removeChild(e)):i(t))},camelCase:function(t){return t.replace(x,"ms-").replace(_,b)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e){var i,n=0;if(y(t))for(i=t.length;n<i&&!1!==e.call(t[n],n,t[n]);n++);else for(n in t)if(!1===e.call(t[n],n,t[n]))break;return t},trim:function(t){return null==t?"":(t+"").replace(g,"")},makeArray:function(t,e){var i=e||[];return null!=t&&(y(Object(t))?p.merge(i,"string"==typeof t?[t]:t):l.call(i,t)),i},inArray:function(t,e,i){return null==e?-1:h.call(e,t,i)},merge:function(t,e){for(var i=+e.length,n=0,s=t.length;n<i;n++)t[s++]=e[n];return t.length=s,t},grep:function(t,e,i){for(var n=[],s=0,r=t.length,o=!i;s<r;s++)!e(t[s],s)!==o&&n.push(t[s]);return n},map:function(t,e,i){var n,s,r=0,o=[];if(y(t))for(n=t.length;r<n;r++)null!=(s=e(t[r],r,i))&&o.push(s);else for(r in t)null!=(s=e(t[r],r,i))&&o.push(s);return a.apply([],o)},guid:1,proxy:function(t,e){var i,s,r;return"string"==typeof e&&(i=t[e],e=t,t=i),p.isFunction(t)?(s=o.call(arguments,2),r=function(){return t.apply(e||this,s.concat(o.call(arguments)))},r.guid=t.guid=t.guid||p.guid++,r):n},now:Date.now,support:d}),"function"==typeof Symbol&&(p.fn[Symbol.iterator]=s[Symbol.iterator]),p.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),(function(t,e){u["[object "+e+"]"]=e.toLowerCase()}));var v=function(t){var e,i,s,r,o,a,l,h,u,c,f,d,m,p,g,x,_,b,y,v="sizzle"+1*new Date,w=t.document,T=0,S=0,D=ot(),E=ot(),C=ot(),A=function(t,e){return t===e&&(f=!0),0},F=1<<31,R={}.hasOwnProperty,P=[],M=P.pop,B=P.push,I=P.push,L=P.slice,N=function(t,e){for(var i=0,n=t.length;i<n;i++)if(t[i]===e)return i;return-1},k="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",O="[\\x20\\t\\r\\n\\f]",U="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",z="\\["+O+"*("+U+")(?:"+O+"*([*^$|!~]?=)"+O+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+U+"))|)"+O+"*\\]",H=":("+U+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+z+")*)|.*)\\)|)",q=new RegExp(O+"+","g"),W=new RegExp("^"+O+"+|((?:^|[^\\\\])(?:\\\\.)*)"+O+"+$","g"),G=new RegExp("^"+O+"*,"+O+"*"),j=new RegExp("^"+O+"*([>+~]|"+O+")"+O+"*"),X=new RegExp("="+O+"*([^\\]'\"]*?)"+O+"*\\]","g"),V=new RegExp(H),Y=new RegExp("^"+U+"$"),Z={ID:new RegExp("^#("+U+")"),CLASS:new RegExp("^\\.("+U+")"),TAG:new RegExp("^("+U+"|[*])"),ATTR:new RegExp("^"+z),PSEUDO:new RegExp("^"+H),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+O+"*(even|odd|(([+-]|)(\\d*)n|)"+O+"*(?:([+-]|)"+O+"*(\\d+)|))"+O+"*\\)|)","i"),bool:new RegExp("^(?:"+k+")$","i"),needsContext:new RegExp("^"+O+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+O+"*((?:-\\d)?\\d*)"+O+"*\\)|)(?=[^-]|$)","i")},Q=/^(?:input|select|textarea|button)$/i,$=/^h\d$/i,J=/^[^{]+\{\s*\[native \w/,K=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,tt=/[+~]/,et=/'|\\/g,it=new RegExp("\\\\([\\da-f]{1,6}"+O+"?|("+O+")|.)","ig"),nt=function(t,e,i){var n="0x"+e-65536;return n!=n||i?e:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)},st=function(){d()};try{I.apply(P=L.call(w.childNodes),w.childNodes),P[w.childNodes.length].nodeType}catch(t){I={apply:P.length?function(t,e){B.apply(t,L.call(e))}:function(t,e){for(var i=t.length,n=0;t[i++]=e[n++];);t.length=i-1}}}function rt(t,e,n,s){var r,o,l,u,c,f,p,_,b=e&&e.ownerDocument,T=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==T&&9!==T&&11!==T)return n;if(!s&&((e?e.ownerDocument||e:w)!==m&&d(e),e=e||m,g)){if(11!==T&&(f=K.exec(t)))if(r=f[1]){if(9===T){if(!(l=e.getElementById(r)))return n;if(l.id===r)return n.push(l),n}else if(b&&(l=b.getElementById(r))&&y(e,l)&&l.id===r)return n.push(l),n}else{if(f[2])return I.apply(n,e.getElementsByTagName(t)),n;if((r=f[3])&&i.getElementsByClassName&&e.getElementsByClassName)return I.apply(n,e.getElementsByClassName(r)),n}if(i.qsa&&!C[t+" "]&&(!x||!x.test(t))){if(1!==T)b=e,_=t;else if("object"!==e.nodeName.toLowerCase()){for((u=e.getAttribute("id"))?u=u.replace(et,"\\$&"):e.setAttribute("id",u=v),o=(p=a(t)).length,c=Y.test(u)?"#"+u:"[id='"+u+"']";o--;)p[o]=c+" "+gt(p[o]);_=p.join(","),b=tt.test(t)&&mt(e.parentNode)||e}if(_)try{return I.apply(n,b.querySelectorAll(_)),n}catch(t){}finally{u===v&&e.removeAttribute("id")}}}return h(t.replace(W,"$1"),e,n,s)}function ot(){var t=[];return function e(i,n){return t.push(i+" ")>s.cacheLength&&delete e[t.shift()],e[i+" "]=n}}function at(t){return t[v]=!0,t}function lt(t){var e=m.createElement("div");try{return!!t(e)}catch(t){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function ht(t,e){for(var i=t.split("|"),n=i.length;n--;)s.attrHandle[i[n]]=e}function ut(t,e){var i=e&&t,n=i&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||F)-(~t.sourceIndex||F);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function ct(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function ft(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function dt(t){return at((function(e){return e=+e,at((function(i,n){for(var s,r=t([],i.length,e),o=r.length;o--;)i[s=r[o]]&&(i[s]=!(n[s]=i[s]))}))}))}function mt(t){return t&&void 0!==t.getElementsByTagName&&t}for(e in i=rt.support={},o=rt.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return!!e&&"HTML"!==e.nodeName},d=rt.setDocument=function(t){var e,n,r=t?t.ownerDocument||t:w;return r!==m&&9===r.nodeType&&r.documentElement?(p=(m=r).documentElement,g=!o(m),(n=m.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",st,!1):n.attachEvent&&n.attachEvent("onunload",st)),i.attributes=lt((function(t){return t.className="i",!t.getAttribute("className")})),i.getElementsByTagName=lt((function(t){return t.appendChild(m.createComment("")),!t.getElementsByTagName("*").length})),i.getElementsByClassName=J.test(m.getElementsByClassName),i.getById=lt((function(t){return p.appendChild(t).id=v,!m.getElementsByName||!m.getElementsByName(v).length})),i.getById?(s.find.ID=function(t,e){if(void 0!==e.getElementById&&g){var i=e.getElementById(t);return i?[i]:[]}},s.filter.ID=function(t){var e=t.replace(it,nt);return function(t){return t.getAttribute("id")===e}}):(delete s.find.ID,s.filter.ID=function(t){var e=t.replace(it,nt);return function(t){var i=void 0!==t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}}),s.find.TAG=i.getElementsByTagName?function(t,e){return void 0!==e.getElementsByTagName?e.getElementsByTagName(t):i.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,n=[],s=0,r=e.getElementsByTagName(t);if("*"===t){for(;i=r[s++];)1===i.nodeType&&n.push(i);return n}return r},s.find.CLASS=i.getElementsByClassName&&function(t,e){if(void 0!==e.getElementsByClassName&&g)return e.getElementsByClassName(t)},_=[],x=[],(i.qsa=J.test(m.querySelectorAll))&&(lt((function(t){p.appendChild(t).innerHTML="<a id='"+v+"'></a><select id='"+v+"-\r\\' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&x.push("[*^$]="+O+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||x.push("\\["+O+"*(?:value|"+k+")"),t.querySelectorAll("[id~="+v+"-]").length||x.push("~="),t.querySelectorAll(":checked").length||x.push(":checked"),t.querySelectorAll("a#"+v+"+*").length||x.push(".#.+[+~]")})),lt((function(t){var e=m.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&x.push("name"+O+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||x.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),x.push(",.*:")}))),(i.matchesSelector=J.test(b=p.matches||p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&lt((function(t){i.disconnectedMatch=b.call(t,"div"),b.call(t,"[s!='']:x"),_.push("!=",H)})),x=x.length&&new RegExp(x.join("|")),_=_.length&&new RegExp(_.join("|")),e=J.test(p.compareDocumentPosition),y=e||J.test(p.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,n=e&&e.parentNode;return t===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):t.compareDocumentPosition&&16&t.compareDocumentPosition(n)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},A=e?function(t,e){if(t===e)return f=!0,0;var n=!t.compareDocumentPosition-!e.compareDocumentPosition;return n||(1&(n=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1)||!i.sortDetached&&e.compareDocumentPosition(t)===n?t===m||t.ownerDocument===w&&y(w,t)?-1:e===m||e.ownerDocument===w&&y(w,e)?1:c?N(c,t)-N(c,e):0:4&n?-1:1)}:function(t,e){if(t===e)return f=!0,0;var i,n=0,s=t.parentNode,r=e.parentNode,o=[t],a=[e];if(!s||!r)return t===m?-1:e===m?1:s?-1:r?1:c?N(c,t)-N(c,e):0;if(s===r)return ut(t,e);for(i=t;i=i.parentNode;)o.unshift(i);for(i=e;i=i.parentNode;)a.unshift(i);for(;o[n]===a[n];)n++;return n?ut(o[n],a[n]):o[n]===w?-1:a[n]===w?1:0},m):m},rt.matches=function(t,e){return rt(t,null,null,e)},rt.matchesSelector=function(t,e){if((t.ownerDocument||t)!==m&&d(t),e=e.replace(X,"='$1']"),i.matchesSelector&&g&&!C[e+" "]&&(!_||!_.test(e))&&(!x||!x.test(e)))try{var n=b.call(t,e);if(n||i.disconnectedMatch||t.document&&11!==t.document.nodeType)return n}catch(t){}return rt(e,m,null,[t]).length>0},rt.contains=function(t,e){return(t.ownerDocument||t)!==m&&d(t),y(t,e)},rt.attr=function(t,e){(t.ownerDocument||t)!==m&&d(t);var r=s.attrHandle[e.toLowerCase()],o=r&&R.call(s.attrHandle,e.toLowerCase())?r(t,e,!g):n;return o!==n?o:i.attributes||!g?t.getAttribute(e):(o=t.getAttributeNode(e))&&o.specified?o.value:null},rt.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},rt.uniqueSort=function(t){var e,n=[],s=0,r=0;if(f=!i.detectDuplicates,c=!i.sortStable&&t.slice(0),t.sort(A),f){for(;e=t[r++];)e===t[r]&&(s=n.push(r));for(;s--;)t.splice(n[s],1)}return c=null,t},r=rt.getText=function(t){var e,i="",n=0,s=t.nodeType;if(s){if(1===s||9===s||11===s){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=r(t)}else if(3===s||4===s)return t.nodeValue}else for(;e=t[n++];)i+=r(e);return i},s=rt.selectors={cacheLength:50,createPseudo:at,match:Z,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(it,nt),t[3]=(t[3]||t[4]||t[5]||"").replace(it,nt),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||rt.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&rt.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return Z.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&V.test(i)&&(e=a(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(it,nt).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=D[t+" "];return e||(e=new RegExp("(^|"+O+")"+t+"("+O+"|$)"))&&D(t,(function(t){return e.test("string"==typeof t.className&&t.className||void 0!==t.getAttribute&&t.getAttribute("class")||"")}))},ATTR:function(t,e,i){return function(n){var s=rt.attr(n,t);return null==s?"!="===e:!e||(s+="","="===e?s===i:"!="===e?s!==i:"^="===e?i&&0===s.indexOf(i):"*="===e?i&&s.indexOf(i)>-1:"$="===e?i&&s.slice(-i.length)===i:"~="===e?(" "+s.replace(q," ")+" ").indexOf(i)>-1:"|="===e&&(s===i||s.slice(0,i.length+1)===i+"-"))}},CHILD:function(t,e,i,n,s){var r="nth"!==t.slice(0,3),o="last"!==t.slice(-4),a="of-type"===e;return 1===n&&0===s?function(t){return!!t.parentNode}:function(e,i,l){var h,u,c,f,d,m,p=r!==o?"nextSibling":"previousSibling",g=e.parentNode,x=a&&e.nodeName.toLowerCase(),_=!l&&!a,b=!1;if(g){if(r){for(;p;){for(f=e;f=f[p];)if(a?f.nodeName.toLowerCase()===x:1===f.nodeType)return!1;m=p="only"===t&&!m&&"nextSibling"}return!0}if(m=[o?g.firstChild:g.lastChild],o&&_){for(b=(d=(h=(u=(c=(f=g)[v]||(f[v]={}))[f.uniqueID]||(c[f.uniqueID]={}))[t]||[])[0]===T&&h[1])&&h[2],f=d&&g.childNodes[d];f=++d&&f&&f[p]||(b=d=0)||m.pop();)if(1===f.nodeType&&++b&&f===e){u[t]=[T,d,b];break}}else if(_&&(b=d=(h=(u=(c=(f=e)[v]||(f[v]={}))[f.uniqueID]||(c[f.uniqueID]={}))[t]||[])[0]===T&&h[1]),!1===b)for(;(f=++d&&f&&f[p]||(b=d=0)||m.pop())&&((a?f.nodeName.toLowerCase()!==x:1!==f.nodeType)||!++b||(_&&((u=(c=f[v]||(f[v]={}))[f.uniqueID]||(c[f.uniqueID]={}))[t]=[T,b]),f!==e)););return(b-=s)===n||b%n==0&&b/n>=0}}},PSEUDO:function(t,e){var i,n=s.pseudos[t]||s.setFilters[t.toLowerCase()]||rt.error("unsupported pseudo: "+t);return n[v]?n(e):n.length>1?(i=[t,t,"",e],s.setFilters.hasOwnProperty(t.toLowerCase())?at((function(t,i){for(var s,r=n(t,e),o=r.length;o--;)t[s=N(t,r[o])]=!(i[s]=r[o])})):function(t){return n(t,0,i)}):n}},pseudos:{not:at((function(t){var e=[],i=[],n=l(t.replace(W,"$1"));return n[v]?at((function(t,e,i,s){for(var r,o=n(t,null,s,[]),a=t.length;a--;)(r=o[a])&&(t[a]=!(e[a]=r))})):function(t,s,r){return e[0]=t,n(e,null,r,i),e[0]=null,!i.pop()}})),has:at((function(t){return function(e){return rt(t,e).length>0}})),contains:at((function(t){return t=t.replace(it,nt),function(e){return(e.textContent||e.innerText||r(e)).indexOf(t)>-1}})),lang:at((function(t){return Y.test(t||"")||rt.error("unsupported lang: "+t),t=t.replace(it,nt).toLowerCase(),function(e){var i;do{if(i=g?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(i=i.toLowerCase())===t||0===i.indexOf(t+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}})),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===p},focus:function(t){return t===m.activeElement&&(!m.hasFocus||m.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return!1===t.disabled},disabled:function(t){return!0===t.disabled},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,!0===t.selected},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!s.pseudos.empty(t)},header:function(t){return $.test(t.nodeName)},input:function(t){return Q.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:dt((function(){return[0]})),last:dt((function(t,e){return[e-1]})),eq:dt((function(t,e,i){return[i<0?i+e:i]})),even:dt((function(t,e){for(var i=0;i<e;i+=2)t.push(i);return t})),odd:dt((function(t,e){for(var i=1;i<e;i+=2)t.push(i);return t})),lt:dt((function(t,e,i){for(var n=i<0?i+e:i;--n>=0;)t.push(n);return t})),gt:dt((function(t,e,i){for(var n=i<0?i+e:i;++n<e;)t.push(n);return t}))}},s.pseudos.nth=s.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[e]=ct(e);for(e in{submit:!0,reset:!0})s.pseudos[e]=ft(e);function pt(){}function gt(t){for(var e=0,i=t.length,n="";e<i;e++)n+=t[e].value;return n}function xt(t,e,i){var n=e.dir,s=i&&"parentNode"===n,r=S++;return e.first?function(e,i,r){for(;e=e[n];)if(1===e.nodeType||s)return t(e,i,r)}:function(e,i,o){var a,l,h,u=[T,r];if(o){for(;e=e[n];)if((1===e.nodeType||s)&&t(e,i,o))return!0}else for(;e=e[n];)if(1===e.nodeType||s){if((a=(l=(h=e[v]||(e[v]={}))[e.uniqueID]||(h[e.uniqueID]={}))[n])&&a[0]===T&&a[1]===r)return u[2]=a[2];if(l[n]=u,u[2]=t(e,i,o))return!0}}}function _t(t){return t.length>1?function(e,i,n){for(var s=t.length;s--;)if(!t[s](e,i,n))return!1;return!0}:t[0]}function bt(t,e,i,n,s){for(var r,o=[],a=0,l=t.length,h=null!=e;a<l;a++)(r=t[a])&&(i&&!i(r,n,s)||(o.push(r),h&&e.push(a)));return o}function yt(t,e,i,n,s,r){return n&&!n[v]&&(n=yt(n)),s&&!s[v]&&(s=yt(s,r)),at((function(r,o,a,l){var h,u,c,f=[],d=[],m=o.length,p=r||function(t,e,i){for(var n=0,s=e.length;n<s;n++)rt(t,e[n],i);return i}(e||"*",a.nodeType?[a]:a,[]),g=!t||!r&&e?p:bt(p,f,t,a,l),x=i?s||(r?t:m||n)?[]:o:g;if(i&&i(g,x,a,l),n)for(h=bt(x,d),n(h,[],a,l),u=h.length;u--;)(c=h[u])&&(x[d[u]]=!(g[d[u]]=c));if(r){if(s||t){if(s){for(h=[],u=x.length;u--;)(c=x[u])&&h.push(g[u]=c);s(null,x=[],h,l)}for(u=x.length;u--;)(c=x[u])&&(h=s?N(r,c):f[u])>-1&&(r[h]=!(o[h]=c))}}else x=bt(x===o?x.splice(m,x.length):x),s?s(null,o,x,l):I.apply(o,x)}))}function vt(t){for(var e,i,n,r=t.length,o=s.relative[t[0].type],a=o||s.relative[" "],l=o?1:0,h=xt((function(t){return t===e}),a,!0),c=xt((function(t){return N(e,t)>-1}),a,!0),f=[function(t,i,n){var s=!o&&(n||i!==u)||((e=i).nodeType?h(t,i,n):c(t,i,n));return e=null,s}];l<r;l++)if(i=s.relative[t[l].type])f=[xt(_t(f),i)];else{if((i=s.filter[t[l].type].apply(null,t[l].matches))[v]){for(n=++l;n<r&&!s.relative[t[n].type];n++);return yt(l>1&&_t(f),l>1&&gt(t.slice(0,l-1).concat({value:" "===t[l-2].type?"*":""})).replace(W,"$1"),i,l<n&&vt(t.slice(l,n)),n<r&&vt(t=t.slice(n)),n<r&&gt(t))}f.push(i)}return _t(f)}return pt.prototype=s.filters=s.pseudos,s.setFilters=new pt,a=rt.tokenize=function(t,e){var i,n,r,o,a,l,h,u=E[t+" "];if(u)return e?0:u.slice(0);for(a=t,l=[],h=s.preFilter;a;){for(o in i&&!(n=G.exec(a))||(n&&(a=a.slice(n[0].length)||a),l.push(r=[])),i=!1,(n=j.exec(a))&&(i=n.shift(),r.push({value:i,type:n[0].replace(W," ")}),a=a.slice(i.length)),s.filter)!(n=Z[o].exec(a))||h[o]&&!(n=h[o](n))||(i=n.shift(),r.push({value:i,type:o,matches:n}),a=a.slice(i.length));if(!i)break}return e?a.length:a?rt.error(t):E(t,l).slice(0)},l=rt.compile=function(t,e){var i,n=[],r=[],o=C[t+" "];if(!o){for(e||(e=a(t)),i=e.length;i--;)(o=vt(e[i]))[v]?n.push(o):r.push(o);(o=C(t,function(t,e){var i=e.length>0,n=t.length>0,r=function(r,o,a,l,h){var c,f,p,x=0,_="0",b=r&&[],y=[],v=u,w=r||n&&s.find.TAG("*",h),S=T+=null==v?1:Math.random()||.1,D=w.length;for(h&&(u=o===m||o||h);_!==D&&null!=(c=w[_]);_++){if(n&&c){for(f=0,o||c.ownerDocument===m||(d(c),a=!g);p=t[f++];)if(p(c,o||m,a)){l.push(c);break}h&&(T=S)}i&&((c=!p&&c)&&x--,r&&b.push(c))}if(x+=_,i&&_!==x){for(f=0;p=e[f++];)p(b,y,o,a);if(r){if(x>0)for(;_--;)b[_]||y[_]||(y[_]=M.call(l));y=bt(y)}I.apply(l,y),h&&!r&&y.length>0&&x+e.length>1&&rt.uniqueSort(l)}return h&&(T=S,u=v),b};return i?at(r):r}(r,n))).selector=t}return o},h=rt.select=function(t,e,n,r){var o,h,u,c,f,d="function"==typeof t&&t,m=!r&&a(t=d.selector||t);if(n=n||[],1===m.length){if((h=m[0]=m[0].slice(0)).length>2&&"ID"===(u=h[0]).type&&i.getById&&9===e.nodeType&&g&&s.relative[h[1].type]){if(!(e=(s.find.ID(u.matches[0].replace(it,nt),e)||[])[0]))return n;d&&(e=e.parentNode),t=t.slice(h.shift().value.length)}for(o=Z.needsContext.test(t)?0:h.length;o--&&(u=h[o],!s.relative[c=u.type]);)if((f=s.find[c])&&(r=f(u.matches[0].replace(it,nt),tt.test(h[0].type)&&mt(e.parentNode)||e))){if(h.splice(o,1),!(t=r.length&&gt(h)))return I.apply(n,r),n;break}}return(d||l(t,m))(r,e,!g,n,!e||tt.test(t)&&mt(e.parentNode)||e),n},i.sortStable=v.split("").sort(A).join("")===v,i.detectDuplicates=!!f,d(),i.sortDetached=lt((function(t){return 1&t.compareDocumentPosition(m.createElement("div"))})),lt((function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")}))||ht("type|href|height|width",(function(t,e,i){if(!i)return t.getAttribute(e,"type"===e.toLowerCase()?1:2)})),i.attributes&&lt((function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")}))||ht("value",(function(t,e,i){if(!i&&"input"===t.nodeName.toLowerCase())return t.defaultValue})),lt((function(t){return null==t.getAttribute("disabled")}))||ht(k,(function(t,e,i){var n;if(!i)return!0===t[e]?e.toLowerCase():(n=t.getAttributeNode(e))&&n.specified?n.value:null})),rt}(e);p.find=v,p.expr=v.selectors,p.expr[":"]=p.expr.pseudos,p.uniqueSort=p.unique=v.uniqueSort,p.text=v.getText,p.isXMLDoc=v.isXML,p.contains=v.contains;var w=function(t,e,i){for(var s=[],r=i!==n;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(r&&p(t).is(i))break;s.push(t)}return s},T=function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i},S=p.expr.match.needsContext,D=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,E=/^.[^:#\[\.,]*$/;function C(t,e,i){if(p.isFunction(e))return p.grep(t,(function(t,n){return!!e.call(t,n,t)!==i}));if(e.nodeType)return p.grep(t,(function(t){return t===e!==i}));if("string"==typeof e){if(E.test(e))return p.filter(e,t,i);e=p.filter(e,t)}return p.grep(t,(function(t){return h.call(e,t)>-1!==i}))}p.filter=function(t,e,i){var n=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===n.nodeType?p.find.matchesSelector(n,t)?[n]:[]:p.find.matches(t,p.grep(e,(function(t){return 1===t.nodeType})))},p.fn.extend({find:function(t){var e,i=this.length,n=[],s=this;if("string"!=typeof t)return this.pushStack(p(t).filter((function(){for(e=0;e<i;e++)if(p.contains(s[e],this))return!0})));for(e=0;e<i;e++)p.find(t,s[e],n);return(n=this.pushStack(i>1?p.unique(n):n)).selector=this.selector?this.selector+" "+t:t,n},filter:function(t){return this.pushStack(C(this,t||[],!1))},not:function(t){return this.pushStack(C(this,t||[],!0))},is:function(t){return!!C(this,"string"==typeof t&&S.test(t)?p(t):t||[],!1).length}});var A,F=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/;(p.fn.init=function(t,e,i){var s,o;if(!t)return this;if(i=i||A,"string"==typeof t){if(!(s="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:F.exec(t))||!s[1]&&e)return!e||e.jquery?(e||i).find(t):this.constructor(e).find(t);if(s[1]){if(e=e instanceof p?e[0]:e,p.merge(this,p.parseHTML(s[1],e&&e.nodeType?e.ownerDocument||e:r,!0)),D.test(s[1])&&p.isPlainObject(e))for(s in e)p.isFunction(this[s])?this[s](e[s]):this.attr(s,e[s]);return this}return(o=r.getElementById(s[2]))&&o.parentNode&&(this.length=1,this[0]=o),this.context=r,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):p.isFunction(t)?i.ready!==n?i.ready(t):t(p):(t.selector!==n&&(this.selector=t.selector,this.context=t.context),p.makeArray(t,this))}).prototype=p.fn,A=p(r);var R=/^(?:parents|prev(?:Until|All))/,P={children:!0,contents:!0,next:!0,prev:!0};function M(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}p.fn.extend({has:function(t){var e=p(t,this),i=e.length;return this.filter((function(){for(var t=0;t<i;t++)if(p.contains(this,e[t]))return!0}))},closest:function(t,e){for(var i,n=0,s=this.length,r=[],o=S.test(t)||"string"!=typeof t?p(t,e||this.context):0;n<s;n++)for(i=this[n];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&p.find.matchesSelector(i,t))){r.push(i);break}return this.pushStack(r.length>1?p.uniqueSort(r):r)},index:function(t){return t?"string"==typeof t?h.call(p(t),this[0]):h.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(p.uniqueSort(p.merge(this.get(),p(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),p.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return w(t,"parentNode")},parentsUntil:function(t,e,i){return w(t,"parentNode",i)},next:function(t){return M(t,"nextSibling")},prev:function(t){return M(t,"previousSibling")},nextAll:function(t){return w(t,"nextSibling")},prevAll:function(t){return w(t,"previousSibling")},nextUntil:function(t,e,i){return w(t,"nextSibling",i)},prevUntil:function(t,e,i){return w(t,"previousSibling",i)},siblings:function(t){return T((t.parentNode||{}).firstChild,t)},children:function(t){return T(t.firstChild)},contents:function(t){return t.contentDocument||p.merge([],t.childNodes)}},(function(t,e){p.fn[t]=function(i,n){var s=p.map(this,e,i);return"Until"!==t.slice(-5)&&(n=i),n&&"string"==typeof n&&(s=p.filter(n,s)),this.length>1&&(P[t]||p.uniqueSort(s),R.test(t)&&s.reverse()),this.pushStack(s)}}));var B,I=/\S+/g;function L(){r.removeEventListener("DOMContentLoaded",L),e.removeEventListener("load",L),p.ready()}p.Callbacks=function(t){t="string"==typeof t?function(t){var e={};return p.each(t.match(I)||[],(function(t,i){e[i]=!0})),e}(t):p.extend({},t);var e,i,n,s,r=[],o=[],a=-1,l=function(){for(s=t.once,n=e=!0;o.length;a=-1)for(i=o.shift();++a<r.length;)!1===r[a].apply(i[0],i[1])&&t.stopOnFalse&&(a=r.length,i=!1);t.memory||(i=!1),e=!1,s&&(r=i?[]:"")},h={add:function(){return r&&(i&&!e&&(a=r.length-1,o.push(i)),function e(i){p.each(i,(function(i,n){p.isFunction(n)?t.unique&&h.has(n)||r.push(n):n&&n.length&&"string"!==p.type(n)&&e(n)}))}(arguments),i&&!e&&l()),this},remove:function(){return p.each(arguments,(function(t,e){for(var i;(i=p.inArray(e,r,i))>-1;)r.splice(i,1),i<=a&&a--})),this},has:function(t){return t?p.inArray(t,r)>-1:r.length>0},empty:function(){return r&&(r=[]),this},disable:function(){return s=o=[],r=i="",this},disabled:function(){return!r},lock:function(){return s=o=[],i||(r=i=""),this},locked:function(){return!!s},fireWith:function(t,i){return s||(i=[t,(i=i||[]).slice?i.slice():i],o.push(i),e||l()),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!n}};return h},p.extend({Deferred:function(t){var e=[["resolve","done",p.Callbacks("once memory"),"resolved"],["reject","fail",p.Callbacks("once memory"),"rejected"],["notify","progress",p.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},then:function(){var t=arguments;return p.Deferred((function(i){p.each(e,(function(e,r){var o=p.isFunction(t[e])&&t[e];s[r[1]]((function(){var t=o&&o.apply(this,arguments);t&&p.isFunction(t.promise)?t.promise().progress(i.notify).done(i.resolve).fail(i.reject):i[r[0]+"With"](this===n?i.promise():this,o?[t]:arguments)}))})),t=null})).promise()},promise:function(t){return null!=t?p.extend(t,n):n}},s={};return n.pipe=n.then,p.each(e,(function(t,r){var o=r[2],a=r[3];n[r[1]]=o.add,a&&o.add((function(){i=a}),e[1^t][2].disable,e[2][2].lock),s[r[0]]=function(){return s[r[0]+"With"](this===s?n:this,arguments),this},s[r[0]+"With"]=o.fireWith})),n.promise(s),t&&t.call(s,s),s},when:function(t){var e,i,n,s=0,r=o.call(arguments),a=r.length,l=1!==a||t&&p.isFunction(t.promise)?a:0,h=1===l?t:p.Deferred(),u=function(t,i,n){return function(s){i[t]=this,n[t]=arguments.length>1?o.call(arguments):s,n===e?h.notifyWith(i,n):--l||h.resolveWith(i,n)}};if(a>1)for(e=new Array(a),i=new Array(a),n=new Array(a);s<a;s++)r[s]&&p.isFunction(r[s].promise)?r[s].promise().progress(u(s,i,e)).done(u(s,n,r)).fail(h.reject):--l;return l||h.resolveWith(n,r),h.promise()}}),p.fn.ready=function(t){return p.ready.promise().done(t),this},p.extend({isReady:!1,readyWait:1,holdReady:function(t){t?p.readyWait++:p.ready(!0)},ready:function(t){(!0===t?--p.readyWait:p.isReady)||(p.isReady=!0,!0!==t&&--p.readyWait>0||(B.resolveWith(r,[p]),p.fn.triggerHandler&&(p(r).triggerHandler("ready"),p(r).off("ready"))))}}),p.ready.promise=function(t){return B||(B=p.Deferred(),"complete"===r.readyState||"loading"!==r.readyState&&!r.documentElement.doScroll?e.setTimeout(p.ready):(r.addEventListener("DOMContentLoaded",L),e.addEventListener("load",L))),B.promise(t)},p.ready.promise();var N=function(t,e,i,s,r,o,a){var l=0,h=t.length,u=null==i;if("object"===p.type(i))for(l in r=!0,i)N(t,e,l,i[l],!0,o,a);else if(s!==n&&(r=!0,p.isFunction(s)||(a=!0),u&&(a?(e.call(t,s),e=null):(u=e,e=function(t,e,i){return u.call(p(t),i)})),e))for(;l<h;l++)e(t[l],i,a?s:s.call(t[l],l,e(t[l],i)));return r?t:u?e.call(t):h?e(t[0],i):o},k=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType};function O(){this.expando=p.expando+O.uid++}O.uid=1,O.prototype={register:function(t,e){var i=e||{};return t.nodeType?t[this.expando]=i:Object.defineProperty(t,this.expando,{value:i,writable:!0,configurable:!0}),t[this.expando]},cache:function(t){if(!k(t))return{};var e=t[this.expando];return e||(e={},k(t)&&(t.nodeType?t[this.expando]=e:Object.defineProperty(t,this.expando,{value:e,configurable:!0}))),e},set:function(t,e,i){var n,s=this.cache(t);if("string"==typeof e)s[e]=i;else for(n in e)s[n]=e[n];return s},get:function(t,e){return e===n?this.cache(t):t[this.expando]&&t[this.expando][e]},access:function(t,e,i){var s;return e===n||e&&"string"==typeof e&&i===n?(s=this.get(t,e))!==n?s:this.get(t,p.camelCase(e)):(this.set(t,e,i),i!==n?i:e)},remove:function(t,e){var i,s,r,o=t[this.expando];if(o!==n){if(e===n)this.register(t);else{p.isArray(e)?s=e.concat(e.map(p.camelCase)):(r=p.camelCase(e),s=e in o?[e,r]:(s=r)in o?[s]:s.match(I)||[]),i=s.length;for(;i--;)delete o[s[i]]}(e===n||p.isEmptyObject(o))&&(t.nodeType?t[this.expando]=n:delete t[this.expando])}},hasData:function(t){var e=t[this.expando];return e!==n&&!p.isEmptyObject(e)}};var U=new O,z=new O,H=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,q=/[A-Z]/g;function W(t,e,i){var s;if(i===n&&1===t.nodeType)if(s="data-"+e.replace(q,"-$&").toLowerCase(),"string"==typeof(i=t.getAttribute(s))){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:H.test(i)?p.parseJSON(i):i)}catch(t){}z.set(t,e,i)}else i=n;return i}p.extend({hasData:function(t){return z.hasData(t)||U.hasData(t)},data:function(t,e,i){return z.access(t,e,i)},removeData:function(t,e){z.remove(t,e)},_data:function(t,e,i){return U.access(t,e,i)},_removeData:function(t,e){U.remove(t,e)}}),p.fn.extend({data:function(t,e){var i,s,r,o=this[0],a=o&&o.attributes;if(t===n){if(this.length&&(r=z.get(o),1===o.nodeType&&!U.get(o,"hasDataAttrs"))){for(i=a.length;i--;)a[i]&&0===(s=a[i].name).indexOf("data-")&&(s=p.camelCase(s.slice(5)),W(o,s,r[s]));U.set(o,"hasDataAttrs",!0)}return r}return"object"==typeof t?this.each((function(){z.set(this,t)})):N(this,(function(e){var i,s;if(o&&e===n)return(i=z.get(o,t)||z.get(o,t.replace(q,"-$&").toLowerCase()))!==n?i:(s=p.camelCase(t),(i=z.get(o,s))!==n||(i=W(o,s,n))!==n?i:void 0);s=p.camelCase(t),this.each((function(){var i=z.get(this,s);z.set(this,s,e),t.indexOf("-")>-1&&i!==n&&z.set(this,t,e)}))}),null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each((function(){z.remove(this,t)}))}}),p.extend({queue:function(t,e,i){var n;if(t)return e=(e||"fx")+"queue",n=U.get(t,e),i&&(!n||p.isArray(i)?n=U.access(t,e,p.makeArray(i)):n.push(i)),n||[]},dequeue:function(t,e){e=e||"fx";var i=p.queue(t,e),n=i.length,s=i.shift(),r=p._queueHooks(t,e);"inprogress"===s&&(s=i.shift(),n--),s&&("fx"===e&&i.unshift("inprogress"),delete r.stop,s.call(t,(function(){p.dequeue(t,e)}),r)),!n&&r&&r.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return U.get(t,i)||U.access(t,i,{empty:p.Callbacks("once memory").add((function(){U.remove(t,[e+"queue",i])}))})}}),p.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?p.queue(this[0],t):e===n?this:this.each((function(){var i=p.queue(this,t,e);p._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&p.dequeue(this,t)}))},dequeue:function(t){return this.each((function(){p.dequeue(this,t)}))},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,s=1,r=p.Deferred(),o=this,a=this.length,l=function(){--s||r.resolveWith(o,[o])};for("string"!=typeof t&&(e=t,t=n),t=t||"fx";a--;)(i=U.get(o[a],t+"queueHooks"))&&i.empty&&(s++,i.empty.add(l));return l(),r.promise(e)}});var G=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,j=new RegExp("^(?:([+-])=|)("+G+")([a-z%]*)$","i"),X=["Top","Right","Bottom","Left"],V=function(t,e){return t=e||t,"none"===p.css(t,"display")||!p.contains(t.ownerDocument,t)};function Y(t,e,i,n){var s,r=1,o=20,a=n?function(){return n.cur()}:function(){return p.css(t,e,"")},l=a(),h=i&&i[3]||(p.cssNumber[e]?"":"px"),u=(p.cssNumber[e]||"px"!==h&&+l)&&j.exec(p.css(t,e));if(u&&u[3]!==h){h=h||u[3],i=i||[],u=+l||1;do{u/=r=r||".5",p.style(t,e,u+h)}while(r!==(r=a()/l)&&1!==r&&--o)}return i&&(u=+u||+l||0,s=i[1]?u+(i[1]+1)*i[2]:+i[2],n&&(n.unit=h,n.start=u,n.end=s)),s}var Z=/^(?:checkbox|radio)$/i,Q=/<([\w:-]+)/,$=/^$|\/(?:java|ecma)script/i,J={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function K(t,e){var i=void 0!==t.getElementsByTagName?t.getElementsByTagName(e||"*"):void 0!==t.querySelectorAll?t.querySelectorAll(e||"*"):[];return e===n||e&&p.nodeName(t,e)?p.merge([t],i):i}function tt(t,e){for(var i=0,n=t.length;i<n;i++)U.set(t[i],"globalEval",!e||U.get(e[i],"globalEval"))}J.optgroup=J.option,J.tbody=J.tfoot=J.colgroup=J.caption=J.thead,J.th=J.td;var et,it,nt=/<|&#?\w+;/;function st(t,e,i,n,s){for(var r,o,a,l,h,u,c=e.createDocumentFragment(),f=[],d=0,m=t.length;d<m;d++)if((r=t[d])||0===r)if("object"===p.type(r))p.merge(f,r.nodeType?[r]:r);else if(nt.test(r)){for(o=o||c.appendChild(e.createElement("div")),a=(Q.exec(r)||["",""])[1].toLowerCase(),l=J[a]||J._default,o.innerHTML=l[1]+p.htmlPrefilter(r)+l[2],u=l[0];u--;)o=o.lastChild;p.merge(f,o.childNodes),(o=c.firstChild).textContent=""}else f.push(e.createTextNode(r));for(c.textContent="",d=0;r=f[d++];)if(n&&p.inArray(r,n)>-1)s&&s.push(r);else if(h=p.contains(r.ownerDocument,r),o=K(c.appendChild(r),"script"),h&&tt(o),i)for(u=0;r=o[u++];)$.test(r.type||"")&&i.push(r);return c}et=r.createDocumentFragment().appendChild(r.createElement("div")),(it=r.createElement("input")).setAttribute("type","radio"),it.setAttribute("checked","checked"),it.setAttribute("name","t"),et.appendChild(it),d.checkClone=et.cloneNode(!0).cloneNode(!0).lastChild.checked,et.innerHTML="<textarea>x</textarea>",d.noCloneChecked=!!et.cloneNode(!0).lastChild.defaultValue;var rt=/^key/,ot=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,at=/^([^.]*)(?:\.(.+)|)/;function lt(){return!0}function ht(){return!1}function ut(){try{return r.activeElement}catch(t){}}function ct(t,e,i,s,r,o){var a,l;if("object"==typeof e){for(l in"string"!=typeof i&&(s=s||i,i=n),e)ct(t,l,i,s,e[l],o);return t}if(null==s&&null==r?(r=i,s=i=n):null==r&&("string"==typeof i?(r=s,s=n):(r=s,s=i,i=n)),!1===r)r=ht;else if(!r)return t;return 1===o&&(a=r,r=function(t){return p().off(t),a.apply(this,arguments)},r.guid=a.guid||(a.guid=p.guid++)),t.each((function(){p.event.add(this,e,r,s,i)}))}p.event={global:{},add:function(t,e,i,s,r){var o,a,l,h,u,c,f,d,m,g,x,_=U.get(t);if(_)for(i.handler&&(i=(o=i).handler,r=o.selector),i.guid||(i.guid=p.guid++),(h=_.events)||(h=_.events={}),(a=_.handle)||(a=_.handle=function(e){return void 0!==p&&p.event.triggered!==e.type?p.event.dispatch.apply(t,arguments):n}),u=(e=(e||"").match(I)||[""]).length;u--;)m=x=(l=at.exec(e[u])||[])[1],g=(l[2]||"").split(".").sort(),m&&(f=p.event.special[m]||{},m=(r?f.delegateType:f.bindType)||m,f=p.event.special[m]||{},c=p.extend({type:m,origType:x,data:s,handler:i,guid:i.guid,selector:r,needsContext:r&&p.expr.match.needsContext.test(r),namespace:g.join(".")},o),(d=h[m])||((d=h[m]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,s,g,a)||t.addEventListener&&t.addEventListener(m,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=i.guid)),r?d.splice(d.delegateCount++,0,c):d.push(c),p.event.global[m]=!0)},remove:function(t,e,i,n,s){var r,o,a,l,h,u,c,f,d,m,g,x=U.hasData(t)&&U.get(t);if(x&&(l=x.events)){for(h=(e=(e||"").match(I)||[""]).length;h--;)if(d=g=(a=at.exec(e[h])||[])[1],m=(a[2]||"").split(".").sort(),d){for(c=p.event.special[d]||{},f=l[d=(n?c.delegateType:c.bindType)||d]||[],a=a[2]&&new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=r=f.length;r--;)u=f[r],!s&&g!==u.origType||i&&i.guid!==u.guid||a&&!a.test(u.namespace)||n&&n!==u.selector&&("**"!==n||!u.selector)||(f.splice(r,1),u.selector&&f.delegateCount--,c.remove&&c.remove.call(t,u));o&&!f.length&&(c.teardown&&!1!==c.teardown.call(t,m,x.handle)||p.removeEvent(t,d,x.handle),delete l[d])}else for(d in l)p.event.remove(t,d+e[h],i,n,!0);p.isEmptyObject(l)&&U.remove(t,"handle events")}},dispatch:function(t){t=p.event.fix(t);var e,i,s,r,a,l=[],h=o.call(arguments),u=(U.get(this,"events")||{})[t.type]||[],c=p.event.special[t.type]||{};if(h[0]=t,t.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,t)){for(l=p.event.handlers.call(this,t,u),e=0;(r=l[e++])&&!t.isPropagationStopped();)for(t.currentTarget=r.elem,i=0;(a=r.handlers[i++])&&!t.isImmediatePropagationStopped();)t.rnamespace&&!t.rnamespace.test(a.namespace)||(t.handleObj=a,t.data=a.data,(s=((p.event.special[a.origType]||{}).handle||a.handler).apply(r.elem,h))!==n&&!1===(t.result=s)&&(t.preventDefault(),t.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,t),t.result}},handlers:function(t,e){var i,s,r,o,a=[],l=e.delegateCount,h=t.target;if(l&&h.nodeType&&("click"!==t.type||isNaN(t.button)||t.button<1))for(;h!==this;h=h.parentNode||this)if(1===h.nodeType&&(!0!==h.disabled||"click"!==t.type)){for(s=[],i=0;i<l;i++)s[r=(o=e[i]).selector+" "]===n&&(s[r]=o.needsContext?p(r,this).index(h)>-1:p.find(r,this,null,[h]).length),s[r]&&s.push(o);s.length&&a.push({elem:h,handlers:s})}return l<e.length&&a.push({elem:this,handlers:e.slice(l)}),a},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var i,s,o,a=e.button;return null==t.pageX&&null!=e.clientX&&(s=(i=t.target.ownerDocument||r).documentElement,o=i.body,t.pageX=e.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),t.pageY=e.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),t.which||a===n||(t.which=1&a?1:2&a?3:4&a?2:0),t}},fix:function(t){if(t[p.expando])return t;var e,i,n,s=t.type,o=t,a=this.fixHooks[s];for(a||(this.fixHooks[s]=a=ot.test(s)?this.mouseHooks:rt.test(s)?this.keyHooks:{}),n=a.props?this.props.concat(a.props):this.props,t=new p.Event(o),e=n.length;e--;)t[i=n[e]]=o[i];return t.target||(t.target=r),3===t.target.nodeType&&(t.target=t.target.parentNode),a.filter?a.filter(t,o):t},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ut()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===ut()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&p.nodeName(this,"input"))return this.click(),!1},_default:function(t){return p.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){t.result!==n&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}}},p.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i)},p.Event=function(t,e){if(!(this instanceof p.Event))return new p.Event(t,e);t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||t.defaultPrevented===n&&!1===t.returnValue?lt:ht):this.type=t,e&&p.extend(this,e),this.timeStamp=t&&t.timeStamp||p.now(),this[p.expando]=!0},p.Event.prototype={constructor:p.Event,isDefaultPrevented:ht,isPropagationStopped:ht,isImmediatePropagationStopped:ht,isSimulated:!1,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=lt,t&&!this.isSimulated&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=lt,t&&!this.isSimulated&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=lt,t&&!this.isSimulated&&t.stopImmediatePropagation(),this.stopPropagation()}},p.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},(function(t,e){p.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,n=t.relatedTarget,s=t.handleObj;return n&&(n===this||p.contains(this,n))||(t.type=s.origType,i=s.handler.apply(this,arguments),t.type=e),i}}})),p.fn.extend({on:function(t,e,i,n){return ct(this,t,e,i,n)},one:function(t,e,i,n){return ct(this,t,e,i,n,1)},off:function(t,e,i){var s,r;if(t&&t.preventDefault&&t.handleObj)return s=t.handleObj,p(t.delegateTarget).off(s.namespace?s.origType+"."+s.namespace:s.origType,s.selector,s.handler),this;if("object"==typeof t){for(r in t)this.off(r,e,t[r]);return this}return!1!==e&&"function"!=typeof e||(i=e,e=n),!1===i&&(i=ht),this.each((function(){p.event.remove(this,t,i,e)}))}});var ft=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,dt=/<script|<style|<link/i,mt=/checked\s*(?:[^=]|=\s*.checked.)/i,pt=/^true\/(.*)/,gt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function xt(t,e){return p.nodeName(t,"table")&&p.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function _t(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function bt(t){var e=pt.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function yt(t,e){var i,n,s,r,o,a,l,h;if(1===e.nodeType){if(U.hasData(t)&&(r=U.access(t),o=U.set(e,r),h=r.events))for(s in delete o.handle,o.events={},h)for(i=0,n=h[s].length;i<n;i++)p.event.add(e,s,h[s][i]);z.hasData(t)&&(a=z.access(t),l=p.extend({},a),z.set(e,l))}}function vt(t,e,i,n){e=a.apply([],e);var s,r,o,l,h,u,c=0,f=t.length,m=f-1,g=e[0],x=p.isFunction(g);if(x||f>1&&"string"==typeof g&&!d.checkClone&&mt.test(g))return t.each((function(s){var r=t.eq(s);x&&(e[0]=g.call(this,s,r.html())),vt(r,e,i,n)}));if(f&&(r=(s=st(e,t[0].ownerDocument,!1,t,n)).firstChild,1===s.childNodes.length&&(s=r),r||n)){for(l=(o=p.map(K(s,"script"),_t)).length;c<f;c++)h=s,c!==m&&(h=p.clone(h,!0,!0),l&&p.merge(o,K(h,"script"))),i.call(t[c],h,c);if(l)for(u=o[o.length-1].ownerDocument,p.map(o,bt),c=0;c<l;c++)h=o[c],$.test(h.type||"")&&!U.access(h,"globalEval")&&p.contains(u,h)&&(h.src?p._evalUrl&&p._evalUrl(h.src):p.globalEval(h.textContent.replace(gt,"")))}return t}function wt(t,e,i){for(var n,s=e?p.filter(e,t):t,r=0;null!=(n=s[r]);r++)i||1!==n.nodeType||p.cleanData(K(n)),n.parentNode&&(i&&p.contains(n.ownerDocument,n)&&tt(K(n,"script")),n.parentNode.removeChild(n));return t}p.extend({htmlPrefilter:function(t){return t.replace(ft,"<$1></$2>")},clone:function(t,e,i){var n,s,r,o,a,l,h,u=t.cloneNode(!0),c=p.contains(t.ownerDocument,t);if(!(d.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||p.isXMLDoc(t)))for(o=K(u),n=0,s=(r=K(t)).length;n<s;n++)a=r[n],l=o[n],h=void 0,"input"===(h=l.nodeName.toLowerCase())&&Z.test(a.type)?l.checked=a.checked:"input"!==h&&"textarea"!==h||(l.defaultValue=a.defaultValue);if(e)if(i)for(r=r||K(t),o=o||K(u),n=0,s=r.length;n<s;n++)yt(r[n],o[n]);else yt(t,u);return(o=K(u,"script")).length>0&&tt(o,!c&&K(t,"script")),u},cleanData:function(t){for(var e,i,s,r=p.event.special,o=0;(i=t[o])!==n;o++)if(k(i)){if(e=i[U.expando]){if(e.events)for(s in e.events)r[s]?p.event.remove(i,s):p.removeEvent(i,s,e.handle);i[U.expando]=n}i[z.expando]&&(i[z.expando]=n)}}}),p.fn.extend({domManip:vt,detach:function(t){return wt(this,t,!0)},remove:function(t){return wt(this,t)},text:function(t){return N(this,(function(t){return t===n?p.text(this):this.empty().each((function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=t)}))}),null,t,arguments.length)},append:function(){return vt(this,arguments,(function(t){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||xt(this,t).appendChild(t)}))},prepend:function(){return vt(this,arguments,(function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=xt(this,t);e.insertBefore(t,e.firstChild)}}))},before:function(){return vt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this)}))},after:function(){return vt(this,arguments,(function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)}))},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(p.cleanData(K(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null!=t&&t,e=null==e?t:e,this.map((function(){return p.clone(this,t,e)}))},html:function(t){return N(this,(function(t){var e=this[0]||{},i=0,s=this.length;if(t===n&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!dt.test(t)&&!J[(Q.exec(t)||["",""])[1].toLowerCase()]){t=p.htmlPrefilter(t);try{for(;i<s;i++)1===(e=this[i]||{}).nodeType&&(p.cleanData(K(e,!1)),e.innerHTML=t);e=0}catch(t){}}e&&this.empty().append(t)}),null,t,arguments.length)},replaceWith:function(){var t=[];return vt(this,arguments,(function(e){var i=this.parentNode;p.inArray(this,t)<0&&(p.cleanData(K(this)),i&&i.replaceChild(e,this))}),t)}}),p.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},(function(t,e){p.fn[t]=function(t){for(var i,n=[],s=p(t),r=s.length-1,o=0;o<=r;o++)i=o===r?this:this.clone(!0),p(s[o])[e](i),l.apply(n,i.get());return this.pushStack(n)}}));var Tt,St={HTML:"block",BODY:"block"};function Dt(t,e){var i=p(e.createElement(t)).appendTo(e.body),n=p.css(i[0],"display");return i.detach(),n}function Et(t){var e=r,i=St[t];return i||("none"!==(i=Dt(t,e))&&i||((e=(Tt=(Tt||p("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement))[0].contentDocument).write(),e.close(),i=Dt(t,e),Tt.detach()),St[t]=i),i}var Ct=/^margin/,At=new RegExp("^("+G+")(?!px)[a-z%]+$","i"),Ft=function(t){var i=t.ownerDocument.defaultView;return i&&i.opener||(i=e),i.getComputedStyle(t)},Rt=function(t,e,i,n){var s,r,o={};for(r in e)o[r]=t.style[r],t.style[r]=e[r];for(r in s=i.apply(t,n||[]),e)t.style[r]=o[r];return s},Pt=r.documentElement;function Mt(t,e,i){var s,r,o,a,l=t.style;return""!==(a=(i=i||Ft(t))?i.getPropertyValue(e)||i[e]:n)&&a!==n||p.contains(t.ownerDocument,t)||(a=p.style(t,e)),i&&!d.pixelMarginRight()&&At.test(a)&&Ct.test(e)&&(s=l.width,r=l.minWidth,o=l.maxWidth,l.minWidth=l.maxWidth=l.width=a,a=i.width,l.width=s,l.minWidth=r,l.maxWidth=o),a!==n?a+"":a}function Bt(t,e){return{get:function(){if(!t())return(this.get=e).apply(this,arguments);delete this.get}}}!function(){var t,i,n,s,o=r.createElement("div"),a=r.createElement("div");function l(){a.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",a.innerHTML="",Pt.appendChild(o);var r=e.getComputedStyle(a);t="1%"!==r.top,s="2px"===r.marginLeft,i="4px"===r.width,a.style.marginRight="50%",n="4px"===r.marginRight,Pt.removeChild(o)}a.style&&(a.style.backgroundClip="content-box",a.cloneNode(!0).style.backgroundClip="",d.clearCloneStyle="content-box"===a.style.backgroundClip,o.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",o.appendChild(a),p.extend(d,{pixelPosition:function(){return l(),t},boxSizingReliable:function(){return null==i&&l(),i},pixelMarginRight:function(){return null==i&&l(),n},reliableMarginLeft:function(){return null==i&&l(),s},reliableMarginRight:function(){var t,i=a.appendChild(r.createElement("div"));return i.style.cssText=a.style.cssText="-webkit-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",a.style.width="1px",Pt.appendChild(o),t=!parseFloat(e.getComputedStyle(i).marginRight),Pt.removeChild(o),a.removeChild(i),t}}))}();var It=/^(none|table(?!-c[ea]).+)/,Lt={position:"absolute",visibility:"hidden",display:"block"},Nt={letterSpacing:"0",fontWeight:"400"},kt=["Webkit","O","Moz","ms"],Ot=r.createElement("div").style;function Ut(t){if(t in Ot)return t;for(var e=t[0].toUpperCase()+t.slice(1),i=kt.length;i--;)if((t=kt[i]+e)in Ot)return t}function zt(t,e,i){var n=j.exec(e);return n?Math.max(0,n[2]-(i||0))+(n[3]||"px"):e}function Ht(t,e,i,n,s){for(var r=i===(n?"border":"content")?4:"width"===e?1:0,o=0;r<4;r+=2)"margin"===i&&(o+=p.css(t,i+X[r],!0,s)),n?("content"===i&&(o-=p.css(t,"padding"+X[r],!0,s)),"margin"!==i&&(o-=p.css(t,"border"+X[r]+"Width",!0,s))):(o+=p.css(t,"padding"+X[r],!0,s),"padding"!==i&&(o+=p.css(t,"border"+X[r]+"Width",!0,s)));return o}function qt(t,e,i){var n=!0,s="width"===e?t.offsetWidth:t.offsetHeight,r=Ft(t),o="border-box"===p.css(t,"boxSizing",!1,r);if(s<=0||null==s){if(((s=Mt(t,e,r))<0||null==s)&&(s=t.style[e]),At.test(s))return s;n=o&&(d.boxSizingReliable()||s===t.style[e]),s=parseFloat(s)||0}return s+Ht(t,e,i||(o?"border":"content"),n,r)+"px"}function Wt(t,e){for(var i,n,s,r=[],o=0,a=t.length;o<a;o++)(n=t[o]).style&&(r[o]=U.get(n,"olddisplay"),i=n.style.display,e?(r[o]||"none"!==i||(n.style.display=""),""===n.style.display&&V(n)&&(r[o]=U.access(n,"olddisplay",Et(n.nodeName)))):(s=V(n),"none"===i&&s||U.set(n,"olddisplay",s?i:p.css(n,"display"))));for(o=0;o<a;o++)(n=t[o]).style&&(e&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=e?r[o]||"":"none"));return t}function Gt(t,e,i,n,s){return new Gt.prototype.init(t,e,i,n,s)}p.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=Mt(t,"opacity");return""===i?"1":i}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:"cssFloat"},style:function(t,e,i,s){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var r,o,a,l=p.camelCase(e),h=t.style;if(e=p.cssProps[l]||(p.cssProps[l]=Ut(l)||l),a=p.cssHooks[e]||p.cssHooks[l],i===n)return a&&"get"in a&&(r=a.get(t,!1,s))!==n?r:h[e];"string"==(o=typeof i)&&(r=j.exec(i))&&r[1]&&(i=Y(t,e,r),o="number"),null!=i&&i==i&&("number"===o&&(i+=r&&r[3]||(p.cssNumber[l]?"":"px")),d.clearCloneStyle||""!==i||0!==e.indexOf("background")||(h[e]="inherit"),a&&"set"in a&&(i=a.set(t,i,s))===n||(h[e]=i))}},css:function(t,e,i,s){var r,o,a,l=p.camelCase(e);return e=p.cssProps[l]||(p.cssProps[l]=Ut(l)||l),(a=p.cssHooks[e]||p.cssHooks[l])&&"get"in a&&(r=a.get(t,!0,i)),r===n&&(r=Mt(t,e,s)),"normal"===r&&e in Nt&&(r=Nt[e]),""===i||i?(o=parseFloat(r),!0===i||isFinite(o)?o||0:r):r}}),p.each(["height","width"],(function(t,e){p.cssHooks[e]={get:function(t,i,n){if(i)return It.test(p.css(t,"display"))&&0===t.offsetWidth?Rt(t,Lt,(function(){return qt(t,e,n)})):qt(t,e,n)},set:function(t,i,n){var s,r=n&&Ft(t),o=n&&Ht(t,e,n,"border-box"===p.css(t,"boxSizing",!1,r),r);return o&&(s=j.exec(i))&&"px"!==(s[3]||"px")&&(t.style[e]=i,i=p.css(t,e)),zt(0,i,o)}}})),p.cssHooks.marginLeft=Bt(d.reliableMarginLeft,(function(t,e){if(e)return(parseFloat(Mt(t,"marginLeft"))||t.getBoundingClientRect().left-Rt(t,{marginLeft:0},(function(){return t.getBoundingClientRect().left})))+"px"})),p.cssHooks.marginRight=Bt(d.reliableMarginRight,(function(t,e){if(e)return Rt(t,{display:"inline-block"},Mt,[t,"marginRight"])})),p.each({margin:"",padding:"",border:"Width"},(function(t,e){p.cssHooks[t+e]={expand:function(i){for(var n=0,s={},r="string"==typeof i?i.split(" "):[i];n<4;n++)s[t+X[n]+e]=r[n]||r[n-2]||r[0];return s}},Ct.test(t)||(p.cssHooks[t+e].set=zt)})),p.fn.extend({css:function(t,e){return N(this,(function(t,e,i){var s,r,o={},a=0;if(p.isArray(e)){for(s=Ft(t),r=e.length;a<r;a++)o[e[a]]=p.css(t,e[a],!1,s);return o}return i!==n?p.style(t,e,i):p.css(t,e)}),t,e,arguments.length>1)},show:function(){return Wt(this,!0)},hide:function(){return Wt(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each((function(){V(this)?p(this).show():p(this).hide()}))}}),p.Tween=Gt,Gt.prototype={constructor:Gt,init:function(t,e,i,n,s,r){this.elem=t,this.prop=i,this.easing=s||p.easing._default,this.options=e,this.start=this.now=this.cur(),this.end=n,this.unit=r||(p.cssNumber[i]?"":"px")},cur:function(){var t=Gt.propHooks[this.prop];return t&&t.get?t.get(this):Gt.propHooks._default.get(this)},run:function(t){var e,i=Gt.propHooks[this.prop];return this.options.duration?this.pos=e=p.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):Gt.propHooks._default.set(this),this}},Gt.prototype.init.prototype=Gt.prototype,Gt.propHooks={_default:{get:function(t){var e;return 1!==t.elem.nodeType||null!=t.elem[t.prop]&&null==t.elem.style[t.prop]?t.elem[t.prop]:(e=p.css(t.elem,t.prop,""))&&"auto"!==e?e:0},set:function(t){p.fx.step[t.prop]?p.fx.step[t.prop](t):1!==t.elem.nodeType||null==t.elem.style[p.cssProps[t.prop]]&&!p.cssHooks[t.prop]?t.elem[t.prop]=t.now:p.style(t.elem,t.prop,t.now+t.unit)}}},Gt.propHooks.scrollTop=Gt.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},p.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2},_default:"swing"},p.fx=Gt.prototype.init,p.fx.step={};var jt,Xt,Vt=/^(?:toggle|show|hide)$/,Yt=/queueHooks$/;function Zt(){return e.setTimeout((function(){jt=n})),jt=p.now()}function Qt(t,e){var i,n=0,s={height:t};for(e=e?1:0;n<4;n+=2-e)s["margin"+(i=X[n])]=s["padding"+i]=t;return e&&(s.opacity=s.width=t),s}function $t(t,e,i){for(var n,s=(Jt.tweeners[e]||[]).concat(Jt.tweeners["*"]),r=0,o=s.length;r<o;r++)if(n=s[r].call(i,e,t))return n}function Jt(t,e,i){var n,s,r=0,o=Jt.prefilters.length,a=p.Deferred().always((function(){delete l.elem})),l=function(){if(s)return!1;for(var e=jt||Zt(),i=Math.max(0,h.startTime+h.duration-e),n=1-(i/h.duration||0),r=0,o=h.tweens.length;r<o;r++)h.tweens[r].run(n);return a.notifyWith(t,[h,n,i]),n<1&&o?i:(a.resolveWith(t,[h]),!1)},h=a.promise({elem:t,props:p.extend({},e),opts:p.extend(!0,{specialEasing:{},easing:p.easing._default},i),originalProperties:e,originalOptions:i,startTime:jt||Zt(),duration:i.duration,tweens:[],createTween:function(e,i){var n=p.Tween(t,h.opts,e,i,h.opts.specialEasing[e]||h.opts.easing);return h.tweens.push(n),n},stop:function(e){var i=0,n=e?h.tweens.length:0;if(s)return this;for(s=!0;i<n;i++)h.tweens[i].run(1);return e?(a.notifyWith(t,[h,1,0]),a.resolveWith(t,[h,e])):a.rejectWith(t,[h,e]),this}}),u=h.props;for(function(t,e){var i,n,s,r,o;for(i in t)if(s=e[n=p.camelCase(i)],r=t[i],p.isArray(r)&&(s=r[1],r=t[i]=r[0]),i!==n&&(t[n]=r,delete t[i]),(o=p.cssHooks[n])&&"expand"in o)for(i in r=o.expand(r),delete t[n],r)i in t||(t[i]=r[i],e[i]=s);else e[n]=s}(u,h.opts.specialEasing);r<o;r++)if(n=Jt.prefilters[r].call(h,t,u,h.opts))return p.isFunction(n.stop)&&(p._queueHooks(h.elem,h.opts.queue).stop=p.proxy(n.stop,n)),n;return p.map(u,$t,h),p.isFunction(h.opts.start)&&h.opts.start.call(t,h),p.fx.timer(p.extend(l,{elem:t,anim:h,queue:h.opts.queue})),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always)}p.Animation=p.extend(Jt,{tweeners:{"*":[function(t,e){var i=this.createTween(t,e);return Y(i.elem,t,j.exec(e),i),i}]},tweener:function(t,e){p.isFunction(t)?(e=t,t=["*"]):t=t.match(I);for(var i,n=0,s=t.length;n<s;n++)i=t[n],Jt.tweeners[i]=Jt.tweeners[i]||[],Jt.tweeners[i].unshift(e)},prefilters:[function(t,e,i){var s,r,o,a,l,h,u,c=this,f={},d=t.style,m=t.nodeType&&V(t),g=U.get(t,"fxshow");for(s in i.queue||(null==(l=p._queueHooks(t,"fx")).unqueued&&(l.unqueued=0,h=l.empty.fire,l.empty.fire=function(){l.unqueued||h()}),l.unqueued++,c.always((function(){c.always((function(){l.unqueued--,p.queue(t,"fx").length||l.empty.fire()}))}))),1===t.nodeType&&("height"in e||"width"in e)&&(i.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===("none"===(u=p.css(t,"display"))?U.get(t,"olddisplay")||Et(t.nodeName):u)&&"none"===p.css(t,"float")&&(d.display="inline-block")),i.overflow&&(d.overflow="hidden",c.always((function(){d.overflow=i.overflow[0],d.overflowX=i.overflow[1],d.overflowY=i.overflow[2]}))),e)if(r=e[s],Vt.exec(r)){if(delete e[s],o=o||"toggle"===r,r===(m?"hide":"show")){if("show"!==r||!g||g[s]===n)continue;m=!0}f[s]=g&&g[s]||p.style(t,s)}else u=n;if(p.isEmptyObject(f))"inline"===("none"===u?Et(t.nodeName):u)&&(d.display=u);else for(s in g?"hidden"in g&&(m=g.hidden):g=U.access(t,"fxshow",{}),o&&(g.hidden=!m),m?p(t).show():c.done((function(){p(t).hide()})),c.done((function(){var e;for(e in U.remove(t,"fxshow"),f)p.style(t,e,f[e])})),f)a=$t(m?g[s]:0,s,c),s in g||(g[s]=a.start,m&&(a.end=a.start,a.start="width"===s||"height"===s?1:0))}],prefilter:function(t,e){e?Jt.prefilters.unshift(t):Jt.prefilters.push(t)}}),p.speed=function(t,e,i){var n=t&&"object"==typeof t?p.extend({},t):{complete:i||!i&&e||p.isFunction(t)&&t,duration:t,easing:i&&e||e&&!p.isFunction(e)&&e};return n.duration=p.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in p.fx.speeds?p.fx.speeds[n.duration]:p.fx.speeds._default,null!=n.queue&&!0!==n.queue||(n.queue="fx"),n.old=n.complete,n.complete=function(){p.isFunction(n.old)&&n.old.call(this),n.queue&&p.dequeue(this,n.queue)},n},p.fn.extend({fadeTo:function(t,e,i,n){return this.filter(V).css("opacity",0).show().end().animate({opacity:e},t,i,n)},animate:function(t,e,i,n){var s=p.isEmptyObject(t),r=p.speed(e,i,n),o=function(){var e=Jt(this,p.extend({},t),r);(s||U.get(this,"finish"))&&e.stop(!0)};return o.finish=o,s||!1===r.queue?this.each(o):this.queue(r.queue,o)},stop:function(t,e,i){var s=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=n),e&&!1!==t&&this.queue(t||"fx",[]),this.each((function(){var e=!0,n=null!=t&&t+"queueHooks",r=p.timers,o=U.get(this);if(n)o[n]&&o[n].stop&&s(o[n]);else for(n in o)o[n]&&o[n].stop&&Yt.test(n)&&s(o[n]);for(n=r.length;n--;)r[n].elem!==this||null!=t&&r[n].queue!==t||(r[n].anim.stop(i),e=!1,r.splice(n,1));!e&&i||p.dequeue(this,t)}))},finish:function(t){return!1!==t&&(t=t||"fx"),this.each((function(){var e,i=U.get(this),n=i[t+"queue"],s=i[t+"queueHooks"],r=p.timers,o=n?n.length:0;for(i.finish=!0,p.queue(this,t,[]),s&&s.stop&&s.stop.call(this,!0),e=r.length;e--;)r[e].elem===this&&r[e].queue===t&&(r[e].anim.stop(!0),r.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete i.finish}))}}),p.each(["toggle","show","hide"],(function(t,e){var i=p.fn[e];p.fn[e]=function(t,n,s){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(Qt(e,!0),t,n,s)}})),p.each({slideDown:Qt("show"),slideUp:Qt("hide"),slideToggle:Qt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},(function(t,e){p.fn[t]=function(t,i,n){return this.animate(e,t,i,n)}})),p.timers=[],p.fx.tick=function(){var t,e=0,i=p.timers;for(jt=p.now();e<i.length;e++)(t=i[e])()||i[e]!==t||i.splice(e--,1);i.length||p.fx.stop(),jt=n},p.fx.timer=function(t){p.timers.push(t),t()?p.fx.start():p.timers.pop()},p.fx.interval=13,p.fx.start=function(){Xt||(Xt=e.setInterval(p.fx.tick,p.fx.interval))},p.fx.stop=function(){e.clearInterval(Xt),Xt=null},p.fx.speeds={slow:600,fast:200,_default:400},p.fn.delay=function(t,i){return t=p.fx&&p.fx.speeds[t]||t,i=i||"fx",this.queue(i,(function(i,n){var s=e.setTimeout(i,t);n.stop=function(){e.clearTimeout(s)}}))},function(){var t=r.createElement("input"),e=r.createElement("select"),i=e.appendChild(r.createElement("option"));t.type="checkbox",d.checkOn=""!==t.value,d.optSelected=i.selected,e.disabled=!0,d.optDisabled=!i.disabled,(t=r.createElement("input")).value="t",t.type="radio",d.radioValue="t"===t.value}();var Kt,te=p.expr.attrHandle;p.fn.extend({attr:function(t,e){return N(this,p.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each((function(){p.removeAttr(this,t)}))}}),p.extend({attr:function(t,e,i){var s,r,o=t.nodeType;if(3!==o&&8!==o&&2!==o)return void 0===t.getAttribute?p.prop(t,e,i):(1===o&&p.isXMLDoc(t)||(e=e.toLowerCase(),r=p.attrHooks[e]||(p.expr.match.bool.test(e)?Kt:n)),i!==n?null===i?void p.removeAttr(t,e):r&&"set"in r&&(s=r.set(t,i,e))!==n?s:(t.setAttribute(e,i+""),i):r&&"get"in r&&null!==(s=r.get(t,e))?s:null==(s=p.find.attr(t,e))?n:s)},attrHooks:{type:{set:function(t,e){if(!d.radioValue&&"radio"===e&&p.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}},removeAttr:function(t,e){var i,n,s=0,r=e&&e.match(I);if(r&&1===t.nodeType)for(;i=r[s++];)n=p.propFix[i]||i,p.expr.match.bool.test(i)&&(t[n]=!1),t.removeAttribute(i)}}),Kt={set:function(t,e,i){return!1===e?p.removeAttr(t,i):t.setAttribute(i,i),i}},p.each(p.expr.match.bool.source.match(/\w+/g),(function(t,e){var i=te[e]||p.find.attr;te[e]=function(t,e,n){var s,r;return n||(r=te[e],te[e]=s,s=null!=i(t,e,n)?e.toLowerCase():null,te[e]=r),s}}));var ee=/^(?:input|select|textarea|button)$/i,ie=/^(?:a|area)$/i;p.fn.extend({prop:function(t,e){return N(this,p.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each((function(){delete this[p.propFix[t]||t]}))}}),p.extend({prop:function(t,e,i){var s,r,o=t.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&p.isXMLDoc(t)||(e=p.propFix[e]||e,r=p.propHooks[e]),i!==n?r&&"set"in r&&(s=r.set(t,i,e))!==n?s:t[e]=i:r&&"get"in r&&null!==(s=r.get(t,e))?s:t[e]},propHooks:{tabIndex:{get:function(t){var e=p.find.attr(t,"tabindex");return e?parseInt(e,10):ee.test(t.nodeName)||ie.test(t.nodeName)&&t.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),d.optSelected||(p.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null},set:function(t){var e=t.parentNode;e&&(e.selectedIndex,e.parentNode&&e.parentNode.selectedIndex)}}),p.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],(function(){p.propFix[this.toLowerCase()]=this}));var ne=/[\t\r\n\f]/g;function se(t){return t.getAttribute&&t.getAttribute("class")||""}p.fn.extend({addClass:function(t){var e,i,n,s,r,o,a,l=0;if(p.isFunction(t))return this.each((function(e){p(this).addClass(t.call(this,e,se(this)))}));if("string"==typeof t&&t)for(e=t.match(I)||[];i=this[l++];)if(s=se(i),n=1===i.nodeType&&(" "+s+" ").replace(ne," ")){for(o=0;r=e[o++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");s!==(a=p.trim(n))&&i.setAttribute("class",a)}return this},removeClass:function(t){var e,i,n,s,r,o,a,l=0;if(p.isFunction(t))return this.each((function(e){p(this).removeClass(t.call(this,e,se(this)))}));if(!arguments.length)return this.attr("class","");if("string"==typeof t&&t)for(e=t.match(I)||[];i=this[l++];)if(s=se(i),n=1===i.nodeType&&(" "+s+" ").replace(ne," ")){for(o=0;r=e[o++];)for(;n.indexOf(" "+r+" ")>-1;)n=n.replace(" "+r+" "," ");s!==(a=p.trim(n))&&i.setAttribute("class",a)}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):p.isFunction(t)?this.each((function(i){p(this).toggleClass(t.call(this,i,se(this),e),e)})):this.each((function(){var e,s,r,o;if("string"===i)for(s=0,r=p(this),o=t.match(I)||[];e=o[s++];)r.hasClass(e)?r.removeClass(e):r.addClass(e);else t!==n&&"boolean"!==i||((e=se(this))&&U.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===t?"":U.get(this,"__className__")||""))}))},hasClass:function(t){var e,i,n=0;for(e=" "+t+" ";i=this[n++];)if(1===i.nodeType&&(" "+se(i)+" ").replace(ne," ").indexOf(e)>-1)return!0;return!1}});var re=/\r/g,oe=/[\x20\t\r\n\f]+/g;p.fn.extend({val:function(t){var e,i,s,r=this[0];return arguments.length?(s=p.isFunction(t),this.each((function(i){var r;1===this.nodeType&&(null==(r=s?t.call(this,i,p(this).val()):t)?r="":"number"==typeof r?r+="":p.isArray(r)&&(r=p.map(r,(function(t){return null==t?"":t+""}))),(e=p.valHooks[this.type]||p.valHooks[this.nodeName.toLowerCase()])&&"set"in e&&e.set(this,r,"value")!==n||(this.value=r))}))):r?(e=p.valHooks[r.type]||p.valHooks[r.nodeName.toLowerCase()])&&"get"in e&&(i=e.get(r,"value"))!==n?i:"string"==typeof(i=r.value)?i.replace(re,""):null==i?"":i:void 0}}),p.extend({valHooks:{option:{get:function(t){var e=p.find.attr(t,"value");return null!=e?e:p.trim(p.text(t)).replace(oe," ")}},select:{get:function(t){for(var e,i,n=t.options,s=t.selectedIndex,r="select-one"===t.type||s<0,o=r?null:[],a=r?s+1:n.length,l=s<0?a:r?s:0;l<a;l++)if(((i=n[l]).selected||l===s)&&(d.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!p.nodeName(i.parentNode,"optgroup"))){if(e=p(i).val(),r)return e;o.push(e)}return o},set:function(t,e){for(var i,n,s=t.options,r=p.makeArray(e),o=s.length;o--;)((n=s[o]).selected=p.inArray(p.valHooks.option.get(n),r)>-1)&&(i=!0);return i||(t.selectedIndex=-1),r}}}}),p.each(["radio","checkbox"],(function(){p.valHooks[this]={set:function(t,e){if(p.isArray(e))return t.checked=p.inArray(p(t).val(),e)>-1}},d.checkOn||(p.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}));var ae=/^(?:focusinfocus|focusoutblur)$/;p.extend(p.event,{trigger:function(t,i,s,o){var a,l,h,u,c,d,m,g=[s||r],x=f.call(t,"type")?t.type:t,_=f.call(t,"namespace")?t.namespace.split("."):[];if(l=h=s=s||r,3!==s.nodeType&&8!==s.nodeType&&!ae.test(x+p.event.triggered)&&(x.indexOf(".")>-1&&(_=x.split("."),x=_.shift(),_.sort()),c=x.indexOf(":")<0&&"on"+x,(t=t[p.expando]?t:new p.Event(x,"object"==typeof t&&t)).isTrigger=o?2:3,t.namespace=_.join("."),t.rnamespace=t.namespace?new RegExp("(^|\\.)"+_.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,t.result=n,t.target||(t.target=s),i=null==i?[t]:p.makeArray(i,[t]),m=p.event.special[x]||{},o||!m.trigger||!1!==m.trigger.apply(s,i))){if(!o&&!m.noBubble&&!p.isWindow(s)){for(u=m.delegateType||x,ae.test(u+x)||(l=l.parentNode);l;l=l.parentNode)g.push(l),h=l;h===(s.ownerDocument||r)&&g.push(h.defaultView||h.parentWindow||e)}for(a=0;(l=g[a++])&&!t.isPropagationStopped();)t.type=a>1?u:m.bindType||x,(d=(U.get(l,"events")||{})[t.type]&&U.get(l,"handle"))&&d.apply(l,i),(d=c&&l[c])&&d.apply&&k(l)&&(t.result=d.apply(l,i),!1===t.result&&t.preventDefault());return t.type=x,o||t.isDefaultPrevented()||m._default&&!1!==m._default.apply(g.pop(),i)||!k(s)||c&&p.isFunction(s[x])&&!p.isWindow(s)&&((h=s[c])&&(s[c]=null),p.event.triggered=x,s[x](),p.event.triggered=n,h&&(s[c]=h)),t.result}},simulate:function(t,e,i){var n=p.extend(new p.Event,i,{type:t,isSimulated:!0});p.event.trigger(n,null,e)}}),p.fn.extend({trigger:function(t,e){return this.each((function(){p.event.trigger(t,e,this)}))},triggerHandler:function(t,e){var i=this[0];if(i)return p.event.trigger(t,e,i,!0)}}),p.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),(function(t,e){p.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}})),p.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)}}),d.focusin="onfocusin"in e,d.focusin||p.each({focus:"focusin",blur:"focusout"},(function(t,e){var i=function(t){p.event.simulate(e,t.target,p.event.fix(t))};p.event.special[e]={setup:function(){var n=this.ownerDocument||this,s=U.access(n,e);s||n.addEventListener(t,i,!0),U.access(n,e,(s||0)+1)},teardown:function(){var n=this.ownerDocument||this,s=U.access(n,e)-1;s?U.access(n,e,s):(n.removeEventListener(t,i,!0),U.remove(n,e))}}}));var le=e.location,he=p.now(),ue=/\?/;p.parseJSON=function(t){return JSON.parse(t+"")},p.parseXML=function(t){var i;if(!t||"string"!=typeof t)return null;try{i=(new e.DOMParser).parseFromString(t,"text/xml")}catch(t){i=n}return i&&!i.getElementsByTagName("parsererror").length||p.error("Invalid XML: "+t),i};var ce=/#.*$/,fe=/([?&])_=[^&]*/,de=/^(.*?):[ \t]*([^\r\n]*)$/gm,me=/^(?:GET|HEAD)$/,pe=/^\/\//,ge={},xe={},_e="*/".concat("*"),be=r.createElement("a");function ye(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var n,s=0,r=e.toLowerCase().match(I)||[];if(p.isFunction(i))for(;n=r[s++];)"+"===n[0]?(n=n.slice(1)||"*",(t[n]=t[n]||[]).unshift(i)):(t[n]=t[n]||[]).push(i)}}function ve(t,e,i,n){var s={},r=t===xe;function o(a){var l;return s[a]=!0,p.each(t[a]||[],(function(t,a){var h=a(e,i,n);return"string"!=typeof h||r||s[h]?r?!(l=h):void 0:(e.dataTypes.unshift(h),o(h),!1)})),l}return o(e.dataTypes[0])||!s["*"]&&o("*")}function we(t,e){var i,s,r=p.ajaxSettings.flatOptions||{};for(i in e)e[i]!==n&&((r[i]?t:s||(s={}))[i]=e[i]);return s&&p.extend(!0,t,s),t}be.href=le.href,p.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:le.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(le.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":_e,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":p.parseJSON,"text xml":p.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?we(we(t,p.ajaxSettings),e):we(p.ajaxSettings,t)},ajaxPrefilter:ye(ge),ajaxTransport:ye(xe),ajax:function(t,i){"object"==typeof t&&(i=t,t=n),i=i||{};var s,o,a,l,h,u,c,f,d=p.ajaxSetup({},i),m=d.context||d,g=d.context&&(m.nodeType||m.jquery)?p(m):p.event,x=p.Deferred(),_=p.Callbacks("once memory"),b=d.statusCode||{},y={},v={},w=0,T="canceled",S={readyState:0,getResponseHeader:function(t){var e;if(2===w){if(!l)for(l={};e=de.exec(a);)l[e[1].toLowerCase()]=e[2];e=l[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===w?a:null},setRequestHeader:function(t,e){var i=t.toLowerCase();return w||(t=v[i]=v[i]||t,y[t]=e),this},overrideMimeType:function(t){return w||(d.mimeType=t),this},statusCode:function(t){var e;if(t)if(w<2)for(e in t)b[e]=[b[e],t[e]];else S.always(t[S.status]);return this},abort:function(t){var e=t||T;return s&&s.abort(e),D(0,e),this}};if(x.promise(S).complete=_.add,S.success=S.done,S.error=S.fail,d.url=((t||d.url||le.href)+"").replace(ce,"").replace(pe,le.protocol+"//"),d.type=i.method||i.type||d.method||d.type,d.dataTypes=p.trim(d.dataType||"*").toLowerCase().match(I)||[""],null==d.crossDomain){u=r.createElement("a");try{u.href=d.url,u.href=u.href,d.crossDomain=be.protocol+"//"+be.host!=u.protocol+"//"+u.host}catch(t){d.crossDomain=!0}}if(d.data&&d.processData&&"string"!=typeof d.data&&(d.data=p.param(d.data,d.traditional)),ve(ge,d,i,S),2===w)return S;for(f in(c=p.event&&d.global)&&0==p.active++&&p.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!me.test(d.type),o=d.url,d.hasContent||(d.data&&(o=d.url+=(ue.test(o)?"&":"?")+d.data,delete d.data),!1===d.cache&&(d.url=fe.test(o)?o.replace(fe,"$1_="+he++):o+(ue.test(o)?"&":"?")+"_="+he++)),d.ifModified&&(p.lastModified[o]&&S.setRequestHeader("If-Modified-Since",p.lastModified[o]),p.etag[o]&&S.setRequestHeader("If-None-Match",p.etag[o])),(d.data&&d.hasContent&&!1!==d.contentType||i.contentType)&&S.setRequestHeader("Content-Type",d.contentType),S.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+_e+"; q=0.01":""):d.accepts["*"]),d.headers)S.setRequestHeader(f,d.headers[f]);if(d.beforeSend&&(!1===d.beforeSend.call(m,S,d)||2===w))return S.abort();for(f in T="abort",{success:1,error:1,complete:1})S[f](d[f]);if(s=ve(xe,d,i,S)){if(S.readyState=1,c&&g.trigger("ajaxSend",[S,d]),2===w)return S;d.async&&d.timeout>0&&(h=e.setTimeout((function(){S.abort("timeout")}),d.timeout));try{w=1,s.send(y,D)}catch(t){if(!(w<2))throw t;D(-1,t)}}else D(-1,"No Transport");function D(t,i,r,l){var u,f,y,v,T,D=i;2!==w&&(w=2,h&&e.clearTimeout(h),s=n,a=l||"",S.readyState=t>0?4:0,u=t>=200&&t<300||304===t,r&&(v=function(t,e,i){for(var s,r,o,a,l=t.contents,h=t.dataTypes;"*"===h[0];)h.shift(),s===n&&(s=t.mimeType||e.getResponseHeader("Content-Type"));if(s)for(r in l)if(l[r]&&l[r].test(s)){h.unshift(r);break}if(h[0]in i)o=h[0];else{for(r in i){if(!h[0]||t.converters[r+" "+h[0]]){o=r;break}a||(a=r)}o=o||a}if(o)return o!==h[0]&&h.unshift(o),i[o]}(d,S,r)),v=function(t,e,i,n){var s,r,o,a,l,h={},u=t.dataTypes.slice();if(u[1])for(o in t.converters)h[o.toLowerCase()]=t.converters[o];for(r=u.shift();r;)if(t.responseFields[r]&&(i[t.responseFields[r]]=e),!l&&n&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=r,r=u.shift())if("*"===r)r=l;else if("*"!==l&&l!==r){if(!(o=h[l+" "+r]||h["* "+r]))for(s in h)if((a=s.split(" "))[1]===r&&(o=h[l+" "+a[0]]||h["* "+a[0]])){!0===o?o=h[s]:!0!==h[s]&&(r=a[0],u.unshift(a[1]));break}if(!0!==o)if(o&&t.throws)e=o(e);else try{e=o(e)}catch(t){return{state:"parsererror",error:o?t:"No conversion from "+l+" to "+r}}}return{state:"success",data:e}}(d,v,S,u),u?(d.ifModified&&((T=S.getResponseHeader("Last-Modified"))&&(p.lastModified[o]=T),(T=S.getResponseHeader("etag"))&&(p.etag[o]=T)),204===t||"HEAD"===d.type?D="nocontent":304===t?D="notmodified":(D=v.state,f=v.data,u=!(y=v.error))):(y=D,!t&&D||(D="error",t<0&&(t=0))),S.status=t,S.statusText=(i||D)+"",u?x.resolveWith(m,[f,D,S]):x.rejectWith(m,[S,D,y]),S.statusCode(b),b=n,c&&g.trigger(u?"ajaxSuccess":"ajaxError",[S,d,u?f:y]),_.fireWith(m,[S,D]),c&&(g.trigger("ajaxComplete",[S,d]),--p.active||p.event.trigger("ajaxStop")))}return S},getJSON:function(t,e,i){return p.get(t,e,i,"json")},getScript:function(t,e){return p.get(t,n,e,"script")}}),p.each(["get","post"],(function(t,e){p[e]=function(t,i,s,r){return p.isFunction(i)&&(r=r||s,s=i,i=n),p.ajax(p.extend({url:t,type:e,dataType:r,data:i,success:s},p.isPlainObject(t)&&t))}})),p._evalUrl=function(t){return p.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,throws:!0})},p.fn.extend({wrapAll:function(t){var e;return p.isFunction(t)?this.each((function(e){p(this).wrapAll(t.call(this,e))})):(this[0]&&(e=p(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map((function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t})).append(this)),this)},wrapInner:function(t){return p.isFunction(t)?this.each((function(e){p(this).wrapInner(t.call(this,e))})):this.each((function(){var e=p(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)}))},wrap:function(t){var e=p.isFunction(t);return this.each((function(i){p(this).wrapAll(e?t.call(this,i):t)}))},unwrap:function(){return this.parent().each((function(){p.nodeName(this,"body")||p(this).replaceWith(this.childNodes)})).end()}}),p.expr.filters.hidden=function(t){return!p.expr.filters.visible(t)},p.expr.filters.visible=function(t){return t.offsetWidth>0||t.offsetHeight>0||t.getClientRects().length>0};var Te=/%20/g,Se=/\[\]$/,De=/\r?\n/g,Ee=/^(?:submit|button|image|reset|file)$/i,Ce=/^(?:input|select|textarea|keygen)/i;function Ae(t,e,i,n){var s;if(p.isArray(e))p.each(e,(function(e,s){i||Se.test(t)?n(t,s):Ae(t+"["+("object"==typeof s&&null!=s?e:"")+"]",s,i,n)}));else if(i||"object"!==p.type(e))n(t,e);else for(s in e)Ae(t+"["+s+"]",e[s],i,n)}p.param=function(t,e){var i,s=[],r=function(t,e){e=p.isFunction(e)?e():null==e?"":e,s[s.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(e===n&&(e=p.ajaxSettings&&p.ajaxSettings.traditional),p.isArray(t)||t.jquery&&!p.isPlainObject(t))p.each(t,(function(){r(this.name,this.value)}));else for(i in t)Ae(i,t[i],e,r);return s.join("&").replace(Te,"+")},p.fn.extend({serialize:function(){return p.param(this.serializeArray())},serializeArray:function(){return this.map((function(){var t=p.prop(this,"elements");return t?p.makeArray(t):this})).filter((function(){var t=this.type;return this.name&&!p(this).is(":disabled")&&Ce.test(this.nodeName)&&!Ee.test(t)&&(this.checked||!Z.test(t))})).map((function(t,e){var i=p(this).val();return null==i?null:p.isArray(i)?p.map(i,(function(t){return{name:e.name,value:t.replace(De,"\r\n")}})):{name:e.name,value:i.replace(De,"\r\n")}})).get()}}),p.ajaxSettings.xhr=function(){try{return new e.XMLHttpRequest}catch(t){}};var Fe={0:200,1223:204},Re=p.ajaxSettings.xhr();d.cors=!!Re&&"withCredentials"in Re,d.ajax=Re=!!Re,p.ajaxTransport((function(t){var i,s;if(d.cors||Re&&!t.crossDomain)return{send:function(r,o){var a,l=t.xhr();if(l.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(a in t.xhrFields)l[a]=t.xhrFields[a];for(a in t.mimeType&&l.overrideMimeType&&l.overrideMimeType(t.mimeType),t.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest"),r)l.setRequestHeader(a,r[a]);i=function(t){return function(){i&&(i=s=l.onload=l.onerror=l.onabort=l.onreadystatechange=null,"abort"===t?l.abort():"error"===t?"number"!=typeof l.status?o(0,"error"):o(l.status,l.statusText):o(Fe[l.status]||l.status,l.statusText,"text"!==(l.responseType||"text")||"string"!=typeof l.responseText?{binary:l.response}:{text:l.responseText},l.getAllResponseHeaders()))}},l.onload=i(),s=l.onerror=i("error"),l.onabort!==n?l.onabort=s:l.onreadystatechange=function(){4===l.readyState&&e.setTimeout((function(){i&&s()}))},i=i("abort");try{l.send(t.hasContent&&t.data||null)}catch(t){if(i)throw t}},abort:function(){i&&i()}}})),p.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(t){return p.globalEval(t),t}}}),p.ajaxPrefilter("script",(function(t){t.cache===n&&(t.cache=!1),t.crossDomain&&(t.type="GET")})),p.ajaxTransport("script",(function(t){var e,i;if(t.crossDomain)return{send:function(n,s){e=p("<script>").prop({charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&s("error"===t.type?404:200,t.type)}),r.head.appendChild(e[0])},abort:function(){i&&i()}}}));var Pe=[],Me=/(=)\?(?=&|$)|\?\?/;p.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Pe.pop()||p.expando+"_"+he++;return this[t]=!0,t}}),p.ajaxPrefilter("json jsonp",(function(t,i,s){var r,o,a,l=!1!==t.jsonp&&(Me.test(t.url)?"url":"string"==typeof t.data&&0===(t.contentType||"").indexOf("application/x-www-form-urlencoded")&&Me.test(t.data)&&"data");if(l||"jsonp"===t.dataTypes[0])return r=t.jsonpCallback=p.isFunction(t.jsonpCallback)?t.jsonpCallback():t.jsonpCallback,l?t[l]=t[l].replace(Me,"$1"+r):!1!==t.jsonp&&(t.url+=(ue.test(t.url)?"&":"?")+t.jsonp+"="+r),t.converters["script json"]=function(){return a||p.error(r+" was not called"),a[0]},t.dataTypes[0]="json",o=e[r],e[r]=function(){a=arguments},s.always((function(){o===n?p(e).removeProp(r):e[r]=o,t[r]&&(t.jsonpCallback=i.jsonpCallback,Pe.push(r)),a&&p.isFunction(o)&&o(a[0]),a=o=n})),"script"})),p.parseHTML=function(t,e,i){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(i=e,e=!1),e=e||r;var n=D.exec(t),s=!i&&[];return n?[e.createElement(n[1])]:(n=st([t],e,s),s&&s.length&&p(s).remove(),p.merge([],n.childNodes))};var Be=p.fn.load;function Ie(t){return p.isWindow(t)?t:9===t.nodeType&&t.defaultView}p.fn.load=function(t,e,i){if("string"!=typeof t&&Be)return Be.apply(this,arguments);var s,r,o,a=this,l=t.indexOf(" ");return l>-1&&(s=p.trim(t.slice(l)),t=t.slice(0,l)),p.isFunction(e)?(i=e,e=n):e&&"object"==typeof e&&(r="POST"),a.length>0&&p.ajax({url:t,type:r||"GET",dataType:"html",data:e}).done((function(t){o=arguments,a.html(s?p("<div>").append(p.parseHTML(t)).find(s):t)})).always(i&&function(t,e){a.each((function(){i.apply(this,o||[t.responseText,e,t])}))}),this},p.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],(function(t,e){p.fn[e]=function(t){return this.on(e,t)}})),p.expr.filters.animated=function(t){return p.grep(p.timers,(function(e){return t===e.elem})).length},p.offset={setOffset:function(t,e,i){var n,s,r,o,a,l,h=p.css(t,"position"),u=p(t),c={};"static"===h&&(t.style.position="relative"),a=u.offset(),r=p.css(t,"top"),l=p.css(t,"left"),("absolute"===h||"fixed"===h)&&(r+l).indexOf("auto")>-1?(o=(n=u.position()).top,s=n.left):(o=parseFloat(r)||0,s=parseFloat(l)||0),p.isFunction(e)&&(e=e.call(t,i,p.extend({},a))),null!=e.top&&(c.top=e.top-a.top+o),null!=e.left&&(c.left=e.left-a.left+s),"using"in e?e.using.call(t,c):u.css(c)}},p.fn.extend({offset:function(t){if(arguments.length)return t===n?this:this.each((function(e){p.offset.setOffset(this,t,e)}));var e,i,s=this[0],r={top:0,left:0},o=s&&s.ownerDocument;return o?(e=o.documentElement,p.contains(e,s)?(r=s.getBoundingClientRect(),i=Ie(o),{top:r.top+i.pageYOffset-e.clientTop,left:r.left+i.pageXOffset-e.clientLeft}):r):void 0},position:function(){if(this[0]){var t,e,i=this[0],n={top:0,left:0};return"fixed"===p.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),p.nodeName(t[0],"html")||(n=t.offset()),n.top+=p.css(t[0],"borderTopWidth",!0),n.left+=p.css(t[0],"borderLeftWidth",!0)),{top:e.top-n.top-p.css(i,"marginTop",!0),left:e.left-n.left-p.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map((function(){for(var t=this.offsetParent;t&&"static"===p.css(t,"position");)t=t.offsetParent;return t||Pt}))}}),p.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},(function(t,e){var i="pageYOffset"===e;p.fn[t]=function(s){return N(this,(function(t,s,r){var o=Ie(t);if(r===n)return o?o[e]:t[s];o?o.scrollTo(i?o.pageXOffset:r,i?r:o.pageYOffset):t[s]=r}),t,s,arguments.length)}})),p.each(["top","left"],(function(t,e){p.cssHooks[e]=Bt(d.pixelPosition,(function(t,i){if(i)return i=Mt(t,e),At.test(i)?p(t).position()[e]+"px":i}))})),p.each({Height:"height",Width:"width"},(function(t,e){p.each({padding:"inner"+t,content:e,"":"outer"+t},(function(i,s){p.fn[s]=function(s,r){var o=arguments.length&&(i||"boolean"!=typeof s),a=i||(!0===s||!0===r?"margin":"border");return N(this,(function(e,i,s){var r;return p.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+t],r["scroll"+t],e.body["offset"+t],r["offset"+t],r["client"+t])):s===n?p.css(e,i,a):p.style(e,i,s,a)}),e,o?s:n,o,null)}}))})),p.fn.extend({bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e)},delegate:function(t,e,i,n){return this.on(e,t,i,n)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)},size:function(){return this.length}}),p.fn.andSelf=p.fn.addBack,"function"==typeof define&&t.amdO&&define("jquery",[],(function(){return p}));var Le=e.jQuery,Ne=e.$;p.noConflict=function(t){return e.$===p&&(e.$=Ne),t&&e.jQuery===p&&(e.jQuery=Le),p},e.jQuery=e.$=p})(void 0!==e?e:this),i.jQuery=jQuery,jQuery.noConflict(!0)}(window,e.lib),function(t){var e,i,n=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],s="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],r=Array.prototype.slice;if(t.event.fixHooks)for(var o=n.length;o;)t.event.fixHooks[n[--o]]=t.event.mouseHooks;var a=t.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var e=s.length;e;)this.addEventListener(s[--e],l,!1);else this.onmousewheel=l;t.data(this,"mousewheel-line-height",a.getLineHeight(this)),t.data(this,"mousewheel-page-height",a.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var e=s.length;e;)this.removeEventListener(s[--e],l,!1);else this.onmousewheel=null;t.removeData(this,"mousewheel-line-height"),t.removeData(this,"mousewheel-page-height")},getLineHeight:function(e){var i=t(e),n=i["offsetParent"in t.fn?"offsetParent":"parent"]();return n.length||(n=t("body")),parseInt(n.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(e){return t(e).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};function l(n){var s=n||window.event,o=r.call(arguments,1),l=0,c=0,f=0,d=0,m=0,p=0;if((n=t.event.fix(s)).type="mousewheel","detail"in s&&(f=-1*s.detail),"wheelDelta"in s&&(f=s.wheelDelta),"wheelDeltaY"in s&&(f=s.wheelDeltaY),"wheelDeltaX"in s&&(c=-1*s.wheelDeltaX),"axis"in s&&s.axis===s.HORIZONTAL_AXIS&&(c=-1*f,f=0),l=0===f?c:f,"deltaY"in s&&(l=f=-1*s.deltaY),"deltaX"in s&&(c=s.deltaX,0===f&&(l=-1*c)),0!==f||0!==c){if(1===s.deltaMode){var g=t.data(this,"mousewheel-line-height");l*=g,f*=g,c*=g}else if(2===s.deltaMode){var x=t.data(this,"mousewheel-page-height");l*=x,f*=x,c*=x}if(d=Math.max(Math.abs(f),Math.abs(c)),(!i||d<i)&&(i=d,u(s,d)&&(i/=40)),u(s,d)&&(l/=40,c/=40,f/=40),l=Math[l>=1?"floor":"ceil"](l/i),c=Math[c>=1?"floor":"ceil"](c/i),f=Math[f>=1?"floor":"ceil"](f/i),a.settings.normalizeOffset&&this.getBoundingClientRect){var _=this.getBoundingClientRect();m=n.clientX-_.left,p=n.clientY-_.top}return n.deltaX=c,n.deltaY=f,n.deltaFactor=i,n.offsetX=m,n.offsetY=p,n.deltaMode=0,o.unshift(n,l,c,f),e&&clearTimeout(e),e=setTimeout(h,200),(t.event.dispatch||t.event.handle).apply(this,o)}}function h(){i=null}function u(t,e){return a.settings.adjustOldDeltas&&"mousewheel"===t.type&&e%120==0}t.fn.extend({mousewheel:function(t){return t?this.bind("mousewheel",t):this.trigger("mousewheel")},unmousewheel:function(t){return this.unbind("mousewheel",t)}})}(e.lib.jQuery),function(t){var e=1e-6,i={};!function(){if("undefined"!=typeof Float32Array){var t=new Float32Array(1),e=new Int32Array(t.buffer);i.invsqrt=function(i){var n=.5*i;t[0]=i;e[0]=1597463007-(e[0]>>1);var s=t[0];return s*(1.5-n*s*s)}}else i.invsqrt=function(t){return 1/Math.sqrt(t)}}();var n=null;function s(){return n="undefined"!=typeof Float32Array?Float32Array:Array}s();var r={create:function(t){var e=new n(3);return t?(e[0]=t[0],e[1]=t[1],e[2]=t[2]):e[0]=e[1]=e[2]=0,e},createFrom:function(t,e,i){var s=new n(3);return s[0]=t,s[1]=e,s[2]=i,s},set:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},equal:function(t,i){return t===i||Math.abs(t[0]-i[0])<e&&Math.abs(t[1]-i[1])<e&&Math.abs(t[2]-i[2])<e},add:function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t)},subtract:function(t,e,i){return i&&t!==i?(i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i):(t[0]-=e[0],t[1]-=e[1],t[2]-=e[2],t)},multiply:function(t,e,i){return i&&t!==i?(i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i):(t[0]*=e[0],t[1]*=e[1],t[2]*=e[2],t)},negate:function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e},scale:function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t)},normalize:function(t,e){e||(e=t);var i=t[0],n=t[1],s=t[2],r=Math.sqrt(i*i+n*n+s*s);return r?1===r?(e[0]=i,e[1]=n,e[2]=s,e):(r=1/r,e[0]=i*r,e[1]=n*r,e[2]=s*r,e):(e[0]=0,e[1]=0,e[2]=0,e)},cross:function(t,e,i){i||(i=t);var n=t[0],s=t[1],r=t[2],o=e[0],a=e[1],l=e[2];return i[0]=s*l-r*a,i[1]=r*o-n*l,i[2]=n*a-s*o,i},length:function(t){var e=t[0],i=t[1],n=t[2];return Math.sqrt(e*e+i*i+n*n)},squaredLength:function(t){var e=t[0],i=t[1],n=t[2];return e*e+i*i+n*n},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},direction:function(t,e,i){i||(i=t);var n=t[0]-e[0],s=t[1]-e[1],r=t[2]-e[2],o=Math.sqrt(n*n+s*s+r*r);return o?(o=1/o,i[0]=n*o,i[1]=s*o,i[2]=r*o,i):(i[0]=0,i[1]=0,i[2]=0,i)},lerp:function(t,e,i,n){return n||(n=t),n[0]=t[0]+i*(e[0]-t[0]),n[1]=t[1]+i*(e[1]-t[1]),n[2]=t[2]+i*(e[2]-t[2]),n},dist:function(t,e){var i=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return Math.sqrt(i*i+n*n+s*s)}},o=null,a=new n(4);r.unproject=function(t,e,i,n,s){s||(s=t),o||(o=m.create());var r=o,l=a;return l[0]=2*(t[0]-n[0])/n[2]-1,l[1]=2*(t[1]-n[1])/n[3]-1,l[2]=2*t[2]-1,l[3]=1,m.multiply(i,e,r),m.inverse(r)?(m.multiplyVec4(r,l),0===l[3]?null:(s[0]=l[0]/l[3],s[1]=l[1]/l[3],s[2]=l[2]/l[3],s)):null};var l=r.createFrom(1,0,0),h=r.createFrom(0,1,0),u=r.createFrom(0,0,1),c=r.create();r.rotationTo=function(t,e,i){i||(i=p.create());var n=r.dot(t,e),s=c;if(n>=1)p.set(g,i);else if(n<-.999999)r.cross(l,t,s),r.length(s)<1e-6&&r.cross(h,t,s),r.length(s)<1e-6&&r.cross(u,t,s),r.normalize(s),p.fromAngleAxis(Math.PI,s,i);else{var o=Math.sqrt(2*(1+n)),a=1/o;r.cross(t,e,s),i[0]=s[0]*a,i[1]=s[1]*a,i[2]=s[2]*a,i[3]=.5*o,p.normalize(i)}return i[3]>1?i[3]=1:i[3]<-1&&(i[3]=-1),i},r.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+"]"};var f,d={create:function(t){var e=new n(9);return t?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]):e[0]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=0,e},createFrom:function(t,e,i,s,r,o,a,l,h){var u=new n(9);return u[0]=t,u[1]=e,u[2]=i,u[3]=s,u[4]=r,u[5]=o,u[6]=a,u[7]=l,u[8]=h,u},determinant:function(t){var e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],l=t[7],h=t[8];return e*(h*r-o*l)+i*(-h*s+o*a)+n*(l*s-r*a)},inverse:function(t,e){var i,n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],f=c*a-l*u,m=-c*o+l*h,p=u*o-a*h,g=n*f+s*m+r*p;return g?(i=1/g,e||(e=d.create()),e[0]=f*i,e[1]=(-c*s+r*u)*i,e[2]=(l*s-r*a)*i,e[3]=m*i,e[4]=(c*n-r*h)*i,e[5]=(-l*n+r*o)*i,e[6]=p*i,e[7]=(-u*n+s*h)*i,e[8]=(a*n-s*o)*i,e):null},multiply:function(t,e,i){i||(i=t);var n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],f=e[0],d=e[1],m=e[2],p=e[3],g=e[4],x=e[5],_=e[6],b=e[7],y=e[8];return i[0]=f*n+d*o+m*h,i[1]=f*s+d*a+m*u,i[2]=f*r+d*l+m*c,i[3]=p*n+g*o+x*h,i[4]=p*s+g*a+x*u,i[5]=p*r+g*l+x*c,i[6]=_*n+b*o+y*h,i[7]=_*s+b*a+y*u,i[8]=_*r+b*l+y*c,i},multiplyVec2:function(t,e,i){i||(i=e);var n=e[0],s=e[1];return i[0]=n*t[0]+s*t[3]+t[6],i[1]=n*t[1]+s*t[4]+t[7],i},multiplyVec3:function(t,e,i){i||(i=e);var n=e[0],s=e[1],r=e[2];return i[0]=n*t[0]+s*t[3]+r*t[6],i[1]=n*t[1]+s*t[4]+r*t[7],i[2]=n*t[2]+s*t[5]+r*t[8],i},set:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},equal:function(t,i){return t===i||Math.abs(t[0]-i[0])<e&&Math.abs(t[1]-i[1])<e&&Math.abs(t[2]-i[2])<e&&Math.abs(t[3]-i[3])<e&&Math.abs(t[4]-i[4])<e&&Math.abs(t[5]-i[5])<e&&Math.abs(t[6]-i[6])<e&&Math.abs(t[7]-i[7])<e&&Math.abs(t[8]-i[8])<e},identity:function(t){return t||(t=d.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(!e||t===e){var i=t[1],n=t[2],s=t[5];return t[1]=t[3],t[2]=t[6],t[3]=i,t[5]=t[7],t[6]=n,t[7]=s,t}return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],e},toMat4:function(t,e){return e||(e=m.create()),e[15]=1,e[14]=0,e[13]=0,e[12]=0,e[11]=0,e[10]=t[8],e[9]=t[7],e[8]=t[6],e[7]=0,e[6]=t[5],e[5]=t[4],e[4]=t[3],e[3]=0,e[2]=t[2],e[1]=t[1],e[0]=t[0],e},str:function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+"]"}},m={create:function(t){var e=new n(16);return t&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e},createFrom:function(t,e,i,s,r,o,a,l,h,u,c,f,d,m,p,g){var x=new n(16);return x[0]=t,x[1]=e,x[2]=i,x[3]=s,x[4]=r,x[5]=o,x[6]=a,x[7]=l,x[8]=h,x[9]=u,x[10]=c,x[11]=f,x[12]=d,x[13]=m,x[14]=p,x[15]=g,x},set:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},equal:function(t,i){return t===i||Math.abs(t[0]-i[0])<e&&Math.abs(t[1]-i[1])<e&&Math.abs(t[2]-i[2])<e&&Math.abs(t[3]-i[3])<e&&Math.abs(t[4]-i[4])<e&&Math.abs(t[5]-i[5])<e&&Math.abs(t[6]-i[6])<e&&Math.abs(t[7]-i[7])<e&&Math.abs(t[8]-i[8])<e&&Math.abs(t[9]-i[9])<e&&Math.abs(t[10]-i[10])<e&&Math.abs(t[11]-i[11])<e&&Math.abs(t[12]-i[12])<e&&Math.abs(t[13]-i[13])<e&&Math.abs(t[14]-i[14])<e&&Math.abs(t[15]-i[15])<e},identity:function(t){return t||(t=m.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},transpose:function(t,e){if(!e||t===e){var i=t[1],n=t[2],s=t[3],r=t[6],o=t[7],a=t[11];return t[1]=t[4],t[2]=t[8],t[3]=t[12],t[4]=i,t[6]=t[9],t[7]=t[13],t[8]=n,t[9]=r,t[11]=t[14],t[12]=s,t[13]=o,t[14]=a,t}return e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15],e},determinant:function(t){var e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],l=t[7],h=t[8],u=t[9],c=t[10],f=t[11],d=t[12],m=t[13],p=t[14],g=t[15];return d*u*a*s-h*m*a*s-d*o*c*s+r*m*c*s+h*o*p*s-r*u*p*s-d*u*n*l+h*m*n*l+d*i*c*l-e*m*c*l-h*i*p*l+e*u*p*l+d*o*n*f-r*m*n*f-d*i*a*f+e*m*a*f+r*i*p*f-e*o*p*f-h*o*n*g+r*u*n*g+h*i*a*g-e*u*a*g-r*i*c*g+e*o*c*g},inverse:function(t,e){e||(e=t);var i,n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],f=t[9],d=t[10],m=t[11],p=t[12],g=t[13],x=t[14],_=t[15],b=n*l-s*a,y=n*h-r*a,v=n*u-o*a,w=s*h-r*l,T=s*u-o*l,S=r*u-o*h,D=c*g-f*p,E=c*x-d*p,C=c*_-m*p,A=f*x-d*g,F=f*_-m*g,R=d*_-m*x,P=b*R-y*F+v*A+w*C-T*E+S*D;return P?(i=1/P,e[0]=(l*R-h*F+u*A)*i,e[1]=(-s*R+r*F-o*A)*i,e[2]=(g*S-x*T+_*w)*i,e[3]=(-f*S+d*T-m*w)*i,e[4]=(-a*R+h*C-u*E)*i,e[5]=(n*R-r*C+o*E)*i,e[6]=(-p*S+x*v-_*y)*i,e[7]=(c*S-d*v+m*y)*i,e[8]=(a*F-l*C+u*D)*i,e[9]=(-n*F+s*C-o*D)*i,e[10]=(p*T-g*v+_*b)*i,e[11]=(-c*T+f*v-m*b)*i,e[12]=(-a*A+l*E-h*D)*i,e[13]=(n*A-s*E+r*D)*i,e[14]=(-p*w+g*y-x*b)*i,e[15]=(c*w-f*y+d*b)*i,e):null},toRotationMat:function(t,e){return e||(e=m.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},toMat3:function(t,e){return e||(e=d.create()),e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},toInverseMat3:function(t,e){var i,n=t[0],s=t[1],r=t[2],o=t[4],a=t[5],l=t[6],h=t[8],u=t[9],c=t[10],f=c*a-l*u,m=-c*o+l*h,p=u*o-a*h,g=n*f+s*m+r*p;return g?(i=1/g,e||(e=d.create()),e[0]=f*i,e[1]=(-c*s+r*u)*i,e[2]=(l*s-r*a)*i,e[3]=m*i,e[4]=(c*n-r*h)*i,e[5]=(-l*n+r*o)*i,e[6]=p*i,e[7]=(-u*n+s*h)*i,e[8]=(a*n-s*o)*i,e):null},multiply:function(t,e,i){i||(i=t);var n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],f=t[9],d=t[10],m=t[11],p=t[12],g=t[13],x=t[14],_=t[15],b=e[0],y=e[1],v=e[2],w=e[3];return i[0]=b*n+y*a+v*c+w*p,i[1]=b*s+y*l+v*f+w*g,i[2]=b*r+y*h+v*d+w*x,i[3]=b*o+y*u+v*m+w*_,b=e[4],y=e[5],v=e[6],w=e[7],i[4]=b*n+y*a+v*c+w*p,i[5]=b*s+y*l+v*f+w*g,i[6]=b*r+y*h+v*d+w*x,i[7]=b*o+y*u+v*m+w*_,b=e[8],y=e[9],v=e[10],w=e[11],i[8]=b*n+y*a+v*c+w*p,i[9]=b*s+y*l+v*f+w*g,i[10]=b*r+y*h+v*d+w*x,i[11]=b*o+y*u+v*m+w*_,b=e[12],y=e[13],v=e[14],w=e[15],i[12]=b*n+y*a+v*c+w*p,i[13]=b*s+y*l+v*f+w*g,i[14]=b*r+y*h+v*d+w*x,i[15]=b*o+y*u+v*m+w*_,i},multiplyVec3:function(t,e,i){i||(i=e);var n=e[0],s=e[1],r=e[2];return i[0]=t[0]*n+t[4]*s+t[8]*r+t[12],i[1]=t[1]*n+t[5]*s+t[9]*r+t[13],i[2]=t[2]*n+t[6]*s+t[10]*r+t[14],i},multiplyVec4:function(t,e,i){i||(i=e);var n=e[0],s=e[1],r=e[2],o=e[3];return i[0]=t[0]*n+t[4]*s+t[8]*r+t[12]*o,i[1]=t[1]*n+t[5]*s+t[9]*r+t[13]*o,i[2]=t[2]*n+t[6]*s+t[10]*r+t[14]*o,i[3]=t[3]*n+t[7]*s+t[11]*r+t[15]*o,i},translate:function(t,e,i){var n,s,r,o,a,l,h,u,c,f,d,m,p=e[0],g=e[1],x=e[2];return i&&t!==i?(n=t[0],s=t[1],r=t[2],o=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],f=t[9],d=t[10],m=t[11],i[0]=n,i[1]=s,i[2]=r,i[3]=o,i[4]=a,i[5]=l,i[6]=h,i[7]=u,i[8]=c,i[9]=f,i[10]=d,i[11]=m,i[12]=n*p+a*g+c*x+t[12],i[13]=s*p+l*g+f*x+t[13],i[14]=r*p+h*g+d*x+t[14],i[15]=o*p+u*g+m*x+t[15],i):(t[12]=t[0]*p+t[4]*g+t[8]*x+t[12],t[13]=t[1]*p+t[5]*g+t[9]*x+t[13],t[14]=t[2]*p+t[6]*g+t[10]*x+t[14],t[15]=t[3]*p+t[7]*g+t[11]*x+t[15],t)},scale:function(t,e,i){var n=e[0],s=e[1],r=e[2];return i&&t!==i?(i[0]=t[0]*n,i[1]=t[1]*n,i[2]=t[2]*n,i[3]=t[3]*n,i[4]=t[4]*s,i[5]=t[5]*s,i[6]=t[6]*s,i[7]=t[7]*s,i[8]=t[8]*r,i[9]=t[9]*r,i[10]=t[10]*r,i[11]=t[11]*r,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i):(t[0]*=n,t[1]*=n,t[2]*=n,t[3]*=n,t[4]*=s,t[5]*=s,t[6]*=s,t[7]*=s,t[8]*=r,t[9]*=r,t[10]*=r,t[11]*=r,t)},rotate:function(t,e,i,n){var s,r,o,a,l,h,u,c,f,d,m,p,g,x,_,b,y,v,w,T,S,D,E,C,A=i[0],F=i[1],R=i[2],P=Math.sqrt(A*A+F*F+R*R);return P?(1!==P&&(A*=P=1/P,F*=P,R*=P),s=Math.sin(e),o=1-(r=Math.cos(e)),a=t[0],l=t[1],h=t[2],u=t[3],c=t[4],f=t[5],d=t[6],m=t[7],p=t[8],g=t[9],x=t[10],_=t[11],b=A*A*o+r,y=F*A*o+R*s,v=R*A*o-F*s,w=A*F*o-R*s,T=F*F*o+r,S=R*F*o+A*s,D=A*R*o+F*s,E=F*R*o-A*s,C=R*R*o+r,n?t!==n&&(n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15]):n=t,n[0]=a*b+c*y+p*v,n[1]=l*b+f*y+g*v,n[2]=h*b+d*y+x*v,n[3]=u*b+m*y+_*v,n[4]=a*w+c*T+p*S,n[5]=l*w+f*T+g*S,n[6]=h*w+d*T+x*S,n[7]=u*w+m*T+_*S,n[8]=a*D+c*E+p*C,n[9]=l*D+f*E+g*C,n[10]=h*D+d*E+x*C,n[11]=u*D+m*E+_*C,n):null},rotateX:function(t,e,i){var n=Math.sin(e),s=Math.cos(e),r=t[4],o=t[5],a=t[6],l=t[7],h=t[8],u=t[9],c=t[10],f=t[11];return i?t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[4]=r*s+h*n,i[5]=o*s+u*n,i[6]=a*s+c*n,i[7]=l*s+f*n,i[8]=r*-n+h*s,i[9]=o*-n+u*s,i[10]=a*-n+c*s,i[11]=l*-n+f*s,i},rotateY:function(t,e,i){var n=Math.sin(e),s=Math.cos(e),r=t[0],o=t[1],a=t[2],l=t[3],h=t[8],u=t[9],c=t[10],f=t[11];return i?t!==i&&(i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=r*s+h*-n,i[1]=o*s+u*-n,i[2]=a*s+c*-n,i[3]=l*s+f*-n,i[8]=r*n+h*s,i[9]=o*n+u*s,i[10]=a*n+c*s,i[11]=l*n+f*s,i},rotateZ:function(t,e,i){var n=Math.sin(e),s=Math.cos(e),r=t[0],o=t[1],a=t[2],l=t[3],h=t[4],u=t[5],c=t[6],f=t[7];return i?t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]):i=t,i[0]=r*s+h*n,i[1]=o*s+u*n,i[2]=a*s+c*n,i[3]=l*s+f*n,i[4]=r*-n+h*s,i[5]=o*-n+u*s,i[6]=a*-n+c*s,i[7]=l*-n+f*s,i},frustum:function(t,e,i,n,s,r,o){o||(o=m.create());var a=e-t,l=n-i,h=r-s;return o[0]=2*s/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2*s/l,o[6]=0,o[7]=0,o[8]=(e+t)/a,o[9]=(n+i)/l,o[10]=-(r+s)/h,o[11]=-1,o[12]=0,o[13]=0,o[14]=-r*s*2/h,o[15]=0,o},perspective:function(t,e,i,n,s){var r=i*Math.tan(t*Math.PI/360),o=r*e;return m.frustum(-o,o,-r,r,i,n,s)},ortho:function(t,e,i,n,s,r,o){o||(o=m.create());var a=e-t,l=n-i,h=r-s;return o[0]=2/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=2/l,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=-2/h,o[11]=0,o[12]=-(t+e)/a,o[13]=-(n+i)/l,o[14]=-(r+s)/h,o[15]=1,o},lookAt:function(t,e,i,n){n||(n=m.create());var s,r,o,a,l,h,u,c,f,d,p=t[0],g=t[1],x=t[2],_=i[0],b=i[1],y=i[2],v=e[0],w=e[1],T=e[2];return p===v&&g===w&&x===T?m.identity(n):(u=p-v,c=g-w,f=x-T,s=b*(f*=d=1/Math.sqrt(u*u+c*c+f*f))-y*(c*=d),r=y*(u*=d)-_*f,o=_*c-b*u,(d=Math.sqrt(s*s+r*r+o*o))?(s*=d=1/d,r*=d,o*=d):(s=0,r=0,o=0),a=c*o-f*r,l=f*s-u*o,h=u*r-c*s,(d=Math.sqrt(a*a+l*l+h*h))?(a*=d=1/d,l*=d,h*=d):(a=0,l=0,h=0),n[0]=s,n[1]=a,n[2]=u,n[3]=0,n[4]=r,n[5]=l,n[6]=c,n[7]=0,n[8]=o,n[9]=h,n[10]=f,n[11]=0,n[12]=-(s*p+r*g+o*x),n[13]=-(a*p+l*g+h*x),n[14]=-(u*p+c*g+f*x),n[15]=1,n)},fromRotationTranslation:function(t,e,i){i||(i=m.create());var n=t[0],s=t[1],r=t[2],o=t[3],a=n+n,l=s+s,h=r+r,u=n*a,c=n*l,f=n*h,d=s*l,p=s*h,g=r*h,x=o*a,_=o*l,b=o*h;return i[0]=1-(d+g),i[1]=c+b,i[2]=f-_,i[3]=0,i[4]=c-b,i[5]=1-(u+g),i[6]=p+x,i[7]=0,i[8]=f+_,i[9]=p-x,i[10]=1-(u+d),i[11]=0,i[12]=e[0],i[13]=e[1],i[14]=e[2],i[15]=1,i},str:function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+"]"}},p={create:function(t){var e=new n(4);return t?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):e[0]=e[1]=e[2]=e[3]=0,e},createFrom:function(t,e,i,s){var r=new n(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=s,r},set:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},equal:function(t,i){return t===i||Math.abs(t[0]-i[0])<e&&Math.abs(t[1]-i[1])<e&&Math.abs(t[2]-i[2])<e&&Math.abs(t[3]-i[3])<e},identity:function(t){return t||(t=p.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}},g=p.identity();p.calculateW=function(t,e){var i=t[0],n=t[1],s=t[2];return e&&t!==e?(e[0]=i,e[1]=n,e[2]=s,e[3]=-Math.sqrt(Math.abs(1-i*i-n*n-s*s)),e):(t[3]=-Math.sqrt(Math.abs(1-i*i-n*n-s*s)),t)},p.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},p.inverse=function(t,e){var i=t[0],n=t[1],s=t[2],r=t[3],o=i*i+n*n+s*s+r*r,a=o?1/o:0;return e&&t!==e?(e[0]=-t[0]*a,e[1]=-t[1]*a,e[2]=-t[2]*a,e[3]=t[3]*a,e):(t[0]*=-a,t[1]*=-a,t[2]*=-a,t[3]*=a,t)},p.conjugate=function(t,e){return e&&t!==e?(e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e):(t[0]*=-1,t[1]*=-1,t[2]*=-1,t)},p.length=function(t){var e=t[0],i=t[1],n=t[2],s=t[3];return Math.sqrt(e*e+i*i+n*n+s*s)},p.normalize=function(t,e){e||(e=t);var i=t[0],n=t[1],s=t[2],r=t[3],o=Math.sqrt(i*i+n*n+s*s+r*r);return 0===o?(e[0]=0,e[1]=0,e[2]=0,e[3]=0,e):(o=1/o,e[0]=i*o,e[1]=n*o,e[2]=s*o,e[3]=r*o,e)},p.add=function(t,e,i){return i&&t!==i?(i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i):(t[0]+=e[0],t[1]+=e[1],t[2]+=e[2],t[3]+=e[3],t)},p.multiply=function(t,e,i){i||(i=t);var n=t[0],s=t[1],r=t[2],o=t[3],a=e[0],l=e[1],h=e[2],u=e[3];return i[0]=n*u+o*a+s*h-r*l,i[1]=s*u+o*l+r*a-n*h,i[2]=r*u+o*h+n*l-s*a,i[3]=o*u-n*a-s*l-r*h,i},p.multiplyVec3=function(t,e,i){i||(i=e);var n=e[0],s=e[1],r=e[2],o=t[0],a=t[1],l=t[2],h=t[3],u=h*n+a*r-l*s,c=h*s+l*n-o*r,f=h*r+o*s-a*n,d=-o*n-a*s-l*r;return i[0]=u*h+d*-o+c*-l-f*-a,i[1]=c*h+d*-a+f*-o-u*-l,i[2]=f*h+d*-l+u*-a-c*-o,i},p.scale=function(t,e,i){return i&&t!==i?(i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i):(t[0]*=e,t[1]*=e,t[2]*=e,t[3]*=e,t)},p.toMat3=function(t,e){e||(e=d.create());var i=t[0],n=t[1],s=t[2],r=t[3],o=i+i,a=n+n,l=s+s,h=i*o,u=i*a,c=i*l,f=n*a,m=n*l,p=s*l,g=r*o,x=r*a,_=r*l;return e[0]=1-(f+p),e[1]=u+_,e[2]=c-x,e[3]=u-_,e[4]=1-(h+p),e[5]=m+g,e[6]=c+x,e[7]=m-g,e[8]=1-(h+f),e},p.toMat4=function(t,e){e||(e=m.create());var i=t[0],n=t[1],s=t[2],r=t[3],o=i+i,a=n+n,l=s+s,h=i*o,u=i*a,c=i*l,f=n*a,d=n*l,p=s*l,g=r*o,x=r*a,_=r*l;return e[0]=1-(f+p),e[1]=u+_,e[2]=c-x,e[3]=0,e[4]=u-_,e[5]=1-(h+p),e[6]=d+g,e[7]=0,e[8]=c+x,e[9]=d-g,e[10]=1-(h+f),e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},p.slerp=function(t,e,i,n){n||(n=t);var s,r,o,a,l=t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3];return Math.abs(l)>=1?(n!==t&&(n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3]),n):(s=Math.acos(l),r=Math.sqrt(1-l*l),Math.abs(r)<.001?(n[0]=.5*t[0]+.5*e[0],n[1]=.5*t[1]+.5*e[1],n[2]=.5*t[2]+.5*e[2],n[3]=.5*t[3]+.5*e[3],n):(o=Math.sin((1-i)*s)/r,a=Math.sin(i*s)/r,n[0]=t[0]*o+e[0]*a,n[1]=t[1]*o+e[1]*a,n[2]=t[2]*o+e[2]*a,n[3]=t[3]*o+e[3]*a,n))},p.fromRotationMatrix=function(t,e){e||(e=p.create());var i,n=t[0]+t[4]+t[8];if(n>0)i=Math.sqrt(n+1),e[3]=.5*i,i=.5/i,e[0]=(t[7]-t[5])*i,e[1]=(t[2]-t[6])*i,e[2]=(t[3]-t[1])*i;else{var s=p.fromRotationMatrix.s_iNext=p.fromRotationMatrix.s_iNext||[1,2,0],r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);var o=s[r],a=s[o];i=Math.sqrt(t[3*r+r]-t[3*o+o]-t[3*a+a]+1),e[r]=.5*i,i=.5/i,e[3]=(t[3*a+o]-t[3*o+a])*i,e[o]=(t[3*o+r]+t[3*r+o])*i,e[a]=(t[3*a+r]+t[3*r+a])*i}return e},d.toQuat4=p.fromRotationMatrix,f=d.create(),p.fromAxes=function(t,e,i,n){return f[0]=e[0],f[3]=e[1],f[6]=e[2],f[1]=i[0],f[4]=i[1],f[7]=i[2],f[2]=t[0],f[5]=t[1],f[8]=t[2],p.fromRotationMatrix(f,n)},p.identity=function(t){return t||(t=p.create()),t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},p.fromAngleAxis=function(t,e,i){i||(i=p.create());var n=.5*t,s=Math.sin(n);return i[3]=Math.cos(n),i[0]=s*e[0],i[1]=s*e[1],i[2]=s*e[2],i},p.toAngleAxis=function(t,e){e||(e=t);var n=t[0]*t[0]+t[1]*t[1]+t[2]*t[2];if(n>0){e[3]=2*Math.acos(t[3]);var s=i.invsqrt(n);e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s}else e[3]=0,e[0]=1,e[1]=0,e[2]=0;return e},p.str=function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"};var x={create:function(t){var e=new n(2);return t?(e[0]=t[0],e[1]=t[1]):(e[0]=0,e[1]=0),e},createFrom:function(t,e){var i=new n(2);return i[0]=t,i[1]=e,i},add:function(t,e,i){return i||(i=e),i[0]=t[0]+e[0],i[1]=t[1]+e[1],i},subtract:function(t,e,i){return i||(i=e),i[0]=t[0]-e[0],i[1]=t[1]-e[1],i},multiply:function(t,e,i){return i||(i=e),i[0]=t[0]*e[0],i[1]=t[1]*e[1],i},divide:function(t,e,i){return i||(i=e),i[0]=t[0]/e[0],i[1]=t[1]/e[1],i},scale:function(t,e,i){return i||(i=t),i[0]=t[0]*e,i[1]=t[1]*e,i},dist:function(t,e){var i=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(i*i+n*n)},set:function(t,e){return e[0]=t[0],e[1]=t[1],e},equal:function(t,i){return t===i||Math.abs(t[0]-i[0])<e&&Math.abs(t[1]-i[1])<e},negate:function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e},normalize:function(t,e){e||(e=t);var i=t[0]*t[0]+t[1]*t[1];return i>0?(i=Math.sqrt(i),e[0]=t[0]/i,e[1]=t[1]/i):e[0]=e[1]=0,e},cross:function(t,e,i){var n=t[0]*e[1]-t[1]*e[0];return i?(i[0]=i[1]=0,i[2]=n,i):n},length:function(t){var e=t[0],i=t[1];return Math.sqrt(e*e+i*i)},squaredLength:function(t){var e=t[0],i=t[1];return e*e+i*i},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},direction:function(t,e,i){i||(i=t);var n=t[0]-e[0],s=t[1]-e[1],r=n*n+s*s;return r?(r=1/Math.sqrt(r),i[0]=n*r,i[1]=s*r,i):(i[0]=0,i[1]=0,i[2]=0,i)},lerp:function(t,e,i,n){return n||(n=t),n[0]=t[0]+i*(e[0]-t[0]),n[1]=t[1]+i*(e[1]-t[1]),n},str:function(t){return"["+t[0]+", "+t[1]+"]"}},_={create:function(t){var e=new n(4);return t?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):e[0]=e[1]=e[2]=e[3]=0,e},createFrom:function(t,e,i,s){var r=new n(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=s,r},set:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},equal:function(t,i){return t===i||Math.abs(t[0]-i[0])<e&&Math.abs(t[1]-i[1])<e&&Math.abs(t[2]-i[2])<e&&Math.abs(t[3]-i[3])<e},identity:function(t){return t||(t=_.create()),t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},transpose:function(t,e){if(!e||t===e){var i=t[1];return t[1]=t[2],t[2]=i,t}return e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3],e},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},inverse:function(t,e){e||(e=t);var i=t[0],n=t[1],s=t[2],r=t[3],o=i*r-s*n;return o?(o=1/o,e[0]=r*o,e[1]=-n*o,e[2]=-s*o,e[3]=i*o,e):null},multiply:function(t,e,i){i||(i=t);var n=t[0],s=t[1],r=t[2],o=t[3];return i[0]=n*e[0]+s*e[2],i[1]=n*e[1]+s*e[3],i[2]=r*e[0]+o*e[2],i[3]=r*e[1]+o*e[3],i},rotate:function(t,e,i){i||(i=t);var n=t[0],s=t[1],r=t[2],o=t[3],a=Math.sin(e),l=Math.cos(e);return i[0]=n*l+s*a,i[1]=n*-a+s*l,i[2]=r*l+o*a,i[3]=r*-a+o*l,i},multiplyVec2:function(t,e,i){i||(i=e);var n=e[0],s=e[1];return i[0]=n*t[0]+s*t[1],i[1]=n*t[2]+s*t[3],i},scale:function(t,e,i){i||(i=t);var n=t[0],s=t[1],r=t[2],o=t[3],a=e[0],l=e[1];return i[0]=n*a,i[1]=s*l,i[2]=r*a,i[3]=o*l,i},str:function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"}},b={create:function(t){var e=new n(4);return t?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]):(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e},createFrom:function(t,e,i,s){var r=new n(4);return r[0]=t,r[1]=e,r[2]=i,r[3]=s,r},add:function(t,e,i){return i||(i=e),i[0]=t[0]+e[0],i[1]=t[1]+e[1],i[2]=t[2]+e[2],i[3]=t[3]+e[3],i},subtract:function(t,e,i){return i||(i=e),i[0]=t[0]-e[0],i[1]=t[1]-e[1],i[2]=t[2]-e[2],i[3]=t[3]-e[3],i},multiply:function(t,e,i){return i||(i=e),i[0]=t[0]*e[0],i[1]=t[1]*e[1],i[2]=t[2]*e[2],i[3]=t[3]*e[3],i},divide:function(t,e,i){return i||(i=e),i[0]=t[0]/e[0],i[1]=t[1]/e[1],i[2]=t[2]/e[2],i[3]=t[3]/e[3],i},scale:function(t,e,i){return i||(i=t),i[0]=t[0]*e,i[1]=t[1]*e,i[2]=t[2]*e,i[3]=t[3]*e,i},set:function(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},equal:function(t,i){return t===i||Math.abs(t[0]-i[0])<e&&Math.abs(t[1]-i[1])<e&&Math.abs(t[2]-i[2])<e&&Math.abs(t[3]-i[3])<e},negate:function(t,e){return e||(e=t),e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e},length:function(t){var e=t[0],i=t[1],n=t[2],s=t[3];return Math.sqrt(e*e+i*i+n*n+s*s)},squaredLength:function(t){var e=t[0],i=t[1],n=t[2],s=t[3];return e*e+i*i+n*n+s*s},lerp:function(t,e,i,n){return n||(n=t),n[0]=t[0]+i*(e[0]-t[0]),n[1]=t[1]+i*(e[1]-t[1]),n[2]=t[2]+i*(e[2]-t[2]),n[3]=t[3]+i*(e[3]-t[3]),n},str:function(t){return"["+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+"]"}};t&&(t.glMatrixArrayType=n,t.MatrixArray=n,t.setMatrixArrayType=function(t){return n=t},t.determineMatrixArrayType=s,t.glMath=i,t.vec2=x,t.vec3=r,t.vec4=b,t.mat2=_,t.mat3=d,t.mat4=m,t.quat4=p)}(e.lib),function(t){function i(t){return 0==t?0:t>0?1:-1}var n=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},s=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},r=function(t,e){return{x:t.x*e,y:t.y*e}},o=Math.pow(2,-65),a=function(t,e){for(var i=[],r=l(t,e),o=e.length-1,a=h(r,2*o-1,i,0),u=n(t,e[0]),c=s(u),f=0,m=0;m<a;m++){u=n(t,d(e,o,i[m],null,null));var p=s(u);p<c&&(c=p,f=i[m])}return u=n(t,e[o]),(p=s(u))<c&&(c=p,f=1),{location:f,distance:c}},l=function(t,e){for(var i=e.length-1,s=2*i-1,o=[],a=[],l=[],h=[],u=[[1,.6,.3,.1],[.4,.6,.6,.4],[.1,.3,.6,1]],c=0;c<=i;c++)o[c]=n(e[c],t);for(c=0;c<=i-1;c++)a[c]=n(e[c+1],e[c]),a[c]=r(a[c],3);for(var f=0;f<=i-1;f++)for(var d=0;d<=i;d++)l[f]||(l[f]=[]),l[f][d]=(m=a[f],p=o[d],m.x*p.x+m.y*p.y);var m,p;for(c=0;c<=s;c++)h[c]||(h[c]=[]),h[c].y=0,h[c].x=parseFloat(c)/s;for(var g=i,x=i-1,_=0;_<=g+x;_++){var b=Math.max(0,_-x),y=Math.min(_,g);for(c=b;c<=y;c++){var v=_-c;h[c+v].y+=l[v][c]*u[v][c]}}return h},h=function(t,e,i,n){var s,r,o=[],a=[],l=[],m=[];switch(u(t,e)){case 0:return 0;case 1:if(n>=64)return i[0]=(t[0].x+t[e].x)/2,1;if(c(t,e))return i[0]=f(t,e),1}d(t,e,.5,o,a),s=h(o,e,l,n+1),r=h(a,e,m,n+1);for(var p=0;p<s;p++)i[p]=l[p];for(p=0;p<r;p++)i[p+s]=m[p];return s+r},u=function(t,e){var n,s,r=0;n=s=i(t[0].y);for(var o=1;o<=e;o++)(n=i(t[o].y))!=s&&r++,s=n;return r},c=function(t,e){var i,n,s,r,a,l,h;r=t[0].y-t[e].y,a=t[e].x-t[0].x,l=t[0].x*t[e].y-t[e].x*t[0].y;for(var u=0,c=0,f=1;f<e;f++){var d=r*t[f].x+a*t[f].y+l;d>u?u=d:d<c&&(c=d)}return i=(1*(l-u)-0*(h=a))*(1/(0*h-1*r)),n=(1*(l-c)-0*(h=a))*(1/(0*h-1*r)),s=Math.min(i,n),Math.max(i,n)-s<o?1:0},f=function(t,e){var i=t[e].x-t[0].x,n=t[e].y-t[0].y,s=t[0].x-0;return 0+(i*(t[0].y-0)-n*s)*(1/(0*i-1*n))*1},d=function(t,e,i,n,s){for(var r=[[]],o=0;o<=e;o++)r[0][o]=t[o];for(var a=1;a<=e;a++)for(o=0;o<=e-a;o++)r[a]||(r[a]=[]),r[a][o]||(r[a][o]={}),r[a][o].x=(1-i)*r[a-1][o].x+i*r[a-1][o+1].x,r[a][o].y=(1-i)*r[a-1][o].y+i*r[a-1][o+1].y;if(null!=n)for(o=0;o<=e;o++)n[o]=r[o][0];if(null!=s)for(o=0;o<=e;o++)s[o]=r[e-o][o];return r[e][0]},m={},p=function(t,e){for(var i=function(t){var e=m[t];if(!e){var i=function(t){return function(e){return t}},n=function(){return function(t){return t}},s=function(){return function(t){return 1-t}},r=function(t){return function(e){for(var i=1,n=0;n<t.length;n++)i*=t[n](e);return i}};(e=[]).push(new function(){return function(e){return Math.pow(e,t)}});for(var o=1;o<t;o++){for(var a=[new i(t)],l=0;l<t-o;l++)a.push(new n);for(l=0;l<o;l++)a.push(new s);e.push(new r(a))}e.push(new function(){return function(e){return Math.pow(1-e,t)}}),m[t]=e}return e}(t.length-1),n=0,s=0,r=0;r<t.length;r++)n+=t[r].x*i[r](e),s+=t[r].y*i[r](e);return{x:n,y:s}},g=function(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},x=function(t,e,i){for(var n=p(t,e),s=0,r=e,o=i>0?1:-1,a=null;s<Math.abs(i);)a=p(t,r+=.005*o),s+=g(a,n),n=a;return{point:a,location:r}},_=function(t,e){var i=p(t,e),n=p(t.slice(0,t.length-1),e),s=n.y-i.y,r=n.x-i.x;return 0==s?1/0:Math.atan(s/r)};e.lib.jsBezier={distanceFromCurve:a,gradientAtPoint:_,gradientAtPointAlongCurveFrom:function(t,e,i){var n=x(t,e,i);return n.location>1&&(n.location=1),n.location<0&&(n.location=0),_(t,n.location)},nearestPointOnCurve:function(t,e){var i=a(t,e);return{point:d(e,e.length-1,i.location,null,null),location:i.location}},pointOnCurve:p,pointAlongCurveFrom:function(t,e,i){return x(t,e,i).point},perpendicularToCurveAt:function(t,e,i,n){var s=x(t,e,n=null==n?0:n),r=_(t,s.location),o=Math.atan(-1/r),a=i/2*Math.sin(o),l=i/2*Math.cos(o);return[{x:s.point.x+l,y:s.point.y+a},{x:s.point.x-l,y:s.point.y-a}]},locationAlongCurveFrom:function(t,e,i){return x(t,e,i).location},getLength:function(t){for(var e=p(t,0),i=0,n=0,s=null;n<1;)s=p(t,n+=.005),i+=g(s,e),e=s;return i}}}(e.lib),e.lib.MarchingCubes=(n=new Uint32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),r=[[],[0,8,3],[0,1,9],[1,8,3,9,8,1],[1,2,10],[0,8,3,1,2,10],[9,2,10,0,2,9],[2,8,3,2,10,8,10,9,8],[3,11,2],[0,11,2,8,11,0],[1,9,0,2,3,11],[1,11,2,1,9,11,9,8,11],[3,10,1,11,10,3],[0,10,1,0,8,10,8,11,10],[3,9,0,3,11,9,11,10,9],[9,8,10,10,8,11],[4,7,8],[4,3,0,7,3,4],[0,1,9,8,4,7],[4,1,9,4,7,1,7,3,1],[1,2,10,8,4,7],[3,4,7,3,0,4,1,2,10],[9,2,10,9,0,2,8,4,7],[2,10,9,2,9,7,2,7,3,7,9,4],[8,4,7,3,11,2],[11,4,7,11,2,4,2,0,4],[9,0,1,8,4,7,2,3,11],[4,7,11,9,4,11,9,11,2,9,2,1],[3,10,1,3,11,10,7,8,4],[1,11,10,1,4,11,1,0,4,7,11,4],[4,7,8,9,0,11,9,11,10,11,0,3],[4,7,11,4,11,9,9,11,10],[9,5,4],[9,5,4,0,8,3],[0,5,4,1,5,0],[8,5,4,8,3,5,3,1,5],[1,2,10,9,5,4],[3,0,8,1,2,10,4,9,5],[5,2,10,5,4,2,4,0,2],[2,10,5,3,2,5,3,5,4,3,4,8],[9,5,4,2,3,11],[0,11,2,0,8,11,4,9,5],[0,5,4,0,1,5,2,3,11],[2,1,5,2,5,8,2,8,11,4,8,5],[10,3,11,10,1,3,9,5,4],[4,9,5,0,8,1,8,10,1,8,11,10],[5,4,0,5,0,11,5,11,10,11,0,3],[5,4,8,5,8,10,10,8,11],[9,7,8,5,7,9],[9,3,0,9,5,3,5,7,3],[0,7,8,0,1,7,1,5,7],[1,5,3,3,5,7],[9,7,8,9,5,7,10,1,2],[10,1,2,9,5,0,5,3,0,5,7,3],[8,0,2,8,2,5,8,5,7,10,5,2],[2,10,5,2,5,3,3,5,7],[7,9,5,7,8,9,3,11,2],[9,5,7,9,7,2,9,2,0,2,7,11],[2,3,11,0,1,8,1,7,8,1,5,7],[11,2,1,11,1,7,7,1,5],[9,5,8,8,5,7,10,1,3,10,3,11],[5,7,0,5,0,9,7,11,0,1,0,10,11,10,0],[11,10,0,11,0,3,10,5,0,8,0,7,5,7,0],[11,10,5,7,11,5],[10,6,5],[0,8,3,5,10,6],[9,0,1,5,10,6],[1,8,3,1,9,8,5,10,6],[1,6,5,2,6,1],[1,6,5,1,2,6,3,0,8],[9,6,5,9,0,6,0,2,6],[5,9,8,5,8,2,5,2,6,3,2,8],[2,3,11,10,6,5],[11,0,8,11,2,0,10,6,5],[0,1,9,2,3,11,5,10,6],[5,10,6,1,9,2,9,11,2,9,8,11],[6,3,11,6,5,3,5,1,3],[0,8,11,0,11,5,0,5,1,5,11,6],[3,11,6,0,3,6,0,6,5,0,5,9],[6,5,9,6,9,11,11,9,8],[5,10,6,4,7,8],[4,3,0,4,7,3,6,5,10],[1,9,0,5,10,6,8,4,7],[10,6,5,1,9,7,1,7,3,7,9,4],[6,1,2,6,5,1,4,7,8],[1,2,5,5,2,6,3,0,4,3,4,7],[8,4,7,9,0,5,0,6,5,0,2,6],[7,3,9,7,9,4,3,2,9,5,9,6,2,6,9],[3,11,2,7,8,4,10,6,5],[5,10,6,4,7,2,4,2,0,2,7,11],[0,1,9,4,7,8,2,3,11,5,10,6],[9,2,1,9,11,2,9,4,11,7,11,4,5,10,6],[8,4,7,3,11,5,3,5,1,5,11,6],[5,1,11,5,11,6,1,0,11,7,11,4,0,4,11],[0,5,9,0,6,5,0,3,6,11,6,3,8,4,7],[6,5,9,6,9,11,4,7,9,7,11,9],[10,4,9,6,4,10],[4,10,6,4,9,10,0,8,3],[10,0,1,10,6,0,6,4,0],[8,3,1,8,1,6,8,6,4,6,1,10],[1,4,9,1,2,4,2,6,4],[3,0,8,1,2,9,2,4,9,2,6,4],[0,2,4,4,2,6],[8,3,2,8,2,4,4,2,6],[10,4,9,10,6,4,11,2,3],[0,8,2,2,8,11,4,9,10,4,10,6],[3,11,2,0,1,6,0,6,4,6,1,10],[6,4,1,6,1,10,4,8,1,2,1,11,8,11,1],[9,6,4,9,3,6,9,1,3,11,6,3],[8,11,1,8,1,0,11,6,1,9,1,4,6,4,1],[3,11,6,3,6,0,0,6,4],[6,4,8,11,6,8],[7,10,6,7,8,10,8,9,10],[0,7,3,0,10,7,0,9,10,6,7,10],[10,6,7,1,10,7,1,7,8,1,8,0],[10,6,7,10,7,1,1,7,3],[1,2,6,1,6,8,1,8,9,8,6,7],[2,6,9,2,9,1,6,7,9,0,9,3,7,3,9],[7,8,0,7,0,6,6,0,2],[7,3,2,6,7,2],[2,3,11,10,6,8,10,8,9,8,6,7],[2,0,7,2,7,11,0,9,7,6,7,10,9,10,7],[1,8,0,1,7,8,1,10,7,6,7,10,2,3,11],[11,2,1,11,1,7,10,6,1,6,7,1],[8,9,6,8,6,7,9,1,6,11,6,3,1,3,6],[0,9,1,11,6,7],[7,8,0,7,0,6,3,11,0,11,6,0],[7,11,6],[7,6,11],[3,0,8,11,7,6],[0,1,9,11,7,6],[8,1,9,8,3,1,11,7,6],[10,1,2,6,11,7],[1,2,10,3,0,8,6,11,7],[2,9,0,2,10,9,6,11,7],[6,11,7,2,10,3,10,8,3,10,9,8],[7,2,3,6,2,7],[7,0,8,7,6,0,6,2,0],[2,7,6,2,3,7,0,1,9],[1,6,2,1,8,6,1,9,8,8,7,6],[10,7,6,10,1,7,1,3,7],[10,7,6,1,7,10,1,8,7,1,0,8],[0,3,7,0,7,10,0,10,9,6,10,7],[7,6,10,7,10,8,8,10,9],[6,8,4,11,8,6],[3,6,11,3,0,6,0,4,6],[8,6,11,8,4,6,9,0,1],[9,4,6,9,6,3,9,3,1,11,3,6],[6,8,4,6,11,8,2,10,1],[1,2,10,3,0,11,0,6,11,0,4,6],[4,11,8,4,6,11,0,2,9,2,10,9],[10,9,3,10,3,2,9,4,3,11,3,6,4,6,3],[8,2,3,8,4,2,4,6,2],[0,4,2,4,6,2],[1,9,0,2,3,4,2,4,6,4,3,8],[1,9,4,1,4,2,2,4,6],[8,1,3,8,6,1,8,4,6,6,10,1],[10,1,0,10,0,6,6,0,4],[4,6,3,4,3,8,6,10,3,0,3,9,10,9,3],[10,9,4,6,10,4],[4,9,5,7,6,11],[0,8,3,4,9,5,11,7,6],[5,0,1,5,4,0,7,6,11],[11,7,6,8,3,4,3,5,4,3,1,5],[9,5,4,10,1,2,7,6,11],[6,11,7,1,2,10,0,8,3,4,9,5],[7,6,11,5,4,10,4,2,10,4,0,2],[3,4,8,3,5,4,3,2,5,10,5,2,11,7,6],[7,2,3,7,6,2,5,4,9],[9,5,4,0,8,6,0,6,2,6,8,7],[3,6,2,3,7,6,1,5,0,5,4,0],[6,2,8,6,8,7,2,1,8,4,8,5,1,5,8],[9,5,4,10,1,6,1,7,6,1,3,7],[1,6,10,1,7,6,1,0,7,8,7,0,9,5,4],[4,0,10,4,10,5,0,3,10,6,10,7,3,7,10],[7,6,10,7,10,8,5,4,10,4,8,10],[6,9,5,6,11,9,11,8,9],[3,6,11,0,6,3,0,5,6,0,9,5],[0,11,8,0,5,11,0,1,5,5,6,11],[6,11,3,6,3,5,5,3,1],[1,2,10,9,5,11,9,11,8,11,5,6],[0,11,3,0,6,11,0,9,6,5,6,9,1,2,10],[11,8,5,11,5,6,8,0,5,10,5,2,0,2,5],[6,11,3,6,3,5,2,10,3,10,5,3],[5,8,9,5,2,8,5,6,2,3,8,2],[9,5,6,9,6,0,0,6,2],[1,5,8,1,8,0,5,6,8,3,8,2,6,2,8],[1,5,6,2,1,6],[1,3,6,1,6,10,3,8,6,5,6,9,8,9,6],[10,1,0,10,0,6,9,5,0,5,6,0],[0,3,8,5,6,10],[10,5,6],[11,5,10,7,5,11],[11,5,10,11,7,5,8,3,0],[5,11,7,5,10,11,1,9,0],[10,7,5,10,11,7,9,8,1,8,3,1],[11,1,2,11,7,1,7,5,1],[0,8,3,1,2,7,1,7,5,7,2,11],[9,7,5,9,2,7,9,0,2,2,11,7],[7,5,2,7,2,11,5,9,2,3,2,8,9,8,2],[2,5,10,2,3,5,3,7,5],[8,2,0,8,5,2,8,7,5,10,2,5],[9,0,1,5,10,3,5,3,7,3,10,2],[9,8,2,9,2,1,8,7,2,10,2,5,7,5,2],[1,3,5,3,7,5],[0,8,7,0,7,1,1,7,5],[9,0,3,9,3,5,5,3,7],[9,8,7,5,9,7],[5,8,4,5,10,8,10,11,8],[5,0,4,5,11,0,5,10,11,11,3,0],[0,1,9,8,4,10,8,10,11,10,4,5],[10,11,4,10,4,5,11,3,4,9,4,1,3,1,4],[2,5,1,2,8,5,2,11,8,4,5,8],[0,4,11,0,11,3,4,5,11,2,11,1,5,1,11],[0,2,5,0,5,9,2,11,5,4,5,8,11,8,5],[9,4,5,2,11,3],[2,5,10,3,5,2,3,4,5,3,8,4],[5,10,2,5,2,4,4,2,0],[3,10,2,3,5,10,3,8,5,4,5,8,0,1,9],[5,10,2,5,2,4,1,9,2,9,4,2],[8,4,5,8,5,3,3,5,1],[0,4,5,1,0,5],[8,4,5,8,5,3,9,0,5,0,3,5],[9,4,5],[4,11,7,4,9,11,9,10,11],[0,8,3,4,9,7,9,11,7,9,10,11],[1,10,11,1,11,4,1,4,0,7,4,11],[3,1,4,3,4,8,1,10,4,7,4,11,10,11,4],[4,11,7,9,11,4,9,2,11,9,1,2],[9,7,4,9,11,7,9,1,11,2,11,1,0,8,3],[11,7,4,11,4,2,2,4,0],[11,7,4,11,4,2,8,3,4,3,2,4],[2,9,10,2,7,9,2,3,7,7,4,9],[9,10,7,9,7,4,10,2,7,8,7,0,2,0,7],[3,7,10,3,10,2,7,4,10,1,10,0,4,0,10],[1,10,2,8,7,4],[4,9,1,4,1,7,7,1,3],[4,9,1,4,1,7,0,8,1,8,7,1],[4,0,3,7,4,3],[4,8,7],[9,10,8,10,11,8],[3,0,9,3,9,11,11,9,10],[0,1,10,0,10,8,8,10,11],[3,1,10,11,3,10],[1,2,11,1,11,9,9,11,8],[3,0,9,3,9,11,1,2,9,2,11,9],[0,2,11,8,0,11],[3,2,11],[2,3,8,2,8,10,10,8,9],[9,10,2,0,9,2],[2,3,8,2,8,10,0,1,8,1,10,8],[1,10,2],[1,3,8,9,1,8],[0,9,1],[0,3,8],[]],o=[[0,0,0],[1,0,0],[1,1,0],[0,1,0],[0,0,1],[1,0,1],[1,1,1],[0,1,1]],a=[[0,1],[1,2],[2,3],[3,0],[4,5],[5,6],[6,7],[7,4],[0,4],[1,5],[2,6],[3,7]],function(t,e){var i=[],s=[],l=0,h=new Float32Array(8),u=new Int32Array(12),c=new Int32Array(3);for(c[2]=0;c[2]<e[2]-1;++c[2],l+=e[0])for(c[1]=0;c[1]<e[1]-1;++c[1],++l)for(c[0]=0;c[0]<e[0]-1;++c[0],++l){for(var f=0,d=0;d<8;++d){var m=o[d],p=t[l+m[0]+e[0]*(m[1]+e[1]*m[2])];h[d]=p,f|=p>0?1<<d:0}var g=n[f];if(0!==g){for(d=0;d<12;++d)if(0!=(g&1<<d)){u[d]=i.length;var x=[0,0,0],_=a[d],b=o[_[0]],y=o[_[1]],v=h[_[0]],w=v-h[_[1]],T=0;Math.abs(w)>1e-6&&(T=v/w);for(var S=0;S<3;++S)x[S]=c[S]+b[S]+T*(y[S]-b[S]);i.push(x)}var D=r[f];for(d=0;d<D.length;d+=3)s.push([u[D[d]],u[D[d+1]],u[D[d+2]]])}}return{vertices:i,faces:s}}),e.animations=function(t,e){let i={};return t.requestAnimFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(e,i){t.setTimeout(e,1e3/60)},i.requestInterval=function(e,i){if(!(t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame&&t.mozCancelRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame))return t.setInterval(e,i);let n=(new Date).getTime(),s=new Object;return s.value=t.requestAnimFrame((function r(){(new Date).getTime()-n>=i&&(e.call(),n=(new Date).getTime()),s.value=t.requestAnimFrame(r)})),s},i.clearRequestInterval=function(e){t.cancelAnimationFrame?t.cancelAnimationFrame(e.value):t.webkitCancelAnimationFrame?t.webkitCancelAnimationFrame(e.value):t.webkitCancelRequestAnimationFrame?t.webkitCancelRequestAnimationFrame(e.value):t.mozCancelRequestAnimationFrame?t.mozCancelRequestAnimationFrame(e.value):t.oCancelRequestAnimationFrame?t.oCancelRequestAnimationFrame(e.value):t.msCancelRequestAnimationFrame?t.msCancelRequestAnimationFrame(e.value):clearInterval(e)},i.requestTimeout=function(e,i){if(!(t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame&&t.mozCancelRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame))return t.setTimeout(e,i);let n=(new Date).getTime(),s=new Object;return s.value=t.requestAnimFrame((function r(){(new Date).getTime()-n>=i?e.call():s.value=t.requestAnimFrame(r)})),s},i.clearRequestTimeout=function(e){t.cancelAnimationFrame?t.cancelAnimationFrame(e.value):t.webkitCancelAnimationFrame?t.webkitCancelAnimationFrame(e.value):t.webkitCancelRequestAnimationFrame?t.webkitCancelRequestAnimationFrame(e.value):t.mozCancelRequestAnimationFrame?t.mozCancelRequestAnimationFrame(e.value):t.oCancelRequestAnimationFrame?t.oCancelRequestAnimationFrame(e.value):t.msCancelRequestAnimationFrame?t.msCancelRequestAnimationFrame(e.value):clearTimeout(e)},i}(window),e.extensions=function(t,e,i,n){return{vec3AngleFrom:function(t,n){let s=e.length(t),r=e.length(n),o=e.dot(t,n)/s/r;return i.acos(o)},contextRoundRect:function(t,e,i,n,s,r){t.beginPath(),t.moveTo(e+r,i),t.lineTo(e+n-r,i),t.quadraticCurveTo(e+n,i,e+n,i+r),t.lineTo(e+n,i+s-r),t.quadraticCurveTo(e+n,i+s,e+n-r,i+s),t.lineTo(e+r,i+s),t.quadraticCurveTo(e,i+s,e,i+s-r),t.lineTo(e,i+r),t.quadraticCurveTo(e,i,e+r,i),t.closePath()},contextEllipse:function(t,e,i,n,s){let r=.5522848,o=n/2*r,a=s/2*r,l=e+n,h=i+s,u=e+n/2,c=i+s/2;t.beginPath(),t.moveTo(e,c),t.bezierCurveTo(e,c-a,u-o,i,u,i),t.bezierCurveTo(u+o,i,l,c-a,l,c),t.bezierCurveTo(l,c+a,u+o,h,u,h),t.bezierCurveTo(u-o,h,e,c+a,e,c),t.closePath()},getFontString:function(t,e,i,n){let s=[];i&&s.push("bold "),n&&s.push("italic "),s.push(t+"px ");for(let t=0,i=e.length;t<i;t++){let i=e[t];-1!==i.indexOf(" ")&&(i='"'+i+'"'),s.push((0!==t?",":"")+i)}return s.join("")}}}(e.structures,e.lib.vec3,Math),function(t,e,i){e.sign||(e.sign=function(t){return(t>0)-(t<0)||+t}),"function"!=typeof t.assign&&(t.assign=function(e,i){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=t(e),s=1;s<arguments.length;s++){var r=arguments[s];if(null!=r)for(var o in r)t.prototype.hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n}),String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.substr(e,t.length)===t})}(Object,Math),e.math=function(t,e,i,n,s){let r={},o={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gray:"#808080",green:"#008000",greenyellow:"#adff2f",honeydew:"#f0fff0",hotpink:"#ff69b4","indianred ":"#cd5c5c","indigo ":"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavender:"#e6e6fa",lavenderblush:"#fff0f5",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgrey:"#d3d3d3",lightgreen:"#90ee90",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370d8",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#d87093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};return r.angleBetweenLargest=function(t){if(0===t.length)return{angle:0,largest:2*n.PI};if(1===t.length)return{angle:t[0]+n.PI,largest:2*n.PI};let e=0,i=0;for(let n=0,s=t.length-1;n<s;n++){let s=t[n+1]-t[n];s>e&&(e=s,i=(t[n+1]+t[n])/2)}let s=t[0]+2*n.PI-t[t.length-1];return s>e&&(i=t[0]-s/2,e=s,i<0&&(i+=2*n.PI)),{angle:i,largest:e}},r.isBetween=function(t,e,i){if(e>i){let t=e;e=i,i=t}return t>=e&&t<=i},i(document).ready((function(){t&&t.iChemLabs&&t.iChemLabs.checkForUpdates&&t.iChemLabs.checkForUpdates({})})),r.getRGB=function(t,e){let i=[0,0,0];if(o[t.toLowerCase()]&&(t=o[t.toLowerCase()]),"#"===t.charAt(0))return 4===t.length&&(t="#"+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2)+t.charAt(3)+t.charAt(3)),[parseInt(t.substring(1,3),16)/255*e,parseInt(t.substring(3,5),16)/255*e,parseInt(t.substring(5,7),16)/255*e];if(t.startsWith("rgba")){let n=t.replace(/rgba\(|\)/g,"").split(",");return 4!==n.length?i:[parseInt(n[0])/255*e,parseInt(n[1])/255*e,parseInt(n[2])/255*e,parseInt(n[3])/255*e]}if(t.startsWith("rgb")){let n=t.replace(/rgb\(|\)/g,"").split(",");return 3!==n.length?i:[parseInt(n[0])/255*e,parseInt(n[1])/255*e,parseInt(n[2])/255*e]}return i},r.hsl2rgb=function(t,e,i){let n,s,r,o=function(t,e,i){return i<0?i+=1:i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t};if(0===e)n=s=r=i;else{let a=i<.5?i*(1+e):i+e-i*e,l=2*i-a;n=o(l,a,t+1/3),s=o(l,a,t),r=o(l,a,t-1/3)}return[255*n,255*s,255*r]},r.idx2color=function(t){let e=t.toString(16);for(let t=0,i=6-e.length;t<i;t++)e="0"+e;return"#"+e},r.distanceFromPointToLineInclusive=function(t,i,s,o){let a=i.distance(s),l=i.angle(s),h=n.PI/2-l,u=i.angle(t)+h,c=i.distance(t),f=new e.Point(c*n.cos(u),-c*n.sin(u)),d=o||0;return r.isBetween(-f.y,d,a-d)?n.abs(f.x):-1},r.calculateDistanceInterior=function(t,e,i){if(this.isBetween(e.x,i.x,i.x+i.w)&&this.isBetween(e.y,i.y,i.y+i.h))return t.distance(e);let s=[];s.push({x1:i.x,y1:i.y,x2:i.x+i.w,y2:i.y}),s.push({x1:i.x,y1:i.y+i.h,x2:i.x+i.w,y2:i.y+i.h}),s.push({x1:i.x,y1:i.y,x2:i.x,y2:i.y+i.h}),s.push({x1:i.x+i.w,y1:i.y,x2:i.x+i.w,y2:i.y+i.h});let r=[];for(let i=0;i<4;i++){let n=s[i],o=this.intersectLines(e.x,e.y,t.x,t.y,n.x1,n.y1,n.x2,n.y2);o&&r.push(o)}if(0===r.length)return 0;let o=0;for(let e=0,i=r.length;e<i;e++){let i=r[e],s=t.x-i.x,a=t.y-i.y;o=n.max(o,n.sqrt(s*s+a*a))}return o},r.intersectLines=function(t,e,i,n,s,r,o,a){let l=(n-=e)*(o-=s)-(i-=t)*(a-=r);if(0===l)return!1;let h=(a*(t-s)-o*(e-r))/l,u=(n*(t-s)-i*(e-r))/l;return u>=0&&u<=1&&h>=0&&h<=1&&{x:t+h*i,y:e+h*n}},r.clamp=function(t,e,i){return t<e?e:t>i?i:t},r.rainbowAt=function(t,e,i){i.length<1?i.push("#000000","#FFFFFF"):i.length<2&&i.push("#FFFFFF");let s=e/(i.length-1),o=n.floor(t/s),a=(t-o*s)/s,l=r.getRGB(i[o],1),h=r.getRGB(i[o+1],1);return"rgb("+[255*(l[0]+(h[0]-l[0])*a),255*(l[1]+(h[1]-l[1])*a),255*(l[2]+(h[2]-l[2])*a)].join(",")+")"},r.angleBounds=function(t,e,i){let s=2*n.PI;for(;t<0;)t+=s;for(;t>s;)t-=s;return i&&t>n.PI&&(t=2*n.PI-t),e&&(t=180*t/n.PI),t},r.isPointInPoly=function(t,e){for(var i=!1,n=-1,s=t.length,r=s-1;++n<s;r=n)(t[n].y<=e.y&&e.y<t[r].y||t[r].y<=e.y&&e.y<t[n].y)&&e.x<(t[r].x-t[n].x)*(e.y-t[n].y)/(t[r].y-t[n].y)+t[n].x&&(i=!i);return i},r}(e,e.structures,e.lib.jQuery,Math),function(t,e,i){t.Bounds=function(){};let n=t.Bounds.prototype;n.minX=n.minY=n.minZ=1/0,n.maxX=n.maxY=n.maxZ=-1/0,n.expand=function(n,s,r,o){n instanceof t.Bounds?(this.minX=e.min(this.minX,n.minX),this.minY=e.min(this.minY,n.minY),this.maxX=e.max(this.maxX,n.maxX),this.maxY=e.max(this.maxY,n.maxY),n.maxZ!==1/0&&(this.minZ=e.min(this.minZ,n.minZ),this.maxZ=e.max(this.maxZ,n.maxZ))):(this.minX=e.min(this.minX,n),this.maxX=e.max(this.maxX,n),this.minY=e.min(this.minY,s),this.maxY=e.max(this.maxY,s),r!==i&&o!==i&&(this.minX=e.min(this.minX,r),this.maxX=e.max(this.maxX,r),this.minY=e.min(this.minY,o),this.maxY=e.max(this.maxY,o)))},n.expand3D=function(t,n,s,r,o,a){this.minX=e.min(this.minX,t),this.maxX=e.max(this.maxX,t),this.minY=e.min(this.minY,n),this.maxY=e.max(this.maxY,n),this.minZ=e.min(this.minZ,s),this.maxZ=e.max(this.maxZ,s),r!==i&&o!==i&&a!==i&&(this.minX=e.min(this.minX,r),this.maxX=e.max(this.maxX,r),this.minY=e.min(this.minY,o),this.maxY=e.max(this.maxY,o),this.minZ=e.min(this.minZ,a),this.maxZ=e.max(this.maxZ,a))}}(e.math,Math),e.featureDetection=function(t,e,i,n,s){let r={supports_canvas:function(){return!!i.createElement("canvas").getContext},supports_canvas_text:function(){return!!r.supports_canvas()&&"function"==typeof i.createElement("canvas").getContext("2d").fillText},supports_webgl:function(){let t=i.createElement("canvas");try{if(t.getContext("webgl"))return!0;if(t.getContext("experimental-webgl"))return!0}catch(t){}return!1},supports_xhr2:function(){return e.support.cors},supports_touch:function(){let t=(/iPhone|iPad|iPod|Android|BlackBerry|BB10/i.test(navigator.userAgent)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!n.MSStream;return"ontouchstart"in n&&t},supports_gesture:function(){return"ongesturestart"in n}};return r}(e.iChemLabs,e.lib.jQuery,document,window),e.SYMBOLS=["H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg","Tl","Pb","Bi","Po","At","Rn","Fr","Ra","Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr","Rf","Db","Sg","Bh","Hs","Mt","Ds","Rg","Cn","Nh","Fl","Mc","Lv","Ts","Og"],e.ELEMENT=function(t,e){let i=[];function n(t,e,i,n,s,r,o,a,l){this.symbol=t,this.name=e,this.atomicNumber=i,this.addH=n,this.jmolColor=this.pymolColor=s,this.covalentRadius=r,this.vdWRadius=o,this.valency=a,this.mass=l}return i.H=new n("H","Hydrogen",1,!1,"#FFFFFF",.31,1.1,1,1),i.He=new n("He","Helium",2,!1,"#D9FFFF",.28,1.4,0,4),i.Li=new n("Li","Lithium",3,!1,"#CC80FF",1.28,1.82,1,7),i.Be=new n("Be","Beryllium",4,!1,"#C2FF00",.96,1.53,2,9),i.B=new n("B","Boron",5,!0,"#FFB5B5",.84,1.92,3,11),i.C=new n("C","Carbon",6,!0,"#909090",.76,1.7,4,12),i.N=new n("N","Nitrogen",7,!0,"#3050F8",.71,1.55,3,14),i.O=new n("O","Oxygen",8,!0,"#FF0D0D",.66,1.52,2,16),i.F=new n("F","Fluorine",9,!0,"#90E050",.57,1.47,1,19),i.Ne=new n("Ne","Neon",10,!1,"#B3E3F5",.58,1.54,0,20),i.Na=new n("Na","Sodium",11,!1,"#AB5CF2",1.66,2.27,1,23),i.Mg=new n("Mg","Magnesium",12,!1,"#8AFF00",1.41,1.73,0,24),i.Al=new n("Al","Aluminum",13,!1,"#BFA6A6",1.21,1.84,0,27),i.Si=new n("Si","Silicon",14,!0,"#F0C8A0",1.11,2.1,4,28),i.P=new n("P","Phosphorus",15,!0,"#FF8000",1.07,1.8,3,31),i.S=new n("S","Sulfur",16,!0,"#FFFF30",1.05,1.8,2,32),i.Cl=new n("Cl","Chlorine",17,!0,"#1FF01F",1.02,1.75,1,35),i.Ar=new n("Ar","Argon",18,!1,"#80D1E3",1.06,1.88,0,40),i.K=new n("K","Potassium",19,!1,"#8F40D4",2.03,2.75,0,39),i.Ca=new n("Ca","Calcium",20,!1,"#3DFF00",1.76,2.31,0,40),i.Sc=new n("Sc","Scandium",21,!1,"#E6E6E6",1.7,0,0,45),i.Ti=new n("Ti","Titanium",22,!1,"#BFC2C7",1.6,0,1,48),i.V=new n("V","Vanadium",23,!1,"#A6A6AB",1.53,0,1,51),i.Cr=new n("Cr","Chromium",24,!1,"#8A99C7",1.39,0,2,52),i.Mn=new n("Mn","Manganese",25,!1,"#9C7AC7",1.39,0,3,55),i.Fe=new n("Fe","Iron",26,!1,"#E06633",1.32,0,2,56),i.Co=new n("Co","Cobalt",27,!1,"#F090A0",1.26,0,1,59),i.Ni=new n("Ni","Nickel",28,!1,"#50D050",1.24,1.63,1,58),i.Cu=new n("Cu","Copper",29,!1,"#C88033",1.32,1.4,0,63),i.Zn=new n("Zn","Zinc",30,!1,"#7D80B0",1.22,1.39,0,64),i.Ga=new n("Ga","Gallium",31,!1,"#C28F8F",1.22,1.87,0,69),i.Ge=new n("Ge","Germanium",32,!1,"#668F8F",1.2,2.11,4,74),i.As=new n("As","Arsenic",33,!0,"#BD80E3",1.19,1.85,3,75),i.Se=new n("Se","Selenium",34,!0,"#FFA100",1.2,1.9,2,80),i.Br=new n("Br","Bromine",35,!0,"#A62929",1.2,1.85,1,79),i.Kr=new n("Kr","Krypton",36,!1,"#5CB8D1",1.16,2.02,0,84),i.Rb=new n("Rb","Rubidium",37,!1,"#702EB0",2.2,3.03,0,85),i.Sr=new n("Sr","Strontium",38,!1,"#00FF00",1.95,2.49,0,88),i.Y=new n("Y","Yttrium",39,!1,"#94FFFF",1.9,0,0,89),i.Zr=new n("Zr","Zirconium",40,!1,"#94E0E0",1.75,0,0,90),i.Nb=new n("Nb","Niobium",41,!1,"#73C2C9",1.64,0,1,93),i.Mo=new n("Mo","Molybdenum",42,!1,"#54B5B5",1.54,0,2,98),i.Tc=new n("Tc","Technetium",43,!1,"#3B9E9E",1.47,0,3,0),i.Ru=new n("Ru","Ruthenium",44,!1,"#248F8F",1.46,0,2,102),i.Rh=new n("Rh","Rhodium",45,!1,"#0A7D8C",1.42,0,1,103),i.Pd=new n("Pd","Palladium",46,!1,"#006985",1.39,1.63,0,106),i.Ag=new n("Ag","Silver",47,!1,"#C0C0C0",1.45,1.72,0,107),i.Cd=new n("Cd","Cadmium",48,!1,"#FFD98F",1.44,1.58,0,114),i.In=new n("In","Indium",49,!1,"#A67573",1.42,1.93,0,115),i.Sn=new n("Sn","Tin",50,!1,"#668080",1.39,2.17,4,120),i.Sb=new n("Sb","Antimony",51,!1,"#9E63B5",1.39,2.06,3,121),i.Te=new n("Te","Tellurium",52,!0,"#D47A00",1.38,2.06,2,130),i.I=new n("I","Iodine",53,!0,"#940094",1.39,1.98,1,127),i.Xe=new n("Xe","Xenon",54,!1,"#429EB0",1.4,2.16,0,132),i.Cs=new n("Cs","Cesium",55,!1,"#57178F",2.44,3.43,0,133),i.Ba=new n("Ba","Barium",56,!1,"#00C900",2.15,2.68,0,138),i.La=new n("La","Lanthanum",57,!1,"#70D4FF",2.07,0,0,139),i.Ce=new n("Ce","Cerium",58,!1,"#FFFFC7",2.04,0,0,140),i.Pr=new n("Pr","Praseodymium",59,!1,"#D9FFC7",2.03,0,0,141),i.Nd=new n("Nd","Neodymium",60,!1,"#C7FFC7",2.01,0,0,142),i.Pm=new n("Pm","Promethium",61,!1,"#A3FFC7",1.99,0,0,0),i.Sm=new n("Sm","Samarium",62,!1,"#8FFFC7",1.98,0,0,152),i.Eu=new n("Eu","Europium",63,!1,"#61FFC7",1.98,0,0,153),i.Gd=new n("Gd","Gadolinium",64,!1,"#45FFC7",1.96,0,0,158),i.Tb=new n("Tb","Terbium",65,!1,"#30FFC7",1.94,0,0,159),i.Dy=new n("Dy","Dysprosium",66,!1,"#1FFFC7",1.92,0,0,164),i.Ho=new n("Ho","Holmium",67,!1,"#00FF9C",1.92,0,0,165),i.Er=new n("Er","Erbium",68,!1,"#00E675",1.89,0,0,166),i.Tm=new n("Tm","Thulium",69,!1,"#00D452",1.9,0,0,169),i.Yb=new n("Yb","Ytterbium",70,!1,"#00BF38",1.87,0,0,174),i.Lu=new n("Lu","Lutetium",71,!1,"#00AB24",1.87,0,0,175),i.Hf=new n("Hf","Hafnium",72,!1,"#4DC2FF",1.75,0,0,180),i.Ta=new n("Ta","Tantalum",73,!1,"#4DA6FF",1.7,0,1,181),i.W=new n("W","Tungsten",74,!1,"#2194D6",1.62,0,2,184),i.Re=new n("Re","Rhenium",75,!1,"#267DAB",1.51,0,3,187),i.Os=new n("Os","Osmium",76,!1,"#266696",1.44,0,2,192),i.Ir=new n("Ir","Iridium",77,!1,"#175487",1.41,0,3,193),i.Pt=new n("Pt","Platinum",78,!1,"#D0D0E0",1.36,1.75,0,195),i.Au=new n("Au","Gold",79,!1,"#FFD123",1.36,1.66,1,197),i.Hg=new n("Hg","Mercury",80,!1,"#B8B8D0",1.32,1.55,0,202),i.Tl=new n("Tl","Thallium",81,!1,"#A6544D",1.45,1.96,0,205),i.Pb=new n("Pb","Lead",82,!1,"#575961",1.46,2.02,4,208),i.Bi=new n("Bi","Bismuth",83,!1,"#9E4FB5",1.48,2.07,3,209),i.Po=new n("Po","Polonium",84,!1,"#AB5C00",1.4,1.97,2,0),i.At=new n("At","Astatine",85,!0,"#754F45",1.5,2.02,1,0),i.Rn=new n("Rn","Radon",86,!1,"#428296",1.5,2.2,0,0),i.Fr=new n("Fr","Francium",87,!1,"#420066",2.6,3.48,0,0),i.Ra=new n("Ra","Radium",88,!1,"#007D00",2.21,2.83,0,0),i.Ac=new n("Ac","Actinium",89,!1,"#70ABFA",2.15,0,0,0),i.Th=new n("Th","Thorium",90,!1,"#00BAFF",2.06,0,0,232),i.Pa=new n("Pa","Protactinium",91,!1,"#00A1FF",2,0,0,231),i.U=new n("U","Uranium",92,!1,"#008FFF",1.96,1.86,0,238),i.Np=new n("Np","Neptunium",93,!1,"#0080FF",1.9,0,0,0),i.Pu=new n("Pu","Plutonium",94,!1,"#006BFF",1.87,0,0,0),i.Am=new n("Am","Americium",95,!1,"#545CF2",1.8,0,0,0),i.Cm=new n("Cm","Curium",96,!1,"#785CE3",1.69,0,0,0),i.Bk=new n("Bk","Berkelium",97,!1,"#8A4FE3",0,0,0,0),i.Cf=new n("Cf","Californium",98,!1,"#A136D4",0,0,0,0),i.Es=new n("Es","Einsteinium",99,!1,"#B31FD4",0,0,0,0),i.Fm=new n("Fm","Fermium",100,!1,"#B31FBA",0,0,0,0),i.Md=new n("Md","Mendelevium",101,!1,"#B30DA6",0,0,0,0),i.No=new n("No","Nobelium",102,!1,"#BD0D87",0,0,0,0),i.Lr=new n("Lr","Lawrencium",103,!1,"#C70066",0,0,0,0),i.Rf=new n("Rf","Rutherfordium",104,!1,"#CC0059",0,0,0,0),i.Db=new n("Db","Dubnium",105,!1,"#D1004F",0,0,0,0),i.Sg=new n("Sg","Seaborgium",106,!1,"#D90045",0,0,0,0),i.Bh=new n("Bh","Bohrium",107,!1,"#E00038",0,0,0,0),i.Hs=new n("Hs","Hassium",108,!1,"#E6002E",0,0,0,0),i.Mt=new n("Mt","Meitnerium",109,!1,"#EB0026",0,0,0,0),i.Ds=new n("Ds","Darmstadtium",110,!1,"#000000",0,0,0,0),i.Rg=new n("Rg","Roentgenium",111,!1,"#000000",0,0,0,0),i.Cn=new n("Cn","Copernicium",112,!1,"#000000",0,0,0,0),i.Nh=new n("Nh","Nihonium",113,!1,"#000000",0,0,0,0),i.Fl=new n("Fl","Flerovium",114,!1,"#000000",0,0,0,0),i.Mc=new n("Mc","Moscovium",115,!1,"#000000",0,0,0,0),i.Lv=new n("Lv","Livermorium",116,!1,"#000000",0,0,0,0),i.Ts=new n("Ts","Tennessine",117,!1,"#000000",0,0,0,0),i.Og=new n("Og","Oganesson",118,!1,"#000000",0,0,0,0),i.H.pymolColor="#E6E6E6",i.C.pymolColor="#33FF33",i.N.pymolColor="#3333FF",i.O.pymolColor="#FF4D4D",i.F.pymolColor="#B3FFFF",i.S.pymolColor="#E6C640",i}(e.SYMBOLS),e.RESIDUE=function(t){let e=[];function i(t,e,i,n,s,r){this.symbol=t,this.name=e,this.polar=i,this.aminoColor=n,this.shapelyColor=s,this.acidity=r}return e.Ala=new i("Ala","Alanine",!1,"#C8C8C8","#8CFF8C",0),e.Arg=new i("Arg","Arginine",!0,"#145AFF","#00007C",1),e.Asn=new i("Asn","Asparagine",!0,"#00DCDC","#FF7C70",0),e.Asp=new i("Asp","Aspartic Acid",!0,"#E60A0A","#A00042",-1),e.Cys=new i("Cys","Cysteine",!0,"#E6E600","#FFFF70",0),e.Gln=new i("Gln","Glutamine",!0,"#00DCDC","#FF4C4C",0),e.Glu=new i("Glu","Glutamic Acid",!0,"#E60A0A","#660000",-1),e.Gly=new i("Gly","Glycine",!1,"#EBEBEB","#FFFFFF",0),e.His=new i("His","Histidine",!0,"#8282D2","#7070FF",1),e.Ile=new i("Ile","Isoleucine",!1,"#0F820F","#004C00",0),e.Leu=new i("Leu","Leucine",!1,"#0F820F","#455E45",0),e.Lys=new i("Lys","Lysine",!0,"#145AFF","#4747B8",1),e.Met=new i("Met","Methionine",!1,"#E6E600","#B8A042",0),e.Phe=new i("Phe","Phenylalanine",!1,"#3232AA","#534C52",0),e.Pro=new i("Pro","Proline",!1,"#DC9682","#525252",0),e.Ser=new i("Ser","Serine",!0,"#FA9600","#FF7042",0),e.Thr=new i("Thr","Threonine",!0,"#FA9600","#B84C00",0),e.Trp=new i("Trp","Tryptophan",!0,"#B45AB4","#4F4600",0),e.Tyr=new i("Tyr","Tyrosine",!0,"#3232AA","#8C704C",0),e.Val=new i("Val","Valine",!1,"#0F820F","#FF8CFF",0),e.Asx=new i("Asx","Asparagine/Aspartic Acid",!0,"#FF69B4","#FF00FF",0),e.Glx=new i("Glx","Glutamine/Glutamic Acid",!0,"#FF69B4","#FF00FF",0),e["*"]=new i("*","Other",!1,"#BEA06E","#FF00FF",0),e.A=new i("A","Adenine",!1,"#BEA06E","#A0A0FF",0),e.G=new i("G","Guanine",!1,"#BEA06E","#FF7070",0),e.I=new i("I","",!1,"#BEA06E","#80FFFF",0),e.C=new i("C","Cytosine",!1,"#BEA06E","#FF8C4B",0),e.T=new i("T","Thymine",!1,"#BEA06E","#A0FFA0",0),e.U=new i("U","Uracil",!1,"#BEA06E","#FF8080",0),e}(),function(t,e){t.Queue=function(){this.queue=[]};let i=t.Queue.prototype;i.queueSpace=0,i.getSize=function(){return this.queue.length-this.queueSpace},i.isEmpty=function(){return 0===this.queue.length},i.enqueue=function(t){this.queue.push(t)},i.dequeue=function(){let t;return this.queue.length&&(t=this.queue[this.queueSpace],2*++this.queueSpace>=this.queue.length&&(this.queue=this.queue.slice(this.queueSpace),this.queueSpace=0)),t},i.getOldestElement=function(){let t;return this.queue.length&&(t=this.queue[this.queueSpace]),t}}(e.structures),function(t,e,i){t.Point=function(t,e){this.x=t||0,this.y=e||0};let n=t.Point.prototype;n.sub=function(t){this.x-=t.x,this.y-=t.y},n.add=function(t){this.x+=t.x,this.y+=t.y},n.distance=function(t){let i=t.x-this.x,n=t.y-this.y;return e.sqrt(i*i+n*n)},n.angleForStupidCanvasArcs=function(t){let i=t.x-this.x,n=t.y-this.y,s=0;for(s=0===i?0===n?0:n>0?e.PI/2:3*e.PI/2:0===n?i>0?0:e.PI:i<0?e.atan(n/i)+e.PI:n<0?e.atan(n/i)+2*e.PI:e.atan(n/i);s<0;)s+=2*e.PI;return s%=2*e.PI,s},n.angle=function(t){let i=t.x-this.x,n=this.y-t.y,s=0;for(s=0===i?0===n?0:n>0?e.PI/2:3*e.PI/2:0===n?i>0?0:e.PI:i<0?e.atan(n/i)+e.PI:n<0?e.atan(n/i)+2*e.PI:e.atan(n/i);s<0;)s+=2*e.PI;return s%=2*e.PI,s}}(e.structures,Math),function(t,e,i,n){let s=/[ ,]+/,r=/\-+/,o=["Helvetica","Arial","Dialog"];e.Query=function(t){this.type=t,this.elements={v:[],not:!1},this.charge=n,this.chirality=n,this.connectivity=n,this.connectivityNoH=n,this.hydrogens=n,this.saturation=n,this.orders={v:[],not:!1},this.stereo=n,this.aromatic=n,this.ringCount=n,this.cache=n},e.Query.TYPE_ATOM=0,e.Query.TYPE_BOND=1;let a=e.Query.prototype;a.parseRange=function(t){let e=[],i=t.split(s);for(let t=0,n=i.length;t<n;t++){let n=i[t],s=!1,o=!1;if("-"===n.charAt(0)&&(s=!0,n=n.substring(1)),-1!=n.indexOf("--")&&(o=!0),-1!=n.indexOf("-")){let t=n.split(r),i={x:parseInt(t[0])*(s?-1:1),y:parseInt(t[1])*(o?-1:1)};if(i.y<i.x){let t=i.y;i.y=i.x,i.x=t}e.push(i)}else e.push({x:parseInt(n)*(s?-1:1)})}return e},a.draw=function(e,i,s){this.cache||(this.cache=this.toString());let r=this.cache,a=n,l=r.indexOf("(");-1!=l&&(r=this.cache.substring(0,l),a=this.cache.substring(l,this.cache.length)),e.textAlign="center",e.textBaseline="middle",e.font=t.getFontString(12,o,!0,!1);let h=e.measureText(r).width;e.fillStyle=i.backgroundColor,e.fillRect(s.x-h/2,s.y-6,h,12),e.fillStyle="black",e.fillText(r,s.x,s.y),a&&(e.font=t.getFontString(10,o,!1,!0),h=e.measureText(a).width,e.fillStyle=i.backgroundColor,e.fillRect(s.x-h/2,s.y+6,h,11),e.fillStyle="black",e.fillText(a,s.x,s.y+11))},a.outputRange=function(t){let e=!1,i=[];for(let n=0,s=t.length;n<s;n++){e&&i.push(","),e=!0;let s=t[n];s.y?(i.push(s.x),i.push("-"),i.push(s.y)):i.push(s.x)}return i.join("")},a.toString=function(){let t=[],i=[];return this.type===e.Query.TYPE_ATOM?(this.elements&&0!==this.elements.v.length?(this.elements.not&&t.push("!"),t.push("["),t.push(this.elements.v.join(",")),t.push("]")):t.push("[a]"),this.chirality&&i.push((this.chirality.not?"!":"")+"@="+this.chirality.v),this.aromatic&&i.push((this.aromatic.not?"!":"")+"A"),this.charge&&i.push((this.charge.not?"!":"")+"C="+this.outputRange(this.charge.v)),this.hydrogens&&i.push((this.hydrogens.not?"!":"")+"H="+this.outputRange(this.hydrogens.v)),this.ringCount&&i.push((this.ringCount.not?"!":"")+"R="+this.outputRange(this.ringCount.v)),this.saturation&&i.push((this.saturation.not?"!":"")+"S"),this.connectivity&&i.push((this.connectivity.not?"!":"")+"X="+this.outputRange(this.connectivity.v)),this.connectivityNoH&&i.push((this.connectivityNoH.not?"!":"")+"x="+this.outputRange(this.connectivityNoH.v))):this.type===e.Query.TYPE_BOND&&(this.orders&&0!==this.orders.v.length?(this.orders.not&&t.push("!"),t.push("["),t.push(this.orders.v.join(",")),t.push("]")):t.push("[a]"),this.stereo&&i.push((this.stereo.not?"!":"")+"@="+this.stereo.v),this.aromatic&&i.push((this.aromatic.not?"!":"")+"A"),this.ringCount&&i.push((this.ringCount.not?"!":"")+"R="+this.outputRange(this.ringCount.v))),i.length>0&&(t.push("("),t.push(i.join(",")),t.push(")")),t.join("")}}(e.extensions,e.structures,Math),function(t,e,i,n,s,r,o){let a=/\s+/g;n.Atom=function(t,e,i,s){this.label=t?t.trim():"C",this.x=e||0,this.y=i||0,this.z=s||0,this.enhancedStereo={type:n.Atom.ESTEREO_ABSOLUTE,group:1},this.pid=n.PID++},n.Atom.ESTEREO_ABSOLUTE="abs",n.Atom.ESTEREO_OR="or",n.Atom.ESTEREO_AND="&";let l=n.Atom.prototype=new n.Point(0,0);l.charge=0,l.numLonePair=0,l.numRadical=0,l.mass=-1,l.implicitH=-1,l.coordinationNumber=0,l.bondNumber=0,l.angleOfLeastInterference=0,l.isHidden=!1,l.altLabel=o,l.isLone=!1,l.isHover=!1,l.isSelected=!1,l.add3D=function(t){this.x+=t.x,this.y+=t.y,this.z+=t.z},l.sub3D=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z},l.distance3D=function(t){let e=t.x-this.x,i=t.y-this.y,n=t.z-this.z;return s.sqrt(e*e+i*i+n*n)},l.draw=function(r,l){if(this.dontDraw)return;if(this.isLassoed){let t=r.createRadialGradient(this.x-1,this.y-1,0,this.x,this.y,7);t.addColorStop(0,"rgba(212, 99, 0, 0)"),t.addColorStop(.7,"rgba(212, 99, 0, 0.8)"),r.fillStyle=t,r.beginPath(),r.arc(this.x,this.y,5,0,2*s.PI,!1),r.fill()}if(this.query)return;this.textBounds=[],this.styles&&(l=this.styles);let h,u=e.getFontString(l.atoms_font_size_2D,l.atoms_font_families_2D,l.atoms_font_bold_2D,l.atoms_font_italic_2D);r.font=u,r.fillStyle=this.getElementColor(l.atoms_useJMOLColors,l.atoms_usePYMOLColors,l.atoms_color,2),"H"===this.label&&l.atoms_HBlack_2D&&(r.fillStyle="black"),this.error&&(r.fillStyle=l.colorError);let c=this.isLabelVisible(l);if(this.isLone&&!c||l.atoms_circles_2D)this.isLone&&(r.fillStyle="#909090"),r.beginPath(),r.arc(this.x,this.y,l.atoms_circleDiameter_2D/2,0,2*s.PI,!1),r.fill(),l.atoms_circleBorderWidth_2D>0&&(r.lineWidth=l.atoms_circleBorderWidth_2D,r.strokeStyle="black",r.stroke());else if(c)if(r.textAlign="center",r.textBaseline="middle",this.altLabel!==o){r.fillText(this.altLabel,this.x,this.y);let t=r.measureText(this.altLabel).width;this.textBounds.push({x:this.x-t/2,y:this.y-l.atoms_font_size_2D/2+1,w:t,h:l.atoms_font_size_2D-2})}else if(t[this.label]){r.fillText(this.label,this.x,this.y);let t=r.measureText(this.label).width;this.textBounds.push({x:this.x-t/2,y:this.y-l.atoms_font_size_2D/2+1,w:t,h:l.atoms_font_size_2D-2});let i=0;if(-1!==this.mass){let n=r.font;r.font=e.getFontString(.7*l.atoms_font_size_2D,l.atoms_font_families_2D,l.atoms_font_bold_2D,l.atoms_font_italic_2D),i=r.measureText(this.mass).width,r.textAlign="right",r.fillText(this.mass,this.x-t/2-1,this.y-l.atoms_font_size_2D/2+1),this.textBounds.push({x:this.x-t/2-i-.5,y:this.y-1.7*l.atoms_font_size_2D/2+1,w:i,h:l.atoms_font_size_2D/2-1}),r.font=n,r.textAlign="center"}let n=t/2,o=this.getImplicitHydrogenCount();if(l.atoms_implicitHydrogens_2D&&o>0){h=0;let a=r.measureText("H").width,c=!0;if(o>1){let n=t/2+a/2,f=0,d=e.getFontString(.8*l.atoms_font_size_2D,l.atoms_font_families_2D,l.atoms_font_bold_2D,l.atoms_font_italic_2D);r.font=d;let m=r.measureText(o).width;1===this.bondNumber?this.angleOfLeastInterference>s.PI/2&&this.angleOfLeastInterference<3*s.PI/2&&(n=-t/2-m-a/2-i/2,c=!1,h=s.PI):this.angleOfLeastInterference<=s.PI/4||(this.angleOfLeastInterference<3*s.PI/4?(n=0,f=.9*-l.atoms_font_size_2D,0!==this.charge&&(f-=.3*l.atoms_font_size_2D),c=!1,h=s.PI/2):this.angleOfLeastInterference<=5*s.PI/4?(n=-t/2-m-a/2-i/2,c=!1,h=s.PI):this.angleOfLeastInterference<7*s.PI/4&&(n=0,f=.9*l.atoms_font_size_2D,c=!1,h=3*s.PI/2)),r.font=u,r.fillText("H",this.x+n,this.y+f),r.font=d,r.fillText(o,this.x+n+a/2+m/2,this.y+f+.3*l.atoms_font_size_2D),this.textBounds.push({x:this.x+n-a/2,y:this.y+f-l.atoms_font_size_2D/2+1,w:a,h:l.atoms_font_size_2D-2}),this.textBounds.push({x:this.x+n+a/2,y:this.y+f+.3*l.atoms_font_size_2D-l.atoms_font_size_2D/2+1,w:m,h:.8*l.atoms_font_size_2D-2})}else{let e=t/2+a/2,n=0;1===this.bondNumber?this.angleOfLeastInterference>s.PI/2&&this.angleOfLeastInterference<3*s.PI/2&&(e=-t/2-a/2-i/2,c=!1,h=s.PI):this.angleOfLeastInterference<=s.PI/4||(this.angleOfLeastInterference<3*s.PI/4?(e=0,n=.9*-l.atoms_font_size_2D,c=!1,h=s.PI/2):this.angleOfLeastInterference<=5*s.PI/4?(e=-t/2-a/2-i/2,c=!1,h=s.PI):this.angleOfLeastInterference<7*s.PI/4&&(e=0,n=.9*l.atoms_font_size_2D,c=!1,h=3*s.PI/2)),r.fillText("H",this.x+e,this.y+n),this.textBounds.push({x:this.x+e-a/2,y:this.y+n-l.atoms_font_size_2D/2+1,w:a,h:l.atoms_font_size_2D-2})}c&&(n+=a)}if(0!==this.charge){let t=this.charge.toFixed(0);"1"===t?t="+":"-1"===t?t="":t.startsWith("-")?t=t.substring(1)+"":t+="+";let i=r.measureText(t).width;n+=i/2,r.textAlign="center",r.textBaseline="middle",r.font=e.getFontString(s.floor(.8*l.atoms_font_size_2D),l.atoms_font_families_2D,l.atoms_font_bold_2D,l.atoms_font_italic_2D),r.fillText(t,this.x+n-1,this.y-l.atoms_font_size_2D/2+1),this.textBounds.push({x:this.x+n-i/2-1,y:this.y-1.8*l.atoms_font_size_2D/2+5,w:i,h:l.atoms_font_size_2D/2-1})}}else if(n.CondensedLabel)if(this.label.match(a)){r.textAlign="left",this.error&&(r.fillStyle=l.colorError),r.fillText(this.label,this.x,this.y);let t=r.measureText(this.label).width;this.textBounds.push({x:this.x+1,y:this.y-l.atoms_font_size_2D/2+1,w:t,h:l.atoms_font_size_2D-2})}else this.condensed&&this.condensed.text===this.label||(this.condensed=new n.CondensedLabel(this,this.label)),this.condensed.draw(r,l);else{r.fillText(this.label,this.x,this.y);let t=r.measureText(this.label).width;this.textBounds.push({x:this.x-t/2,y:this.y-l.atoms_font_size_2D/2+1,w:t,h:l.atoms_font_size_2D-2})}let f=[];for(let t=0;t<this.numLonePair;t++)f.push({t:2});for(let t=0;t<this.numRadical;t++)f.push({t:1});if(this.enhancedStereo.type!==n.Atom.ESTEREO_ABSOLUTE&&f.push(this.enhancedStereo),f.length>0){r.fillStyle="black",r.font=e.getFontString(.8*l.atoms_font_size_2D,l.atoms_font_families_2D,l.atoms_font_bold_2D,l.atoms_font_italic_2D),r.textAlign="center",r.textBaseline="middle";let t=this.angles.slice(0),n=this.angleOfLeastInterference,a=this.largestAngle;if(h!==o){t.push(h),t.sort((function(t,e){return t-e}));let e=i.angleBetweenLargest(t);n=e.angle%(2*s.PI),a=e.largest}if(h===o&&s.abs(a-2*s.PI/t.length)<s.PI/60){let e=s.ceil(f.length/t.length);for(let t=0,i=f.length;t<i;t+=e,n+=a)this.drawAttribute(r,l,f.slice(t,s.min(f.length,t+e)),n,a,h,c)}else this.drawAttribute(r,l,f,n,a,h,c)}},l.drawAttribute=function(t,e,i,n,r,a,l){let h=r/(i.length+(0===this.bonds.length&&a===o?0:1)),u=n-r/2+h;for(let n=0;n<i.length;n++){let r=i[n],a=u+n*h,c=e.atoms_lonePairDistance_2D;l&&r.type!==o&&(c+=4);let f=this.x+Math.cos(a)*c,d=this.y-Math.sin(a)*c;if(r.type!==o){let e=r.type+r.group;t.fillText(e,f,d)}else if(2===r.t){let i=a+Math.PI/2,n=Math.cos(i)*e.atoms_lonePairSpread_2D/2,r=-Math.sin(i)*e.atoms_lonePairSpread_2D/2;t.beginPath(),t.arc(f+n,d+r,e.atoms_lonePairDiameter_2D,0,2*s.PI,!1),t.fill(),t.beginPath(),t.arc(f-n,d-r,e.atoms_lonePairDiameter_2D,0,2*s.PI,!1),t.fill()}else 1===r.t&&(t.beginPath(),t.arc(f,d,e.atoms_lonePairDiameter_2D,0,2*s.PI,!1),t.fill())}},l.drawDecorations=function(t,e){if(this.isHover||this.isSelected){t.strokeStyle=this.isHover?e.colorHover:e.colorSelect,t.lineWidth=1.2,t.beginPath();let i=this.isHover?7:15;t.arc(this.x,this.y,i,0,2*s.PI,!1),t.stroke()}this.isOverlap&&(t.strokeStyle=e.colorError,t.lineWidth=1.2,t.beginPath(),t.arc(this.x,this.y,7,0,2*s.PI,!1),t.stroke())},l.render=function(e,i,n){this.styles&&(i=this.styles);let s=r.translate(r.identity(),[this.x,this.y,this.z]),o=i.atoms_useVDWDiameters_3D?t[this.label].vdWRadius*i.atoms_vdwMultiplier_3D:i.atoms_sphereDiameter_3D/2;if(0===o&&(o=1),r.scale(s,[o,o,o]),!n){let n=i.atoms_color;i.atoms_useJMOLColors?n=t[this.label].jmolColor:i.atoms_usePYMOLColors&&(n=t[this.label].pymolColor),e.material.setDiffuseColor(e,n)}e.shader.setMatrixUniforms(e,s);let a=this.renderAsStar?e.starBuffer:e.sphereBuffer;e.drawElements(e.TRIANGLES,a.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)},l.renderHighlight=function(e,i){if(this.isSelected||this.isHover){this.styles&&(i=this.styles);let n=r.translate(r.identity(),[this.x,this.y,this.z]),s=i.atoms_useVDWDiameters_3D?t[this.label].vdWRadius*i.atoms_vdwMultiplier_3D:i.atoms_sphereDiameter_3D/2;0===s&&(s=1),s*=1.3,r.scale(n,[s,s,s]),e.shader.setMatrixUniforms(e,n),e.material.setDiffuseColor(e,this.isHover?i.colorHover:i.colorSelect);let o=this.renderAsStar?e.starBuffer:e.sphereBuffer;e.drawElements(e.TRIANGLES,o.vertexIndexBuffer.numItems,e.UNSIGNED_SHORT,0)}},l.isLabelVisible=function(e){return!(!e.atoms_displayAllCarbonLabels_2D&&"C"===this.label&&!this.altLabel&&t[this.label]&&-1===this.mass&&-1===this.implicitH&&0===this.charge&&(!e.atoms_showAttributedCarbons_2D||0===this.numRadical&&0===this.numLonePair)&&(!this.isHidden||!e.atoms_showHiddenCarbons_2D)&&(!e.atoms_displayTerminalCarbonLabels_2D||1!==this.bondNumber))},l.getImplicitHydrogenCount=function(){if(!t[this.label])return 0;if(-1!==this.implicitH)return this.implicitH;if(!t[this.label].addH||"H"===this.label)return 0;let e=t[this.label].valency,i=e-this.coordinationNumber;if(this.numRadical>0&&(i=s.max(0,i-this.numRadical)),this.charge>0){let t=4-e;this.charge<=t?i+=this.charge:i=4-this.coordinationNumber-this.charge+t}else i+=this.charge;return i<0?0:s.floor(i)},l.getBounds=function(){let t=new i.Bounds;if(t.expand(this.x,this.y),this.textBounds)for(let e=0,i=this.textBounds.length;e<i;e++){let i=this.textBounds[e];t.expand(i.x,i.y,i.x+i.w,i.y+i.h)}return t},l.getBounds3D=function(){let t=new i.Bounds;return t.expand3D(this.x,this.y,this.z),t},l.getElementColor=function(e,i,n){return t[this.label]?(e?n=t[this.label].jmolColor:i&&(n=t[this.label].pymolColor),n):"#000"}}(e.ELEMENT,e.extensions,e.math,e.structures,Math,e.lib.mat4),function(t,e,i,n,s,r,o,a){navigator.userAgent.indexOf("Safari")>-1&&-1===navigator.userAgent.indexOf("Chrome")&&(CanvasRenderingContext2D.prototype.oldStroke=CanvasRenderingContext2D.prototype.stroke,CanvasRenderingContext2D.prototype.stroke=function(){this.lineWidth+=.01*s.random(),this.oldStroke()}),i.Bond=function(t,e,n){this.a1=t,this.a2=e,this.bondOrder=n!==a?n:1,this.pid=i.PID++},i.Bond.STEREO_NONE="none",i.Bond.STEREO_PROTRUDING="protruding",i.Bond.STEREO_RECESSED="recessed",i.Bond.STEREO_AMBIGUOUS="ambiguous";let l=i.Bond.prototype;l.stereo=i.Bond.STEREO_NONE,l.isHover=!1,l.ring=a,l.getCenter=function(){return new i.Point((this.a1.x+this.a2.x)/2,(this.a1.y+this.a2.y)/2)},l.getLength=function(){return this.a1.distance(this.a2)},l.getLength3D=function(){return this.a1.distance3D(this.a2)},l.contains=function(t){return t===this.a1||t===this.a2},l.getNeighbor=function(t){return t===this.a1?this.a2:t===this.a2?this.a1:a},l.draw=function(t,e){if(this.a1.x===this.a2.x&&this.a1.y===this.a2.y)return;this.styles&&(e=this.styles);let r=this.a1.x,o=this.a2.x,a=this.a1.y,l=this.a2.y,h=this.a1.distance(this.a2),u=o-r,c=l-a;if(this.a1.isLassoed&&this.a2.isLassoed){let e=t.createLinearGradient(r,a,o,l);e.addColorStop(0,"rgba(212, 99, 0, 0)"),e.addColorStop(.5,"rgba(212, 99, 0, 0.8)"),e.addColorStop(1,"rgba(212, 99, 0, 0)");let i=2.5,n=this.a1.angle(this.a2)+s.PI/2,h=s.cos(n),u=s.sin(n),c=r-h*i,f=a+u*i,d=r+h*i,m=a-u*i,p=o+h*i,g=l-u*i,x=o-h*i,_=l+u*i;t.fillStyle=e,t.beginPath(),t.moveTo(c,f),t.lineTo(d,m),t.lineTo(p,g),t.lineTo(x,_),t.closePath(),t.fill()}if(e.atoms_display&&!e.atoms_circles_2D&&this.a1.isLabelVisible(e)&&this.a1.textBounds){let t=0;for(let e=0,i=this.a1.textBounds.length;e<i;e++)t=Math.max(t,n.calculateDistanceInterior(this.a1,this.a2,this.a1.textBounds[e]));t+=e.bonds_atomLabelBuffer_2D;let i=t/h;r+=u*i,a+=c*i}if(e.atoms_display&&!e.atoms_circles_2D&&this.a2.isLabelVisible(e)&&this.a2.textBounds){let t=0;for(let e=0,i=this.a2.textBounds.length;e<i;e++)t=Math.max(t,n.calculateDistanceInterior(this.a2,this.a1,this.a2.textBounds[e]));t+=e.bonds_atomLabelBuffer_2D;let i=t/h;o-=u*i,l-=c*i}if(e.bonds_clearOverlaps_2D){let i=r+.15*u,n=a+.15*c,s=o-.15*u,h=l-.15*c;t.strokeStyle=e.backgroundColor,t.lineWidth=e.bonds_width_2D+2*e.bonds_overlapClearWidth_2D,t.lineCap="round",t.beginPath(),t.moveTo(i,n),t.lineTo(s,h),t.stroke()}if(t.strokeStyle=this.error?e.colorError:e.bonds_color,t.fillStyle=this.error?e.colorError:e.bonds_color,t.lineWidth=e.bonds_width_2D,t.lineCap=e.bonds_ends_2D,e.bonds_splitColor){let i=t.createLinearGradient(r,a,o,l),n=this.a1.styles?this.a1.styles:e,s=this.a2.styles?this.a2.styles:e,h=this.a1.getElementColor(n.atoms_useJMOLColors,n.atoms_usePYMOLColors,n.atoms_color,2),u=this.a2.getElementColor(s.atoms_useJMOLColors,s.atoms_usePYMOLColors,s.atoms_color,2);i.addColorStop(0,h),e.bonds_colorGradient||(i.addColorStop(.5,h),i.addColorStop(.51,u)),i.addColorStop(1,u),t.strokeStyle=i,t.fillStyle=i}if(e.bonds_lewisStyle_2D&&this.bondOrder%1==0)this.drawLewisStyle(t,e,r,a,o,l);else switch(this.query?1:this.bondOrder){case 0:if(this.stereo!==i.Bond.STEREO_PROTRUDING){let i=o-r,n=l-a,h=s.sqrt(i*i+n*n),u=s.floor(h/e.bonds_dotSize_2D),c=(h-(u-1)*e.bonds_dotSize_2D)/2;u%2==1?c+=e.bonds_dotSize_2D/4:(c-=e.bonds_dotSize_2D/4,u+=2),u/=2;let f=this.a1.angle(this.a2),d=r+c*Math.cos(f),m=a-c*Math.sin(f);t.beginPath();for(let i=0;i<u;i++)t.arc(d,m,e.bonds_dotSize_2D/2,0,2*s.PI,!1),d+=2*e.bonds_dotSize_2D*Math.cos(f),m-=2*e.bonds_dotSize_2D*Math.sin(f);t.fill();break}{e.bonds_width_2D;let i=e.bonds_wedgeThickness_2D/2,n=this.a1.angle(this.a2),h=n+s.PI/2,u=2*e.shapes_arrowLength_2D/s.sqrt(3),c=s.cos(n),f=s.sin(n),d=s.cos(h),m=s.sin(h),p=o-c*u*.8,g=l+f*u*.8,x=p+d*i,_=g-m*i,b=p-d*i,y=g+m*i;t.beginPath(),t.moveTo(o,l),t.lineTo(x,_),t.lineTo(b,y),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(r,a),t.lineTo(p,g),t.stroke()}case.5:t.beginPath(),t.moveTo(r,a),t.lineTo(o,l),t.setLineDash([e.bonds_hashSpacing_2D,e.bonds_hashSpacing_2D]),t.stroke(),t.setLineDash([]);break;case 1:if(this.query||this.stereo!==i.Bond.STEREO_PROTRUDING&&this.stereo!==i.Bond.STEREO_RECESSED){if(!this.query&&this.stereo===i.Bond.STEREO_AMBIGUOUS){let i=o-r,n=l-a;t.beginPath(),t.moveTo(r,a);let h,u,c=s.floor(s.sqrt(i*i+n*n)/e.bonds_wavyLength_2D),f=r,d=a,m=this.a1.angle(this.a2)+s.PI/2,p=s.cos(m),g=s.sin(m),x=i/c,_=n/c;for(let i=0;i<c;i++){f+=x,d+=_;let n=i%2==0?1:-1;h=e.bonds_wavyLength_2D*p*n+f-.5*x,u=e.bonds_wavyLength_2D*-g*n+d-.5*_,t.quadraticCurveTo(h,u,f,d)}t.stroke();break}t.beginPath(),t.moveTo(r,a),t.lineTo(o,l),t.stroke(),this.query&&this.query.draw(t,e,this.getCenter())}else{let n=e.bonds_width_2D/2,h=e.bonds_wedgeThickness_2D/2,u=this.a1.angle(this.a2)+s.PI/2,c=s.cos(u),f=s.sin(u),d=r-c*n,m=a+f*n,p=r+c*n,g=a-f*n,x=o+c*h,_=l-f*h,b=o-c*h,y=l+f*h;if(t.beginPath(),t.moveTo(d,m),t.lineTo(p,g),t.lineTo(x,_),t.lineTo(b,y),t.closePath(),this.stereo===i.Bond.STEREO_PROTRUDING)t.fill();else{t.save(),t.clip(),t.lineWidth=2*h,t.lineCap="butt",t.beginPath(),t.moveTo(r,a);let i=o-r,n=l-a;t.lineTo(o+5*i,l+5*n),t.setLineDash([e.bonds_hashWidth_2D,e.bonds_hashSpacing_2D]),t.stroke(),t.setLineDash([]),t.restore()}}break;case 1.5:case 2:{let n=this.a1.angle(this.a2),h=n+s.PI/2,u=s.cos(h),c=s.sin(h),f=this.a1.distance(this.a2),d=e.bonds_useAbsoluteSaturationWidths_2D?e.bonds_saturationWidthAbs_2D/2:f*e.bonds_saturationWidth_2D/2;if(this.stereo===i.Bond.STEREO_AMBIGUOUS){let e=r-u*d,i=a+c*d,n=r+u*d,s=a-c*d,h=o+u*d,f=l-c*d,m=o-u*d,p=l+c*d;t.beginPath(),t.moveTo(e,i),t.lineTo(h,f),t.moveTo(n,s),t.lineTo(m,p),t.stroke()}else if(!e.bonds_symmetrical_2D&&(this.ring||"C"===this.a1.label&&"C"===this.a2.label)){t.beginPath(),t.moveTo(r,a),t.lineTo(o,l),t.stroke();let i=0;d*=2;let h=e.bonds_saturationAngle_2D;if(h<s.PI/2&&(i=-d/s.tan(h)),s.abs(i)<f/2){let h=r-s.cos(n)*i,f=o+s.cos(n)*i,m=a+s.sin(n)*i,p=l-s.sin(n)*i,g=h-u*d,x=m+c*d,_=h+u*d,b=m-c*d,y=f-u*d,v=p+c*d,w=f+u*d,T=p-c*d,S=!this.ring||this.ring.center.angle(this.a1)>this.ring.center.angle(this.a2)&&!(this.ring.center.angle(this.a1)-this.ring.center.angle(this.a2)>s.PI)||this.ring.center.angle(this.a1)-this.ring.center.angle(this.a2)<-s.PI;t.beginPath(),S?(t.moveTo(g,x),t.lineTo(y,v)):(t.moveTo(_,b),t.lineTo(w,T)),2!==this.bondOrder&&t.setLineDash([e.bonds_hashSpacing_2D,e.bonds_hashSpacing_2D]),t.stroke(),t.setLineDash([])}}else{let i=r-u*d,n=a+c*d,s=r+u*d,h=a-c*d,f=o+u*d,m=l-c*d,p=o-u*d,g=l+c*d;t.beginPath(),t.moveTo(i,n),t.lineTo(p,g),t.stroke(),t.beginPath(),t.moveTo(s,h),t.lineTo(f,m),2!==this.bondOrder&&t.setLineDash([e.bonds_hashWidth_2D,e.bonds_hashSpacing_2D]),t.stroke(),t.setLineDash([])}break}case 3:{let i=e.bonds_useAbsoluteSaturationWidths_2D?e.bonds_saturationWidthAbs_2D:this.a1.distance(this.a2)*e.bonds_saturationWidth_2D,n=this.a1.angle(this.a2)+s.PI/2,h=s.cos(n),u=s.sin(n),c=r-h*i,f=a+u*i,d=r+h*i,m=a-u*i,p=o+h*i,g=l-u*i,x=o-h*i,_=l+u*i;t.beginPath(),t.moveTo(c,f),t.lineTo(x,_),t.moveTo(d,m),t.lineTo(p,g),t.moveTo(r,a),t.lineTo(o,l),t.stroke();break}}},l.drawDecorations=function(t,e){if(this.isHover||this.isSelected){let i=2*s.PI,n=(this.a1.angleForStupidCanvasArcs(this.a2)+s.PI/2)%i;t.strokeStyle=this.isHover?e.colorHover:e.colorSelect,t.lineWidth=1.2,t.beginPath();let r=(n+s.PI)%i;r%=2*s.PI,t.arc(this.a1.x,this.a1.y,7,n,r,!1),t.stroke(),t.beginPath(),n+=s.PI,r=(n+s.PI)%i,t.arc(this.a2.x,this.a2.y,7,n,r,!1),t.stroke()}},l.drawLewisStyle=function(t,e,i,n,r,o){let a=this.a1.angle(this.a2),l=a+s.PI/2,h=r-i,u=o-n,c=s.sqrt(h*h+u*u)/(this.bondOrder+1),f=c*s.cos(a),d=-c*s.sin(a),m=i+f,p=n+d;for(let i=0;i<this.bondOrder;i++){let i=e.atoms_lonePairSpread_2D/2,n=m-s.cos(l)*i,r=p+s.sin(l)*i,o=m+s.cos(l)*i,a=p-s.sin(l)*i;t.beginPath(),t.arc(n-e.atoms_lonePairDiameter_2D/2,r-e.atoms_lonePairDiameter_2D/2,e.atoms_lonePairDiameter_2D,0,2*s.PI,!1),t.fill(),t.beginPath(),t.arc(o-e.atoms_lonePairDiameter_2D/2,a-e.atoms_lonePairDiameter_2D/2,e.atoms_lonePairDiameter_2D,0,2*s.PI,!1),t.fill(),m+=f,p+=d}},l.render=function(t,i,n){this.styles&&(i=this.styles);let a=this.a1.distance3D(this.a2);if(0===a)return;let l,h,u,c=i.bonds_cylinderDiameter_3D/2,f=i.bonds_color,d=r.translate(r.identity(),[this.a1.x,this.a1.y,this.a1.z]),m=[this.a2.x-this.a1.x,this.a2.y-this.a1.y,this.a2.z-this.a1.z],p=[0,1,0],g=0;if(this.a1.x===this.a2.x&&this.a1.z===this.a2.z?(u=[0,0,1],this.a2.y<this.a1.y&&(g=s.PI)):(g=e.vec3AngleFrom(p,m),u=o.cross(p,m,[])),i.bonds_splitColor){let t=this.a1.styles?this.a1.styles:i,e=this.a2.styles?this.a2.styles:i;f=this.a1.getElementColor(t.atoms_useJMOLColors,t.atoms_usePYMOLColors,t.atoms_color),l=this.a2.getElementColor(e.atoms_useJMOLColors,e.atoms_usePYMOLColors,e.atoms_color),f!=l&&(h=r.translate(r.identity(),[this.a2.x,this.a2.y,this.a2.z]))}let x,_=[0];if(n){if(i.bonds_showBondOrders_3D&&this.bondOrder>1){_=[i.bonds_cylinderDiameter_3D];let e=[0,0,1],n=r.inverse(t.rotationMatrix,[]);r.multiplyVec3(n,e),x=o.cross(m,e,[]),o.normalize(x)}let e=1,n=i.bonds_pillSpacing_3D,c=i.bonds_pillHeight_3D;0==this.bondOrder&&(i.bonds_renderAsLines_3D?c=n:(c=i.bonds_pillDiameter_3D,c<i.bonds_cylinderDiameter_3D&&(c/=2),e=c/2,a/=e,n/=e/2));let p=c+n,b=a/p,y=s.floor(b),v=a-p*y,w=(n+i.bonds_pillDiameter_3D+v)/2,T=y;h&&(T=s.floor(y/2));for(let n=0,a=_.length;n<a;n++){let a=r.set(d,[]);0!==_[n]&&r.translate(a,o.scale(x,_[n],[])),0!==g&&r.rotate(a,g,u),1!=e&&r.scale(a,[e,e,e]),f&&t.material.setDiffuseColor(t,f),r.translate(a,[0,w,0]);for(let e=0;e<T;e++)i.bonds_renderAsLines_3D?0==this.bondOrder?(t.shader.setMatrixUniforms(t,a),t.drawArrays(t.POINTS,0,1)):(r.scale(a,[1,c,1]),t.shader.setMatrixUniforms(t,a),t.drawArrays(t.LINES,0,t.lineBuffer.vertexPositionBuffer.numItems),r.scale(a,[1,1/c,1])):(t.shader.setMatrixUniforms(t,a),0==this.bondOrder?t.drawElements(t.TRIANGLES,t.sphereBuffer.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0):t.drawElements(t.TRIANGLES,t.pillBuffer.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0)),r.translate(a,[0,p,0]);if(h){let f,d;i.bonds_renderAsLines_3D?(f=c,f/=2,d=0):(f=2/3,d=(1-f)/2),y%2!=0&&(r.scale(a,[1,f,1]),t.shader.setMatrixUniforms(t,a),i.bonds_renderAsLines_3D?0==this.bondOrder?t.drawArrays(t.POINTS,0,1):t.drawArrays(t.LINES,0,t.lineBuffer.vertexPositionBuffer.numItems):0==this.bondOrder?t.drawElements(t.TRIANGLES,t.sphereBuffer.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0):t.drawElements(t.TRIANGLES,t.pillBuffer.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0),r.translate(a,[0,p*(1+d),0]),r.scale(a,[1,1/f,1])),r.set(h,a),0!==_[n]&&r.translate(a,o.scale(x,_[n],[])),r.rotate(a,g+s.PI,u),1!=e&&r.scale(a,[e,e,e]),l&&t.material.setDiffuseColor(t,l),r.translate(a,[0,w,0]);for(let e=0;e<T;e++)i.bonds_renderAsLines_3D?0==this.bondOrder?(t.shader.setMatrixUniforms(t,a),t.drawArrays(t.POINTS,0,1)):(r.scale(a,[1,c,1]),t.shader.setMatrixUniforms(t,a),t.drawArrays(t.LINES,0,t.lineBuffer.vertexPositionBuffer.numItems),r.scale(a,[1,1/c,1])):(t.shader.setMatrixUniforms(t,a),0==this.bondOrder?t.drawElements(t.TRIANGLES,t.sphereBuffer.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0):t.drawElements(t.TRIANGLES,t.pillBuffer.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0)),r.translate(a,[0,p,0]);y%2!=0&&(r.scale(a,[1,f,1]),t.shader.setMatrixUniforms(t,a),i.bonds_renderAsLines_3D?0==this.bondOrder?t.drawArrays(t.POINTS,0,1):t.drawArrays(t.LINES,0,t.lineBuffer.vertexPositionBuffer.numItems):0==this.bondOrder?t.drawElements(t.TRIANGLES,t.sphereBuffer.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0):t.drawElements(t.TRIANGLES,t.pillBuffer.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0),r.translate(a,[0,p*(1+d),0]),r.scale(a,[1,1/f,1]))}}}else{if(i.bonds_showBondOrders_3D){switch(this.bondOrder){case 1.5:_=[-i.bonds_cylinderDiameter_3D];break;case 2:_=[-i.bonds_cylinderDiameter_3D,i.bonds_cylinderDiameter_3D];break;case 3:_=[-1.2*i.bonds_cylinderDiameter_3D,0,1.2*i.bonds_cylinderDiameter_3D]}if(this.bondOrder>1){let e=[0,0,1],i=r.inverse(t.rotationMatrix,[]);r.multiplyVec3(i,e),x=o.cross(m,e,[]),o.normalize(x)}}else switch(this.bondOrder){case 0:c*=.25;break;case.5:case 1.5:c*=.5}h&&(a/=2);let e=[c,a,c];for(let n=0,a=_.length;n<a;n++){let a=r.set(d,[]);0!==_[n]&&r.translate(a,o.scale(x,_[n],[])),0!==g&&r.rotate(a,g,u),r.scale(a,e),f&&t.material.setDiffuseColor(t,f),t.shader.setMatrixUniforms(t,a),i.bonds_renderAsLines_3D?t.drawArrays(t.LINES,0,t.lineBuffer.vertexPositionBuffer.numItems):t.drawArrays(t.TRIANGLE_STRIP,0,t.cylinderBuffer.vertexPositionBuffer.numItems),h&&(r.set(h,a),0!==_[n]&&r.translate(a,o.scale(x,_[n],[])),r.rotate(a,g+s.PI,u),r.scale(a,e),l&&t.material.setDiffuseColor(t,l),t.shader.setMatrixUniforms(t,a),i.bonds_renderAsLines_3D?t.drawArrays(t.LINES,0,t.lineBuffer.vertexPositionBuffer.numItems):t.drawArrays(t.TRIANGLE_STRIP,0,t.cylinderBuffer.vertexPositionBuffer.numItems))}}},l.renderHighlight=function(t,i){if(this.isSelected||this.isHover){this.styles&&(i=this.styles),this.styles&&(i=this.styles);let n=this.a1.distance3D(this.a2);if(0===n)return;let a,l=i.bonds_cylinderDiameter_3D/1.2,h=r.translate(r.identity(),[this.a1.x,this.a1.y,this.a1.z]),u=[this.a2.x-this.a1.x,this.a2.y-this.a1.y,this.a2.z-this.a1.z],c=[0,1,0],f=0;this.a1.x===this.a2.x&&this.a1.z===this.a2.z?(a=[0,0,1],this.a2.y<this.a1.y&&(f=s.PI)):(f=e.vec3AngleFrom(c,u),a=o.cross(c,u,[]));let d=[l,n,l];0!==f&&r.rotate(h,f,a),r.scale(h,d),t.shader.setMatrixUniforms(t,h),t.material.setDiffuseColor(t,this.isHover?i.colorHover:i.colorSelect),t.drawArrays(t.TRIANGLE_STRIP,0,t.cylinderBuffer.vertexPositionBuffer.numItems)}},l.renderPicker=function(t,i){this.styles&&(i=this.styles);let n=this.a1.distance3D(this.a2);if(0===n)return;let a,l=i.bonds_cylinderDiameter_3D/2,h=r.translate(r.identity(),[this.a1.x,this.a1.y,this.a1.z]),u=[this.a2.x-this.a1.x,this.a2.y-this.a1.y,this.a2.z-this.a1.z],c=[0,1,0],f=0;this.a1.x===this.a2.x&&this.a1.z===this.a2.z?(a=[0,0,1],this.a2.y<this.a1.y&&(f=s.PI)):(f=e.vec3AngleFrom(c,u),a=o.cross(c,u,[]));let d,m=[0];if(i.bonds_showBondOrders_3D)if(i.bonds_renderAsLines_3D){switch(this.bondOrder){case 1.5:case 2:m=[-i.bonds_cylinderDiameter_3D,i.bonds_cylinderDiameter_3D];break;case 3:m=[-1.2*i.bonds_cylinderDiameter_3D,0,1.2*i.bonds_cylinderDiameter_3D]}if(this.bondOrder>1){let e=[0,0,1],i=r.inverse(t.rotationMatrix,[]);r.multiplyVec3(i,e),d=o.cross(u,e,[]),o.normalize(d)}}else switch(this.bondOrder){case 1.5:case 2:l*=3;break;case 3:l*=3.4}else switch(this.bondOrder){case 0:l*=.25;break;case.5:case 1.5:l*=.5}let p=[l,n,l];for(let e=0,n=m.length;e<n;e++){let n=r.set(h,[]);0!==m[e]&&r.translate(n,o.scale(d,m[e],[])),0!==f&&r.rotate(n,f,a),r.scale(n,p),t.shader.setMatrixUniforms(t,n),i.bonds_renderAsLines_3D?t.drawArrays(t.LINES,0,t.lineBuffer.vertexPositionBuffer.numItems):t.drawArrays(t.TRIANGLE_STRIP,0,t.cylinderBuffer.vertexPositionBuffer.numItems)}}}(e.ELEMENT,e.extensions,e.structures,e.math,Math,e.lib.mat4,e.lib.vec3),function(t,e,i){t.Ring=function(){this.atoms=[],this.bonds=[]};let n=t.Ring.prototype;n.center=void 0,n.setupBonds=function(){for(let t=0,e=this.bonds.length;t<e;t++)this.bonds[t].ring=this;this.center=this.getCenter()},n.getCenter=function(){let i=1/0,n=1/0,s=-1/0,r=-1/0;for(let t=0,o=this.atoms.length;t<o;t++)i=e.min(this.atoms[t].x,i),n=e.min(this.atoms[t].y,n),s=e.max(this.atoms[t].x,s),r=e.max(this.atoms[t].y,r);return new t.Point((s+i)/2,(r+n)/2)}}(e.structures,Math),function(t,e,i,n,s,r){i.Molecule=function(){this.atoms=[],this.bonds=[],this.rings=[]};let o=i.Molecule.prototype;o.findRings=!0,o.draw=function(t,e){if(this.styles&&(e=this.styles),e.atoms_display&&!e.atoms_circles_2D)for(let i=0,n=this.atoms.length;i<n;i++)this.atoms[i].draw(t,e);if(e.bonds_display)for(let i=0,n=this.bonds.length;i<n;i++)this.bonds[i].draw(t,e);if(e.atoms_display)for(let i=0,n=this.atoms.length;i<n;i++){let n=this.atoms[i];e.atoms_circles_2D&&n.draw(t,e),n.query&&n.query.draw(t,e,n)}},o.render=function(t,s){this.styles&&(s=this.styles);let o=this.atoms.length>0&&this.atoms[0].hetatm!==r;if(o){if(s.macro_displayBonds){this.bonds.length>0&&(s.bonds_renderAsLines_3D&&!this.residueSpecs||this.residueSpecs&&this.residueSpecs.bonds_renderAsLines_3D?(t.lineWidth(this.residueSpecs?this.residueSpecs.bonds_width_2D:s.bonds_width_2D),t.lineBuffer.bindBuffers(t)):t.cylinderBuffer.bindBuffers(t),t.material.setTempColors(t,s.bonds_materialAmbientColor_3D,r,s.bonds_materialSpecularColor_3D,s.bonds_materialShininess_3D));for(let e=0,i=this.bonds.length;e<i;e++){let i=this.bonds[e];!i.a1.hetatm&&(-1===s.macro_atomToLigandDistance||i.a1.closestDistance!==r&&s.macro_atomToLigandDistance>=i.a1.closestDistance&&s.macro_atomToLigandDistance>=i.a2.closestDistance)&&i.render(t,this.residueSpecs?this.residueSpecs:s)}}if(s.macro_displayAtoms){this.atoms.length>0&&(t.sphereBuffer.bindBuffers(t),t.material.setTempColors(t,s.atoms_materialAmbientColor_3D,r,s.atoms_materialSpecularColor_3D,s.atoms_materialShininess_3D));for(let e=0,i=this.atoms.length;e<i;e++){let i=this.atoms[e];!i.hetatm&&(-1===s.macro_atomToLigandDistance||i.closestDistance!==r&&s.macro_atomToLigandDistance>=i.closestDistance)&&i.render(t,this.residueSpecs?this.residueSpecs:s)}}}if(s.bonds_display){let e=[],i=[];this.bonds.length>0&&(s.bonds_renderAsLines_3D?(t.lineWidth(s.bonds_width_2D),t.lineBuffer.bindBuffers(t)):t.cylinderBuffer.bindBuffers(t),t.material.setTempColors(t,s.bonds_materialAmbientColor_3D,r,s.bonds_materialSpecularColor_3D,s.bonds_materialShininess_3D));for(let n=0,r=this.bonds.length;n<r;n++){let r=this.bonds[n];o&&!r.a1.hetatm||(s.bonds_showBondOrders_3D?0==r.bondOrder?i.push(r):.5==r.bondOrder?e.push(r):(1.5==r.bondOrder&&e.push(r),r.render(t,s)):r.render(t,s))}if(e.length>0){s.bonds_renderAsLines_3D||t.pillBuffer.bindBuffers(t);for(let i=0,n=e.length;i<n;i++)e[i].render(t,s,!0)}if(i.length>0){s.bonds_renderAsLines_3D||t.sphereBuffer.bindBuffers(t);for(let e=0,n=i.length;e<n;e++)i[e].render(t,s,!0)}}if(s.atoms_display){for(let t=0,e=this.atoms.length;t<e;t++){let e=this.atoms[t];e.bondNumber=0,e.renderAsStar=!1}for(let t=0,e=this.bonds.length;t<e;t++){let e=this.bonds[t];e.a1.bondNumber++,e.a2.bondNumber++}this.atoms.length>0&&(t.sphereBuffer.bindBuffers(t),t.material.setTempColors(t,s.atoms_materialAmbientColor_3D,r,s.atoms_materialSpecularColor_3D,s.atoms_materialShininess_3D));let e=[];for(let i=0,n=this.atoms.length;i<n;i++){let n=this.atoms[i];o&&(!n.hetatm||!s.macro_showWater&&n.isWater)||(s.atoms_nonBondedAsStars_3D&&0===n.bondNumber?(n.renderAsStar=!0,e.push(n)):n.render(t,s))}if(e.length>0){t.starBuffer.bindBuffers(t);for(let i=0,n=e.length;i<n;i++)e[i].render(t,s)}}if(this.chains){if(t.shader.setMatrixUniforms(t),s.proteins_displayRibbon){t.material.setTempColors(t,s.proteins_materialAmbientColor_3D,r,s.proteins_materialSpecularColor_3D,s.proteins_materialShininess_3D);let i=s.proteins_ribbonCartoonize?this.cartoons:this.ribbons;for(let n=0,r=i.length;n<r;n++){let r=i[n];if("none"!==s.proteins_residueColor){r.front.bindBuffers(t);let i="rainbow"===s.proteins_residueColor;for(let n=0,o=r.front.segments.length;n<o;n++)i&&t.material.setDiffuseColor(t,e.rainbowAt(n,o,s.macro_rainbowColors)),r.front.segments[n].render(t,s);r.back.bindBuffers(t);for(let n=0,o=r.back.segments.length;n<o;n++)i&&t.material.setDiffuseColor(t,e.rainbowAt(n,o,s.macro_rainbowColors)),r.back.segments[n].render(t,s)}else r.front.render(t,s),r.back.render(t,s)}}if(s.proteins_displayPipePlank)for(let e=0,i=this.pipePlanks.length;e<i;e++)this.pipePlanks[e].render(t,s);if(s.proteins_displayBackbone){if(!this.alphaCarbonTrace){this.alphaCarbonTrace={nodes:[],edges:[]};for(let t=0,e=this.chains.length;t<e;t++){let e=this.chains[t];if(!(e.length>2&&n[e[2].name]&&"#BEA06E"===n[e[2].name].aminoColor)&&e.length>0)for(let t=0,n=e.length-2;t<n;t++){let n=e[t].cp1;n.chainColor=e.chainColor,this.alphaCarbonTrace.nodes.push(n);let s=new i.Bond(e[t].cp1,e[t+1].cp1);s.residueName=e[t].name,s.chainColor=e.chainColor,this.alphaCarbonTrace.edges.push(s),t===e.length-3&&(n=e[t+1].cp1,n.chainColor=e.chainColor,this.alphaCarbonTrace.nodes.push(n))}}}if(this.alphaCarbonTrace.nodes.length>0){let o=new i.Styles;o.atoms_display=!0,o.bonds_display=!0,o.atoms_sphereDiameter_3D=s.proteins_backboneThickness,o.bonds_cylinderDiameter_3D=s.proteins_backboneThickness,o.bonds_splitColor=!1,o.atoms_color=s.proteins_backboneColor,o.bonds_color=s.proteins_backboneColor,o.atoms_useVDWDiameters_3D=!1,t.material.setTempColors(t,s.proteins_materialAmbientColor_3D,r,s.proteins_materialSpecularColor_3D,s.proteins_materialShininess_3D),t.material.setDiffuseColor(t,s.proteins_backboneColor);for(let e=0,i=this.alphaCarbonTrace.nodes.length;e<i;e++){let i=this.alphaCarbonTrace.nodes[e];s.macro_colorByChain&&(o.atoms_color=i.chainColor),t.sphereBuffer.bindBuffers(t),i.render(t,o)}for(let i=0,r=this.alphaCarbonTrace.edges.length;i<r;i++){let a,l=this.alphaCarbonTrace.edges[i],h=n[l.residueName]?n[l.residueName]:n["*"];s.macro_colorByChain?a=l.chainColor:"shapely"===s.proteins_residueColor?a=h.shapelyColor:"amino"===s.proteins_residueColor?a=h.aminoColor:"polarity"===s.proteins_residueColor?a=h.polar?"#C10000":"#FFFFFF":"acidity"===s.proteins_residueColor?a=1===h.acidity?"#0000FF":-1===h.acidity?"#FF0000":h.polar?"#FFFFFF":"#773300":"rainbow"===s.proteins_residueColor&&(a=e.rainbowAt(i,r,s.macro_rainbowColors)),a&&(o.bonds_color=a),t.cylinderBuffer.bindBuffers(t),l.render(t,o)}}}if(s.nucleics_display){t.material.setTempColors(t,s.nucleics_materialAmbientColor_3D,r,s.nucleics_materialSpecularColor_3D,s.nucleics_materialShininess_3D);for(let e=0,i=this.tubes.length;e<i;e++)t.shader.setMatrixUniforms(t),this.tubes[e].render(t,s)}}if(s.atoms_display){let e=!1;for(let t=0,i=this.atoms.length;t<i;t++){let i=this.atoms[t];if(i.isHover||i.isSelected){e=!0;break}}if(!e)for(let t=0,i=this.bonds.length;t<i;t++){let i=this.bonds[t];if(i.isHover||i.isSelected){e=!0;break}}if(e){t.sphereBuffer.bindBuffers(t),t.blendFunc(t.SRC_ALPHA,t.ONE),t.material.setTempColors(t,s.atoms_materialAmbientColor_3D,r,"#000000",0),t.enable(t.BLEND),t.depthMask(!1),t.material.setAlpha(t,.4),t.sphereBuffer.bindBuffers(t);for(let e=0,i=this.atoms.length;e<i;e++){let i=this.atoms[e];(i.isHover||i.isSelected)&&i.renderHighlight(t,s)}t.cylinderBuffer.bindBuffers(t);for(let e=0,i=this.bonds.length;e<i;e++){let i=this.bonds[e];(i.isHover||i.isSelected)&&i.renderHighlight(t,s)}t.depthMask(!0),t.disable(t.BLEND),t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA)}}},o.renderPickFrame=function(t,i,n,s,o){this.styles&&(i=this.styles);let a=this.atoms.length>0&&this.atoms[0].hetatm!==r;if(o&&i.bonds_display){this.bonds.length>0&&(i.bonds_renderAsLines_3D?(t.lineWidth(i.bonds_width_2D),t.lineBuffer.bindBuffers(t)):t.cylinderBuffer.bindBuffers(t));for(let s=0,r=this.bonds.length;s<r;s++){let r=this.bonds[s];a&&!r.a1.hetatm||(t.material.setDiffuseColor(t,e.idx2color(n.length)),r.renderPicker(t,i),n.push(r))}}if(s&&i.atoms_display){for(let t=0,e=this.atoms.length;t<e;t++){let e=this.atoms[t];e.bondNumber=0,e.renderAsStar=!1}for(let t=0,e=this.bonds.length;t<e;t++){let e=this.bonds[t];e.a1.bondNumber++,e.a2.bondNumber++}this.atoms.length>0&&t.sphereBuffer.bindBuffers(t);let s=[];for(let r=0,o=this.atoms.length;r<o;r++){let o=this.atoms[r];a&&(!o.hetatm||!i.macro_showWater&&o.isWater)||(i.atoms_nonBondedAsStars_3D&&0===o.bondNumber?(o.renderAsStar=!0,s.push(o)):(t.material.setDiffuseColor(t,e.idx2color(n.length)),o.render(t,i,!0),n.push(o)))}if(s.length>0){t.starBuffer.bindBuffers(t);for(let r=0,o=s.length;r<o;r++){let o=s[r];t.material.setDiffuseColor(t,e.idx2color(n.length)),o.render(t,i,!0),n.push(o)}}}},o.getCenter3D=function(){if(1===this.atoms.length)return new i.Atom("C",this.atoms[0].x,this.atoms[0].y,this.atoms[0].z);let t=1/0,e=1/0,n=1/0,r=-1/0,o=-1/0,a=-1/0;if(this.chains)for(let i=0,l=this.chains.length;i<l;i++){let l=this.chains[i];for(let i=0,h=l.length;i<h;i++){let h=l[i];t=s.min(h.cp1.x,h.cp2.x,t),e=s.min(h.cp1.y,h.cp2.y,e),n=s.min(h.cp1.z,h.cp2.z,n),r=s.max(h.cp1.x,h.cp2.x,r),o=s.max(h.cp1.y,h.cp2.y,o),a=s.max(h.cp1.z,h.cp2.z,a)}}for(let i=0,l=this.atoms.length;i<l;i++)t=s.min(this.atoms[i].x,t),e=s.min(this.atoms[i].y,e),n=s.min(this.atoms[i].z,n),r=s.max(this.atoms[i].x,r),o=s.max(this.atoms[i].y,o),a=s.max(this.atoms[i].z,a);return new i.Atom("C",(r+t)/2,(o+e)/2,(a+n)/2)},o.getCenter=function(){if(1===this.atoms.length)return new i.Point(this.atoms[0].x,this.atoms[0].y);let t=1/0,e=1/0,n=-1/0,r=-1/0;for(let i=0,o=this.atoms.length;i<o;i++)t=s.min(this.atoms[i].x,t),e=s.min(this.atoms[i].y,e),n=s.max(this.atoms[i].x,n),r=s.max(this.atoms[i].y,r);return new i.Point((n+t)/2,(r+e)/2)},o.getDimension=function(){if(1===this.atoms.length)return new i.Point(0,0);let t=1/0,e=1/0,n=-1/0,r=-1/0;if(this.chains){for(let i=0,o=this.chains.length;i<o;i++){let o=this.chains[i];for(let i=0,a=o.length;i<a;i++){let a=o[i];t=s.min(a.cp1.x,a.cp2.x,t),e=s.min(a.cp1.y,a.cp2.y,e),n=s.max(a.cp1.x,a.cp2.x,n),r=s.max(a.cp1.y,a.cp2.y,r)}}t-=30,e-=30,n+=30,r+=30}for(let i=0,o=this.atoms.length;i<o;i++)t=s.min(this.atoms[i].x,t),e=s.min(this.atoms[i].y,e),n=s.max(this.atoms[i].x,n),r=s.max(this.atoms[i].y,r);return new i.Point(n-t,r-e)},o.check=function(e){if(e&&this.doChecks){if(this.findRings)if(this.bonds.length-this.atoms.length!==this.fjNumCache){this.rings=new t.informatics.SSSRFinder(this).rings;for(let t=0,e=this.bonds.length;t<e;t++)this.bonds[t].ring=r;for(let t=0,e=this.rings.length;t<e;t++)this.rings[t].setupBonds()}else for(let t=0,e=this.rings.length;t<e;t++){let e=this.rings[t];e.center=e.getCenter()}for(let t=0,e=this.atoms.length;t<e;t++)if(this.atoms[t].isLone=!1,"C"===this.atoms[t].label){let e=0;for(let i=0,n=this.bonds.length;i<n;i++)this.bonds[i].a1!==this.atoms[t]&&this.bonds[i].a2!==this.atoms[t]||e++;0===e&&(this.atoms[t].isLone=!0)}let e=!1;for(let t=0,i=this.atoms.length;t<i;t++)0!==this.atoms[t].z&&(e=!0);e&&(this.sortAtomsByZ(),this.sortBondsByZ()),this.setupMetaData(),this.atomNumCache=this.atoms.length,this.bondNumCache=this.bonds.length,this.fjNumCache=this.bonds.length-this.atoms.length}this.doChecks=!e},o.getAngles=function(t){let e=[];for(let i=0,n=this.bonds.length;i<n;i++)this.bonds[i].contains(t)&&e.push(t.angle(this.bonds[i].getNeighbor(t)));return e.sort((function(t,e){return t-e})),e},o.getCoordinationNumber=function(t){let e=0;for(let i=0,n=t.length;i<n;i++)e+=t[i].bondOrder;return e},o.getBonds=function(t){let e=[];for(let i=0,n=this.bonds.length;i<n;i++)this.bonds[i].contains(t)&&e.push(this.bonds[i]);return e},o.sortAtomsByZ=function(){for(let t=1,e=this.atoms.length;t<e;t++){let e=t;for(;e>0&&this.atoms[e].z<this.atoms[e-1].z;){let t=this.atoms[e];this.atoms[e]=this.atoms[e-1],this.atoms[e-1]=t,e--}}},o.sortBondsByZ=function(){for(let t=1,e=this.bonds.length;t<e;t++){let e=t;for(;e>0&&this.bonds[e].a1.z+this.bonds[e].a2.z<this.bonds[e-1].a1.z+this.bonds[e-1].a2.z;){let t=this.bonds[e];this.bonds[e]=this.bonds[e-1],this.bonds[e-1]=t,e--}}},o.setupMetaData=function(){let t=this.getCenter();for(let i=0,n=this.atoms.length;i<n;i++){let n=this.atoms[i];n.bonds=this.getBonds(n),n.angles=this.getAngles(n),n.isHidden=2===n.bonds.length&&s.abs(s.abs(n.angles[1]-n.angles[0])-s.PI)<s.PI/30&&n.bonds[0].bondOrder===n.bonds[1].bondOrder;let r=e.angleBetweenLargest(n.angles);n.angleOfLeastInterference=r.angle%(2*s.PI),n.largestAngle=r.largest,n.coordinationNumber=this.getCoordinationNumber(n.bonds),n.bondNumber=n.bonds.length,n.molCenter=t}for(let e=0,i=this.bonds.length;e<i;e++)this.bonds[e].molCenter=t},o.scaleToAverageBondLength=function(t){let e=this.getAverageBondLength();if(0!==e){let i=t/e;for(let t=0,e=this.atoms.length;t<e;t++)this.atoms[t].x*=i,this.atoms[t].y*=i}},o.getAverageBondLength=function(){if(0===this.bonds.length)return 0;let t=0;for(let e=0,i=this.bonds.length;e<i;e++)t+=this.bonds[e].getLength();return t/=this.bonds.length,t},o.getBounds=function(){let t=new e.Bounds;for(let e=0,i=this.atoms.length;e<i;e++)t.expand(this.atoms[e].getBounds());if(this.chains){for(let e=0,i=this.chains.length;e<i;e++){let i=this.chains[e];for(let e=0,n=i.length;e<n;e++){let n=i[e];t.expand(n.cp1.x,n.cp1.y),t.expand(n.cp2.x,n.cp2.y)}}t.minX-=30,t.minY-=30,t.maxX+=30,t.maxY+=30}return t},o.getBounds3D=function(){let t=new e.Bounds;for(let e=0,i=this.atoms.length;e<i;e++)t.expand(this.atoms[e].getBounds3D());if(this.chains)for(let e=0,i=this.chains.length;e<i;e++){let i=this.chains[e];for(let e=0,n=i.length;e<n;e++){let n=i[e];t.expand3D(n.cp1.x,n.cp1.y,n.cp1.z),t.expand3D(n.cp2.x,n.cp2.y,n.cp2.z)}}return t},o.getAtomGroup=function(t){let e=!1;for(let t=0,e=this.atoms.length;t<e;t++)this.atoms[t].visited=!1;for(let i=0,n=this.bonds.length;i<n;i++){let n=this.bonds[i];!e&&n.contains(t)&&n.ring!==r&&(e=!0)}if(!e)return r;let n=[t];t.visited=!0;let s=new i.Queue;for(s.enqueue(t);!s.isEmpty();){let t=s.dequeue();for(let i=0,o=this.bonds.length;i<o;i++){let o=this.bonds[i];if(o.contains(t)&&e===(o.ring!==r)){let e=o.getNeighbor(t);e.visited||(e.visited=!0,n.push(e),s.enqueue(e))}}}return n},o.getBondGroup=function(t){let e=t.ring!==r,n=!1;for(let e=0,i=this.bonds.length;e<i;e++){let i=this.bonds[e];i===t&&(n=!0),i.visited=!1}if(!n)return r;let s=[t];t.visited=!0;let o=new i.Queue;for(o.enqueue(t);!o.isEmpty();){let t=o.dequeue();for(let i=0,n=this.bonds.length;i<n;i++){let n=this.bonds[i];n.visited||n.a1!==t.a1&&n.a2!==t.a1&&n.a1!==t.a2&&n.a2!==t.a2||n.ring!==r!==e||(n.visited=!0,s.push(n),o.enqueue(n))}}return s}}(e,e.math,e.structures,e.RESIDUE,Math),(l=e.structures).Reaction=function(){},l.Reaction.prototype.resolve=function(t,e){if(!t||!e)return;let i={reactants:[],products:[]},n=t.getPoints();if(!n)return i.reactants.push(...e),i;for(let t=0,s=e.length;t<s;t++){let s=e[t];s.getCenter().x<n[1].x?i.reactants.push(s):i.products.push(s)}return i},function(t,e,i,n,s){let r,o=-1;t.Residue=function(t){this.resSeq=t};let a=t.Residue.prototype;a.setup=function(e,i){this.horizontalResolution=i;let s=[e.x-this.cp1.x,e.y-this.cp1.y,e.z-this.cp1.z],r=[this.cp2.x-this.cp1.x,this.cp2.y-this.cp1.y,this.cp2.z-this.cp1.z],o=n.cross(s,r,[]);this.D=n.cross(o,s,[]),n.normalize(o),n.normalize(this.D),this.guidePointsSmall=[],this.guidePointsLarge=[];let a=[(e.x+this.cp1.x)/2,(e.y+this.cp1.y)/2,(e.z+this.cp1.z)/2];this.helix&&(n.scale(o,1.5),n.add(a,o)),this.guidePointsSmall[0]=new t.Atom("",a[0]-this.D[0]/2,a[1]-this.D[1]/2,a[2]-this.D[2]/2);for(let e=1;e<i;e++)this.guidePointsSmall[e]=new t.Atom("",this.guidePointsSmall[0].x+this.D[0]*e/i,this.guidePointsSmall[0].y+this.D[1]*e/i,this.guidePointsSmall[0].z+this.D[2]*e/i);n.scale(this.D,4),this.guidePointsLarge[0]=new t.Atom("",a[0]-this.D[0]/2,a[1]-this.D[1]/2,a[2]-this.D[2]/2);for(let e=1;e<i;e++)this.guidePointsLarge[e]=new t.Atom("",this.guidePointsLarge[0].x+this.D[0]*e/i,this.guidePointsLarge[0].y+this.D[1]*e/i,this.guidePointsLarge[0].z+this.D[2]*e/i)},a.getGuidePointSet=function(t){return 0===t?this.helix||this.sheet?this.guidePointsLarge:this.guidePointsSmall:1===t?this.guidePointsSmall:2===t?this.guidePointsLarge:void 0},a.computeLineSegments=function(t,e,i,n,s){this.setVerticalResolution(s),this.split=i.helix!==this.helix||i.sheet!==this.sheet,this.lineSegments=this.innerCompute(0,t,e,i,!1,s),n&&(this.lineSegmentsCartoon=this.innerCompute(this.helix||this.sheet?2:1,t,e,i,!0,s))},a.innerCompute=function(s,o,a,l,h,u){let c=[],f=this.getGuidePointSet(s),d=o.getGuidePointSet(s),m=a.getGuidePointSet(s),p=l.getGuidePointSet(s);for(let e=0,n=f.length;e<n;e++){let n=[d[e].x,d[e].y,d[e].z,1,m[e].x,m[e].y,m[e].z,1,f[e].x,f[e].y,f[e].z,1,p[e].x,p[e].y,p[e].z,1],s=i.multiply(n,r,[]),o=[];for(let e=0;e<u;e++){for(let t=3;t>0;t--)for(let e=0;e<4;e++)s[4*t+e]+=s[4*(t-1)+e];o[e]=new t.Atom("",s[12]/s[15],s[13]/s[15],s[14]/s[15])}c[e]=o}if(h&&this.arrow)for(let t=0,i=u;t<i;t++){let i=1.5-1.3*t/u,s=e.floor(this.horizontalResolution/2),r=c[s];for(let e=0,o=c.length;e<o;e++)if(e!==s){let s=r[t],o=c[e][t],a=[o.x-s.x,o.y-s.y,o.z-s.z];n.scale(a,i),o.x=s.x+a[0],o.y=s.y+a[1],o.z=s.z+a[2]}}return c},a.setVerticalResolution=function(t){t!==o&&function(t){let e=t*t,n=t*t*t,s=[6/n,0,0,0,6/n,2/e,0,0,1/n,1/e,1/t,0,0,0,0,1];r=i.multiply([-1/6,.5,-.5,1/6,.5,-1,.5,0,-.5,0,.5,0,1/6,2/3,1/6,0],s,[]),o=t}(t)}}(e.structures,Math,e.lib.mat4,e.lib.vec3),function(t,i,n,s,r,o){i.Spectrum=function(){this.data=[],this.metadata=[],this.dataDisplay=[],this.memory={offsetTop:0,offsetLeft:0,offsetBottom:0,flipXAxis:!1,scale:1,width:0,height:0}};let a=i.Spectrum.prototype;a.title=o,a.xUnit=o,a.yUnit=o,a.continuous=!0,a.integrationSensitivity=.01,a.draw=function(e,i,n,s){this.styles&&(i=this.styles);let o=5,a=0,l=0;e.fillStyle=i.text_color,e.textAlign="center",e.textBaseline="alphabetic",e.font=t.getFontString(i.text_font_size,i.text_font_families),this.xUnit&&(l+=i.text_font_size,e.fillText(this.xUnit,n/2,s-2)),this.yUnit&&i.plots_showYAxis&&(a+=i.text_font_size,e.save(),e.translate(i.text_font_size,s/2),e.rotate(-r.PI/2),e.fillText(this.yUnit,0,0),e.restore()),this.title&&(o+=i.text_font_size,e.fillText(this.title,n/2,i.text_font_size)),e.lineCap="square",l+=5+i.text_font_size,i.plots_showYAxis&&(a+=5+e.measureText("1000").width),i.plots_showGrid&&(e.strokeStyle=i.plots_gridColor,e.lineWidth=i.plots_gridLineWidth,e.strokeRect(a,o,n-a,s-l-o)),e.textAlign="center",e.textBaseline="top";let h=this.maxX-this.minX,u=h/100,c=.001;for(;c<u||h/c>25;)c*=10;let f=0,d=i.plots_flipXAxis?n:0;for(let t=r.round(this.minX/c)*c;t<=this.maxX;t+=c/2){let r=this.getTransformedX(t,i,n,a);if(r>a)if(e.strokeStyle="black",e.lineWidth=1,f%2==0){e.beginPath(),e.moveTo(r,s-l),e.lineTo(r,s-l+2),e.stroke();let n=t.toFixed(5);for(;"0"===n.charAt(n.length-1);)n=n.substring(0,n.length-1);"."===n.charAt(n.length-1)&&(n=n.substring(0,n.length-1));let a=e.measureText(n).width;i.plots_flipXAxis&&(a*=-1);let h=r-a/2;(i.plots_flipXAxis?h<d:h>d)&&(e.fillText(n,r,s-l+2),d=r+a/2),i.plots_showGrid&&(e.strokeStyle=i.plots_gridColor,e.lineWidth=i.plots_gridLineWidth,e.beginPath(),e.moveTo(r,s-l),e.lineTo(r,o),e.stroke())}else e.beginPath(),e.moveTo(r,s-l),e.lineTo(r,s-l+2),e.stroke();f++}if(i.plots_showYAxis||i.plots_showGrid){let t=1/i.scale;e.textAlign="right",e.textBaseline="middle";for(let h=0;h<=10;h++){let u=t/10*h,c=o+(s-l-o)*(1-u*i.scale);if(i.plots_showGrid&&(e.strokeStyle=i.plots_gridColor,e.lineWidth=i.plots_gridLineWidth,e.beginPath(),e.moveTo(a,c),e.lineTo(n,c),e.stroke()),i.plots_showYAxis){e.strokeStyle="black",e.lineWidth=1,e.beginPath(),e.moveTo(a,c),e.lineTo(a-3,c),e.stroke();let t=100*u,i=r.max(0,3-r.floor(t).toString().length),n=t.toFixed(i);if(i>0)for(;"0"===n.charAt(n.length-1);)n=n.substring(0,n.length-1);"."===n.charAt(n.length-1)&&(n=n.substring(0,n.length-1)),e.fillText(n,a-3,c)}}}if(e.strokeStyle="black",e.lineWidth=1,e.beginPath(),e.moveTo(n,s-l),e.lineTo(a,s-l),i.plots_showYAxis&&e.lineTo(a,o),e.stroke(),this.dataDisplay.length>0){e.textAlign="left",e.textBaseline="top";let t=0;for(let n=0,s=this.dataDisplay.length;n<s;n++)if(this.dataDisplay[n].value)e.fillText([this.dataDisplay[n].display,": ",this.dataDisplay[n].value].join(""),a+10,o+10+t*(i.text_font_size+5)),t++;else if(this.dataDisplay[n].tag)for(let s=0,r=this.metadata.length;s<r;s++)if(this.metadata[s].startsWith(this.dataDisplay[n].tag)){let r=this.metadata[s];if(this.dataDisplay[n].display){let t=this.metadata[s].indexOf("=");r=[this.dataDisplay[n].display,": ",t>-1?this.metadata[s].substring(t+2):this.metadata[s]].join("")}e.fillText(r,a+10,o+10+t*(i.text_font_size+5)),t++;break}}this.drawPlot(e,i,n,s,o,a,l),this.memory.offsetTop=o,this.memory.offsetLeft=a,this.memory.offsetBottom=l,this.memory.flipXAxis=i.plots_flipXAxis,this.memory.scale=i.scale,this.memory.width=n,this.memory.height=s},a.drawPlot=function(t,e,n,s,a,l,h){this.styles&&(e=this.styles),t.strokeStyle=e.plots_color,t.lineWidth=e.plots_width;let u=[];if(t.save(),t.rect(l,a,n-l,s-h-a),t.clip(),t.beginPath(),this.continuous){let c=!1,f=0,d=!1;for(let m=0,p=this.data.length;m<p;m++){let g,x=this.getTransformedX(this.data[m].x,e,n,l);if(m<p&&!c&&this.data[m+1]&&(g=this.getTransformedX(this.data[m+1].x,e,n,l)),x>=l&&x<n||g!==o&&g>=l&&g<n){let n=this.getTransformedY(this.data[m].y,e,s,h,a);if(e.plots_showIntegration&&r.abs(this.data[m].y)>this.integrationSensitivity&&u.push(new i.Point(this.data[m].x,this.data[m].y)),c||(t.moveTo(x,n),c=!0),t.lineTo(x,n),f++,f%1e3==0&&(t.stroke(),t.beginPath(),t.moveTo(x,n)),d)break}else c&&(d=!0)}}else for(let i=0,r=this.data.length;i<r;i++){let r=this.getTransformedX(this.data[i].x,e,n,l);r>=l&&r<n&&(t.moveTo(r,s-h),t.lineTo(r,this.getTransformedY(this.data[i].y,e,s,h,a)))}if(t.stroke(),e.plots_showIntegration&&u.length>1){t.strokeStyle=e.plots_integrationColor,t.lineWidth=e.plots_integrationLineWidth,t.beginPath();let i,r=u[1].x>u[0].x;if(this.flipXAxis&&!r||!this.flipXAxis&&r){for(let t=u.length-2;t>=0;t--)u[t].y=u[t].y+u[t+1].y;i=u[0].y}else{for(let t=1,e=u.length;t<e;t++)u[t].y=u[t].y+u[t-1].y;i=u[u.length-1].y}for(let r=0,o=u.length;r<o;r++){let o=this.getTransformedX(u[r].x,e,n,l),c=this.getTransformedY(u[r].y/e.scale/i,e,s,h,a);0===r?t.moveTo(o,c):t.lineTo(o,c)}t.stroke()}t.restore()},a.getTransformedY=function(t,e,i,n,s){return s+(i-n-s)*(1-t*e.scale)},a.getInverseTransformedY=function(t){return(1-(t-this.memory.offsetTop)/(this.memory.height-this.memory.offsetBottom-this.memory.offsetTop))/this.memory.scale*100},a.getTransformedX=function(t,e,i,n){let s=n+(t-this.minX)/(this.maxX-this.minX)*(i-n);return e.plots_flipXAxis&&(s=i+n-s),s},a.getInverseTransformedX=function(t){return this.memory.flipXAxis&&(t=this.memory.width+this.memory.offsetLeft-t),(t-this.memory.offsetLeft)*(this.maxX-this.minX)/(this.memory.width-this.memory.offsetLeft)+this.minX},a.setup=function(){let t=Number.MAX_VALUE,e=Number.MIN_VALUE,i=Number.MIN_VALUE;for(let n=0,s=this.data.length;n<s;n++)t=r.min(t,this.data[n].x),e=r.max(e,this.data[n].x),i=r.max(i,this.data[n].y);this.continuous?(this.minX=t,this.maxX=e):(this.minX=t-1,this.maxX=e+1);for(let t=0,e=this.data.length;t<e;t++)this.data[t].y/=i},a.zoom=function(t,e,i,s){let o=this.getInverseTransformedX(t),a=this.getInverseTransformedX(e);if(this.minX=r.min(o,a),this.maxX=r.max(o,a),s){let t=Number.MIN_VALUE;for(let e=0,i=this.data.length;e<i;e++)n.isBetween(this.data[e].x,this.minX,this.maxX)&&(t=r.max(t,this.data[e].y));return 1/t}},a.translate=function(t,e){let i=t/(e-this.memory.offsetLeft)*(this.maxX-this.minX)*(this.memory.flipXAxis?1:-1);this.minX+=i,this.maxX+=i},a.alertMetadata=function(){alert(this.metadata.join("\n"))},a.getInternalCoordinates=function(t,i){return new e.structures.Point(this.getInverseTransformedX(t),this.getInverseTransformedY(i))},a.getClosestPlotInternalCoordinates=function(t){let i=this.getInverseTransformedX(t-1),s=this.getInverseTransformedX(t+1);if(i>s){let t=i;i=s,s=t}let r=-1,a=-1/0,l=!1;for(let t=0,e=this.data.length;t<e;t++){let e=this.data[t];if(n.isBetween(e.x,i,s))e.y>a&&(l=!0,a=e.y,r=t);else if(l)break}if(-1===r)return o;let h=this.data[r];return new e.structures.Point(h.x,100*h.y)},a.getClosestPeakInternalCoordinates=function(t){let i=this.getInverseTransformedX(t),n=0,s=1/0;for(let t=0,e=this.data.length;t<e;t++){let e=r.abs(this.data[t].x-i);if(!(e<=s))break;s=e,n=t}let o=n,a=n,l=this.data[n].y,h=this.data[n].y;for(let t=n+1,e=this.data.length;t<e&&this.data[t].y+.05>h;t++)h=this.data[t].y,a=t;for(let t=n-1;t>=0&&this.data[t].y+.05>l;t--)l=this.data[t].y,o=t;let u=this.data[o-n>a-n?a:o];return new e.structures.Point(u.x,100*u.y)}}(e.extensions,e.structures,e.math,e.lib.jQuery,Math),function(t,e,i,n){e._Shape=function(){};let s=e._Shape.prototype;s.drawDecorations=function(t,e){if(this.isHover){let i=this.getPoints();for(let n=0,s=i.length;n<s;n++){let s=i[n];this.drawAnchor(t,e,s,s===this.hoverPoint)}}},s.getBounds=function(){let e=new t.Bounds,i=this.getPoints();for(let t=0,n=i.length;t<n;t++){let n=i[t];e.expand(n.x,n.y)}return e},s.drawAnchor=function(t,e,n,s){t.save(),t.translate(n.x,n.y),t.rotate(i.PI/4),t.scale(1/e.scale,1/e.scale),t.beginPath(),t.moveTo(-4,-4),t.lineTo(4,-4),t.lineTo(4,4),t.lineTo(-4,4),t.closePath(),t.fillStyle=s?e.colorHover:"white",t.fill(),t.beginPath(),t.moveTo(-4,-2),t.lineTo(-4,-4),t.lineTo(-2,-4),t.moveTo(2,-4),t.lineTo(4,-4),t.lineTo(4,-2),t.moveTo(4,2),t.lineTo(4,4),t.lineTo(2,4),t.moveTo(-2,4),t.lineTo(-4,4),t.lineTo(-4,2),t.moveTo(-4,-2),t.strokeStyle="rgba(0,0,0,.2)",t.lineWidth=5,t.stroke(),t.strokeStyle="blue",t.lineWidth=1,t.stroke(),t.restore()}}(e.math,e.structures.d2,Math),function(t,e,i,n,s,r){n.AtomMapping=function(t,e){this.o1=t,this.o2=e,this.label="0",this.error=!1};let o=n.AtomMapping.prototype=new n._Shape;o.drawDecorations=function(t,e){(this.isHover||this.isSelected)&&(t.strokeStyle=this.isHover?e.colorHover:e.colorSelect,t.lineWidth=1,t.beginPath(),t.moveTo(this.o1.x,this.o1.y),t.lineTo(this.o2.x,this.o2.y),t.setLineDash([2]),t.stroke(),t.setLineDash([]))},o.draw=function(e,i){if(this.o1&&this.o2){let n=14;this.x1=this.o1.x+n*s.cos(this.o1.angleOfLeastInterference),this.y1=this.o1.y-n*s.sin(this.o1.angleOfLeastInterference),this.x2=this.o2.x+n*s.cos(this.o2.angleOfLeastInterference),this.y2=this.o2.y-n*s.sin(this.o2.angleOfLeastInterference),e.font=t.getFontString(i.text_font_size,i.text_font_families,i.text_font_bold,i.text_font_italic);let r=this.label,o=e.measureText(r).width;this.isLassoed&&(e.fillStyle=i.colorHover,e.fillRect(this.x1-o/2-3,this.y1-i.text_font_size/2-3,o+6,i.text_font_size+6),e.fillRect(this.x2-o/2-3,this.y2-i.text_font_size/2-3,o+6,i.text_font_size+6));let a=this.error?i.colorError:i.shapes_color;(this.isHover||this.isSelected)&&(a=this.isHover?i.colorHover:i.colorSelect),e.fillStyle=a,e.fillRect(this.x1-o/2-1,this.y1-i.text_font_size/2-1,o+2,i.text_font_size+2),e.fillRect(this.x2-o/2-1,this.y2-i.text_font_size/2-1,o+2,i.text_font_size+2),e.textAlign="center",e.textBaseline="middle",e.fillStyle=i.backgroundColor,e.fillText(r,this.x1,this.y1),e.fillText(r,this.x2,this.y2)}},o.getPoints=function(){return[new i.Point(this.x1,this.y1),new i.Point(this.x2,this.y2)]},o.isOver=function(t,e){return!!this.x1&&(t.distance({x:this.x1,y:this.y1})<e||t.distance({x:this.x2,y:this.y2})<e)}}(e.extensions,e.math,e.structures,e.structures.d2,Math),function(t,e,i,n,s,r){n.Bracket=function(t,e){this.p1=t||new i.Point,this.p2=e||new i.Point};let o=n.Bracket.prototype=new n._Shape;o.charge=0,o.mult=0,o.repeat=0,o.draw=function(e,i){let n=s.min(this.p1.x,this.p2.x),r=s.max(this.p1.x,this.p2.x),o=s.min(this.p1.y,this.p2.y),a=s.max(this.p1.y,this.p2.y),l=a-o,h=l/10;if(e.beginPath(),e.moveTo(n+h,o),e.lineTo(n,o),e.lineTo(n,a),e.lineTo(n+h,a),e.moveTo(r-h,a),e.lineTo(r,a),e.lineTo(r,o),e.lineTo(r-h,o),this.isLassoed){let t=e.createLinearGradient(this.p1.x,this.p1.y,this.p2.x,this.p2.y);t.addColorStop(0,"rgba(212, 99, 0, 0)"),t.addColorStop(.5,"rgba(212, 99, 0, 0.8)"),t.addColorStop(1,"rgba(212, 99, 0, 0)"),e.lineWidth=i.shapes_lineWidth+5,e.strokeStyle=t,e.lineJoin="miter",e.lineCap="square",e.stroke()}if(e.strokeStyle=i.shapes_color,e.lineWidth=i.shapes_lineWidth,e.lineJoin="miter",e.lineCap="butt",e.stroke(),0!==this.charge){e.fillStyle=i.text_color,e.textAlign="left",e.textBaseline="alphabetic",e.font=t.getFontString(i.text_font_size,i.text_font_families);let n=this.charge.toFixed(0);"1"===n?n="+":"-1"===n?n="":n.startsWith("-")?n=n.substring(1)+"":n+="+",e.fillText(n,r+5,o+5)}if(0!==this.mult&&(e.fillStyle=i.text_color,e.textAlign="right",e.textBaseline="middle",e.font=t.getFontString(i.text_font_size,i.text_font_families),e.fillText(this.mult.toFixed(0),n-5,o+l/2)),0!==this.repeat){e.fillStyle=i.text_color,e.textAlign="left",e.textBaseline="top",e.font=t.getFontString(i.text_font_size,i.text_font_families);let n=this.repeat.toFixed(0);e.fillText(n,r+5,a-5)}},o.getPoints=function(){return[this.p1,this.p2]},o.isOver=function(t,i){return e.isBetween(t.x,this.p1.x,this.p2.x)&&e.isBetween(t.y,this.p1.y,this.p2.y)}}(e.extensions,e.math,e.structures,e.structures.d2,Math),function(t,e,i,n,s,r,o){s.RepeatUnit=function(t,e){this.b1=t,this.b2=e,this.n1=1,this.n2=4,this.contents=[],this.ps=[]};let a=s.RepeatUnit.prototype=new s._Shape;a.drawDecorations=function(t,e){if(this.isHover)for(let e=0,i=this.contents.length;e<i;e++){let i=this.contents[e],n=t.createRadialGradient(i.x-1,i.y-1,0,i.x,i.y,7);n.addColorStop(0,"rgba(212, 99, 0, 0)"),n.addColorStop(.7,"rgba(212, 99, 0, 0.8)"),t.fillStyle=n,t.beginPath(),t.arc(i.x,i.y,5,0,2*r.PI,!1),t.fill()}};let l=function(t,e,i,s,o){let a=[],l=o.length>0?-1===o.indexOf(i.a1)?i.a2:i.a1:i.a1.distance(s.getCenter())<i.a2.distance(s.getCenter())?i.a1:i.a2,h=l.angle(i.getNeighbor(l)),u=h+r.PI/2,c=i.getLength()/(o.length>1?4:2),f=l.x+c*r.cos(h),d=l.y-c*r.sin(h),m=10*r.cos(u),p=10*r.sin(u),g=f+m,x=d-p,_=f-m,b=d+p,y=-4*r.cos(h),v=-4*r.sin(h),w=g+y,T=x-v,S=_+y,D=b-v;return t.beginPath(),t.moveTo(w,T),t.lineTo(g,x),t.lineTo(_,b),t.lineTo(S,D),t.stroke(),a.push(new n.Point(g,x)),a.push(new n.Point(_,b)),a};a.draw=function(e,i){if(this.b1&&this.b2){let n=this.error?i.colorError:i.shapes_color;(this.isHover||this.isSelected)&&(n=this.isHover?i.colorHover:i.colorSelect),e.strokeStyle=n,e.fillStyle=e.strokeStyle,e.lineWidth=i.shapes_lineWidth,e.lineJoin="miter",e.lineCap="butt";let s=l(e,0,this.b1,this.b2,this.contents),r=l(e,0,this.b2,this.b1,this.contents);this.ps=s.concat(r),this.b1.getCenter().x>this.b2.getCenter().x?this.ps[0].x>this.ps[1].x+5?this.textPos=this.ps[0]:this.textPos=this.ps[1]:this.ps[2].x>this.ps[3].x+5?this.textPos=this.ps[2]:this.textPos=this.ps[3],!this.error&&this.contents.length>0&&(e.font=t.getFontString(i.text_font_size,i.text_font_families,i.text_font_bold,i.text_font_italic),e.fillStyle=this.isHover?i.colorHover:i.text_color,e.textAlign="left",e.textBaseline="bottom",e.fillText(this.n1+"-"+this.n2,this.textPos.x+2,this.textPos.y+2))}},a.getPoints=function(){return this.ps},a.isOver=function(t,e){return!1},a.setContents=function(t){this.contents=[];let e=t.getMoleculeByAtom(this.b1.a1),i=t.getMoleculeByAtom(this.b2.a1);if(e&&e===i){let t=0,i=0;for(let n=0,s=e.rings.length;n<s;n++){let s=e.rings[n];for(let e=0,n=s.bonds.length;e<n;e++){let n=s.bonds[e];n===this.b1?t++:n===this.b2&&i++}}let s=1===t&&1===i&&this.b1.ring===this.b2.ring;if(this.contents.flippable=s,this.b1.ring===o&&this.b2.ring===o||s)for(let t=0,i=e.atoms.length;t<i;t++){let i=!1,r=!1,o=!1;for(let t=0,i=e.bonds.length;t<i;t++)e.bonds[t].visited=!1;let a=new n.Queue,l=e.atoms[t];for(a.enqueue(l);!(a.isEmpty()||i&&r);){let t=a.dequeue();s&&(!this.flip&&t===this.b1.a1||this.flip&&t===this.b1.a2)&&(o=!0);for(let n=0,s=e.bonds.length;n<s;n++){let s=e.bonds[n];s.a1!==t&&s.a2!==t||(s===this.b1?i=!0:s===this.b2?r=!0:s.visited||(s.visited=!0,a.enqueue(s.getNeighbor(t))))}}i&&r&&(!s||o)&&this.contents.push(l)}}}}(e.extensions,e.math,e.lib.jsBezier,e.structures,e.structures.d2,Math),function(t,e,i,n,s,r){n.Line=function(t,e){this.p1=t||new i.Point,this.p2=e||new i.Point},n.Line.ARROW_SYNTHETIC="synthetic",n.Line.ARROW_RETROSYNTHETIC="retrosynthetic",n.Line.ARROW_RESONANCE="resonance",n.Line.ARROW_EQUILIBRIUM="equilibrium";let o=n.Line.prototype=new n._Shape;o.arrowType=r,o.topText=r,o.bottomText=r,o.draw=function(e,i){if(this.isLassoed){let t=e.createLinearGradient(this.p1.x,this.p1.y,this.p2.x,this.p2.y);t.addColorStop(0,"rgba(212, 99, 0, 0)"),t.addColorStop(.5,"rgba(212, 99, 0, 0.8)"),t.addColorStop(1,"rgba(212, 99, 0, 0)");let i=2.5,n=this.p1.angle(this.p2)+s.PI/2,r=s.cos(n),o=s.sin(n),a=this.p1.x-r*i,l=this.p1.y+o*i,h=this.p1.x+r*i,u=this.p1.y-o*i,c=this.p2.x+r*i,f=this.p2.y-o*i,d=this.p2.x-r*i,m=this.p2.y+o*i;e.fillStyle=t,e.beginPath(),e.moveTo(a,l),e.lineTo(h,u),e.lineTo(c,f),e.lineTo(d,m),e.closePath(),e.fill()}if(e.strokeStyle=i.shapes_color,e.fillStyle=i.shapes_color,e.lineWidth=i.shapes_lineWidth,e.lineJoin="miter",e.lineCap="butt",this.p1.x!==this.p2.x||this.p1.y!==this.p2.y){if(this.arrowType===n.Line.ARROW_RETROSYNTHETIC){let t=2*s.sqrt(2),n=i.shapes_arrowLength_2D/t,r=this.p1.angle(this.p2),o=r+s.PI/2,a=i.shapes_arrowLength_2D/t,l=s.cos(r),h=s.sin(r),u=s.cos(o),c=s.sin(o),f=this.p1.x-u*n,d=this.p1.y+c*n,m=this.p1.x+u*n,p=this.p1.y-c*n,g=this.p2.x+u*n-l*a,x=this.p2.y-c*n+h*a,_=this.p2.x-u*n-l*a,b=this.p2.y+c*n+h*a,y=this.p2.x+u*n*2-l*a*2,v=this.p2.y-c*n*2+h*a*2,w=this.p2.x-u*n*2-l*a*2,T=this.p2.y+c*n*2+h*a*2;e.beginPath(),e.moveTo(m,p),e.lineTo(g,x),e.moveTo(y,v),e.lineTo(this.p2.x,this.p2.y),e.lineTo(w,T),e.moveTo(_,b),e.lineTo(f,d),e.stroke()}else if(this.arrowType===n.Line.ARROW_EQUILIBRIUM){let t=2*s.sqrt(2),n=i.shapes_arrowLength_2D/t/2,r=this.p1.angle(this.p2),o=r+s.PI/2,a=2*i.shapes_arrowLength_2D/s.sqrt(3),l=s.cos(r),h=s.sin(r),u=s.cos(o),c=s.sin(o),f=this.p1.x-u*n,d=this.p1.y+c*n,m=this.p1.x+u*n,p=this.p1.y-c*n,g=this.p2.x+u*n,x=this.p2.y-c*n,_=this.p2.x-u*n,b=this.p2.y+c*n;e.beginPath(),e.moveTo(m,p),e.lineTo(g,x),e.moveTo(_,b),e.lineTo(f,d),e.stroke();let y=g-l*a*.8,v=x+h*a*.8,w=g+u*i.shapes_arrowLength_2D/3-l*a,T=x-c*i.shapes_arrowLength_2D/3+h*a;e.beginPath(),e.moveTo(g,x),e.lineTo(w,T),e.lineTo(y,v),e.closePath(),e.fill(),e.stroke(),y=f+l*a*.8,v=d-h*a*.8,w=f-u*i.shapes_arrowLength_2D/3+l*a,T=d+c*i.shapes_arrowLength_2D/3-h*a,e.beginPath(),e.moveTo(f,d),e.lineTo(w,T),e.lineTo(y,v),e.closePath(),e.fill(),e.stroke()}else if(this.arrowType===n.Line.ARROW_SYNTHETIC){let t=this.p1.angle(this.p2),n=t+s.PI/2,r=2*i.shapes_arrowLength_2D/s.sqrt(3),o=s.cos(t),a=s.sin(t),l=s.cos(n),h=s.sin(n);e.beginPath(),e.moveTo(this.p1.x,this.p1.y),e.lineTo(this.p2.x-o*r/2,this.p2.y+a*r/2),e.stroke();let u=this.p2.x-o*r*.8,c=this.p2.y+a*r*.8,f=this.p2.x+l*i.shapes_arrowLength_2D/3-o*r,d=this.p2.y-h*i.shapes_arrowLength_2D/3+a*r,m=this.p2.x-l*i.shapes_arrowLength_2D/3-o*r,p=this.p2.y+h*i.shapes_arrowLength_2D/3+a*r;e.beginPath(),e.moveTo(this.p2.x,this.p2.y),e.lineTo(m,p),e.lineTo(u,c),e.lineTo(f,d),e.closePath(),e.fill(),e.stroke()}else if(this.arrowType===n.Line.ARROW_RESONANCE){let t=this.p1.angle(this.p2),n=t+s.PI/2,r=2*i.shapes_arrowLength_2D/s.sqrt(3),o=s.cos(t),a=s.sin(t),l=s.cos(n),h=s.sin(n);e.beginPath(),e.moveTo(this.p1.x+o*r/2,this.p1.y-a*r/2),e.lineTo(this.p2.x-o*r/2,this.p2.y+a*r/2),e.stroke();let u=this.p2.x-o*r*.8,c=this.p2.y+a*r*.8,f=this.p2.x+l*i.shapes_arrowLength_2D/3-o*r,d=this.p2.y-h*i.shapes_arrowLength_2D/3+a*r,m=this.p2.x-l*i.shapes_arrowLength_2D/3-o*r,p=this.p2.y+h*i.shapes_arrowLength_2D/3+a*r;e.beginPath(),e.moveTo(this.p2.x,this.p2.y),e.lineTo(m,p),e.lineTo(u,c),e.lineTo(f,d),e.closePath(),e.fill(),e.stroke(),u=this.p1.x+o*r*.8,c=this.p1.y-a*r*.8,f=this.p1.x-l*i.shapes_arrowLength_2D/3+o*r,d=this.p1.y+h*i.shapes_arrowLength_2D/3-a*r,m=this.p1.x+l*i.shapes_arrowLength_2D/3+o*r,p=this.p1.y-h*i.shapes_arrowLength_2D/3-a*r,e.beginPath(),e.moveTo(this.p1.x,this.p1.y),e.lineTo(m,p),e.lineTo(u,c),e.lineTo(f,d),e.closePath(),e.fill(),e.stroke()}else e.beginPath(),e.moveTo(this.p1.x,this.p1.y),e.lineTo(this.p2.x,this.p2.y),e.stroke();(this.topText||this.bottomText)&&(e.font=t.getFontString(i.text_font_size,i.text_font_families,i.text_font_bold,i.text_font_italic),e.fillStyle=i.text_color),this.topText&&(e.textAlign="center",e.textBaseline="bottom",e.fillText(this.topText,(this.p1.x+this.p2.x)/2,this.p1.y-5)),this.bottomText&&(e.textAlign="center",e.textBaseline="top",e.fillText(this.bottomText,(this.p1.x+this.p2.x)/2,this.p1.y+5))}},o.getPoints=function(){return[this.p1,this.p2]},o.isOver=function(t,i){let n=e.distanceFromPointToLineInclusive(t,this.p1,this.p2);return-1!==n&&n<i}}(e.extensions,e.math,e.structures,e.structures.d2,Math),function(t,e,i,n,s,r){let o=function(t){let e=[];if(t instanceof i.Atom){if(0===t.bondNumber)e.push(s.PI);else if(t.angles){if(1===t.angles.length)e.push(t.angles[0]+s.PI);else{for(let i=1,n=t.angles.length;i<n;i++)e.push(t.angles[i-1]+(t.angles[i]-t.angles[i-1])/2);let i=t.angles[0]+2*s.PI,n=t.angles[t.angles.length-1];e.push(n+(i-n)/2)}if(t.largestAngle>s.PI&&(e=[t.angleOfLeastInterference]),t.bonds)for(let i=0,n=t.bonds.length;i<n;i++){let n=t.bonds[i];if(2===n.bondOrder){let i=n.getNeighbor(t);if("O"===i.label){e=[i.angle(t)];break}}}}}else{let i=t.a1.angle(t.a2);e.push(i+s.PI/2),e.push(i+3*s.PI/2)}for(let t=0,i=e.length;t<i;t++){for(;e[t]>2*s.PI;)e[t]-=2*s.PI;for(;e[t]<0;)e[t]+=2*s.PI}return e},a=function(t,e){let n=3;return t instanceof i.Atom?(t.isLabelVisible(e)&&(n=8),0===t.charge&&0===t.numRadical&&0===t.numLonePair||(n=13)):t instanceof i.Point?n=0:t.bondOrder>1&&(n=5),n},l=function(t,e,n,r,o,l,h,u,c,f){let d=l.angle(o),m=h.angle(u),p=s.cos(d),g=s.sin(d),x=a(n,e);o.x-=p*x,o.y+=g*x;let _=m+s.PI/2,b=2*e.shapes_arrowLength_2D/s.sqrt(3);p=s.cos(m),g=s.sin(m);let y=s.cos(_),v=s.sin(_);u.x-=5*p,u.y+=5*g;let w=new i.Point(u.x,u.y);x=a(r,e)/3,w.x-=p*x,w.y+=g*x,u.x-=p*(.8*b+x),u.y+=g*(.8*b+x);let T=w.x-p*b*.8,S=w.y+g*b*.8,D=new i.Point(w.x+y*e.shapes_arrowLength_2D/3-p*b,w.y-v*e.shapes_arrowLength_2D/3+g*b),E=new i.Point(w.x-y*e.shapes_arrowLength_2D/3-p*b,w.y+v*e.shapes_arrowLength_2D/3+g*b),C=!0,A=!0;1===c&&(D.distance(l)>E.distance(l)?A=!1:C=!1),t.beginPath(),t.moveTo(w.x,w.y),A&&t.lineTo(E.x,E.y),t.lineTo(T,S),C&&t.lineTo(D.x,D.y),t.closePath(),t.fill(),t.stroke(),t.beginPath(),t.moveTo(o.x,o.y),t.bezierCurveTo(l.x,l.y,h.x,h.y,u.x,u.y),t.stroke(),f.push([o,l,h,u])};n.Pusher=function(t,e,i){this.o1=t,this.o2=e,this.numElectron=i||1};let h=n.Pusher.prototype=new n._Shape;h.drawDecorations=function(t,e){if(this.isHover){let n=[this.o1 instanceof i.Atom?new i.Point(this.o1.x,this.o1.y):this.o1.getCenter(),this.o2 instanceof i.Atom?new i.Point(this.o2.x,this.o2.y):this.o2.getCenter()];for(let i=0,s=n.length;i<s;i++){let s=n[i];this.drawAnchor(t,e,s,s===this.hoverPoint)}}},h.draw=function(e,n){if(this.o1&&this.o2){e.strokeStyle=n.shapes_color,e.fillStyle=n.shapes_color,e.lineWidth=n.shapes_lineWidth,e.lineJoin="miter",e.lineCap="butt";let r,a,h=this.o1 instanceof i.Atom?new i.Point(this.o1.x,this.o1.y):this.o1.getCenter(),u=this.o2 instanceof i.Atom?new i.Point(this.o2.x,this.o2.y):this.o2.getCenter(),c=35,f=o(this.o1),d=o(this.o2),m=1/0;for(let t=0,e=f.length;t<e;t++)for(let e=0,n=d.length;e<n;e++){let n=new i.Point(h.x+c*s.cos(f[t]),h.y-c*s.sin(f[t])),o=new i.Point(u.x+c*s.cos(d[e]),u.y-c*s.sin(d[e])),l=n.distance(o);l<m&&(m=l,r=n,a=o)}if(this.caches=[],-1===this.numElectron){let t=h.distance(u)/2,o=h.angle(u),f=o+s.PI/2,d=s.cos(o),m=s.sin(o),p=new i.Point(h.x+(t-1)*d,h.y-(t-1)*m),g=new i.Point(p.x+s.cos(f+s.PI/6)*c,p.y-s.sin(f+s.PI/6)*c),x=new i.Point(h.x+(t+1)*d,h.y-(t+1)*m),_=new i.Point(x.x+s.cos(f-s.PI/6)*c,x.y-s.sin(f-s.PI/6)*c);l(e,n,this.o1,p,h,r,g,p,1,this.caches),l(e,n,this.o2,x,u,a,_,x,1,this.caches)}else{if(t.intersectLines(h.x,h.y,r.x,r.y,u.x,u.y,a.x,a.y)){let t=r;r=a,a=t}let i=r.angle(h),o=a.angle(u),f=s.max(i,o)-s.min(i,o);s.abs(f-s.PI)<.001&&this.o1.molCenter===this.o2.molCenter&&(i+=s.PI/2,o-=s.PI/2,r.x=h.x+c*s.cos(i+s.PI),r.y=h.y-c*s.sin(i+s.PI),a.x=u.x+c*s.cos(o+s.PI),a.y=u.y-c*s.sin(o+s.PI)),l(e,n,this.o1,this.o2,h,r,a,u,this.numElectron,this.caches)}}},h.getPoints=function(){return[]},h.isOver=function(t,i){for(let n=0,s=this.caches.length;n<s;n++)if(e.distanceFromCurve(t,this.caches[n]).distance<i)return!0;return!1}}(e.math,e.lib.jsBezier,e.structures,e.structures.d2,Math),function(t,e,i,n,s){let r=new e.Bond;i.VAP=function(t,i){this.asterisk=new e.Atom("O",t,i),this.substituent,this.bondType=1,this.attachments=[]};let o=i.VAP.prototype=new i._Shape;o.drawDecorations=function(t,e){if(this.isHover||this.isSelected){t.strokeStyle=this.isHover?e.colorHover:e.colorSelect,t.lineWidth=1.2;let i=7;if(this.hoverBond){let s=2*n.PI,r=(this.asterisk.angleForStupidCanvasArcs(this.hoverBond)+n.PI/2)%s;t.strokeStyle=this.isHover?e.colorHover:e.colorSelect,t.beginPath();let o=(r+n.PI)%s;o%=2*n.PI,t.arc(this.asterisk.x,this.asterisk.y,i,r,o,!1),t.stroke(),t.beginPath(),r+=n.PI,o=(r+n.PI)%s,t.arc(this.hoverBond.x,this.hoverBond.y,i,r,o,!1),t.stroke()}else t.beginPath(),t.arc(this.asterisk.x,this.asterisk.y,i,0,2*n.PI,!1),t.stroke()}},o.draw=function(t,e){t.strokeStyle=this.error?e.colorError:e.shapes_color,t.lineWidth=1;let i=n.sqrt(3)/2;t.beginPath(),t.moveTo(this.asterisk.x,this.asterisk.y-4),t.lineTo(this.asterisk.x,this.asterisk.y+4),t.moveTo(this.asterisk.x-4*i,this.asterisk.y-2),t.lineTo(this.asterisk.x+4*i,this.asterisk.y+2),t.moveTo(this.asterisk.x-4*i,this.asterisk.y+2),t.lineTo(this.asterisk.x+4*i,this.asterisk.y-2),t.stroke(),this.asterisk.textBounds=[],this.asterisk.textBounds.push({x:this.asterisk.x-4,y:this.asterisk.y-4,w:8,h:8});let s=e.bonds_color;this.error&&(e.bonds_color=e.colorError),r.a1=this.asterisk,this.substituent&&(r.a2=this.substituent,r.bondOrder=this.bondType,r.draw(t,e)),r.bondOrder=0,this.error||(e.bonds_color=e.shapes_color);for(let i=0,n=this.attachments.length;i<n;i++)r.a2=this.attachments[i],r.draw(t,e);e.bonds_color=s},o.getPoints=function(){return[this.asterisk]},o.isOver=function(t,e){return!1}}(e.math,e.structures,e.structures.d2,Math),function(t,e,i){t._Mesh=function(){};let n=t._Mesh.prototype;n.storeData=function(t,e,i){this.positionData=t,this.normalData=e,this.indexData=i},n.setupBuffers=function(t){if(this.vertexPositionBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexPositionBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.positionData),t.STATIC_DRAW),this.vertexPositionBuffer.itemSize=3,this.vertexPositionBuffer.numItems=this.positionData.length/3,this.vertexNormalBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vertexNormalBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(this.normalData),t.STATIC_DRAW),this.vertexNormalBuffer.itemSize=3,this.vertexNormalBuffer.numItems=this.normalData.length/3,this.indexData&&(this.vertexIndexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indexData),t.STATIC_DRAW),this.vertexIndexBuffer.itemSize=1,this.vertexIndexBuffer.numItems=this.indexData.length),this.partitions)for(let e=0,i=this.partitions.length;e<i;e++){let i=this.partitions[e],n=this.generateBuffers(t,i.positionData,i.normalData,i.indexData);i.vertexPositionBuffer=n[0],i.vertexNormalBuffer=n[1],i.vertexIndexBuffer=n[2]}},n.generateBuffers=function(t,e,i,n){let s=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,s),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),s.itemSize=3,s.numItems=e.length/3;let r,o=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),o.itemSize=3,o.numItems=i.length/3,n&&(r=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(n),t.STATIC_DRAW),r.itemSize=1,r.numItems=n.length),[s,o,r]},n.bindBuffers=function(t){this.vertexPositionBuffer||this.setupBuffers(t),t.bindBuffer(t.ARRAY_BUFFER,this.vertexPositionBuffer),t.vertexAttribPointer(t.shader.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexNormalBuffer),t.vertexAttribPointer(t.shader.vertexNormalAttribute,this.vertexNormalBuffer.itemSize,t.FLOAT,!1,0,0),this.vertexIndexBuffer&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer)}}(e.structures.d3,Math),function(t,e){t._Measurement=function(){};let i=t._Measurement.prototype=new t._Mesh;i.render=function(t,i){t.shader.setMatrixUniforms(t),i.measurement_update_3D&&(this.vertexPositionBuffer=e,this.text=e),this.vertexPositionBuffer||this.calculateData(i),this.bindBuffers(t),t.material.setDiffuseColor(t,i.shapes_color),t.lineWidth(i.shapes_lineWidth),t.drawElements(t.LINES,this.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0)},i.renderText=function(t,e){t.shader.setMatrixUniforms(t),this.text||(this.text=this.getText(e));let i={position:[],texCoord:[],translation:[]};t.textImage.pushVertexData(this.text.value,this.text.pos,1,i),t.textMesh.storeData(t,i.position,i.texCoord,i.translation),t.textImage.useTexture(t),t.textMesh.render(t)}}(e.structures.d3),function(t,e,i,n,s,r,o,a){i.Angle=function(t,e,i){this.a1=t,this.a2=e,this.a3=i};let l=i.Angle.prototype=new i._Measurement;l.calculateData=function(t){let i=[],n=[],r=[],a=this.a2.distance3D(this.a1),l=this.a2.distance3D(this.a3);this.distUse=s.min(a,l)/2,this.vec1=o.normalize([this.a1.x-this.a2.x,this.a1.y-this.a2.y,this.a1.z-this.a2.z]),this.vec2=o.normalize([this.a3.x-this.a2.x,this.a3.y-this.a2.y,this.a3.z-this.a2.z]),this.angle=e.vec3AngleFrom(this.vec1,this.vec2);let h=o.normalize(o.cross(this.vec1,this.vec2,[])),u=o.normalize(o.cross(h,this.vec1,[])),c=t.measurement_angleBands_3D;for(let t=0;t<=c;++t){let e=this.angle*t/c,a=o.scale(this.vec1,s.cos(e),[]),l=o.scale(u,s.sin(e),[]),h=o.scale(o.normalize(o.add(a,l,[])),this.distUse);i.push(this.a2.x+h[0],this.a2.y+h[1],this.a2.z+h[2]),n.push(0,0,0),t<c&&r.push(t,t+1)}this.storeData(i,n,r)},l.getText=function(t){let e=o.scale(o.normalize(o.add(this.vec1,this.vec2,[])),this.distUse+.3);return{pos:[this.a2.x+e[0],this.a2.y+e[1],this.a2.z+e[2]],value:[n.angleBounds(this.angle,!0).toFixed(2)," "].join("")}}}(e.ELEMENT,e.extensions,e.structures.d3,e.math,Math,e.lib.mat4,e.lib.vec3),h=e.structures.d3,u=Math,h.Arrow=function(t,e){let i=[],n=[];for(let s=0;s<=e;s++){let r=2*s*u.PI/e,o=u.sin(r),a=u.cos(r),l=o;n.push(0,0,-1,0,0,-1,a,l,0,a,l,0,0,0,-1,0,0,-1,a,l,1,a,l,1),i.push(0,0,0,t*a,t*l,0,t*a,t*l,0,t*a,t*l,2,t*a,t*l,2,t*a*2,t*l*2,2,t*a*2,t*l*2,2,0,0,3)}let s=[];for(let t=0;t<e;t++){let e=8*t;for(let t=0,i=7;t<i;t++){let n=t+e,r=n+1,o=n+i+2,a=o-1;s.push(n,o,r,o,n,a)}}this.storeData(i,n,s)},h.Arrow.prototype=new h._Mesh,function(t,e,i){t.Box=function(t,e,i){t/=2,i/=2;let n=[],s=[];n.push(t,e,-i),n.push(t,e,-i),n.push(-t,e,-i),n.push(t,e,i),n.push(-t,e,i),n.push(-t,e,i);for(let t=6;t--;s.push(0,1,0));n.push(-t,e,i),n.push(-t,e,i),n.push(-t,0,i),n.push(t,e,i),n.push(t,0,i),n.push(t,0,i);for(let t=6;t--;s.push(0,0,1));n.push(t,e,i),n.push(t,e,i),n.push(t,0,i),n.push(t,e,-i),n.push(t,0,-i),n.push(t,0,-i);for(let t=6;t--;s.push(1,0,0));n.push(t,e,-i),n.push(t,e,-i),n.push(t,0,-i),n.push(-t,e,-i),n.push(-t,0,-i),n.push(-t,0,-i);for(let t=6;t--;s.push(0,0,-1));n.push(-t,e,-i),n.push(-t,e,-i),n.push(-t,0,-i),n.push(-t,e,i),n.push(-t,0,i),n.push(-t,0,i);for(let t=6;t--;s.push(-1,0,0));n.push(-t,0,i),n.push(-t,0,i),n.push(-t,0,-i),n.push(t,0,i),n.push(t,0,-i),n.push(t,0,-i);for(let t=6;t--;s.push(0,-1,0));this.storeData(n,s)},t.Box.prototype=new t._Mesh}(e.structures.d3,Math),function(t,e,i,n,s,r){e.Camera=function(){this.fieldOfView=45,this.aspect=1,this.near=.1,this.far=1e4,this.zoom=1,this.viewMatrix=n.identity([]),this.projectionMatrix=n.identity([])};let o=e.Camera.prototype;o.perspectiveProjectionMatrix=function(){let t=s.tan(this.fieldOfView/360*s.PI)*this.near*this.zoom,e=this.aspect*t;return n.frustum(-e,e,-t,t,this.near,this.far,this.projectionMatrix)},o.orthogonalProjectionMatrix=function(){let t=s.tan(this.fieldOfView/360*s.PI)*((this.far-this.near)/2+this.near)*this.zoom,e=this.aspect*t;return n.ortho(-e,e,-t,t,this.near,this.far,this.projectionMatrix)},o.updateProjectionMatrix=function(t){return t?this.perspectiveProjectionMatrix():this.orthogonalProjectionMatrix()},o.focalLength=function(){return(this.far-this.near)/2+this.near},o.zoomOut=function(){this.zoom=s.min(1.25*this.zoom,200)},o.zoomIn=function(){this.zoom=s.max(this.zoom/1.25,1/400)}}(e.math,e.structures.d3,e.lib.vec3,e.lib.mat4,window.Math),function(t,e,i,n){t.LineArrow=function(){let t=2.8,e=.1;this.storeData([0,0,-3,e,0,-t,0,0,-3,-e,0,-t,0,0,-3,0,0,3,0,0,3,e,0,t,0,0,3,-e,0,t],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])},t.LineArrow.prototype=new t._Mesh,t.Compass=function(n,s){this.textImage=new t.TextImage,this.textImage.init(n),this.textImage.updateFont(n,s.text_font_size,s.text_font_families,s.text_font_bold,s.text_font_italic,s.text_font_stroke_3D),this.textMesh=new t.TextMesh,this.textMesh.init(n);let r,o,a=3/(s.compass_size_3D/n.canvas.clientHeight),l=e.tan(s.projectionPerspectiveVerticalFieldOfView_3D/360*e.PI),h=a/l,u=e.max(h-a,.1),c=h+a,f=n.canvas.clientWidth/n.canvas.clientHeight;s.projectionPerspective_3D?(o=u,r=i.frustum):(o=h,r=i.ortho);let d=o/n.canvas.clientHeight*2*l,m=l*o,p=-m,g=f*p,x=f*m;if(0===s.compass_type_3D){let t=(-(n.canvas.clientWidth-s.compass_size_3D)/2+this.textImage.charHeight)*d,e=(-(n.canvas.clientHeight-s.compass_size_3D)/2+this.textImage.charHeight)*d;g-=t,x-=t,p-=e,m-=e}this.projectionMatrix=r(g,x,p,m,u,c),this.translationMatrix=i.translate(i.identity([]),[0,0,-h]);let _={position:[],texCoord:[],translation:[]};this.textImage.pushVertexData("X",[3.5,0,0],0,_),this.textImage.pushVertexData("Y",[0,3.5,0],0,_),this.textImage.pushVertexData("Z",[0,0,3.5],0,_),this.textMesh.storeData(n,_.position,_.texCoord,_.translation)};let s=t.Compass.prototype;s.renderArrow=function(t,e,i,n){t.material.setDiffuseColor(t,i),t.shader.setModelViewMatrix(t,n),1===e?t.drawArrays(t.LINES,0,t.lineArrowBuffer.vertexPositionBuffer.numItems):t.drawElements(t.TRIANGLES,t.arrowBuffer.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0)},s.render=function(t,n){t.shader.setProjectionMatrix(t,this.projectionMatrix),1===n.compass_type_3D?t.lineArrowBuffer.bindBuffers(t):t.arrowBuffer.bindBuffers(t),t.material.setTempColors(t,n.bonds_materialAmbientColor_3D,void 0,n.bonds_materialSpecularColor_3D,n.bonds_materialShininess_3D);let s=i.multiply(this.translationMatrix,t.rotationMatrix,[]),r=e.PI/2;this.renderArrow(t,n.compass_type_3D,n.compass_axisXColor_3D,i.rotateY(s,r,[])),this.renderArrow(t,n.compass_type_3D,n.compass_axisYColor_3D,i.rotateX(s,-r,[])),this.renderArrow(t,n.compass_type_3D,n.compass_axisZColor_3D,s)},s.renderAxis=function(t){t.shader.setProjectionMatrix(t,this.projectionMatrix);let e=i.multiply(this.translationMatrix,t.rotationMatrix,[]);t.shader.setModelViewMatrix(t,e),this.textImage.useTexture(t),this.textMesh.render(t)}}(e.structures.d3,Math,e.lib.mat4),function(t,e,i){t.Cylinder=function(t,i,n,s){let r=[],o=[];if(s){for(let i=0;i<=n;i++){let s=i%n*2*e.PI/n,a=e.cos(s),l=e.sin(s);o.push(0,-1,0),r.push(0,0,0),o.push(0,-1,0),r.push(t*a,0,t*l)}for(let s=0;s<=n;s++){let a=s%n*2*e.PI/n,l=e.cos(a),h=e.sin(a);o.push(l,0,h),r.push(t*l,0,t*h),o.push(l,0,h),r.push(t*l,i,t*h)}for(let s=0;s<=n;s++){let a=s%n*2*e.PI/n,l=e.cos(a),h=e.sin(a);o.push(0,1,0),r.push(t*l,i,t*h),o.push(0,1,0),r.push(0,i,0)}}else{for(let s=0;s<n;s++){let a=2*s*e.PI/n,l=e.cos(a),h=e.sin(a);o.push(l,0,h),r.push(t*l,0,t*h),o.push(l,0,h),r.push(t*l,i,t*h)}o.push(1,0,0),r.push(t,0,0),o.push(1,0,0),r.push(t,i,0)}this.storeData(r,o)},t.Cylinder.prototype=new t._Mesh}(e.structures.d3,Math),function(t,e,i,n,s){e.Distance=function(t,e,i,n){this.a1=t,this.a2=e,this.node=i,this.offset=n||0};let r=e.Distance.prototype=new e._Measurement;r.calculateData=function(e){let s=[this.a1.x,this.a1.y,this.a1.z,this.a2.x,this.a2.y,this.a2.z];if(this.node){let r=e.atoms_useVDWDiameters_3D?t[this.a1.label].vdWRadius*e.atoms_vdwMultiplier_3D:e.atoms_sphereDiameter_3D/2,o=e.atoms_useVDWDiameters_3D?t[this.a2.label].vdWRadius*e.atoms_vdwMultiplier_3D:e.atoms_sphereDiameter_3D/2;this.move=this.offset+i.max(r,o),this.displacement=[(this.a1.x+this.a2.x)/2-this.node.x,(this.a1.y+this.a2.y)/2-this.node.y,(this.a1.z+this.a2.z)/2-this.node.z],n.normalize(this.displacement);let a=n.scale(this.displacement,this.move,[]);s[0]+=a[0],s[1]+=a[1],s[2]+=a[2],s[3]+=a[0],s[4]+=a[1],s[5]+=a[2]}this.storeData(s,[0,0,0,0,0,0],[0,1])},r.getText=function(t){let e=this.a1.distance3D(this.a2),i=[(this.a1.x+this.a2.x)/2,(this.a1.y+this.a2.y)/2,(this.a1.z+this.a2.z)/2];if(this.node){let t=n.scale(this.displacement,this.move+.1,[]);i[0]+=t[0],i[1]+=t[1],i[2]+=t[2]}return{pos:i,value:[e.toFixed(2)," "].join("")}}}(e.ELEMENT,e.structures.d3,Math,e.lib.vec3),function(t,e,i,n){e.Fog=function(t,e,i,n){this.fogScene(t,e,i,n)},e.Fog.prototype.fogScene=function(e,i,n,s){this.colorRGB=t.getRGB(e,1),this.fogStart=i,this.fogEnd=n,this.density=s}}(e.math,e.structures.d3,e.lib.vec3),function(t,e,i){e.Label=function(t){};let n=e.Label.prototype;n.updateVerticesBuffer=function(e,i,n){for(let s=0,r=i.length;s<r;s++){let r=i[s],o=r.labelMesh,a=r.atoms,l={position:[],texCoord:[],translation:[]},h=a.length>0&&null!=a[0].hetatm;for(let i=0,s=a.length;i<s;i++){let s=a[i],r=s.label,o=.05;if(n.atoms_useVDWDiameters_3D){let e=t[r].vdWRadius*n.atoms_vdwMultiplier_3D;0===e&&(e=1),o+=e}else n.atoms_sphereDiameter_3D&&(o+=n.atoms_sphereDiameter_3D/2*1.5);if(h)if(s.hetatm){if(s.isWater&&!n.macro_showWaters)continue}else if(!n.macro_displayAtoms)continue;e.textImage.pushVertexData(s.altLabel?s.altLabel:s.label,[s.x,s.y,s.z],o,l)}let u=r.chains;if(u&&(n.proteins_displayRibbon||n.proteins_displayBackbone))for(let t=0,i=u.length;t<i;t++){let i=u[t];for(let t=0,n=i.length;t<n;t++){let n=i[t];if(n.name){let t=n.cp1;e.textImage.pushVertexData(n.name,[t.x,t.y,t.z],2,l)}}}o.storeData(e,l.position,l.texCoord,l.translation,l.zDepth)}},n.render=function(t,e,i){t.shader.setMatrixUniforms(t),t.textImage.useTexture(t);for(let e=0,n=i.length;e<n;e++)i[e].labelMesh&&i[e].labelMesh.render(t)}}(e.ELEMENT,e.structures.d3),function(t,e,i){t.Sphere=function(t,i,n){let s=[],r=[];for(let o=0;o<=i;o++){let a=o*e.PI/i,l=e.sin(a),h=e.cos(a);for(let i=0;i<=n;i++){let o=2*i*e.PI/n,a=e.sin(o),u=e.cos(o)*l,c=h,f=a*l;r.push(u,c,f),s.push(t*u,t*c,t*f)}}let o=[];n+=1;for(let t=0;t<i;t++)for(let e=0;e<n;e++){let i=t*n+e%n,s=i+n;o.push(i,i+1,s),e<n-1&&o.push(s,i+1,s+1)}this.storeData(s,r,o)},t.Sphere.prototype=new t._Mesh}(e.structures.d3,Math),function(t,e,i,n,s){function r(t,e,i,n){this.entire=t,this.name=e,this.indexes=i,this.pi=n}let o=r.prototype;o.getColor=function(e){return e.macro_colorByChain?this.entire.chainColor:this.name?this.getResidueColor(t[this.name]?this.name:"*",e):this.helix?this.entire.front?e.proteins_ribbonCartoonHelixPrimaryColor:e.proteins_ribbonCartoonHelixSecondaryColor:this.sheet?e.proteins_ribbonCartoonSheetColor:this.entire.front?e.proteins_primaryColor:e.proteins_secondaryColor},o.getResidueColor=function(e,i){let n=t[e];return"shapely"===i.proteins_residueColor?n.shapelyColor:"amino"===i.proteins_residueColor?n.aminoColor:"polarity"===i.proteins_residueColor?n.polar?"#C10000":"#FFFFFF":"acidity"===i.proteins_residueColor?1===n.acidity?"#0000FF":-1===n.acidity?"#FF0000":n.polar?"#FFFFFF":"#773300":"#FFFFFF"},o.render=function(t,e,i){this.entire.partitions&&this.pi!==this.entire.partitions.lastRender&&(function(t,e){t.bindBuffer(t.ARRAY_BUFFER,e.vertexPositionBuffer),t.vertexAttribPointer(t.shader.vertexPositionAttribute,e.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,e.vertexNormalBuffer),t.vertexAttribPointer(t.shader.vertexNormalAttribute,e.vertexNormalBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.vertexIndexBuffer)}(t,this.entire.partitions[this.pi]),this.entire.partitions.lastRender=this.pi),this.vertexIndexBuffer||(this.vertexIndexBuffer=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(this.indexes),t.STATIC_DRAW),this.vertexIndexBuffer.itemSize=1,this.vertexIndexBuffer.numItems=this.indexes.length),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,this.vertexIndexBuffer),i||"rainbow"===e.proteins_residueColor||t.material.setDiffuseColor(t,this.getColor(e)),t.drawElements(t.TRIANGLES,this.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0)},e.Ribbon=function(t,e,o){let a,l=t[0].lineSegments.length,h=t[0].lineSegments[0].length;this.partitions=[],this.partitions.lastRender=0,this.front=e>0;for(let s=0,r=t.length;s<r;s++){(!a||a.positionData.length>65e3)&&(this.partitions.length>0&&s--,a={count:0,positionData:[],normalData:[]},this.partitions.push(a));let r=t[s];a.count++;for(let u=0;u<l;u++){let c=o?r.lineSegmentsCartoon[u]:r.lineSegments[u],f=0===u,d=!1;for(let m=0;m<h;m++){let p=c[m],g=s,x=m+1;s===t.length-1&&m===h-1?x--:m===h-1&&(g++,x=0);let _=o?t[g].lineSegmentsCartoon[u][x]:t[g].lineSegments[u][x],b=!1,y=u+1;u===l-1&&(y-=2,b=!0);let v=o?r.lineSegmentsCartoon[y][m]:r.lineSegments[y][m],w=[_.x-p.x,_.y-p.y,_.z-p.z],T=[v.x-p.x,v.y-p.y,v.z-p.z],S=n.cross(w,T,[]);0===m&&(n.normalize(w),n.scale(w,-1),a.normalData.push(w[0],w[1],w[2]),a.positionData.push(p.x,p.y,p.z)),f||d?(n.normalize(T),n.scale(T,-1),a.normalData.push(T[0],T[1],T[2]),a.positionData.push(p.x,p.y,p.z),f&&m===h-1&&(f=!1,m=-1)):(n.normalize(S),(b&&!this.front||!b&&this.front)&&n.scale(S,-1),a.normalData.push(S[0],S[1],S[2]),n.scale(S,i.abs(e)),a.positionData.push(p.x+S[0],p.y+S[1],p.z+S[2]),u===l-1&&m===h-1&&(d=!0,m=-1)),-1!==m&&m!==h-1||(n.normalize(w),a.normalData.push(w[0],w[1],w[2]),a.positionData.push(p.x,p.y,p.z))}}}l+=2,h+=2,this.segments=[],this.partitionSegments=[];for(let e=0,i=this.partitions.length;e<i;e++){let i=this.partitions[e],n=[],a=s;for(let u=0,c=i.count-1;u<c;u++){let f=u;for(let t=0;t<e;t++)f+=this.partitions[t].count-1;a=t[f];let d=u*l*h,m=[];for(let t=0,s=l-1;t<s;t++){let s=d+t*h;for(let t=0;t<h-1;t++){let r=1;u===c&&(r=0);let o=[s+t,s+h+t,s+h+t+r,s+t,s+t+r,s+h+t+r];if(t!==h-1&&(this.front?m.push(o[0],o[1],o[2],o[3],o[5],o[4]):m.push(o[0],o[2],o[1],o[3],o[4],o[5])),t===h-2&&(u!==i.count-2||e!==this.partitions.length-1)){let e=l*h-t;o[2]+=e,o[4]+=e,o[5]+=e}this.front?n.push(o[0],o[1],o[2],o[3],o[5],o[4]):n.push(o[0],o[2],o[1],o[3],o[4],o[5])}}if(o&&a.split){let t=new r(this,s,n,e);t.helix=a.helix,t.sheet=a.sheet,this.partitionSegments.push(t),n=[]}this.segments.push(new r(this,a.name,m,e))}let u=new r(this,s,n,e);u.helix=a.helix,u.sheet=a.sheet,this.partitionSegments.push(u)}this.storeData(this.partitions[0].positionData,this.partitions[0].normalData),1===this.partitions.length&&(this.partitions=s)},(e.Ribbon.prototype=new e._Mesh).render=function(t,e){this.bindBuffers(t);let i=e.macro_colorByChain?this.chainColor:s;i||(i=this.front?e.proteins_primaryColor:e.proteins_secondaryColor),t.material.setDiffuseColor(t,i);for(let i=0,n=this.partitionSegments.length;i<n;i++)this.partitionSegments[i].render(t,e,!e.proteins_ribbonCartoonize)}}(e.RESIDUE,e.structures.d3,Math,e.lib.vec3),function(t,e,i,n,s){e.Light=function(t,i,n){this.camera=new e.Camera,this.lightScene(t,i,n)};let r=e.Light.prototype;r.lightScene=function(e,i,n){this.diffuseRGB=t.getRGB(e,1),this.specularRGB=t.getRGB(i,1),this.direction=n,this.updateView()},r.updateView=function(){let t=i.normalize(this.direction,[]),e=i.scale(t,(this.camera.near-this.camera.far)/2-this.camera.near,[]),s=i.equal(t,[0,1,0])?[0,0,1]:[0,1,0];n.lookAt(e,[0,0,0],s,this.camera.viewMatrix),this.camera.orthogonalProjectionMatrix()}}(e.math,e.structures.d3,e.lib.vec3,e.lib.mat4),function(t,e){t.Line=function(){this.storeData([0,0,0,0,1,0],[0,0,0,0,0,0])},t.Line.prototype=new t._Mesh}(e.structures.d3),function(t,e,i){e.Material=function(){};let n=e.Material.prototype;n.setTempColors=function(e,i,n,s,r){i&&e.shader.setMaterialAmbientColor(e,t.getRGB(i,1)),n&&e.shader.setMaterialDiffuseColor(e,t.getRGB(n,1)),s&&e.shader.setMaterialSpecularColor(e,t.getRGB(s,1)),e.shader.setMaterialShininess(e,r),e.shader.setMaterialAlpha(e,1)},n.setDiffuseColor=function(e,i){e.shader.setMaterialDiffuseColor(e,t.getRGB(i,1))},n.setAlpha=function(t,e){t.shader.setMaterialAlpha(t,e)}}(e.math,e.structures.d3),function(t,e,i,n){t.Picker=function(){};let s=t.Picker.prototype;s.init=function(t){this.framebuffer=t.createFramebuffer();let e=t.createTexture(),i=t.createRenderbuffer();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindRenderbuffer(t.RENDERBUFFER,i),t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,i),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},s.setDimension=function(t,e,i){t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer);let n=t.getFramebufferAttachmentParameter(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME);t.isRenderbuffer(n)&&(t.bindRenderbuffer(t.RENDERBUFFER,n),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,e,i),t.bindRenderbuffer(t.RENDERBUFFER,null));let s=t.getFramebufferAttachmentParameter(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME);t.isTexture(s)&&(t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e,i,0,t.RGBA,t.UNSIGNED_BYTE,null),t.bindTexture(t.TEXTURE_2D,null)),t.bindFramebuffer(t.FRAMEBUFFER,null)}}(e.structures.d3,e.math,document),function(t,e,i){t.Pill=function(t,i,n,s){let r=1,o=2*t;(i-=o)<0?(r=0,i+=o):i<o&&(r=i/o,i=o);let a=[],l=[];for(let o=0;o<=n;o++){let h=o*e.PI/n,u=e.sin(h),c=e.cos(h)*r;for(let r=0;r<=s;r++){let h=2*r*e.PI/s,f=e.sin(h),d=e.cos(h)*u,m=c,p=f*u;l.push(d,m,p),a.push(t*d,t*m+(o<n/2?i:0),t*p)}}let h=[];s+=1;for(let t=0;t<n;t++)for(let e=0;e<s;e++){let i=t*s+e%s,n=i+s;h.push(i,i+1,n),e<s-1&&h.push(n,i+1,n+1)}this.storeData(a,l,h)},t.Pill.prototype=new t._Mesh}(e.structures.d3,Math),function(t,e,i,n,s,r,o,a,l){function h(t,e,n){let s=new i.Residue(-1);return s.cp1=s.cp2=new i.Atom("",t,e,n),s}function u(t,e){this.a1=t,this.a2=e}function c(t,e,i){this.a1=t,this.a2=e,this.vx=i}u.prototype.render=function(e,i){let n,a=this.a1,l=this.a2,h=1.001*a.distance3D(l),u=i.proteins_cylinderHelixDiameter/2,c=[u,h,u],f=r.translate(r.identity(),[a.x,a.y,a.z]),d=[0,1,0],m=0;if(a.x===l.x&&a.z===l.z)n=[0,0,1],l.y<a.y&&(m=s.PI);else{let e=[l.x-a.x,l.y-a.y,l.z-a.z];m=t.vec3AngleFrom(d,e),n=o.cross(d,e,[])}0!==m&&r.rotate(f,m,n),r.scale(f,c),e.shader.setMatrixUniforms(e,f),e.drawArrays(e.TRIANGLE_STRIP,0,e.cylinderClosedBuffer.vertexPositionBuffer.numItems)},c.prototype.render=function(t,e){this.styles&&(e=this.styles);let i=1.001*this.a1.distance3D(this.a2),n=[this.a2.x-this.a1.x,this.a2.y-this.a1.y,this.a2.z-this.a1.z],s=o.cross(n,this.vx,[]),a=o.cross(s,n,[]);o.normalize(a),o.normalize(n),o.normalize(s);let l=[a[0],a[1],a[2],0,n[0],n[1],n[2],0,s[0],s[1],s[2],0,this.a1.x,this.a1.y,this.a1.z,1],h=[e.proteins_plankSheetWidth,i,e.proteins_tubeThickness];r.scale(l,h),t.shader.setMatrixUniforms(t,l),t.drawArrays(t.TRIANGLE_STRIP,0,t.boxBuffer.vertexPositionBuffer.numItems)},n.PipePlank=function(t,e){this.tubes=[],this.helixCylinders=[],this.sheetPlanks=[],this.chainColor=t.chainColor;let r=[],a=[],l=[],f=[];if(t.length>1){let e=t[0],i=t[1];i.helix?l.push(e):i.sheet?f.push(e):a.push(e)}for(let e=1,n=t.length-1;e<=n;e++){let d=t[e];if(d.helix){if(l.push(d),d.arrow){let c=o.create(),m=o.create();if(1===l.length){c=[d.guidePointsSmall[0].x,d.guidePointsSmall[0].y,d.guidePointsSmall[0].z];let t=d.guidePointsSmall[d.guidePointsSmall.length-1];m=[t.x,t.y,t.z]}else if(2===l.length)c=[l[0].cp1.x,l[0].cp1.y,l[0].cp1.z],m=[l[1].cp1.x,l[1].cp1.y,l[1].cp1.z];else{3===l.length&&l.unshift(t[s.max(e-3,0)]);let i=[],n=[];for(let t=1,e=l.length-1;t<e;t++){let e=[l[t].cp1.x,l[t].cp1.y,l[t].cp1.z],s=[l[t-1].cp1.x,l[t-1].cp1.y,l[t-1].cp1.z],r=[l[t+1].cp1.x,l[t+1].cp1.y,l[t+1].cp1.z];o.subtract(s,e),o.subtract(r,e);let a=o.scale(s,o.length(r),[]),h=o.scale(r,o.length(s),[]),u=o.normalize(o.add(a,h,[]));i.push(e),n.push(u)}let r=[];for(let t=0,e=i.length-1;t<e;t++){let e=i[t],s=n[t],a=i[t+1],l=n[t+1],h=o.normalize(o.cross(s,l,[])),u=o.subtract(a,e,[]),c=o.dot(u,h),f=o.scale(h,c,[]),d=o.length(f),m=o.length(u),p=-(d*d-m*m)/(2*o.dot(o.subtract(e,a,[]),l)),g=o.add(e,o.scale(s,p,[]),[]),x=o.add(a,o.scale(l,p,[]),[]);r.push([g,x])}let a=r[0][0],h=r[0][1],u=o.subtract(a,h,[]);o.add(a,u,c),a=r[r.length-1][1],h=r[r.length-1][0],u=o.subtract(a,h,[]),o.add(a,u,m)}let p=new i.Atom("",c[0],c[1],c[2]),g=new i.Atom("",m[0],m[1],m[2]);this.helixCylinders.push(new u(p,g)),l=[];let x=o.subtract(c,m,[]);if(o.normalize(x),o.scale(x,.5),a.length>0){let t=o.add(c,x,[]),e=a[a.length-1].cp1,n=o.subtract([e.x,e.y,e.z],t,[]);o.normalize(n),o.scale(n,.5),o.add(t,n);let s=new i.Residue(-1);s.cp1=s.cp2=new i.Atom("",t[0],t[1],t[2]),a.push(s),s=h(c[0],c[1],c[2]),a.push(s),r.push(a)}if(a=[],e<n){let i=h(m[0],m[1],m[2]);a.push(i);let n=t[e+1];if(n.sheet)a.push(d),a.push(d),r.push(a),a=[],f.push(d);else{o.scale(x,-1);let t=o.add(m,x,[]),e=n.cp1,i=o.subtract([e.x,e.y,e.z],t,[]);o.normalize(i),o.scale(i,.5),o.add(t,i);let s=h(t[0],t[1],t[2]);a.push(s)}}}}else if(d.sheet){if(f.push(d),d.arrow){let i=[0,0,0],s=[0,0,0],r=f.length;for(let t=0;t<r;t++){let e=f[t].guidePointsLarge,n=e[0],r=e[e.length-1];o.add(i,[n.x,n.y,n.z]),o.add(s,[r.x,r.y,r.z])}o.scale(i,1/r),o.scale(s,1/r);let l=o.subtract(i,s),u=f[0],m=f[r-1],p=u.guidePointsSmall[0],g=m.guidePointsSmall[0];if(this.sheetPlanks.push(new c(p,g,l)),f=[],e<n)if(t[e+1].sheet)f.push(d);else{let t=h(g.x,g.y,g.z);a.push(t)}}}else if(a.push(d),e<n&&t[e+1].sheet){let t=d.guidePointsSmall[0],e=h(t.x,t.y,t.z);a.push(e),r.push(a),a=[],f.push(d)}}a.length>1&&(2==a.length&&a.push(a[a.length-1]),r.push(a)),a=[];let d=[];for(let t=0,e=r.length;t<e;t++){let e=r[t],i=[];for(let t=0,n=e.length-1;t<=n;t++)i.push(e[t].cp1);d.push(i)}for(let i=0,s=d.length;i<s;i++){let s=new n.CatmullTube(d[i],e.proteins_tubeThickness,e.proteins_tubeResolution_3D,e.proteins_horizontalResolution);s.chainColor=t.chainColor,this.tubes.push(s)}},(n.PipePlank.prototype=new n._Mesh).render=function(t,e){t.material.setTempColors(t,e.proteins_materialAmbientColor_3D,void 0,e.proteins_materialSpecularColor_3D,e.proteins_materialShininess_3D),t.material.setDiffuseColor(t,e.macro_colorByChain?this.chainColor:e.proteins_tubeColor);for(let i=0,n=this.tubes.length;i<n;i++)t.shader.setMatrixUniforms(t),this.tubes[i].render(t,e);e.macro_colorByChain||t.material.setDiffuseColor(t,e.proteins_ribbonCartoonHelixSecondaryColor),t.cylinderClosedBuffer.bindBuffers(t);for(let i=0,n=this.helixCylinders.length;i<n;i++)this.helixCylinders[i].render(t,e);e.macro_colorByChain||t.material.setDiffuseColor(t,e.proteins_ribbonCartoonSheetColor),t.boxBuffer.bindBuffers(t);for(let i=0,n=this.sheetPlanks.length;i<n;i++)this.sheetPlanks[i].render(t,e)}}(e.extensions,e.RESIDUE,e.structures,e.structures.d3,Math,e.lib.mat4,e.lib.vec3,e.math),function(t,e){t.Quad=function(){this.storeData([-1,1,0,-1,-1,0,1,1,0,1,-1,0],[0,0,0,0,0,0,0,0,0,0,0,0])},t.Quad.prototype=new t._Mesh}(e.structures.d3),function(t,e,i,n){e.Shape=function(e,n){let s=e.length,r=[],o=[],a=new t.Point;for(let t=0,l=s;t<l;t++){let s=t+1;t===l-1&&(s=0);let h=[0,0,1],u=e[t],c=e[s],f=[c.x-u.x,c.y-u.y,0],d=i.cross(h,f);for(let t=0;t<2;t++)r.push(u.x,u.y,n/2),r.push(u.x,u.y,-n/2),r.push(c.x,c.y,n/2),r.push(c.x,c.y,-n/2);for(let t=0;t<4;t++)o.push(d[0],d[1],d[2]);o.push(0,0,1),o.push(0,0,-1),o.push(0,0,1),o.push(0,0,-1),a.add(u)}a.x/=s,a.y/=s,o.push(0,0,1),r.push(a.x,a.y,n/2),o.push(0,0,-1),r.push(a.x,a.y,-n/2);let l=[],h=8*s;for(let t=0,e=s;t<e;t++){let e=8*t;l.push(e),l.push(e+3),l.push(e+1),l.push(e),l.push(e+2),l.push(e+3),l.push(e+4),l.push(h),l.push(e+6),l.push(e+5),l.push(e+7),l.push(h+1)}this.storeData(r,o,l)},e.Shape.prototype=new e._Mesh}(e.structures,e.structures.d3,e.lib.vec3),function(t,e,i,n){t.Star=function(){let t=[.8944,.4472,0,.2764,.4472,.8506,.2764,.4472,-.8506,-.7236,.4472,.5257,-.7236,.4472,-.5257,-.3416,.4472,0,-.1056,.4472,.3249,-.1056,.4472,-.3249,.2764,.4472,.2008,.2764,.4472,-.2008,-.8944,-.4472,0,-.2764,-.4472,.8506,-.2764,-.4472,-.8506,.7236,-.4472,.5257,.7236,-.4472,-.5257,.3416,-.4472,0,.1056,-.4472,.3249,.1056,-.4472,-.3249,-.2764,-.4472,.2008,-.2764,-.4472,-.2008,-.5527,.1058,0,-.1708,.1058,.5527,-.1708,.1058,-.5527,.4471,.1058,.3249,.4471,.1058,-.3249,.5527,-.1058,0,.1708,-.1058,.5527,.1708,-.1058,-.5527,-.4471,-.1058,.3249,-.4471,-.1058,-.3249,0,1,0,0,-1,0],e=[0,9,8,2,7,9,4,5,7,3,6,5,1,8,6,0,8,23,30,6,8,3,21,6,11,26,21,13,23,26,2,9,24,30,8,9,1,23,8,13,25,23,14,24,25,4,7,22,30,9,7,0,24,9,14,27,24,12,22,27,3,5,20,30,7,5,2,22,7,12,29,22,10,20,29,1,6,21,30,5,6,4,20,5,10,28,20,11,21,28,10,19,18,12,17,19,14,15,17,13,16,15,11,18,16,31,19,17,14,17,27,2,27,22,4,22,29,10,29,19,31,18,19,12,19,29,4,29,20,3,20,28,11,28,18,31,16,18,10,18,28,3,28,21,1,21,26,13,26,16,31,15,16,11,16,26,1,26,23,0,23,25,14,25,15,31,17,15,13,15,25,0,25,24,2,24,27,12,27,17],n=[],s=[],r=[];for(let o=0,a=e.length;o<a;o+=3){let a=3*e[o],l=3*e[o+1],h=3*e[o+2],u=[t[a],t[a+1],t[a+2]],c=[t[l],t[l+1],t[l+2]],f=[t[h],t[h+1],t[h+2]],d=[u[0]-c[0],u[1]-c[1],u[2]-c[2]],m=[f[0]-c[0],f[1]-c[1],f[2]-c[2]],p=i.cross(m,d,[]);i.normalize(p),n.push(u[0],u[1],u[2],c[0],c[1],c[2],f[0],f[1],f[2]),s.push(p[0],p[1],p[2],p[0],p[1],p[2],p[0],p[1],p[2]),r.push(o,o+1,o+2)}this.storeData(n,s,r)},t.Star.prototype=new t._Mesh}(e.structures.d3,Math,e.lib.vec3),function(t,e,i,n,s){let r=1;n.devicePixelRatio&&(r=n.devicePixelRatio),t.TextImage=function(){this.ctx=i.createElement("canvas").getContext("2d"),this.data=[],this.text="",this.charHeight=0};let o=t.TextImage.prototype;o.init=function(t){this.textureImage=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.textureImage),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,null),this.updateFont(t,12,["Sans-serif"],!1,!1,!1)},o.charData=function(t){let e=this.text.indexOf(t);return e>=0?this.data[e]:null},o.updateFont=function(t,i,n,s,o,a){let l=this.ctx,h=this.ctx.canvas,u=[],c="";i*=r;let f=e.getFontString(i,n,s,o);l.font=f,l.save();let d=0,m=1.5*i;for(let t=32,e=127;t<e;t++){let e=String.fromCharCode(t),i=l.measureText(e).width;u.push({text:e,width:i,height:m}),d+=2*i}let p="".split("");for(let t=0,e=p.length;t<e;t++){let e=p[t],i=l.measureText(e).width;u.push({text:e,width:i,height:m}),d+=2*i}let g=d*m,x=Math.sqrt(g),_=Math.ceil(x/m),b=Math.ceil(d/(_-1));h.width=b,h.height=_*m,l.font=f,l.textAlign="left",l.textBaseline="middle",l.strokeStyle="#000",l.lineWidth=1.4,l.fillStyle="#fff";let y=0,v=0;for(let t=0,e=u.length;t<e;t++){let e=u[t],i=2*e.width,n=e.height,s=e.text;v+i>b&&(y++,v=0);let r=y*n;a&&l.strokeText(s,v,r+n/2),l.fillText(s,v,r+n/2),e.x=v,e.y=r,c+=s,v+=i}this.text=c,this.data=u,this.charHeight=m,t.bindTexture(t.TEXTURE_2D,this.textureImage),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,h),t.bindTexture(t.TEXTURE_2D,null)},o.pushVertexData=function(t,e,i,n){let s=t.toString().split(""),o=this.getHeight(),a=this.getWidth(),l=-this.textWidth(t)/2/r,h=-this.charHeight/2/r;for(let t=0,u=s.length;t<u;t++){let u=this.charData(s[t]),c=u.width,f=u.x/a,d=f+1.8*u.width/a,m=u.y/o,p=m+u.height/o,g=l+1.8*c/r,x=this.charHeight/2/r;n.position.push(e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2],e[0],e[1],e[2]),n.texCoord.push(f,m,d,p,d,m,f,m,f,p,d,p),n.translation.push(l,x,i,g,h,i,g,x,i,l,x,i,l,h,i,g,h,i),l=g+(c-1.8*c)/r}},o.getCanvas=function(){return this.ctx.canvas},o.getHeight=function(){return this.getCanvas().height},o.getWidth=function(){return this.getCanvas().width},o.textWidth=function(t){return this.ctx.measureText(t).width},o.test=function(){i.body.appendChild(this.getCanvas())},o.useTexture=function(t){t.bindTexture(t.TEXTURE_2D,this.textureImage)}}(e.structures.d3,e.extensions,document,window),function(t,e,i){t.TextMesh=function(){};let n=t.TextMesh.prototype;n.init=function(t){this.vertexPositionBuffer=t.createBuffer(),this.vertexTexCoordBuffer=t.createBuffer(),this.vertexTranslationBuffer=t.createBuffer()},n.setVertexData=function(t,e,i,n){t.bindBuffer(t.ARRAY_BUFFER,e),t.bufferData(t.ARRAY_BUFFER,new Float32Array(i),t.STATIC_DRAW),e.itemSize=n,e.numItems=i.length/n},n.storeData=function(t,e,i,n){this.setVertexData(t,this.vertexPositionBuffer,e,3),this.setVertexData(t,this.vertexTexCoordBuffer,i,2),this.setVertexData(t,this.vertexTranslationBuffer,n,3)},n.bindBuffers=function(t){t.bindBuffer(t.ARRAY_BUFFER,this.vertexPositionBuffer),t.vertexAttribPointer(t.shader.vertexPositionAttribute,this.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexTexCoordBuffer),t.vertexAttribPointer(t.shader.vertexTexCoordAttribute,this.vertexTexCoordBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,this.vertexTranslationBuffer),t.vertexAttribPointer(t.shader.vertexNormalAttribute,this.vertexTranslationBuffer.itemSize,t.FLOAT,!1,0,0)},n.render=function(t){let e=this.vertexPositionBuffer.numItems;e&&(this.bindBuffers(t),t.drawArrays(t.TRIANGLES,0,e))}}(e.structures.d3,Math),function(t,e,i,n,s,r,o){i.Torsion=function(t,e,i,n){this.a1=t,this.a2=e,this.a3=i,this.a4=n};let a=i.Torsion.prototype=new i._Measurement;a.calculateData=function(t){let e=[],i=[],s=[],o=this.a2.distance3D(this.a1),a=this.a2.distance3D(this.a3);this.distUse=n.min(o,a)/2;let l=[this.a2.x-this.a1.x,this.a2.y-this.a1.y,this.a2.z-this.a1.z],h=[this.a3.x-this.a2.x,this.a3.y-this.a2.y,this.a3.z-this.a2.z],u=[this.a4.x-this.a3.x,this.a4.y-this.a3.y,this.a4.z-this.a3.z],c=r.cross(l,h,[]),f=r.cross(h,u,[]);r.scale(l,r.length(h)),this.torsion=n.atan2(r.dot(l,f),r.dot(c,f));let d=r.normalize(r.cross(c,h,[])),m=r.normalize(r.cross(h,d,[]));this.pos=r.add([this.a2.x,this.a2.y,this.a2.z],r.scale(r.normalize(h,[]),this.distUse));let p,g=[],x=t.measurement_angleBands_3D,_=0;for(_=0;_<=x;++_){let t=this.torsion*_/x,o=r.scale(d,n.cos(t),[]),a=r.scale(m,n.sin(t),[]);p=r.scale(r.normalize(r.add(o,a,[])),this.distUse),0==_&&(g=p),e.push(this.pos[0]+p[0],this.pos[1]+p[1],this.pos[2]+p[2]),i.push(0,0,0),_<x&&s.push(_,_+1)}this.vecText=r.normalize(r.add(g,p,[]));let b=r.normalize(h,[]);r.scale(b,.0625);let y=this.torsion-2*n.asin(.125)*this.torsion/n.abs(this.torsion),v=r.scale(d,n.cos(y),[]),w=r.scale(m,n.sin(y),[]);p=r.scale(r.normalize(r.add(v,w,[])),this.distUse),e.push(this.pos[0]+b[0]+p[0],this.pos[1]+b[1]+p[1],this.pos[2]+b[2]+p[2]),i.push(0,0,0),e.push(this.pos[0]-b[0]+p[0],this.pos[1]-b[1]+p[1],this.pos[2]-b[2]+p[2]),i.push(0,0,0),s.push(--_,_+1,_,_+2),this.storeData(e,i,s)},a.getText=function(t){return r.add(this.pos,r.scale(this.vecText,this.distUse+.3,[])),{pos:this.pos,value:[e.angleBounds(this.torsion,!0,!0).toFixed(2)," "].join("")}}}(e.ELEMENT,e.math,e.structures.d3,Math,e.lib.mat4,e.lib.vec3),function(t,e,i,n,s,r,o,a,l){let h=function(t,e){t.bindBuffer(t.ARRAY_BUFFER,e.vertexPositionBuffer),t.vertexAttribPointer(t.shader.vertexPositionAttribute,e.vertexPositionBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ARRAY_BUFFER,e.vertexNormalBuffer),t.vertexAttribPointer(t.shader.vertexNormalAttribute,e.vertexNormalBuffer.itemSize,t.FLOAT,!1,0,0),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.vertexIndexBuffer)},u=function(t,e,i){let n=s.sqrt(e[1]*e[1]+e[2]*e[2]),o=[1,0,0,0,0,e[2]/n,-e[1]/n,0,0,e[1]/n,e[2]/n,0,0,0,0,1],a=[1,0,0,0,0,e[2]/n,e[1]/n,0,0,-e[1]/n,e[2]/n,0,0,0,0,1],l=[n,0,-e[0],0,0,1,0,0,e[0],0,n,0,0,0,0,1],h=[n,0,e[0],0,0,1,0,0,-e[0],0,n,0,0,0,0,1],u=[s.cos(i),-s.sin(i),0,0,s.sin(i),s.cos(i),0,0,0,0,1,0,0,0,0,1],c=r.multiply(o,r.multiply(l,r.multiply(u,r.multiply(h,a,[]))));this.rotate=function(){return r.multiplyVec3(c,t)}};n.Tube=function(n,l,c){let f,d=n[0].lineSegments[0].length;this.partitions=[],this.ends=[],this.ends.push(n[0].lineSegments[0][0]),this.ends.push(n[n.length-1].lineSegments[0][0]);let m=[1,0,0];for(let t=0,e=n.length;t<e;t++){(!f||f.positionData.length>65e3)&&(this.partitions.length>0&&t--,f={count:0,positionData:[],normalData:[],indexData:[]},this.partitions.push(f));let e=n[t];f.count++;let r=1/0,a=new i.Atom("",n[t].cp1.x,n[t].cp1.y,n[t].cp1.z);for(let i=0;i<d;i++){let h,p=e.lineSegments[0][i];h=i===d-1?t===n.length-1?e.lineSegments[0][i-1]:n[t+1].lineSegments[0][0]:e.lineSegments[0][i+1];let g=[h.x-p.x,h.y-p.y,h.z-p.z];o.normalize(g),t===n.length-1&&i===d-1&&o.scale(g,-1);let x=o.cross(g,m,[]);o.normalize(x),o.scale(x,l/2);let _=new u(x,g,2*Math.PI/c);for(let t=0,e=c;t<e;t++){let e=_.rotate();t===s.floor(c/4)&&(m=[e[0],e[1],e[2]]),f.normalData.push(e[0],e[1],e[2]),f.positionData.push(p.x+e[0],p.y+e[1],p.z+e[2])}if(a){let e=p.distance3D(a);e<r&&(r=e,n[t].pPoint=p)}}}for(let t=0,e=this.partitions.length;t<e;t++){let e=this.partitions[t];for(let t=0,i=e.count-1;t<i;t++){let i=t*d*c;for(let t=0,n=d;t<n;t++){let n=i+t*c;for(let t=0;t<c;t++){let i=1,s=n+t;e.indexData.push(s),e.indexData.push(s+c),e.indexData.push(s+c+i),e.indexData.push(s),e.indexData.push(s+c+i),e.indexData.push(s+i)}}}}this.storeData(this.partitions[0].positionData,this.partitions[0].normalData,this.partitions[0].indexData);let p=[new i.Point(2,0)];for(let t=0;t<60;t++){let e=t/60*s.PI;p.push(new i.Point(2*s.cos(e),-2*s.sin(e)))}p.push(new i.Point(-2,0),new i.Point(-2,4),new i.Point(2,4));let g=new i.d3.Shape(p,1);this.render=function(u,c){if(this.bindBuffers(u),u.material.setDiffuseColor(u,c.macro_colorByChain?this.chainColor:c.nucleics_tubeColor),u.drawElements(u.TRIANGLES,this.vertexIndexBuffer.numItems,u.UNSIGNED_SHORT,0),this.partitions)for(let t=1,e=this.partitions.length;t<e;t++){let e=this.partitions[t];h(u,e),u.drawElements(u.TRIANGLES,e.vertexIndexBuffer.numItems,u.UNSIGNED_SHORT,0)}u.sphereBuffer.bindBuffers(u);for(let t=0;t<2;t++){let e=this.ends[t],i=r.translate(r.identity(),[e.x,e.y,e.z]),n=l/2;r.scale(i,[n,n,n]),u.shader.setMatrixUniforms(u,i),u.drawElements(u.TRIANGLES,u.sphereBuffer.vertexIndexBuffer.numItems,u.UNSIGNED_SHORT,0)}u.cylinderBuffer.bindBuffers(u);for(let e=0,a=n.length-1;e<a;e++){let a,h=n[e],c=h.pPoint,f=new i.Atom("",h.cp2.x,h.cp2.y,h.cp2.z),d=1.001*c.distance3D(f),m=[l/4,d,l/4],p=r.translate(r.identity(),[c.x,c.y,c.z]),g=[0,1,0],x=0,_=[f.x-c.x,f.y-c.y,f.z-c.z];c.x===f.x&&c.z===f.z?(a=[0,0,1],c.y<c.y&&(x=s.PI)):(x=t.vec3AngleFrom(g,_),a=o.cross(g,_,[])),0!==x&&r.rotate(p,x,a),r.scale(p,m),u.shader.setMatrixUniforms(u,p),u.drawArrays(u.TRIANGLE_STRIP,0,u.cylinderBuffer.vertexPositionBuffer.numItems)}g.bindBuffers(u),"none"!==c.nucleics_residueColor||c.macro_colorByChain||u.material.setDiffuseColor(u,c.nucleics_baseColor);for(let i=0,l=n.length-1;i<l;i++){let h,f=n[i],d=f.cp2,m=r.translate(r.identity(),[d.x,d.y,d.z]),p=[0,1,0],x=0,_=f.cp3;if(_){let n=[_.x-d.x,_.y-d.y,_.z-d.z];d.x===_.x&&d.z===_.z?(h=[0,0,1],d.y<d.y&&(x=s.PI)):(x=t.vec3AngleFrom(p,n),h=o.cross(p,n,[])),0!==x&&r.rotate(m,x,h);let b=[1,0,0],y=r.rotate(r.identity([]),x,h);r.multiplyVec3(y,b);let v=f.cp4,w=f.cp5;if(v.y!==w.y||v.z!==w.z){let e=[w.x-v.x,w.y-v.y,w.z-v.z],i=t.vec3AngleFrom(b,e);o.dot(n,o.cross(b,e))<0&&(i*=-1),r.rotateY(m,i)}c.macro_colorByChain||("shapely"===c.nucleics_residueColor?e[f.name]?u.material.setDiffuseColor(u,e[f.name].shapelyColor):u.material.setDiffuseColor(u,e["*"].shapelyColor):"rainbow"===c.nucleics_residueColor&&u.material.setDiffuseColor(u,a.rainbowAt(i,l,c.macro_rainbowColors))),u.shader.setMatrixUniforms(u,m),u.drawElements(u.TRIANGLES,g.vertexIndexBuffer.numItems,u.UNSIGNED_SHORT,0)}}}},n.Tube.prototype=new n._Mesh,n.CatmullTube=function(t,e,n,r){let a=[];t.push(t[t.length-1]);for(let e=0,n=t.length-2;e<=n;e++){let s=t[0==e?0:e-1],o=t[e+0],l=t[e+1],h=t[e==n?e+1:e+2],u=[];for(let t=0;t<r;t++){let a=t/r;e==n&&(a=t/(r-1));let c=.5*(2*o.x+(l.x-s.x)*a+(2*s.x-5*o.x+4*l.x-h.x)*a*a+(3*o.x-s.x-3*l.x+h.x)*a*a*a),f=.5*(2*o.y+(l.y-s.y)*a+(2*s.y-5*o.y+4*l.y-h.y)*a*a+(3*o.y-s.y-3*l.y+h.y)*a*a*a),d=.5*(2*o.z+(l.z-s.z)*a+(2*s.z-5*o.z+4*l.z-h.z)*a*a+(3*o.z-s.z-3*l.z+h.z)*a*a*a),m=new i.Atom("C",c,f,d);u.push(m)}a.push(u)}let l,h=a[0].length;this.partitions=[],this.ends=[],this.ends.push(a[0][0]),this.ends.push(a[a.length-1][0]);let c=[1,0,0];for(let t=0,i=a.length;t<i;t++){(!l||l.positionData.length>65e3)&&(this.partitions.length>0&&t--,l={count:0,positionData:[],normalData:[],indexData:[]},this.partitions.push(l));let i=a[t];l.count++;for(let r=0;r<h;r++){let f,d=i[r];f=r===h-1?t===a.length-1?i[r-1]:a[t+1][0]:i[r+1];let m=[f.x-d.x,f.y-d.y,f.z-d.z];o.normalize(m),t===a.length-1&&r===h-1&&o.scale(m,-1);let p=o.cross(m,c,[]);o.normalize(p),o.scale(p,e/2);let g=new u(p,m,2*Math.PI/n);for(let t=0,e=n;t<e;t++){let e=g.rotate();t===s.floor(n/4)&&(c=[e[0],e[1],e[2]]),l.normalData.push(e[0],e[1],e[2]),l.positionData.push(d.x+e[0],d.y+e[1],d.z+e[2])}}}for(let t=0,e=this.partitions.length;t<e;t++){let e=this.partitions[t];for(let t=0,i=e.count-1;t<i;t++){let i=t*h*n;for(let t=0,s=h;t<s;t++){let s=i+t*n;for(let t=0;t<=n;t++){let i=s+t%n;e.indexData.push(i,i+n)}}}}this.storeData(this.partitions[0].positionData,this.partitions[0].normalData,this.partitions[0].indexData)},(n.CatmullTube.prototype=new n._Mesh).render=function(t,e){this.bindBuffers(t);for(let e=0,i=this.partitions.length;e<i;e++){let i=this.partitions[e];h(t,i),t.drawElements(t.TRIANGLE_STRIP,i.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0)}t.sphereBuffer.bindBuffers(t);for(let i=0;i<2;i++){let n=this.ends[i],s=r.translate(r.identity(),[n.x,n.y,n.z]),o=e.proteins_tubeThickness/2;r.scale(s,[o,o,o]),t.shader.setMatrixUniforms(t,s),t.drawElements(t.TRIANGLES,t.sphereBuffer.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0)}}}(e.extensions,e.RESIDUE,e.structures,e.structures.d3,Math,e.lib.mat4,e.lib.vec3,e.math),function(t,e,i,n,s){t.UnitCell=function(t,n,s){this.lengths=t,this.angles=n,this.offset=s;let r=e.CIFInterpreter.generateABC2XYZ(t[0],t[1],t[2],n[0],n[1],n[2]);s||(this.offset=[0,0,0]),this.unitCellVectors={o:i.multiplyVec3(r,this.offset,[]),x:i.multiplyVec3(r,[this.offset[0]+1,this.offset[1],this.offset[2]]),y:i.multiplyVec3(r,[this.offset[0],this.offset[1]+1,this.offset[2]]),z:i.multiplyVec3(r,[this.offset[0],this.offset[1],this.offset[2]+1]),xy:i.multiplyVec3(r,[this.offset[0]+1,this.offset[1]+1,this.offset[2]]),xz:i.multiplyVec3(r,[this.offset[0]+1,this.offset[1],this.offset[2]+1]),yz:i.multiplyVec3(r,[this.offset[0],this.offset[1]+1,this.offset[2]+1]),xyz:i.multiplyVec3(r,[this.offset[0]+1,this.offset[1]+1,this.offset[2]+1])};let o=[],a=[],l=function(t,e,i,n){o.push(t[0],t[1],t[2]),o.push(e[0],e[1],e[2]),o.push(i[0],i[1],i[2]),o.push(n[0],n[1],n[2]);for(let t=0;t<4;t++)a.push(0,0,0)};l(this.unitCellVectors.o,this.unitCellVectors.x,this.unitCellVectors.xy,this.unitCellVectors.y),l(this.unitCellVectors.o,this.unitCellVectors.y,this.unitCellVectors.yz,this.unitCellVectors.z),l(this.unitCellVectors.o,this.unitCellVectors.z,this.unitCellVectors.xz,this.unitCellVectors.x),l(this.unitCellVectors.yz,this.unitCellVectors.y,this.unitCellVectors.xy,this.unitCellVectors.xyz),l(this.unitCellVectors.xyz,this.unitCellVectors.xz,this.unitCellVectors.z,this.unitCellVectors.yz),l(this.unitCellVectors.xy,this.unitCellVectors.x,this.unitCellVectors.xz,this.unitCellVectors.xyz);let h=[];for(let t=0;t<6;t++){let e=4*t;h.push(e,e+1,e+1,e+2,e+2,e+3,e+3,e)}this.storeData(o,a,h)},(t.UnitCell.prototype=new t._Mesh).render=function(t,e){t.shader.setMatrixUniforms(t),this.bindBuffers(t),t.material.setDiffuseColor(t,e.shapes_color),t.lineWidth(e.shapes_lineWidth),t.drawElements(t.LINES,this.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0)}}(e.structures.d3,e.io,e.lib.mat4,e.lib.vec3),function(t,e,i,n){t.Framebuffer=function(){};let s=t.Framebuffer.prototype;s.init=function(t){this.framebuffer=t.createFramebuffer()},s.setColorTexture=function(t,e,i){let s=i===n?0:i;t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),t.bindTexture(t.TEXTURE_2D,e),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+s,t.TEXTURE_2D,e,0),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},s.setColorRenderbuffer=function(t,e,i){let s=i===n?0:i;t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),t.bindRenderbuffer(t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+s,t.RENDERBUFFER,e),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},s.setDepthTexture=function(t,e){t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),t.bindTexture(t.TEXTURE_2D,e),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,e,0),t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},s.setDepthRenderbuffer=function(t,e){t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),t.bindRenderbuffer(t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},s.bind=function(t,e,i){t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffer),t.viewport(0,0,e,i)}}(e.structures.d3,e.math,document),function(t,e,i,n){t.Renderbuffer=function(){};let s=t.Renderbuffer.prototype;s.init=function(t,e){this.renderbuffer=t.createRenderbuffer(),this.format=e},s.setParameter=function(t,e,i){this.width=e,this.height=i,t.bindRenderbuffer(t.RENDERBUFFER,this.renderbuffer),t.renderbufferStorage(t.RENDERBUFFER,this.format,this.width,this.height),t.bindRenderbuffer(t.RENDERBUFFER,null)}}(e.structures.d3,e.math,document),function(t,e,i,n){e.SSAO=function(){};let s=e.SSAO.prototype;s.initSampleKernel=function(t){let e=[];for(let n=0;n<t;n++){let s=2*i.random()-1,r=2*i.random()-1,o=2*i.random()-1,a=n/t,l=.1+a*a*.9;s*=l,r*=l,o*=l,e.push(s,r,o)}this.sampleKernel=new Float32Array(e)},s.initNoiseTexture=function(t){let e=[];for(let t=0;t<16;t++)e.push(2*i.random()-1),e.push(2*i.random()-1),e.push(0);this.noiseTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.noiseTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGB,4,4,0,t.RGB,t.FLOAT,new Float32Array(e)),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.bindTexture(t.TEXTURE_2D,null)}}(e.math,e.structures.d3,Math),function(t,e,i,n){t.Texture=function(){};let s=t.Texture.prototype;s.init=function(t,e,i,n){this.texture=t.createTexture(),this.type=e,this.internalFormat=i,this.format=void 0!==n?n:i,t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null)},s.setParameter=function(t,e,i){this.width=e,this.height=i,t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,this.internalFormat,this.width,this.height,0,this.format,this.type,null),t.bindTexture(t.TEXTURE_2D,null)}}(e.structures.d3,e.math,document),function(t,e,i,n,s){t._Shader=function(){};let r=t._Shader.prototype;r.useShaderProgram=function(t){t.useProgram(this.gProgram),t.shader=this},r.init=function(t){let e=this.getShader(t,"vertex-shader");e||(e=this.loadDefaultVertexShader(t));let i=this.getShader(t,"fragment-shader");i||(i=this.loadDefaultFragmentShader(t)),this.gProgram=t.createProgram(),t.attachShader(this.gProgram,e),t.attachShader(this.gProgram,i),this.onShaderAttached(t),t.linkProgram(this.gProgram),t.getProgramParameter(this.gProgram,t.LINK_STATUS)||alert("Could not initialize shaders: "+t.getProgramInfoLog(this.gProgram)),t.useProgram(this.gProgram),this.initUniformLocations(t),t.useProgram(null)},r.onShaderAttached=function(t){this.vertexPositionAttribute=0,this.vertexNormalAttribute=1,t.bindAttribLocation(this.gProgram,this.vertexPositionAttribute,"a_vertex_position"),t.bindAttribLocation(this.gProgram,this.vertexNormalAttribute,"a_vertex_normal")},r.getShaderFromStr=function(t,e,i){let n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),t.getShaderParameter(n,t.COMPILE_STATUS)?n:(alert(shaderScript.type+" "+t.getShaderInfoLog(n)),t.deleteShader(n),s)},r.enableAttribsArray=function(t){t.enableVertexAttribArray(this.vertexPositionAttribute)},r.disableAttribsArray=function(t){t.disableVertexAttribArray(this.vertexPositionAttribute)},r.getShader=function(t,e){let i=n.getElementById(e);if(!i)return s;let r=[],o=i.firstChild;for(;o;)3===o.nodeType&&r.push(o.textContent),o=o.nextSibling;let a,l=r.join("");if("x-shader/x-fragment"===i.type)a=this.getShaderFromStr(t,t.FRAGMENT_SHADER,l);else{if("x-shader/x-vertex"!==i.type)return s;a=this.getShaderFromStr(t,t.VERTEX_SHADER,l)}return a},r.initUniformLocations=function(t){this.modelViewMatrixUniform=t.getUniformLocation(this.gProgram,"u_model_view_matrix"),this.projectionMatrixUniform=t.getUniformLocation(this.gProgram,"u_projection_matrix")},r.loadDefaultVertexShader=function(t){},r.loadDefaultFragmentShader=function(t){},r.setMatrixUniforms=function(t,e){e===s?this.setModelViewMatrix(t,t.modelViewMatrix):this.setModelViewMatrix(t,i.multiply(t.modelViewMatrix,e,[]))},r.setProjectionMatrix=function(t,e){t.uniformMatrix4fv(this.projectionMatrixUniform,!1,e)},r.setModelViewMatrix=function(t,e){t.uniformMatrix4fv(this.modelViewMatrixUniform,!1,e)},r.setMaterialAmbientColor=function(t,e){},r.setMaterialDiffuseColor=function(t,e){},r.setMaterialSpecularColor=function(t,e){},r.setMaterialShininess=function(t,e){},r.setMaterialAlpha=function(t,e){}}(e.structures.d3,e.lib.mat3,e.lib.mat4,document),function(t,e,i,n,s){t.FXAAShader=function(){};let r=t._Shader.prototype,o=t.FXAAShader.prototype=new t._Shader;o.initUniformLocations=function(t){r.initUniformLocations.call(this,t),this.buffersizeUniform=t.getUniformLocation(this.gProgram,"u_buffersize"),this.antialiasUniform=t.getUniformLocation(this.gProgram,"u_antialias"),this.edgeThresholdUniform=t.getUniformLocation(this.gProgram,"u_edge_threshold"),this.edgeThresholdMinUniform=t.getUniformLocation(this.gProgram,"u_edge_threshold_min"),this.searchStepsUniform=t.getUniformLocation(this.gProgram,"u_search_steps"),this.searchThresholdUniform=t.getUniformLocation(this.gProgram,"u_search_threshold"),this.subpixCapUniform=t.getUniformLocation(this.gProgram,"u_subpix_cap"),this.subpixTrimUniform=t.getUniformLocation(this.gProgram,"u_subpix_trim")},o.setBuffersize=function(t,e,i){t.uniform2f(this.buffersizeUniform,e,i)},o.setAntialias=function(t,e){t.uniform1f(this.antialiasUniform,e)},o.setEdgeThreshold=function(t,e){t.uniform1f(this.edgeThresholdUniform,e)},o.setEdgeThresholdMin=function(t,e){t.uniform1f(this.edgeThresholdMinUniform,e)},o.setSearchSteps=function(t,e){t.uniform1i(this.searchStepsUniform,e)},o.setSearchThreshold=function(t,e){t.uniform1f(this.searchThresholdUniform,e)},o.setSubpixCap=function(t,e){t.uniform1f(this.subpixCapUniform,e)},o.setSubpixTrim=function(t,e){t.uniform1f(this.subpixTrimUniform,e)},o.loadDefaultVertexShader=function(t){let e=["precision mediump float;","attribute vec3 a_vertex_position;","varying vec2 v_texcoord;","void main() {","gl_Position = vec4(a_vertex_position, 1.);","v_texcoord = a_vertex_position.xy * .5 + .5;","}"].join("");return this.getShaderFromStr(t,t.VERTEX_SHADER,e)},o.loadDefaultFragmentShader=function(t){let e=["precision mediump float;","const int fxaaMaxSearchSteps = 128;","uniform float u_edge_threshold;","uniform float u_edge_threshold_min;","uniform int u_search_steps;","uniform float u_search_threshold;","uniform float u_subpix_cap;","uniform float u_subpix_trim;","uniform sampler2D u_sampler0;","uniform vec2 u_buffersize;","uniform bool u_antialias;","varying vec2 v_texcoord;","float FxaaLuma(vec3 rgb) {","return rgb.y * (0.587/0.299) + rgb.x;","}","vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {","return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);","}","vec4 FxaaTexOff(sampler2D tex, vec2 pos, vec2 off, vec2 rcpFrame) {","return texture2D(tex, pos + off * rcpFrame);","}","vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {","float subpix_trim_scale = (1.0/(1.0 - u_subpix_trim));","vec3 rgbN = FxaaTexOff(tex, pos.xy, vec2( 0.,-1.), rcpFrame).xyz;","vec3 rgbW = FxaaTexOff(tex, pos.xy, vec2(-1., 0.), rcpFrame).xyz;","vec3 rgbM = FxaaTexOff(tex, pos.xy, vec2( 0., 0.), rcpFrame).xyz;","vec3 rgbE = FxaaTexOff(tex, pos.xy, vec2( 1., 0.), rcpFrame).xyz;","vec3 rgbS = FxaaTexOff(tex, pos.xy, vec2( 0., 1.), rcpFrame).xyz;","float lumaN = FxaaLuma(rgbN);","float lumaW = FxaaLuma(rgbW);","float lumaM = FxaaLuma(rgbM);","float lumaE = FxaaLuma(rgbE);","float lumaS = FxaaLuma(rgbS);","float rangeMin = min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));","float rangeMax = max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));","float range = rangeMax - rangeMin;","if(range < max(u_edge_threshold_min, rangeMax * u_edge_threshold)) {","return rgbM;","}","vec3 rgbL = rgbN + rgbW + rgbM + rgbE + rgbS;","float lumaL = (lumaN + lumaW + lumaE + lumaS) * 0.25;","float rangeL = abs(lumaL - lumaM);","float blendL = max(0.0, (rangeL / range) - u_subpix_trim) * subpix_trim_scale;","blendL = min(u_subpix_cap, blendL);","vec3 rgbNW = FxaaTexOff(tex, pos.xy, vec2(-1.,-1.), rcpFrame).xyz;","vec3 rgbNE = FxaaTexOff(tex, pos.xy, vec2( 1.,-1.), rcpFrame).xyz;","vec3 rgbSW = FxaaTexOff(tex, pos.xy, vec2(-1., 1.), rcpFrame).xyz;","vec3 rgbSE = FxaaTexOff(tex, pos.xy, vec2( 1., 1.), rcpFrame).xyz;","rgbL += (rgbNW + rgbNE + rgbSW + rgbSE);","rgbL *= vec3(1.0/9.0);","float lumaNW = FxaaLuma(rgbNW);","float lumaNE = FxaaLuma(rgbNE);","float lumaSW = FxaaLuma(rgbSW);","float lumaSE = FxaaLuma(rgbSE);","float edgeVert =","abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +","abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +","abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));","float edgeHorz =","abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +","abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +","abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));","bool horzSpan = edgeHorz >= edgeVert;","float lengthSign = horzSpan ? -rcpFrame.y : -rcpFrame.x;","if(!horzSpan) {","lumaN = lumaW;","lumaS = lumaE;","}","float gradientN = abs(lumaN - lumaM);","float gradientS = abs(lumaS - lumaM);","lumaN = (lumaN + lumaM) * 0.5;","lumaS = (lumaS + lumaM) * 0.5;","if (gradientN < gradientS) {","lumaN = lumaS;","lumaN = lumaS;","gradientN = gradientS;","lengthSign *= -1.0;","}","vec2 posN;","posN.x = pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);","posN.y = pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);","gradientN *= u_search_threshold;","vec2 posP = posN;","vec2 offNP = horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);","float lumaEndN = lumaN;","float lumaEndP = lumaN;","bool doneN = false;","bool doneP = false;","posN += offNP * vec2(-1.0, -1.0);","posP += offNP * vec2( 1.0,  1.0);","for(int i = 0; i < fxaaMaxSearchSteps; i++) {","if(i >= u_search_steps) break;","if(!doneN) {","lumaEndN = FxaaLuma(texture2D(tex, posN.xy).xyz);","}","if(!doneP) {","lumaEndP = FxaaLuma(texture2D(tex, posP.xy).xyz);","}","doneN = doneN || (abs(lumaEndN - lumaN) >= gradientN);","doneP = doneP || (abs(lumaEndP - lumaN) >= gradientN);","if(doneN && doneP) {","break;","}","if(!doneN) {","posN -= offNP;","}","if(!doneP) {","posP += offNP;","}","}","float dstN = horzSpan ? pos.x - posN.x : pos.y - posN.y;","float dstP = horzSpan ? posP.x - pos.x : posP.y - pos.y;","bool directionN = dstN < dstP;","lumaEndN = directionN ? lumaEndN : lumaEndP;","if(((lumaM - lumaN) < 0.0) == ((lumaEndN - lumaN) < 0.0)) {","lengthSign = 0.0;","}","float spanLength = (dstP + dstN);","dstN = directionN ? dstN : dstP;","float subPixelOffset = (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;","vec3 rgbF = texture2D(tex, vec2(","pos.x + (horzSpan ? 0.0 : subPixelOffset),","pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;","return FxaaLerp3(rgbL, rgbF, blendL);","}","void main() {","gl_FragColor = texture2D(u_sampler0, v_texcoord);","if(u_antialias) {","gl_FragColor.xyz = FxaaPixelShader(v_texcoord, u_sampler0, 1. / u_buffersize).xyz;","}","}"].join("\n");return this.getShaderFromStr(t,t.FRAGMENT_SHADER,e)}}(e.structures.d3,e.lib.mat3,e.lib.mat4,document),function(t,e,i,n,s){t.LabelShader=function(){};let r=t._Shader.prototype,o=t.LabelShader.prototype=new t._Shader;o.initUniformLocations=function(t){r.initUniformLocations.call(this,t),this.dimensionUniform=t.getUniformLocation(this.gProgram,"u_dimension")},o.onShaderAttached=function(t){r.onShaderAttached.call(this,t),this.vertexTexCoordAttribute=2,t.bindAttribLocation(this.gProgram,this.vertexTexCoordAttribute,"a_vertex_texcoord")},o.loadDefaultVertexShader=function(t){let e=["precision mediump float;","attribute vec3 a_vertex_position;","attribute vec3 a_vertex_normal;","attribute vec2 a_vertex_texcoord;","uniform mat4 u_model_view_matrix;","uniform mat4 u_projection_matrix;","uniform vec2 u_dimension;","varying vec2 v_texcoord;","void main() {","gl_Position = u_model_view_matrix * vec4(a_vertex_position, 1.);","vec4 depth_pos = vec4(gl_Position);","depth_pos.z += a_vertex_normal.z;","gl_Position = u_projection_matrix * gl_Position;","depth_pos = u_projection_matrix * depth_pos;","gl_Position /= gl_Position.w;","gl_Position.xy += a_vertex_normal.xy / u_dimension * 2.;","gl_Position.z = depth_pos.z / depth_pos.w;","v_texcoord = a_vertex_texcoord;","}"].join("");return this.getShaderFromStr(t,t.VERTEX_SHADER,e)},o.loadDefaultFragmentShader=function(t){let e=[t.depthTextureExt?"#define CWC_DEPTH_TEX\n":"","precision mediump float;","uniform sampler2D u_image;","varying vec2 v_texcoord;","void main(void) {","gl_FragColor = texture2D(u_image, v_texcoord);","}"].join("");return this.getShaderFromStr(t,t.FRAGMENT_SHADER,e)},o.enableAttribsArray=function(t){r.enableAttribsArray.call(this,t),t.enableVertexAttribArray(this.vertexNormalAttribute),t.enableVertexAttribArray(this.vertexTexCoordAttribute)},o.disableAttribsArray=function(t){r.disableAttribsArray.call(this,t),t.disableVertexAttribArray(this.vertexNormalAttribute),t.disableVertexAttribArray(this.vertexTexCoordAttribute)},o.setDimension=function(t,e,i){t.uniform2f(this.dimensionUniform,e,i)}}(e.structures.d3,e.lib.mat3,e.lib.mat4,document),function(t,e,i,n,s){t.LightingShader=function(){};let r=t._Shader.prototype,o=t.LightingShader.prototype=new t._Shader;o.initUniformLocations=function(t){r.initUniformLocations.call(this,t),this.positionSampleUniform=t.getUniformLocation(this.gProgram,"u_position_sample"),this.colorSampleUniform=t.getUniformLocation(this.gProgram,"u_color_sample"),this.ssaoSampleUniform=t.getUniformLocation(this.gProgram,"u_ssao_sample"),this.outlineSampleUniform=t.getUniformLocation(this.gProgram,"u_outline_sample")},o.loadDefaultVertexShader=function(t){let e=["precision mediump float;","attribute vec3 a_vertex_position;","varying vec2 v_texcoord;","void main() {","gl_Position = vec4(a_vertex_position, 1.);","v_texcoord = a_vertex_position.xy * .5 + .5;","}"].join("");return this.getShaderFromStr(t,t.VERTEX_SHADER,e)},o.loadDefaultFragmentShader=function(t){let e=["precision mediump float;","uniform sampler2D u_position_sample;","uniform sampler2D u_color_sample;","uniform sampler2D u_ssao_sample;","uniform sampler2D u_outline_sample;","varying vec2 v_texcoord;","void main() {","vec4 position = texture2D(u_position_sample, v_texcoord);","vec4 color = texture2D(u_color_sample, v_texcoord);","vec4 ao = texture2D(u_ssao_sample, v_texcoord);","float outline = texture2D(u_outline_sample, v_texcoord).r;","if(position.w == 0. && outline == 1.) {","return;","}","gl_FragColor = vec4(color.rgb * ao.r * outline, 1.);","}"].join("");return this.getShaderFromStr(t,t.FRAGMENT_SHADER,e)}}(e.structures.d3,e.lib.mat3,e.lib.mat4,document),function(t,e,i,n,s){t.NormalShader=function(){};let r=t._Shader.prototype,o=t.NormalShader.prototype=new t._Shader;o.initUniformLocations=function(t){r.initUniformLocations.call(this,t),this.normalMatrixUniform=t.getUniformLocation(this.gProgram,"u_normal_matrix")},o.loadDefaultVertexShader=function(t){let e=["precision mediump float;","attribute vec3 a_vertex_position;","attribute vec3 a_vertex_normal;","uniform mat4 u_model_view_matrix;","uniform mat4 u_projection_matrix;","uniform mat3 u_normal_matrix;","varying vec3 v_normal;","void main() {","v_normal = length(a_vertex_normal)==0. ? a_vertex_normal : u_normal_matrix * a_vertex_normal;","gl_Position = u_projection_matrix * u_model_view_matrix * vec4(a_vertex_position, 1.);","}"].join("");return this.getShaderFromStr(t,t.VERTEX_SHADER,e)},o.loadDefaultFragmentShader=function(t){let e=["precision mediump float;","varying vec3 v_normal;","void main(void) {","vec3 normal = length(v_normal)==0. ? vec3(0., 0., 1.) : normalize(v_normal);","gl_FragColor = vec4(normal, 0.);","}"].join("");return this.getShaderFromStr(t,t.FRAGMENT_SHADER,e)},o.enableAttribsArray=function(t){r.enableAttribsArray.call(this,t),t.enableVertexAttribArray(this.vertexNormalAttribute)},o.disableAttribsArray=function(t){r.disableAttribsArray.call(this,t),t.disableVertexAttribArray(this.vertexNormalAttribute)},o.setModelViewMatrix=function(t,n){r.setModelViewMatrix.call(this,t,n);let s=e.transpose(i.toInverseMat3(n,[]));t.uniformMatrix3fv(this.normalMatrixUniform,!1,s)}}(e.structures.d3,e.lib.mat3,e.lib.mat4,document),function(t,e,i,n,s){t.OutlineShader=function(){};let r=t._Shader.prototype,o=t.OutlineShader.prototype=new t._Shader;o.initUniformLocations=function(t){r.initUniformLocations.call(this,t),this.normalSampleUniform=t.getUniformLocation(this.gProgram,"u_normal_sample"),this.depthSampleUniform=t.getUniformLocation(this.gProgram,"u_depth_sample"),this.gbufferTextureSizeUniform=t.getUniformLocation(this.gProgram,"u_gbuffer_texture_size"),this.normalThresholdUniform=t.getUniformLocation(this.gProgram,"u_normal_threshold"),this.depthThresholdUniform=t.getUniformLocation(this.gProgram,"u_depth_threshold"),this.thicknessUniform=t.getUniformLocation(this.gProgram,"u_thickness")},o.loadDefaultVertexShader=function(t){let e=["precision mediump float;","attribute vec3 a_vertex_position;","varying vec2 v_texcoord;","void main() {","gl_Position = vec4(a_vertex_position, 1.);","v_texcoord = a_vertex_position.xy * .5 + .5;","}"].join("");return this.getShaderFromStr(t,t.VERTEX_SHADER,e)},o.loadDefaultFragmentShader=function(t){let e=["precision mediump float;","uniform sampler2D u_normal_sample;","uniform sampler2D u_depth_sample;","uniform float u_normal_threshold;","uniform float u_depth_threshold;","uniform float u_thickness;","uniform vec2 u_gbuffer_texture_size;","varying vec2 v_texcoord;","void main() {","vec3 normal = texture2D(u_normal_sample, v_texcoord).xyz;","float depth = texture2D(u_depth_sample, v_texcoord).r;","vec2 texelSize = u_thickness/u_gbuffer_texture_size * .5;","vec2 offsets[8];","offsets[0] = vec2(-texelSize.x, -texelSize.y);","offsets[1] = vec2(-texelSize.x, 0);","offsets[2] = vec2(-texelSize.x, texelSize.y);","offsets[3] = vec2(0, -texelSize.y);","offsets[4] = vec2(0,  texelSize.y);","offsets[5] = vec2(texelSize.x, -texelSize.y);","offsets[6] = vec2(texelSize.x, 0);","offsets[7] = vec2(texelSize.x, texelSize.y);","float edge = 0.;","for (int i = 0; i < 8; i++) {","vec3 sampleNorm = texture2D(u_normal_sample, v_texcoord + offsets[i]).xyz;","if(normal == vec3(.0, .0, .0)) {","if(sampleNorm != vec3(.0, .0, .0)) {","edge = 1.0;","break;","}","continue;","}","if (dot(sampleNorm, normal) < u_normal_threshold) {","edge = 1.0;","break;","}","float sampleDepth = texture2D(u_depth_sample, v_texcoord + offsets[i]).r;","if (abs(sampleDepth - depth) > u_depth_threshold) {","edge = 1.0;","break;","}","}","edge = 1. - edge;","gl_FragColor = vec4(edge, edge, edge, 1.);","}"].join("");return this.getShaderFromStr(t,t.FRAGMENT_SHADER,e)},o.setGbufferTextureSize=function(t,e,i){t.uniform2f(this.gbufferTextureSizeUniform,e,i)},o.setNormalThreshold=function(t,e){t.uniform1f(this.normalThresholdUniform,e)},o.setDepthThreshold=function(t,e){t.uniform1f(this.depthThresholdUniform,e)},o.setThickness=function(t,e){t.uniform1f(this.thicknessUniform,e)}}(e.structures.d3,e.lib.mat3,e.lib.mat4,document),function(t,e,i,n,s){t.PhongShader=function(){};let r=t._Shader.prototype,o=t.PhongShader.prototype=new t._Shader;o.initUniformLocations=function(t){r.initUniformLocations.call(this,t),this.shadowUniform=t.getUniformLocation(this.gProgram,"u_shadow"),this.flatColorUniform=t.getUniformLocation(this.gProgram,"u_flat_color"),this.normalMatrixUniform=t.getUniformLocation(this.gProgram,"u_normal_matrix"),this.lightModelViewMatrixUniform=t.getUniformLocation(this.gProgram,"u_light_model_view_matrix"),this.lightProjectionMatrixUniform=t.getUniformLocation(this.gProgram,"u_light_projection_matrix"),this.lightDiffuseColorUniform=t.getUniformLocation(this.gProgram,"u_light_diffuse_color"),this.lightSpecularColorUniform=t.getUniformLocation(this.gProgram,"u_light_specular_color"),this.lightDirectionUniform=t.getUniformLocation(this.gProgram,"u_light_direction"),this.materialAmbientColorUniform=t.getUniformLocation(this.gProgram,"u_material_ambient_color"),this.materialDiffuseColorUniform=t.getUniformLocation(this.gProgram,"u_material_diffuse_color"),this.materialSpecularColorUniform=t.getUniformLocation(this.gProgram,"u_material_specular_color"),this.materialShininessUniform=t.getUniformLocation(this.gProgram,"u_material_shininess"),this.materialAlphaUniform=t.getUniformLocation(this.gProgram,"u_material_alpha"),this.fogModeUniform=t.getUniformLocation(this.gProgram,"u_fog_mode"),this.fogColorUniform=t.getUniformLocation(this.gProgram,"u_fog_color"),this.fogStartUniform=t.getUniformLocation(this.gProgram,"u_fog_start"),this.fogEndUniform=t.getUniformLocation(this.gProgram,"u_fog_end"),this.fogDensityUniform=t.getUniformLocation(this.gProgram,"u_fog_density"),this.shadowDepthSampleUniform=t.getUniformLocation(this.gProgram,"u_shadow_depth_sample"),this.shadowTextureSizeUniform=t.getUniformLocation(this.gProgram,"u_shadow_texture_size"),this.shadowIntensityUniform=t.getUniformLocation(this.gProgram,"u_shadow_intensity"),this.gammaCorrectionUniform=t.getUniformLocation(this.gProgram,"u_gamma_inverted"),this.pointSizeUniform=t.getUniformLocation(this.gProgram,"u_point_size")},o.loadDefaultVertexShader=function(t){let e=["precision mediump float;","attribute vec3 a_vertex_position;","attribute vec3 a_vertex_normal;","uniform vec3 u_light_diffuse_color;","uniform vec3 u_material_ambient_color;","uniform vec3 u_material_diffuse_color;","uniform mat4 u_model_view_matrix;","uniform mat4 u_projection_matrix;","uniform mat3 u_normal_matrix;","uniform mat4 u_light_model_view_matrix;","uniform mat4 u_light_projection_matrix;","uniform bool u_shadow;","varying vec3 v_viewpos;","varying vec4 v_shadcoord;","varying vec3 v_diffuse;","varying vec3 v_ambient;","varying vec3 v_normal;","uniform float u_point_size;","void main() {","v_normal = length(a_vertex_normal)==0. ? a_vertex_normal : u_normal_matrix * a_vertex_normal;","v_ambient = u_material_ambient_color;","v_diffuse = u_material_diffuse_color * u_light_diffuse_color;","if(u_shadow) {","v_shadcoord = u_light_projection_matrix * u_light_model_view_matrix * vec4(a_vertex_position, 1.);","v_shadcoord /= v_shadcoord.w;","}","vec4 viewPos = u_model_view_matrix * vec4(a_vertex_position, 1.);","v_viewpos = viewPos.xyz / viewPos.w;","gl_Position = u_projection_matrix * viewPos;","gl_Position /= gl_Position.w;","gl_PointSize = u_point_size;","}"].join("");return this.getShaderFromStr(t,t.VERTEX_SHADER,e)},o.loadDefaultFragmentShader=function(t){let e=[t.depthTextureExt?"#define CWC_DEPTH_TEX\n":"","precision mediump float;","uniform vec3 u_light_specular_color;","uniform vec3 u_light_direction;","uniform vec3 u_material_specular_color;","uniform float u_material_shininess;","uniform float u_material_alpha;","uniform int u_fog_mode;","uniform vec3 u_fog_color;","uniform float u_fog_density;","uniform float u_fog_start;","uniform float u_fog_end;","uniform bool u_shadow;","uniform float u_shadow_intensity;","uniform bool u_flat_color;","uniform float u_gamma_inverted;","uniform sampler2D u_shadow_depth_sample;","uniform vec2 u_shadow_texture_size;","varying vec3 v_viewpos;","varying vec4 v_shadcoord;","varying vec3 v_diffuse;","varying vec3 v_ambient;","varying vec3 v_normal;","\n#ifndef CWC_DEPTH_TEX\n","float unpack (vec4 colour) {","const vec4 bitShifts = vec4(1.,","1. / 255.,","1. / (255. * 255.),","1. / (255. * 255. * 255.));","return dot(colour, bitShifts);","}","\n#endif\n","float shadowMapDepth(vec4 shadowMapColor) {","float zShadowMap;","\n#ifdef CWC_DEPTH_TEX\n","zShadowMap = shadowMapColor.r;","\n#else\n","zShadowMap = unpack(shadowMapColor);","\n#endif\n","return zShadowMap;","}","void main(void) {","vec3 color = v_diffuse;","if(length(v_normal)!=0.){","vec3 normal = normalize(v_normal);","vec3 lightDir = normalize(-u_light_direction);","float nDotL = dot(normal, lightDir);","float shadow = 0.0;","if(u_shadow) {","vec3 depthCoord = .5 + v_shadcoord.xyz / v_shadcoord.w * .5;","if(depthCoord.z <= 1. && depthCoord.z >= 0.) {","float bias = max(.05 * (1. - nDotL), .005);","vec2 texelSize = 1. / u_shadow_texture_size;","for(int x = -1; x <= 1; ++x) {","for(int y = -1; y <= 1; ++y)  {","vec4 shadowMapColor = texture2D(u_shadow_depth_sample, depthCoord.xy + vec2(x, y) * texelSize);","float zShadowMap = shadowMapDepth(shadowMapColor);","shadow += zShadowMap + bias < depthCoord.z ? 1. : 0.;","}","}","shadow /= 9.;","shadow *= u_shadow_intensity;","}","}","if(!u_flat_color) {","vec3 viewDir = normalize(-v_viewpos);","vec3 halfDir = normalize(lightDir + viewDir);","float nDotHV = max(dot(halfDir, normal), 0.);","vec3 specular = u_material_specular_color * u_light_specular_color;","color*=max(nDotL, 0.);","color+=specular * pow(nDotHV, u_material_shininess);","}","color = (1.-shadow)*color+v_ambient;","}","gl_FragColor = vec4(pow(color, vec3(u_gamma_inverted)), u_material_alpha);","if(u_fog_mode != 0){","float fogCoord = 1.-clamp((u_fog_end - gl_FragCoord.z/gl_FragCoord.w) / (u_fog_end - u_fog_start), 0., 1.);","float fogFactor = 1.;","if(u_fog_mode == 1){","fogFactor = 1.-fogCoord;","}","else if(u_fog_mode == 2) {","fogFactor = clamp(exp(-u_fog_density*fogCoord), 0., 1.);","}","else if(u_fog_mode == 3) {","fogFactor = clamp(exp(-pow(u_fog_density*fogCoord, 2.)), 0., 1.);","}","gl_FragColor = mix(vec4(u_fog_color, 1.), gl_FragColor, fogFactor);","}","}"].join("");return this.getShaderFromStr(t,t.FRAGMENT_SHADER,e)},o.enableAttribsArray=function(t){r.enableAttribsArray.call(this,t),t.enableVertexAttribArray(this.vertexNormalAttribute)},o.disableAttribsArray=function(t){r.disableAttribsArray.call(this,t),t.disableVertexAttribArray(this.vertexNormalAttribute)},o.setMatrixUniforms=function(t,e){if(void 0===e)this.setModelViewMatrix(t,t.modelViewMatrix),this.setLightModelViewMatrix(t,t.lightViewMatrix);else{let n=i.multiply(t.modelViewMatrix,e,[]),s=i.multiply(t.lightViewMatrix,e,[]);this.setModelViewMatrix(t,n),this.setLightModelViewMatrix(t,s)}},o.setModelViewMatrix=function(t,n){r.setModelViewMatrix.call(this,t,n);let s=e.transpose(i.toInverseMat3(n,[]));t.uniformMatrix3fv(this.normalMatrixUniform,!1,s)},o.setFlatColor=function(t,e){t.uniform1i(this.flatColorUniform,e)},o.setShadow=function(t,e){t.uniform1i(this.shadowUniform,e)},o.setFogMode=function(t,e){t.uniform1i(this.fogModeUniform,e)},o.setFogColor=function(t,e){t.uniform3fv(this.fogColorUniform,e)},o.setFogStart=function(t,e){t.uniform1f(this.fogStartUniform,e)},o.setFogEnd=function(t,e){t.uniform1f(this.fogEndUniform,e)},o.setFogDensity=function(t,e){t.uniform1f(this.fogDensityUniform,e)},o.setMaterialAmbientColor=function(t,e){t.uniform3fv(this.materialAmbientColorUniform,e)},o.setMaterialDiffuseColor=function(t,e){t.uniform3fv(this.materialDiffuseColorUniform,e)},o.setMaterialSpecularColor=function(t,e){t.uniform3fv(this.materialSpecularColorUniform,e)},o.setMaterialShininess=function(t,e){t.uniform1f(this.materialShininessUniform,e)},o.setMaterialAlpha=function(t,e){t.uniform1f(this.materialAlphaUniform,e)},o.setLightDiffuseColor=function(t,e){t.uniform3fv(this.lightDiffuseColorUniform,e)},o.setLightSpecularColor=function(t,e){t.uniform3fv(this.lightSpecularColorUniform,e)},o.setLightDirection=function(t,e){t.uniform3fv(this.lightDirectionUniform,e)},o.setLightModelViewMatrix=function(t,e){t.uniformMatrix4fv(this.lightModelViewMatrixUniform,!1,e)},o.setLightProjectionMatrix=function(t,e){t.uniformMatrix4fv(this.lightProjectionMatrixUniform,!1,e)},o.setShadowTextureSize=function(t,e,i){t.uniform2f(this.shadowTextureSizeUniform,e,i)},o.setShadowIntensity=function(t,e){t.uniform1f(this.shadowIntensityUniform,e)},o.setGammaCorrection=function(t,e){t.uniform1f(this.gammaCorrectionUniform,1/e)},o.setPointSize=function(t,e){t.uniform1f(this.pointSizeUniform,e)}}(e.structures.d3,e.lib.mat3,e.lib.mat4,document),function(t,e,i,n,s){t.PickShader=function(){};let r=t._Shader.prototype,o=t.PickShader.prototype=new t._Shader;o.initUniformLocations=function(t){r.initUniformLocations.call(this,t),this.materialDiffuseColorUniform=t.getUniformLocation(this.gProgram,"u_material_diffuse_color")},o.loadDefaultVertexShader=function(t){let e=["precision mediump float;","attribute vec3 a_vertex_position;","uniform mat4 u_model_view_matrix;","uniform mat4 u_projection_matrix;","void main() {","gl_Position = u_projection_matrix * u_model_view_matrix * vec4(a_vertex_position, 1.);","gl_Position /= gl_Position.w;","}"].join("");return this.getShaderFromStr(t,t.VERTEX_SHADER,e)},o.loadDefaultFragmentShader=function(t){let e=[t.depthTextureExt?"#define CWC_DEPTH_TEX\n":"","precision mediump float;","uniform vec3 u_material_diffuse_color;","void main(void) {","gl_FragColor = vec4(u_material_diffuse_color, 1.);","}"].join("");return this.getShaderFromStr(t,t.FRAGMENT_SHADER,e)},o.setMaterialDiffuseColor=function(t,e){t.uniform3fv(this.materialDiffuseColorUniform,e)}}(e.structures.d3,e.lib.mat3,e.lib.mat4,document),function(t,e,i,n,s){t.PositionShader=function(){},t._Shader.prototype;let r=t.PositionShader.prototype=new t._Shader;r.loadDefaultVertexShader=function(t){let e=["precision mediump float;","attribute vec3 a_vertex_position;","uniform mat4 u_model_view_matrix;","uniform mat4 u_projection_matrix;","varying vec4 v_position;","void main() {","vec4 viewPos = u_model_view_matrix * vec4(a_vertex_position, 1.);","gl_Position = u_projection_matrix * viewPos;","v_position = viewPos / viewPos.w;","}"].join("");return this.getShaderFromStr(t,t.VERTEX_SHADER,e)},r.loadDefaultFragmentShader=function(t){let e=["precision mediump float;","varying vec4 v_position;","void main(void) {","gl_FragColor = v_position;","}"].join("");return this.getShaderFromStr(t,t.FRAGMENT_SHADER,e)}}(e.structures.d3,e.lib.mat3,e.lib.mat4,document),function(t,e,i,n,s){t.QuadShader=function(){};let r=t.QuadShader.prototype=new t._Shader;r.loadDefaultVertexShader=function(t){let e=["precision mediump float;","attribute vec3 a_vertex_position;","varying vec2 v_texcoord;","void main() {","gl_Position = vec4(a_vertex_position, 1.);","v_texcoord = a_vertex_position.xy * .5 + .5;","}"].join("");return this.getShaderFromStr(t,t.VERTEX_SHADER,e)},r.loadDefaultFragmentShader=function(t){let e=["precision mediump float;","uniform sampler2D u_image;","varying vec2 v_texcoord;","void main() {","gl_FragColor = texture2D(u_image, v_texcoord);","}"].join("");return this.getShaderFromStr(t,t.FRAGMENT_SHADER,e)}}(e.structures.d3,e.lib.mat3,e.lib.mat4,document),function(t,e,i,n,s,r,o){let a=function(t,e,i){this.i1=t,this.i2=e,this.i3=i};function l(e,i,n,s,o,a){let l=e[0]*a+n-a,h=e[1]*a+s-a,u=e[2]*a+o-a,c=-1,f=.001;for(let t=0,e=i.length;t<e;t++){let e=i[t];if(r.abs(e.x-l)<f&&r.abs(e.y-h)<f&&r.abs(e.z-u)<f){c=t;break}}return-1==c&&(c=i.length,i.push(new t.Atom("C",l,h,u))),c}e._Surface=function(){};let h=e._Surface.prototype=new e._Mesh;h.generate=function(t,e,i,n,s,r,o,a){let l=[],h=s[4]-n;for(let t=0;t<a;t++){let t=s[2]-n;for(let e=0;e<o;e++){let e=s[0]-n;for(let i=0;i<r;i++)l.push(this.calculate(e,t,h)),e+=n;t+=n}h+=n}return l},h.build=function(e,i,o){let h=[],u=[],c=[],f=function(t,e){let i=[1/0,-1/0,1/0,-1/0,1/0,-1/0],n=e+2;for(let e=0,s=t.length;e<s;e++){let s=t[e];i[0]=r.min(i[0],s.x-n),i[1]=r.max(i[1],s.x+n),i[2]=r.min(i[2],s.y-n),i[3]=r.max(i[3],s.y+n),i[4]=r.min(i[4],s.z-n),i[5]=r.max(i[5],s.z+n)}return i}(e,i),d=f[1]-f[0],m=f[3]-f[2],p=f[5]-f[4],g=r.min(d,r.min(m,p))/o,x=2+r.ceil(d/g),_=2+r.ceil(m/g),b=2+r.ceil(p/g),y=this.generate(d,m,p,g,f,x,_,b),v=n(y,[x,_,b]),w=[],T=[];for(let t=0,e=v.vertices.length;t<e;t++)T.push(l(v.vertices[t],w,f[0],f[2],f[4],g));let S=[];for(let t=0,e=v.faces.length;t<e;t++){let e=v.faces[t],i=T[e[0]],n=T[e[1]],s=T[e[2]];S.push(new a(i,n,s)),c.push(i,n,s)}let D=[];for(let t=0,e=w.length;t<e;t++){let e=[];for(let i=0,n=S.length;i<n;i++){let n=S[i];n.i1!==t&&n.i2!==t&&n.i3!==t||(n.i1!=t&&-1===e.indexOf(n.i1)&&e.push(n.i1),n.i2!=t&&-1===e.indexOf(n.i2)&&e.push(n.i2),n.i3!=t&&-1===e.indexOf(n.i3)&&e.push(n.i3))}D.push(e)}let E=[];for(let e=0,i=w.length;e<i;e++){let i=w[e],n=D[e],s=new t.Atom;if(n.length<3)s.x=i.x,s.y=i.y,s.z=i.z;else{let t=1;n.length<5&&(t=.5);for(let t=0,e=n.length;t<e;t++){let e=w[n[t]];s.x+=e.x,s.y+=e.y,s.z+=e.z}s.x+=i.x*t,s.y+=i.y*t,s.z+=i.z*t;let e=1/(t+n.length);s.x*=e,s.y*=e,s.z*=e}E.push(s)}w=E;for(let t=0,e=w.length;t<e;t++){let e=w[t];h.push(e.x,e.y,e.z)}for(let t=0,e=S.length;t<e;t++){let e=S[t],i=w[e.i1],n=w[e.i2],r=w[e.i3],o=[n.x-i.x,n.y-i.y,n.z-i.z],a=[r.x-i.x,r.y-i.y,r.z-i.z];s.cross(o,a),isNaN(o[0])&&(o=[0,0,0]),e.normal=o}for(let t=0,e=w.length;t<e;t++){let e=[0,0,0];for(let i=0,n=S.length;i<n;i++){let n=S[i];n.i1!==t&&n.i2!==t&&n.i3!==t||(e[0]+=n.normal[0],e[1]+=n.normal[1],e[2]+=n.normal[2])}s.normalize(e),u.push(e[0],e[1],e[2])}this.storeData(h,u,c)},h.render=function(t,e){this.styles&&(e=this.styles),e.surfaces_display&&(t.shader.setMatrixUniforms(t),this.bindBuffers(t),t.material.setTempColors(t,e.surfaces_materialAmbientColor_3D,e.surfaces_color,e.surfaces_materialSpecularColor_3D,e.surfaces_materialShininess_3D),t.material.setAlpha(t,e.surfaces_alpha),"Dots"===e.surfaces_style?(t.shader.setPointSize(t,e.shapes_pointSize),t.drawElements(t.POINTS,this.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0)):"Mesh"===e.surfaces_style?(t.lineWidth(e.shapes_lineWidth),t.drawElements(t.LINES,this.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0)):t.drawElements(t.TRIANGLES,this.vertexIndexBuffer.numItems,t.UNSIGNED_SHORT,0))}}(e.structures,e.structures.d3,e.ELEMENT,e.lib.MarchingCubes,e.lib.vec3,Math),function(t,e,i,n,s){e.SASSurface=function(t,e,i){this.atoms=t,this.probeRadius=e,this.resolution=i,this.build(t,e,i)},(e.SASSurface.prototype=new e._Surface).calculate=function(e,s,r){let o=1/0,a=new t.Atom("C",e,s,r);for(let t=0,e=this.atoms.length;t<e;t++){let e=this.atoms[t],s=i[e.label]&&0!==i[e.label].vdWRadius?i[e.label].vdWRadius:2,r=e.distance3D(a)-this.probeRadius-s;o=n.min(o,r)}return o}}(e.structures,e.structures.d3,e.ELEMENT,Math),function(t,e,i,n,s){e.VDWSurface=function(t,e){this.atoms=t,this.probeRadius=0,this.resolution=e,this.build(t,0,e)},(e.VDWSurface.prototype=new e._Surface).calculate=function(e,s,r){let o=1/0,a=new t.Atom("C",e,s,r);for(let t=0,e=this.atoms.length;t<e;t++){let e=this.atoms[t],s=i[e.label]&&0!==i[e.label].vdWRadius?i[e.label].vdWRadius:2,r=e.distance3D(a)-s;o=n.min(o,r)}return o}}(e.structures,e.structures.d3,e.ELEMENT,Math),function(t,e,n,r){t.Plate=function(t){for(this.lanes=new Array(t),i=0,ii=t;i<ii;i++)this.lanes[i]=[]};let o=t.Plate.prototype;o.sort=function(){for(i=0,ii=this.lanes.length;i<ii;i++)this.lanes[i].sort((function(t,e){return t-e}))},o.draw=function(t,r){let o=t.canvas.width,a=t.canvas.height;for(this.origin=9*a/10,this.front=a/10,this.laneLength=this.origin-this.front,t.strokeStyle="#000000",t.beginPath(),t.moveTo(0,this.front),t.lineTo(o,this.front),t.setLineDash([3]),t.stroke(),t.setLineDash([]),t.beginPath(),t.moveTo(0,this.origin),t.lineTo(o,this.origin),t.closePath(),t.stroke(),i=0,ii=this.lanes.length;i<ii;i++){let r=(i+1)*o/(ii+1);for(t.beginPath(),t.moveTo(r,this.origin),t.lineTo(r,this.origin+3),t.closePath(),t.stroke(),s=0,ss=this.lanes[i].length;s<ss;s++){let o=this.origin-this.laneLength*this.lanes[i][s].rf;switch(this.lanes[i][s].type){case"compact":t.beginPath(),t.arc(r,o,3,0,2*n.PI,!1),t.closePath();break;case"expanded":t.beginPath(),t.arc(r,o,7,0,2*n.PI,!1),t.closePath();break;case"trailing":break;case"widened":e.contextEllipse(t,r-18,o-10,36,10);break;case"cresent":t.beginPath(),t.arc(r,o,9,0,n.PI,!0),t.closePath()}switch(this.lanes[i][s].style){case"solid":t.fillStyle="#000000",t.fill();break;case"transparent":t.stroke()}}}},t.Plate.Spot=function(t,e,i){this.type=t,this.rf=e,this.style=i||"solid"}}(e.structures,e.extensions,Math),function(t,i,n,s,r,o){t.DEFAULT_STYLES={backgroundColor:"#FFFFFF",scale:1,rotateAngle:0,bondLength_2D:20,angstromsPerBondLength:1.25,lightDirection_3D:[-.1,-.1,-1],lightDiffuseColor_3D:"#FFFFFF",lightSpecularColor_3D:"#FFFFFF",projectionPerspective_3D:!0,projectionPerspectiveVerticalFieldOfView_3D:45,projectionOrthoWidth_3D:40,projectionWidthHeightRatio_3D:o,projectionFrontCulling_3D:.1,projectionBackCulling_3D:1e4,cullBackFace_3D:!0,fog_mode_3D:0,fog_color_3D:"#000000",fog_start_3D:0,fog_end_3D:1,fog_density_3D:1,shadow_3D:!1,shadow_intensity_3D:.85,flat_color_3D:!1,antialias_3D:!0,gammaCorrection_3D:2.2,colorHover:"#885110",colorSelect:"#0060B2",colorError:"#c10000",colorPreview:"#00FF00",ssao_3D:!1,ssao_kernel_radius:17,ssao_kernel_samples:32,ssao_power:1,outline_3D:!1,outline_thickness:1,outline_normal_threshold:.85,outline_depth_threshold:.1,fxaa_edgeThreshold:1/16,fxaa_edgeThresholdMin:1/12,fxaa_searchSteps:64,fxaa_searchThreshold:1/4,fxaa_subpixCap:1,fxaa_subpixTrim:0,atoms_display:!0,atoms_color:"#000000",atoms_font_size_2D:12,atoms_font_families_2D:["Helvetica","Arial","Dialog"],atoms_font_bold_2D:!1,atoms_font_italic_2D:!1,atoms_circles_2D:!1,atoms_circleDiameter_2D:10,atoms_circleBorderWidth_2D:1,atoms_lonePairDistance_2D:8,atoms_lonePairSpread_2D:4,atoms_lonePairDiameter_2D:1,atoms_useJMOLColors:!1,atoms_usePYMOLColors:!1,atoms_HBlack_2D:!0,atoms_implicitHydrogens_2D:!0,atoms_displayTerminalCarbonLabels_2D:!1,atoms_showHiddenCarbons_2D:!0,atoms_showAttributedCarbons_2D:!0,atoms_displayAllCarbonLabels_2D:!1,atoms_resolution_3D:30,atoms_sphereDiameter_3D:.8,atoms_useVDWDiameters_3D:!1,atoms_vdwMultiplier_3D:1,atoms_materialAmbientColor_3D:"#000000",atoms_materialSpecularColor_3D:"#555555",atoms_materialShininess_3D:32,atoms_nonBondedAsStars_3D:!1,atoms_displayLabels_3D:!1,bonds_display:!0,bonds_color:"#000000",bonds_width_2D:1,bonds_useAbsoluteSaturationWidths_2D:!0,bonds_saturationWidth_2D:.2,bonds_saturationWidthAbs_2D:5,bonds_ends_2D:"round",bonds_splitColor:!1,bonds_colorGradient:!1,bonds_saturationAngle_2D:n.PI/3,bonds_symmetrical_2D:!1,bonds_clearOverlaps_2D:!1,bonds_overlapClearWidth_2D:.5,bonds_atomLabelBuffer_2D:1,bonds_wedgeThickness_2D:6,bonds_wavyLength_2D:4,bonds_hashWidth_2D:1,bonds_hashSpacing_2D:2.5,bonds_dotSize_2D:2,bonds_lewisStyle_2D:!1,bonds_showBondOrders_3D:!1,bonds_resolution_3D:30,bonds_renderAsLines_3D:!1,bonds_cylinderDiameter_3D:.3,bonds_pillLatitudeResolution_3D:10,bonds_pillLongitudeResolution_3D:20,bonds_pillHeight_3D:.3,bonds_pillSpacing_3D:.1,bonds_pillDiameter_3D:.3,bonds_materialAmbientColor_3D:"#000000",bonds_materialSpecularColor_3D:"#555555",bonds_materialShininess_3D:32,proteins_displayRibbon:!0,proteins_displayBackbone:!1,proteins_backboneThickness:1.5,proteins_backboneColor:"#CCCCCC",proteins_ribbonCartoonize:!1,proteins_displayPipePlank:!1,proteins_residueColor:"none",proteins_primaryColor:"#FF0D0D",proteins_secondaryColor:"#FFFF30",proteins_ribbonCartoonHelixPrimaryColor:"#00E740",proteins_ribbonCartoonHelixSecondaryColor:"#9905FF",proteins_ribbonCartoonSheetColor:"#E8BB99",proteins_tubeColor:"#FF0D0D",proteins_tubeResolution_3D:15,proteins_ribbonThickness:.2,proteins_tubeThickness:.5,proteins_plankSheetWidth:3.5,proteins_cylinderHelixDiameter:4,proteins_verticalResolution:8,proteins_horizontalResolution:8,proteins_materialAmbientColor_3D:"#000000",proteins_materialSpecularColor_3D:"#555555",proteins_materialShininess_3D:32,nucleics_display:!0,nucleics_tubeColor:"#CCCCCC",nucleics_baseColor:"#C10000",nucleics_residueColor:"none",nucleics_tubeThickness:1.5,nucleics_tubeResolution_3D:15,nucleics_verticalResolution:8,nucleics_materialAmbientColor_3D:"#000000",nucleics_materialSpecularColor_3D:"#555555",nucleics_materialShininess_3D:32,macro_displayAtoms:!1,macro_displayBonds:!1,macro_atomToLigandDistance:-1,macro_showWater:!1,macro_colorByChain:!1,macro_rainbowColors:["#0000FF","#00FFFF","#00FF00","#FFFF00","#FF0000"],surfaces_display:!0,surfaces_alpha:.5,surfaces_style:"Solid",surfaces_color:"white",surfaces_materialAmbientColor_3D:"#000000",surfaces_materialSpecularColor_3D:"#000000",surfaces_materialShininess_3D:32,plots_color:"#000000",plots_width:1,plots_showIntegration:!1,plots_integrationColor:"#c10000",plots_integrationLineWidth:1,plots_showGrid:!1,plots_gridColor:"gray",plots_gridLineWidth:.5,plots_showYAxis:!0,plots_flipXAxis:!1,text_font_size:12,text_font_families:["Helvetica","Arial","Dialog"],text_font_bold:!0,text_font_italic:!1,text_font_stroke_3D:!0,text_color:"#000000",shapes_color:"#000000",shapes_lineWidth:1,shapes_pointSize:2,shapes_arrowLength_2D:8,compass_display:!1,compass_axisXColor_3D:"#FF0000",compass_axisYColor_3D:"#00FF00",compass_axisZColor_3D:"#0000FF",compass_size_3D:50,compass_resolution_3D:10,compass_displayText_3D:!0,compass_type_3D:0,measurement_update_3D:!1,measurement_angleBands_3D:10,measurement_displayText_3D:!0},i.Styles=function(e){r.assign(this,s.parse(s.stringify(e===o?t.DEFAULT_STYLES:e)))};let a=i.Styles.prototype;a.set3DRepresentation=function(t){this.atoms_display=!0,this.bonds_display=!0,this.bonds_color="#777777",this.atoms_useVDWDiameters_3D=!0,this.atoms_useJMOLColors=!0,this.bonds_splitColor=!0,this.bonds_showBondOrders_3D=!0,this.bonds_renderAsLines_3D=!1,"Ball and Stick"===t?(this.atoms_vdwMultiplier_3D=.3,this.bonds_splitColor=!1,this.bonds_cylinderDiameter_3D=.3,this.bonds_materialAmbientColor_3D=e.DEFAULT_STYLES.atoms_materialAmbientColor_3D,this.bonds_pillDiameter_3D=.15):"van der Waals Spheres"===t?(this.bonds_display=!1,this.atoms_vdwMultiplier_3D=1):"Stick"===t?(this.atoms_useVDWDiameters_3D=!1,this.bonds_showBondOrders_3D=!1,this.bonds_cylinderDiameter_3D=this.atoms_sphereDiameter_3D=.8,this.bonds_materialAmbientColor_3D=this.atoms_materialAmbientColor_3D):"Wireframe"===t?(this.atoms_useVDWDiameters_3D=!1,this.bonds_cylinderDiameter_3D=this.bonds_pillDiameter_3D=.05,this.atoms_sphereDiameter_3D=.15,this.bonds_materialAmbientColor_3D=e.DEFAULT_STYLES.atoms_materialAmbientColor_3D):"Line"===t?(this.atoms_display=!1,this.bonds_renderAsLines_3D=!0,this.bonds_width_2D=1,this.bonds_cylinderDiameter_3D=.05):alert('"'+t+'" is not recognized. Use one of the following strings:\n\n1. Ball and Stick\n2. van der Waals Spheres\n3. Stick\n4. Wireframe\n5. Line\n')},a.copy=function(){return new i.Styles(this)}}(e,e.structures,Math,JSON,Object),function(t,e,i,n,s){i.getPointsPerAngstrom=function(){return t.DEFAULT_STYLES.bondLength_2D/t.DEFAULT_STYLES.angstromsPerBondLength},i.BondDeducer=function(){};let r=i.BondDeducer.prototype;r.margin=1.1,r.deduceCovalentBonds=function(t,s){let r=i.getPointsPerAngstrom();s&&(r=s);for(let i=0,s=t.atoms.length;i<s;i++)for(let o=i+1;o<s;o++){let s=t.atoms[i],a=t.atoms[o];s.distance3D(a)<(e[s.label].covalentRadius+e[a.label].covalentRadius)*r*this.margin&&t.bonds.push(new n.Bond(s,a,1))}}}(e,e.ELEMENT,e.informatics,e.structures),function(t,e,i){t.HydrogenDeducer=function(){},t.HydrogenDeducer.prototype.removeHydrogens=function(t,i){let n=[],s=[];for(let n=0,r=t.bonds.length;n<r;n++){let r=t.bonds[n],o="H"!==r.a1.label&&"H"!==r.a2.label;o||i||r.stereo===e.Bond.STEREO_NONE||(o=!0),o?(r.a1.tag=!0,s.push(r)):("H"===r.a1.label&&(r.a1.remove=!0),"H"===r.a2.label&&(r.a2.remove=!0))}for(let e=0,i=t.atoms.length;e<i;e++){let i=t.atoms[e];i.remove?i.remove=void 0:n.push(i)}t.atoms=n,t.bonds=s}}(e.informatics,e.structures),function(t,e,i){t.Splitter=function(){},t.Splitter.prototype.split=function(t){let i=[];for(let e=0,i=t.atoms.length;e<i;e++)t.atoms[e].visited=!1;for(let e=0,i=t.bonds.length;e<i;e++)t.bonds[e].visited=!1;for(let n=0,s=t.atoms.length;n<s;n++){let s=t.atoms[n];if(!s.visited){let n=new e.Molecule;n.atoms.push(s),s.visited=!0;let r=new e.Queue;for(r.enqueue(s);!r.isEmpty();){let e=r.dequeue();for(let i=0,s=t.bonds.length;i<s;i++){let s=t.bonds[i];if(s.contains(e)&&!s.visited){s.visited=!0,n.bonds.push(s);let t=s.getNeighbor(e);t.visited||(t.visited=!0,n.atoms.push(t),r.enqueue(t))}}}i.push(n)}}return i}}(e.informatics,e.structures),c=e.informatics,f=e.io,e.structures,c.StructureBuilder=function(){},c.StructureBuilder.prototype.copy=function(t){let e=new f.JSONInterpreter;return e.molFrom(e.molTo(t))},function(t,e){t._Counter=function(){};let i=t._Counter.prototype;i.value=0,i.molecule=void 0,i.setMolecule=function(t){this.value=0,this.molecule=t,this.innerCalculate&&this.innerCalculate()}}(e.informatics),function(t,e){t.FrerejacqueNumberCounter=function(t){this.setMolecule(t)},(t.FrerejacqueNumberCounter.prototype=new t._Counter).innerCalculate=function(){this.value=this.molecule.bonds.length-this.molecule.atoms.length+new t.NumberOfMoleculesCounter(this.molecule).value}}(e.informatics),function(t,e,i){e.NumberOfMoleculesCounter=function(t){this.setMolecule(t)},(e.NumberOfMoleculesCounter.prototype=new e._Counter).innerCalculate=function(){for(let t=0,e=this.molecule.atoms.length;t<e;t++)this.molecule.atoms[t].visited=!1;for(let e=0,i=this.molecule.atoms.length;e<i;e++)if(!this.molecule.atoms[e].visited){this.value++;let i=new t.Queue;for(this.molecule.atoms[e].visited=!0,i.enqueue(this.molecule.atoms[e]);!i.isEmpty();){let t=i.dequeue();for(let e=0,n=this.molecule.bonds.length;e<n;e++){let n=this.molecule.bonds[e];if(n.contains(t)){let e=n.getNeighbor(t);e.visited||(e.visited=!0,i.enqueue(e))}}}}}}(e.structures,e.informatics),function(t,e){t._RingFinder=function(){};let i=t._RingFinder.prototype;i.atoms=e,i.bonds=e,i.rings=e,i.reduce=function(t){for(let e=0,i=t.atoms.length;e<i;e++)t.atoms[e].visited=!1;for(let e=0,i=t.bonds.length;e<i;e++)t.bonds[e].visited=!1;let e=!0;for(;e;){e=!1;for(let i=0,n=t.atoms.length;i<n;i++){let n,s=0;for(let e=0,r=t.bonds.length;e<r;e++)if(t.bonds[e].contains(t.atoms[i])&&!t.bonds[e].visited){if(s++,2===s)break;n=t.bonds[e]}1===s&&(e=!0,n.visited=!0,t.atoms[i].visited=!0)}}for(let e=0,i=t.atoms.length;e<i;e++)t.atoms[e].visited||this.atoms.push(t.atoms[e]);for(let e=0,i=t.bonds.length;e<i;e++)t.bonds[e].visited||this.bonds.push(t.bonds[e]);0===this.bonds.length&&0!==this.atoms.length&&(this.atoms=[])},i.setMolecule=function(t){this.atoms=[],this.bonds=[],this.rings=[],this.reduce(t),this.atoms.length>2&&this.innerGetRings&&this.innerGetRings()},i.fuse=function(){for(let t=0,e=this.rings.length;t<e;t++)for(let e=0,i=this.bonds.length;e<i;e++)-1!==this.rings[t].atoms.indexOf(this.bonds[e].a1)&&-1!==this.rings[t].atoms.indexOf(this.bonds[e].a2)&&this.rings[t].bonds.push(this.bonds[e])}}(e.informatics),function(t,e,i){function n(t,e){if(this.atoms=[],e)for(let t=0,i=e.atoms.length;t<i;t++)this.atoms[t]=e.atoms[t];this.atoms.push(t)}let s=n.prototype;s.grow=function(t,e){let i=this.atoms[this.atoms.length-1],s=[];for(let n=0,r=t.length;n<r;n++)if(t[n].contains(i)){let r=t[n].getNeighbor(i);-1===e.indexOf(r)&&s.push(r)}let r=[];for(let t=0,e=s.length;t<e;t++)r.push(new n(s[t],this));return r},s.check=function(t,n,s){for(let t=0,e=n.atoms.length-1;t<e;t++)if(-1!==this.atoms.indexOf(n.atoms[t]))return i;let r;if(n.atoms[n.atoms.length-1]===this.atoms[this.atoms.length-1]){r=new e.Ring,r.atoms[0]=s;for(let t=0,e=this.atoms.length;t<e;t++)r.atoms.push(this.atoms[t]);for(let t=n.atoms.length-2;t>=0;t--)r.atoms.push(n.atoms[t])}else{let i=[];for(let e=0,s=t.length;e<s;e++)t[e].contains(n.atoms[n.atoms.length-1])&&i.push(t[e]);for(let t=0,o=i.length;t<o;t++)if((1===n.atoms.length||!i[t].contains(n.atoms[n.atoms.length-2]))&&i[t].contains(this.atoms[this.atoms.length-1])){r=new e.Ring,r.atoms[0]=s;for(let t=0,e=this.atoms.length;t<e;t++)r.atoms.push(this.atoms[t]);for(let t=n.atoms.length-1;t>=0;t--)r.atoms.push(n.atoms[t]);break}}return r},t.EulerFacetRingFinder=function(t){this.setMolecule(t)};let r=t.EulerFacetRingFinder.prototype=new t._RingFinder;r.fingerBreak=5,r.innerGetRings=function(){for(let t=0,e=this.atoms.length;t<e;t++){let e=[];for(let i=0,n=this.bonds.length;i<n;i++)this.bonds[i].contains(this.atoms[t])&&e.push(this.bonds[i].getNeighbor(this.atoms[t]));for(let s=0,r=e.length;s<r;s++)for(let r=s+1;r<e.length;r++){let o=[];o[0]=new n(e[s]),o[1]=new n(e[r]);let a=[];a[0]=this.atoms[t];for(let t=0,i=e.length;t<i;t++)t!==s&&t!==r&&a.push(e[t]);let l=[],h=o[0].check(this.bonds,o[1],this.atoms[t]);for(h&&(l[0]=h);0===l.length&&o.length>0&&o[0].atoms.length<this.fingerBreak;){let e=[];for(let t=0,i=o.length;t<i;t++){let i=o[t].grow(this.bonds,a);for(let t=0,n=i.length;t<n;t++)e.push(i[t])}o=e;for(let e=0,i=o.length;e<i;e++)for(let n=e+1;n<i;n++){let i=o[e].check(this.bonds,o[n],this.atoms[t]);i&&l.push(i)}if(0===l.length){let t=[];for(let e=0,i=a.length;e<i;e++)for(let i=0,n=this.bonds.length;i<n;i++)if(this.bonds[i].contains(a[e])){let n=this.bonds[i].getNeighbor(a[e]);-1===a.indexOf(n)&&-1===t.indexOf(n)&&t.push(n)}for(let e=0,i=t.length;e<i;e++)a.push(t[e])}}if(l.length>0){let t=i;for(let e=0,i=l.length;e<i;e++)(!t||t.atoms.length>l[e].atoms.length)&&(t=l[e]);let e=!1;for(let i=0,n=this.rings.length;i<n;i++){let n=!0;for(let e=0,s=t.atoms.length;e<s;e++)if(-1===this.rings[i].atoms.indexOf(t.atoms[e])){n=!1;break}if(n){e=!0;break}}e||this.rings.push(t)}}}this.fuse()}}(e.informatics,e.structures),function(t,e){t.SSSRFinder=function(e){if(this.rings=[],e.atoms.length>0){let i=new t.FrerejacqueNumberCounter(e).value,n=new t.EulerFacetRingFinder(e).rings;n.sort((function(t,e){return t.atoms.length-e.atoms.length}));for(let t=0,i=e.bonds.length;t<i;t++)e.bonds[t].visited=!1;for(let t=0,e=n.length;t<e;t++){let e=!1;for(let i=0,s=n[t].bonds.length;i<s;i++)if(!n[t].bonds[i].visited){e=!0;break}if(e){for(let e=0,i=n[t].bonds.length;e<i;e++)n[t].bonds[e].visited=!0;this.rings.push(n[t])}if(this.rings.length===i)break}}}}(e.informatics),function(t,e){t._Interpreter=function(){},t._Interpreter.prototype.fit=function(t,e,i){let n=t.length,s=[];for(let t=0;t<e-n;t++)s.push(" ");return i?t+s.join(""):s.join("")+t}}(e.io),function(t,e,i,n,s,r,o,a){let l=/\s+/g,h=/\(|\)|\s+/g,u=/\'|\s+/g,c=/,|\'|\s+/g,f=/^\s+/,d=/[0-9]/g,m=/[0-9]|\+|\-/g,p=function(t){return 0!==t.length},g={P:[],A:[[0,.5,.5]],B:[[.5,0,.5]],C:[[.5,.5,0]],I:[[.5,.5,.5]],R:[[2/3,1/3,1/3],[1/3,2/3,2/3]],S:[[1/3,1/3,2/3],[2/3,2/3,1/3]],T:[[1/3,2/3,1/3],[2/3,1/3,2/3]],F:[[0,.5,.5],[.5,0,.5],[.5,.5,0]]},x=function(t){let e=0,i=0,n=0,s=0,r=t.indexOf("x"),o=t.indexOf("y"),a=t.indexOf("z");if(-1!==r&&(i++,r>0&&"+"!==t.charAt(r-1)&&(i*=-1)),-1!==o&&(n++,o>0&&"+"!==t.charAt(o-1)&&(n*=-1)),-1!==a&&(s++,a>0&&"+"!==t.charAt(a-1)&&(s*=-1)),t.length>2){let i="+";for(let n=0,s=t.length;n<s;n++){let s=t.charAt(n);"-"!==s&&"/"!==s||n!==t.length-1&&!t.charAt(n+1).match(d)||(i=s),s.match(d)&&("+"===i?e+=parseInt(s):"-"===i?e-=parseInt(s):"/"===i&&(e/=parseInt(s)))}}return[e,i,n,s]};e.CIFInterpreter=function(){},e.CIFInterpreter.generateABC2XYZ=function(t,e,i,n,r,o){let a=(s.cos(n)-s.cos(o)*s.cos(r))/s.sin(o);return[t,0,0,0,e*s.cos(o),e*s.sin(o),0,0,i*s.cos(r),i*a,i*s.sqrt(1-s.pow(s.cos(r),2)-a*a),0,0,0,0,1]},(e.CIFInterpreter.prototype=new e._Interpreter).read=function(o,d,_,b){d=d||1,_=_||1,b=b||1;let y=new i.Molecule;if(!o)return y;let v,w,T,S,D=o.split("\n"),E=0,C=0,A=0,F=0,R=0,P=0,M="P",B=!0;for(;D.length>0;)if(B?S=D.shift():B=!0,S.length>0)if(S.startsWith("_cell_length_a"))E=parseFloat(S.split(h)[1]);else if(S.startsWith("_cell_length_b"))C=parseFloat(S.split(h)[1]);else if(S.startsWith("_cell_length_c"))A=parseFloat(S.split(h)[1]);else if(S.startsWith("_cell_angle_alpha"))F=s.PI*parseFloat(S.split(h)[1])/180;else if(S.startsWith("_cell_angle_beta"))R=s.PI*parseFloat(S.split(h)[1])/180;else if(S.startsWith("_cell_angle_gamma"))P=s.PI*parseFloat(S.split(h)[1])/180;else if(S.startsWith("_symmetry_space_group_name_H-M"))M=S.split(u)[1];else if(S.startsWith("loop_")){let t={fields:[],lines:[]},e=!1;for(;(S=D.shift())!==a&&!(S=S.replace(f,"")).startsWith("loop_")&&S.length>0;)if(S.startsWith("_")){if(e)break;t.fields=t.fields.concat(S.split(l).filter(p))}else e=!0,t.lines.push(S);0!==D.length&&(S.startsWith("loop_")||S.startsWith("_"))&&(B=!1),-1!==t.fields.indexOf("_symmetry_equiv_pos_as_xyz")||-1!==t.fields.indexOf("_space_group_symop_operation_xyz")?v=t:-1!==t.fields.indexOf("_atom_site_label")?w=t:-1!==t.fields.indexOf("_geom_bond_atom_site_label_1")&&(T=t)}let I=e.CIFInterpreter.generateABC2XYZ(E,C,A,F,R,P);if(w){let t=-1,e=-1,n=-1,s=-1,r=-1;for(let i=0,o=w.fields.length;i<o;i++){let o=w.fields[i];"_atom_site_type_symbol"===o?t=i:"_atom_site_label"===o?e=i:"_atom_site_fract_x"===o?n=i:"_atom_site_fract_y"===o?s=i:"_atom_site_fract_z"===o&&(r=i)}for(let o=0,a=w.lines.length;o<a;o++){S=w.lines[o];let a=S.split(l).filter(p),h=new i.Atom(a[-1===t?e:t].split(m)[0],parseFloat(a[n]),parseFloat(a[s]),parseFloat(a[r]));y.atoms.push(h),-1!==e&&(h.cifId=a[e],h.cifPart=0)}}if(v&&!T){let t=0;for(let e=0,i=v.fields.length;e<i;e++){let i=v.fields[e];"_symmetry_equiv_pos_as_xyz"!==i&&"_space_group_symop_operation_xyz"!==i||(t=e)}let e=g[M],n=[];for(let s=0,r=v.lines.length;s<r;s++){let r=v.lines[s].split(c).filter(p),o=x(r[t]),l=x(r[t+1]),h=x(r[t+2]);for(let t=0,r=y.atoms.length;t<r;t++){let r=y.atoms[t],u=r.x*o[1]+r.y*o[2]+r.z*o[3]+o[0],c=r.x*l[1]+r.y*l[2]+r.z*l[3]+l[0],f=r.x*h[1]+r.y*h[2]+r.z*h[3]+h[0],d=new i.Atom(r.label,u,c,f);if(n.push(d),r.cifId!==a&&(d.cifId=r.cifId,d.cifPart=s+1),e)for(let t=0,o=e.length;t<o;t++){let o=e[t],l=new i.Atom(r.label,u+o[0],c+o[1],f+o[2]);n.push(l),r.cifId!==a&&(l.cifId=r.cifId,l.cifPart=s+1)}}}for(let t=0,e=n.length;t<e;t++){let e=n[t];for(;e.x>=1;)e.x--;for(;e.x<0;)e.x++;for(;e.y>=1;)e.y--;for(;e.y<0;)e.y++;for(;e.z>=1;)e.z--;for(;e.z<0;)e.z++}let s=[];for(let t=0,e=n.length;t<e;t++){let e=!1,i=n[t];for(let t=0,n=y.atoms.length;t<n;t++)if(y.atoms[t].distance3D(i)<1e-4){e=!0;break}if(!e){for(let t=0,n=s.length;t<n;t++)if(s[t].distance3D(i)<1e-4){e=!0;break}e||s.push(i)}}y.atoms=y.atoms.concat(s)}let L=[];for(let t=0;t<d;t++)for(let e=0;e<_;e++)for(let n=0;n<b;n++)if(0!==t||0!==e||0!==n)for(let s=0,r=y.atoms.length;s<r;s++){let r=y.atoms[s],o=new i.Atom(r.label,r.x+t,r.y+e,r.z+n);L.push(o),r.cifId!==a&&(o.cifId=r.cifId,o.cifPart=r.cifPart+(v?v.lines.length:0)+t+10*e+100*n)}y.atoms=y.atoms.concat(L);for(let t=0,e=y.atoms.length;t<e;t++){let e=y.atoms[t],i=r.multiplyVec3(I,[e.x,e.y,e.z]);e.x=i[0],e.y=i[1],e.z=i[2]}if(T){let t=-1,e=-1;for(let i=0,n=T.fields.length;i<n;i++){let n=T.fields[i];"_geom_bond_atom_site_label_1"===n?t=i:"_geom_bond_atom_site_label_2"===n&&(e=i)}for(let n=0,s=T.lines.length;n<s;n++){let s=T.lines[n].split(l).filter(p),r=s[t],o=s[e];for(let t=0,e=y.atoms.length;t<e;t++)for(let n=t+1;n<e;n++){let e=y.atoms[t],s=y.atoms[n];if(e.cifPart!==s.cifPart)break;(e.cifId===r&&s.cifId===o||e.cifId===o&&s.cifId===r)&&y.bonds.push(new i.Bond(e,s))}}}else(new t.informatics.BondDeducer).deduceCovalentBonds(y,1);return{molecule:y,unitCell:new n.UnitCell([E,C,A],[F,R,P],[0,0,0])}};let _=new e.CIFInterpreter;t.readCIF=function(t,e,i,n){return _.read(t,e,i,n)}}(e,e.io,e.structures,e.structures.d3,Math,e.lib.mat4,e.lib.vec3),function(t,e,i,n,s){e.CMLInterpreter=function(){};let r=e.CMLInterpreter.prototype=new e._Interpreter;r.read=function(t){let e=[],r=n.parseXML(t),o=n(r).find("cml");for(let t=0,r=o.length;t<r;t++){let r=n(o[t]).find("molecule");for(let t=0,o=r.length;t<o;t++){let o=e[t]=new i.Molecule,a=[],l=n(r[t]).find("atom");for(let r=0,o=l.length;r<o;r++){let o,h,u,c,f=n(l[r]),d=f.attr("elementType");f.attr("x2")==s?(o=f.attr("x3"),h=f.attr("y3"),u=f.attr("z3")):(o=f.attr("x2"),h=f.attr("y2"),u=0),c=e[t].atoms[r]=new i.Atom(d,o,h,u),a[r]=f.attr("id"),f.attr("formalCharge")!=s&&(c.charge=f.attr("formalCharge"))}let h=n(r[t]).find("bond");for(let s=0,r=h.length;s<r;s++){let r,l,u,c=n(h[s]),f=c.attr("atomRefs2").split(" ");switch(r=o.atoms[n.inArray(f[0],a)],l=o.atoms[n.inArray(f[1],a)],c.attr("order")){case"2":case"D":u=2;break;case"3":case"T":u=3;break;case"A":u=1.5;break;default:u=1}let d=e[t].bonds[s]=new i.Bond(r,l,u);switch(c.find("bondStereo").text()){case"W":d.stereo=i.Bond.STEREO_PROTRUDING;break;case"H":d.stereo=i.Bond.STEREO_RECESSED}}}}return e},r.write=function(t){let e=[];e.push('<?xml version="1.0" encoding="UTF-8"?>\n'),e.push('<cml convention="conventions:molecular" xmlns="http://www.xml-cml.org/schema" xmlns:conventions="http://www.xml-cml.org/convention/" xmlns:dc="http://purl.org/dc/elements/1.1/">\n');for(let i=0,n=t.length;i<n;i++){e.push('<molecule id="m'),e.push(i),e.push('">'),e.push("<atomArray>");for(let n=0,s=t[i].atoms.length;n<s;n++){let s=t[i].atoms[n];e.push('<atom elementType="'),e.push(s.label),e.push('" id="a'),e.push(n),e.push('" '),e.push('x3="'),e.push(s.x),e.push('" y3="'),e.push(s.y),e.push('" z3="'),e.push(s.z),e.push('" '),0!=s.charge&&(e.push('formalCharge="'),e.push(s.charge),e.push('" ')),e.push("/>")}e.push("</atomArray>"),e.push("<bondArray>");for(let n=0,s=t[i].bonds.length;n<s;n++){let s=t[i].bonds[n];switch(e.push('<bond atomRefs2="a'),e.push(t[i].atoms.indexOf(s.a1)),e.push(" a"),e.push(t[i].atoms.indexOf(s.a2)),e.push('" order="'),s.bondOrder){case 1.5:e.push("A");break;case 1:case 2:case 3:e.push(s.bondOrder);break;default:e.push("S")}e.push('"/>')}e.push("</bondArray>"),e.push("</molecule>")}return e.push("</cml>"),e.join("")};let o=new e.CMLInterpreter;t.readCML=function(t){return o.read(t)},t.writeCML=function(t){return o.write(t)}}(e,e.io,e.structures,e.lib.jQuery),function(t,e,i,n,s){i.MOLInterpreter=function(){};let r=i.MOLInterpreter.prototype=new i._Interpreter;r.version=2,r.read=function(i,s){s||(s=t.DEFAULT_STYLES.bondLength_2D);let r=new n.Molecule;if(!i)return r;let o=i.split("\n"),a=o[3],l=parseInt(a.substring(0,3)),h=parseInt(a.substring(3,6)),u="V3000"===a.substring(34,39).trim().toUpperCase()?3:2;if(2===u){for(let t=0;t<l;t++){let i=o[4+t],a=new n.Atom(i.substring(31,34),parseFloat(i.substring(0,10))*s,(1===s?1:-1)*parseFloat(i.substring(10,20))*s,parseFloat(i.substring(20,30))*s),l=parseInt(i.substring(34,36));switch(0!==l&&e[a.label]&&(a.mass=e[a.label].mass+l),parseInt(i.substring(36,39))){case 1:a.charge=3;break;case 2:a.charge=2;break;case 3:a.charge=1;break;case 5:a.charge=-1;break;case 6:a.charge=-2;break;case 7:a.charge=-3}r.atoms[t]=a}for(let t=0;t<h;t++){let e=o[4+l+t],i=parseInt(e.substring(6,9)),s=parseInt(e.substring(9,12));i>3&&(i=4===i?1.5:1);let a=new n.Bond(r.atoms[parseInt(e.substring(0,3))-1],r.atoms[parseInt(e.substring(3,6))-1],i);switch(s){case 3:a.stereo=n.Bond.STEREO_AMBIGUOUS;break;case 1:a.stereo=n.Bond.STEREO_PROTRUDING;break;case 6:a.stereo=n.Bond.STEREO_RECESSED}r.bonds[t]=a}}else if(3===u){let t;for(let e=4,i=o.length;e<i;e++){let i=o[e].trim();if(i.startsWith("M  V30 "))if(i=i.substring(7),i.startsWith("BEGIN "))t=i.substring(6);else if(i.startsWith("END "))t=void 0;else{let e=i.split(/(\s+)/).filter((t=>t.trim().length>0));if("ATOM"===t){let t=new n.Atom(e[1],parseFloat(e[2])*s,(1===s?1:-1)*parseFloat(e[3])*s,parseFloat(e[4])*s);for(let i=6,n=e.length;i<n;i++){let n=e[i],s=n.indexOf("=");if(-1!==s){let e=n.substring(0,s),i=n.substring(s+1);"CHG"===e?t.charge=parseInt(i):"RAD"===e?t.numRadical=parseInt(i):"MASS"===e&&(t.mass=parseInt(i))}}r.atoms.push(t)}else if("BOND"===t){let t=parseInt(e[1]);t>3&&(t=4===t?1.5:1);let i=new n.Bond(r.atoms[parseInt(e[2])-1],r.atoms[parseInt(e[3])-1],t);for(let t=4,s=e.length;t<s;t++){let s=e[t],r=s.indexOf("=");if(-1!==r){let t=s.substring(0,r),e=s.substring(r+1);if("CFG"===t)switch(parseInt(e)){case 2:i.stereo=n.Bond.STEREO_AMBIGUOUS;break;case 1:i.stereo=n.Bond.STEREO_PROTRUDING;break;case 3:i.stereo=n.Bond.STEREO_RECESSED}}}r.bonds.push(i)}else if("COLLECTION"===t)if(i.startsWith("MDLV30/STEREL")){i=i.substring(13);let t=i.indexOf(" "),e=parseInt(i.substring(0,t)),s=i.substring(t+1);s=s.substring(7,s.length-1);let o=s.split(/(\s+)/).filter((t=>t.trim().length>0));for(let t=1,i=o.length;t<i;t++){let i=o[t];r.atoms[parseInt(i)-1].enhancedStereo={type:n.Atom.ESTEREO_OR,group:e}}}else if(i.startsWith("MDLV30/STERAC")){i=i.substring(13);let t=i.indexOf(" "),e=parseInt(i.substring(0,t)),s=i.substring(t+1);s=s.substring(7,s.length-1);let o=s.split(/(\s+)/).filter((t=>t.trim().length>0));for(let t=1,i=o.length;t<i;t++){let i=o[t];r.atoms[parseInt(i)-1].enhancedStereo={type:n.Atom.ESTEREO_AND,group:e}}}}}}return r},r.write=function(i){let s=[];s.push("Molecule from ChemDoodle Web Components\n\nhttp://www.ichemlabs.com\n"),s.push(this.fit(i.atoms.length.toString(),3)),s.push(this.fit(i.bonds.length.toString(),3)),s.push("  0  0  0  0            999 V"+this.version+"000\n");let r=i.getCenter();if(2===this.version){for(let n=0,o=i.atoms.length;n<o;n++){let o=i.atoms[n],a=" 0";if(-1!==o.mass&&e[o.label]){let t=o.mass-e[o.label].mass;t<5&&t>-4&&(a=(t>-1?" ":"")+t)}let l="  0";if(0!==o.charge)switch(o.charge){case 3:l="  1";break;case 2:l="  2";break;case 1:l="  3";break;case-1:l="  5";break;case-2:l="  6";break;case-3:l="  7"}s.push(this.fit(((o.x-r.x)/t.DEFAULT_STYLES.bondLength_2D).toFixed(4),10)),s.push(this.fit((-(o.y-r.y)/t.DEFAULT_STYLES.bondLength_2D).toFixed(4),10)),s.push(this.fit((o.z/t.DEFAULT_STYLES.bondLength_2D).toFixed(4),10)),s.push(" "),s.push(this.fit(o.label,3,!0)),s.push(a),s.push(l),s.push("  0  0  0  0\n")}for(let t=0,e=i.bonds.length;t<e;t++){let e=i.bonds[t],r=0;e.stereo===n.Bond.STEREO_AMBIGUOUS?r=3:e.stereo===n.Bond.STEREO_PROTRUDING?r=1:e.stereo===n.Bond.STEREO_RECESSED&&(r=6),s.push(this.fit((i.atoms.indexOf(e.a1)+1).toString(),3)),s.push(this.fit((i.atoms.indexOf(e.a2)+1).toString(),3));let o=e.bondOrder;1.5==o?o=4:(o>3||o%1!=0)&&(o=1),s.push(this.fit(o.toString(),3)),s.push("  "),s.push(r),s.push("  0  0  0\n")}}else if(3===this.version){s.push("M  V30 BEGIN CTAB\n"),s.push("M  V30 COUNTS "),s.push(i.atoms.length),s.push(" "),s.push(i.bonds.length),s.push(" 0 0 0\n"),s.push("M  V30 BEGIN ATOM\n");for(let e=0,n=i.atoms.length;e<n;e++){let n=i.atoms[e];s.push("M  V30 "),s.push(e+1),s.push(" "),s.push(n.label),s.push(" "),s.push(((n.x-r.x)/t.DEFAULT_STYLES.bondLength_2D).toFixed(6)),s.push(" "),s.push((-(n.y-r.y)/t.DEFAULT_STYLES.bondLength_2D).toFixed(6)),s.push(" "),s.push((n.z/t.DEFAULT_STYLES.bondLength_2D).toFixed(6)),s.push(" 0"),0!==n.charge&&(s.push(" CHG="),s.push(n.charge)),0!==n.numRadical&&(s.push(" RAD="),s.push(n.numRadical)),-1!==n.mass&&(s.push(" MASS="),s.push(n.mass)),s.push("\n")}s.push("M  V30 END ATOM\n"),s.push("M  V30 BEGIN BOND\n");for(let t=0,e=i.bonds.length;t<e;t++){let e=i.bonds[t],r=e.bondOrder;if(1.5==r?r=4:(r>3||r%1!=0)&&(r=1),s.push("M  V30 "),s.push(t+1),s.push(" "),s.push(r),s.push(" "),s.push(i.atoms.indexOf(e.a1)+1),s.push(" "),s.push(i.atoms.indexOf(e.a2)+1),e.stereo!==n.Bond.STEREO_NONE){let t=0;e.stereo===n.Bond.STEREO_AMBIGUOUS?t=2:e.stereo===n.Bond.STEREO_PROTRUDING?t=1:e.stereo===n.Bond.STEREO_RECESSED&&(t=3),s.push(" CFG="),s.push(t)}s.push("\n")}let e,o;s.push("M  V30 END BOND\n");for(let t=0,s=i.atoms.length;t<s;t++){let s=i.atoms[t];if(s.enhancedStereo.type!==n.Atom.ESTEREO_ABSOLUTE){let t,i;e||(e=[],o=[]),s.enhancedStereo.type===n.Atom.ESTEREO_AND?t=e:s.enhancedStereo.type===n.Atom.ESTEREO_OR&&(t=o);for(let e=0,n=t.length;e<n;e++){let n=t[e];if(n.group==s.enhancedStereo.group){i=n;break}}i||(i={group:s.enhancedStereo.group,list:[]},t.push(i)),i.list.push(s)}}if(e&&(e.length>0||o.length>0)){if(s.push("M  V30 BEGIN COLLECTION\n"),e.length>0)for(let t=0,n=e.length;t<n;t++){let n=e[t];s.push("M  V30 MDLV30/STERAC"),s.push(n.group),s.push(" ATOMS=("),s.push(n.list.length);for(let t=0,e=n.list.length;t<e;t++)s.push(" "),s.push(i.atoms.indexOf(n.list[t])+1);s.push(")\n")}if(o.length>0)for(let t=0,e=o.length;t<e;t++){let e=o[t];s.push("M  V30 MDLV30/STEREL"),s.push(e.group),s.push(" ATOMS=("),s.push(e.list.length);for(let t=0,n=e.list.length;t<n;t++)s.push(" "),s.push(i.atoms.indexOf(e.list[t])+1);s.push(")\n")}s.push("M  V30 END COLLECTION\n")}s.push("M  V30 END CTAB\n")}return s.push("M  END"),s.join("")};let o=new i.MOLInterpreter;t.readMOL=function(t,e){return o.read(t,e)},t.writeMOL=function(t){return o.write(t)};let a=new i.MOLInterpreter;a.version=3,t.writeMOLV3=function(t){return a.write(t)}}(e,e.ELEMENT,e.io,e.structures),function(t,e,i,n,s,r,o){function a(t,e,i,n,s){for(let r=0,o=e.length;r<o;r++){let o=e[r];if(o.id===i&&n>=o.start&&n<=o.end)return s?t.helix=!0:t.sheet=!0,void(n===o.end&&(t.arrow=!0))}}e.PDBInterpreter=function(){};let l=e.PDBInterpreter.prototype=new e._Interpreter;l.calculateRibbonDistances=!1,l.deduceResidueBonds=!1,l.read=function(e,o){let l=new i.Molecule;if(l.chains=[],!e)return l;let h=e.split("\n");o||(o=1);let u,c=[],f=[],d=[],m=[],p=[];for(let t=0,e=h.length;t<e;t++){let e=h[t];if(e.startsWith("HELIX"))c.push({id:e.substring(19,20),start:parseInt(e.substring(21,25)),end:parseInt(e.substring(33,37))});else if(e.startsWith("SHEET"))f.push({id:e.substring(21,22),start:parseInt(e.substring(22,26)),end:parseInt(e.substring(33,37))});else if(e.startsWith("ATOM")){let t=e.substring(16,17);if(" "===t||"A"===t){let t=s(e.substring(76,78));if(0===t.length){let i=s(e.substring(12,14));"HD"===i?t="H":i.length>0&&(t=i.length>1?i.charAt(0)+i.substring(1).toLowerCase():i)}let n=new i.Atom(t,parseFloat(e.substring(30,38))*o,parseFloat(e.substring(38,46))*o,parseFloat(e.substring(46,54))*o);n.hetatm=!1,m.push(n);let r=parseInt(e.substring(22,26));if(0===d.length)for(let t=0;t<3;t++){let t=new i.Residue(-1);t.cp1=n,t.cp2=n,d.push(t)}if(r!==Number.NaN&&d[d.length-1].resSeq!==r){let t=new i.Residue(r);t.name=s(e.substring(17,20)),3===t.name.length?t.name=t.name.substring(0,1)+t.name.substring(1).toLowerCase():2===t.name.length&&"D"===t.name.charAt(0)&&(t.name=t.name.substring(1)),d.push(t);let n=e.substring(21,22);a(t,c,n,r,!0),a(t,f,n,r,!1)}let l=s(e.substring(12,16)),h=d[d.length-1];"CA"===l||"P"===l||"O5'"===l?h.cp1||(h.cp1=n):"N3"===l&&("C"===h.name||"U"===h.name||"T"===h.name)||"N1"===l&&("A"===h.name||"G"===h.name)?h.cp3=n:"C2"===l?h.cp4=n:"C4"===l&&("C"===h.name||"U"===h.name||"T"===h.name)||"C6"===l&&("A"===h.name||"G"===h.name)?h.cp5=n:"O"===l||"C6"===l&&("C"===h.name||"U"===h.name||"T"===h.name)||"N9"===l?d[d.length-1].cp2||("C6"!==l&&"N9"!==l||(u=n),h.cp2=n):"C"===l&&(u=n)}}else if(e.startsWith("HETATM")){let t=s(e.substring(76,78));0===t.length&&(t=s(e.substring(12,16))),t.length>1&&(t=t.substring(0,1)+t.substring(1).toLowerCase());let n=new i.Atom(t,parseFloat(e.substring(30,38))*o,parseFloat(e.substring(38,46))*o,parseFloat(e.substring(46,54))*o);n.hetatm=!0,"HOH"===s(e.substring(17,20))&&(n.isWater=!0),l.atoms.push(n),p[parseInt(s(e.substring(6,11)))]=n}else if(e.startsWith("CONECT")){let t=parseInt(s(e.substring(6,11)));if(p[t]){let n=p[t];for(let t=0;t<4;t++){let r=s(e.substring(11+5*t,16+5*t));if(0!==r.length){let t=parseInt(r);if(p[t]){let e=p[t],s=!1;for(let t=0,i=l.bonds.length;t<i;t++){let i=l.bonds[t];if(i.a1===n&&i.a2===e||i.a1===e&&i.a2===n){s=!0;break}}s||l.bonds.push(new i.Bond(n,e))}}}}}else if(e.startsWith("TER"))this.endChain(l,d,u,m),d=[];else if(e.startsWith("ENDMDL"))break}if(this.endChain(l,d,u,m),0===l.bonds.length&&(new t.informatics.BondDeducer).deduceCovalentBonds(l,o),this.deduceResidueBonds)for(let t=0,e=m.length;t<e;t++){let s=r.min(e,t+20);for(let e=t+1;e<s;e++){let s=m[t],r=m[e];s.distance3D(r)<1.1*(n[s.label].covalentRadius+n[r.label].covalentRadius)&&l.bonds.push(new i.Bond(s,r,1))}}return l.atoms=l.atoms.concat(m),this.calculateRibbonDistances&&this.calculateDistances(l,m),l},l.endChain=function(t,e,n,s){if(e.length>0){let r=e[e.length-1];r.cp1||(r.cp1=s[s.length-2]),r.cp2||(r.cp2=s[s.length-1]);for(let t=0;t<4;t++){let t=new i.Residue(-1);t.cp1=n,t.cp2=e[e.length-1].cp2,e.push(t)}t.chains.push(e)}},l.calculateDistances=function(t,e){let i=[];for(let e=0,n=t.atoms.length;e<n;e++){let n=t.atoms[e];n.hetatm&&(n.isWater||i.push(n))}for(let t=0,n=e.length;t<n;t++){let n=e[t];if(n.closestDistance=Number.POSITIVE_INFINITY,0===i.length)n.closestDistance=0;else for(let t=0,e=i.length;t<e;t++)n.closestDistance=Math.min(n.closestDistance,n.distance3D(i[t]))}};let h=new e.PDBInterpreter;t.readPDB=function(t,e){return h.read(t,e)}}(e,e.io,e.structures,e.ELEMENT,e.lib.jQuery.trim,Math),function(t,e,i,n,s){let r={"@":0,A:1,B:2,C:3,D:4,E:5,F:6,G:7,H:8,I:9,a:-1,b:-2,c:-3,d:-4,e:-5,f:-6,g:-7,h:-8,i:-9},o={"%":0,J:1,K:2,L:3,M:4,N:5,O:6,P:7,Q:8,R:9,j:-1,k:-2,l:-3,m:-4,n:-5,o:-6,p:-7,q:-8,r:-9},a={S:1,T:2,U:3,V:4,W:5,X:6,Y:7,Z:8,s:9};e.JCAMPInterpreter=function(){};let l=e.JCAMPInterpreter.prototype=new e._Interpreter;l.convertHZ2PPM=!1,l.read=function(t){this.isBreak=function(t){return r[t]!==s||o[t]!==s||a[t]!==s||" "===t||"-"===t||"+"===t},this.getValue=function(t,e){let i=t.charAt(0),n=t.substring(1);return r[i]!==s?parseFloat(r[i]+n):o[i]!==s?parseFloat(o[i]+n)+e:parseFloat(n)};let e=new i.Spectrum;if(t===s||0===t.length)return e;let n,l,h,u,c=t.split("\n"),f=[],d=1,m=1,p=1,g=-1,x=-1,_=-1,b=!0,y=!1;for(let t=0,v=c.length;t<v;t++){let v=c[t].trim(),w=v.indexOf("$$");if(-1!==w&&(v=v.substring(0,w)),0!==f.length&&c[t].startsWith("##")){let t=f.join("");if(b&&t.length<100&&e.metadata.push(t),f=[v],t.startsWith("##TITLE="))e.title=t.substring(8).trim();else if(t.startsWith("##XUNITS="))e.xUnit=t.substring(9).trim(),this.convertHZ2PPM&&"HZ"===e.xUnit.toUpperCase()&&(e.xUnit="PPM",y=!0);else if(t.startsWith("##YUNITS="))e.yUnit=t.substring(9).trim();else if(t.startsWith("##XYPAIRS="));else if(t.startsWith("##FIRSTX="))l=parseFloat(t.substring(9).trim());else if(t.startsWith("##LASTX="))n=parseFloat(t.substring(8).trim());else if(t.startsWith("##FIRSTY="))h=parseFloat(t.substring(9).trim());else if(t.startsWith("##NPOINTS="))u=parseFloat(t.substring(10).trim());else if(t.startsWith("##XFACTOR="))d=parseFloat(t.substring(10).trim());else if(t.startsWith("##YFACTOR="))m=parseFloat(t.substring(10).trim());else if(t.startsWith("##DELTAX="))g=parseFloat(t.substring(9).trim());else if(t.startsWith("##.OBSERVE FREQUENCY="))this.convertHZ2PPM&&(p=parseFloat(t.substring(21).trim()));else if(t.startsWith("##.SHIFT REFERENCE=")){if(this.convertHZ2PPM){let e=t.substring(19).split(",");x=parseInt(e[2].trim()),_=parseFloat(e[3].trim())}}else if(t.startsWith("##XYDATA=")){y||(p=1),b=!1;let c,f=!1,g=t.split("\n"),v=(n-l)/(u-1),w=l-v,T=h,S=0;for(let t=1,n=g.length;t<n;t++){let n=[],l=g[t].trim(),h=[];for(let t=0,e=l.length;t<e;t++)this.isBreak(l.charAt(t))?(h.length>0&&(1!==h.length||" "!==h[0])&&n.push(h.join("")),h=[l.charAt(t)]):h.push(l.charAt(t));n.push(h.join("")),w=parseFloat(n[0])*d-v;for(let t=1,l=n.length;t<l;t++){let l=n[t];if(a[l.charAt(0)]!==s){let t=parseInt(a[l.charAt(0)]+l.substring(1))-1;for(let n=0;n<t;n++)w+=v,S=this.getValue(c,S),T=S*m,e.data[e.data.length-1]=new i.Point(w/p,T)}else r[l.charAt(0)]!==s&&f?T=this.getValue(l,S)*m:(f=o[l.charAt(0)]!==s,c=l,w+=v,S=this.getValue(l,S),T=S*m,e.data.push(new i.Point(w/p,T)))}}if(-1!==x){let t=_-e.data[x-1].x;for(let i=0,n=e.data.length;i<n;i++)e.data[i].x+=t}}else if(t.startsWith("##PEAK TABLE=")){b=!1,e.continuous=!1;let n=t.split("\n"),s=/[\s,]+/;for(let t=1,r=n.length;t<r;t++){let r=n[t].split(s);for(let t=0,n=r.length;t+1<n;t+=2)e.data.push(new i.Point(parseFloat(r[t].trim()),parseFloat(r[t+1].trim())))}}else if(t.startsWith("##ATOMLIST=")){e.molecule=new i.Molecule;let n=t.split("\n"),s=/[\s]+/;for(let t=1,r=n.length;t<r;t++){let r=n[t].split(s);e.molecule.atoms.push(new i.Atom(r[1]))}}else if(t.startsWith("##BONDLIST=")){let n=t.split("\n"),s=/[\s]+/;for(let t=1,r=n.length;t<r;t++){let r=n[t].split(s),o=1;"D"===r[2]?o=2:"T"===r[2]&&(o=3),e.molecule.bonds.push(new i.Bond(e.molecule.atoms[parseInt(r[0])-1],e.molecule.atoms[parseInt(r[1])-1],o))}}else if(e.molecule&&t.startsWith("##XY_RASTER=")){let i=t.split("\n"),n=/[\s]+/;for(let t=1,s=i.length;t<s;t++){let s=i[t].split(n),r=e.molecule.atoms[parseInt(s[0])-1];r.x=parseInt(s[1]),r.y=parseInt(s[2]),4==s.length&&(r.z=parseInt(s[3]))}e.molecule.scaleToAverageBondLength(20)}else if(t.startsWith("##PEAK ASSIGNMENTS=")){let i=t.split("\n"),n=/[\s,()<>]+/;e.assignments=[];for(let t=1,s=i.length;t<s;t++){let s=i[t].split(n),r=parseFloat(s[1]),o=parseFloat(s[2]),a=e.molecule.atoms[parseInt(s[3])-1],l=!1;for(let t=0,i=e.assignments.length;t<i;t++){let i=e.assignments[t];if(i.x===r){i.as.push(a),a.assigned=i,l=!0;break}}if(!l){let t={x:r,y:o,as:[a]};a.assigned=t,e.assignments.push(t)}}}}else{let t=v.trim();0!==f.length&&0!==t.length&&f.push("\n"),f.push(t)}}return e.setup(),e},l.makeStructureSpectrumSet=function(e,i){this.convertHZ2PPM=!0;let n=this.read(i),r=new t.ViewerCanvas(e+"_molecule",200,200);r.styles.atoms_displayTerminalCarbonLabels_2D=!0,r.styles.atoms_displayImplicitHydrogens_2D=!0,r.mouseout=function(t){if(0!==this.molecules.length){for(let t=0,e=this.molecules[0].atoms.length;t<e;t++)this.molecules[0].atoms[t].isHover=!1;n.hovered=s,this.repaint(),o.repaint()}},r.touchend=r.mouseout,r.mousemove=function(t){if(0!==this.molecules.length){let e=s;for(let i=0,n=this.molecules[0].atoms.length;i<n;i++){let n=this.molecules[0].atoms[i];n.isHover=!1,n.assigned&&(e===s||t.p.distance(n)<t.p.distance(e))&&(e=n)}if(n.hovered=s,t.p.distance(e)<20){for(let t=0,i=e.assigned.as.length;t<i;t++)e.assigned.as[t].isHover=!0;o.spectrum.hovered=e.assigned}this.repaint(),o.repaint()}},r.touchmove=r.mousemove,r.drawChildExtras=function(t,e){if(0!==this.molecules.length)for(let i=0,n=this.molecules[0].atoms.length;i<n;i++)this.molecules[0].atoms[i].drawDecorations(t,e)};let o=new t.ObserverCanvas(e+"_spectrum",400,200);return o.styles.plots_showYAxis=!1,o.styles.plots_flipXAxis=!0,o.mouseout=function(t){if(this.spectrum&&this.spectrum.assignments){for(let t=0,e=r.molecules[0].atoms.length;t<e;t++)r.molecules[0].atoms[t].isHover=!1;this.spectrum.hovered=s,r.repaint(),this.repaint()}},o.touchend=o.mouseout,o.mousemove=function(t){if(this.spectrum&&this.spectrum.assignments){let e=s;for(let t=0,e=r.molecules[0].atoms.length;t<e;t++)r.molecules[0].atoms[t].isHover=!1;this.spectrum.hovered=s;for(let i=0,n=this.spectrum.assignments.length;i<n;i++){let n=this.spectrum.assignments[i];(e===s||Math.abs(this.spectrum.getTransformedX(n.x,this.styles,this.spectrum.memory.width,this.spectrum.memory.offsetLeft)-t.p.x)<Math.abs(this.spectrum.getTransformedX(e.x,this.styles,this.spectrum.memory.width,this.spectrum.memory.offsetLeft)-t.p.x))&&(e=n)}if(Math.abs(this.spectrum.getTransformedX(e.x,this.styles,this.spectrum.memory.width,this.spectrum.memory.offsetLeft)-t.p.x)<20){for(let t=0,i=e.as.length;t<i;t++)e.as[t].isHover=!0;this.spectrum.hovered=e}r.repaint(),this.repaint()}},o.touchmove=o.mousemove,o.drawChildExtras=function(t){if(this.spectrum&&this.spectrum.hovered){let e=this.spectrum.getTransformedX(this.spectrum.hovered.x,o.styles,this.spectrum.memory.width,this.spectrum.memory.offsetLeft);e>=this.spectrum.memory.offsetLeft&&e<this.spectrum.memory.width&&(t.save(),t.strokeStyle="#885110",t.lineWidth=3,t.beginPath(),t.moveTo(e,this.spectrum.memory.height-this.spectrum.memory.offsetBottom),t.lineTo(e,this.spectrum.getTransformedY(this.spectrum.hovered.y,o.styles,this.spectrum.memory.height,this.spectrum.memory.offsetBottom,this.spectrum.memory.offsetTop)),t.stroke(),t.restore())}},n&&(o.loadSpectrum(n),n.molecule&&r.loadMolecule(n.molecule)),[r,o]};let h=new e.JCAMPInterpreter;h.convertHZ2PPM=!0,t.readJCAMP=function(t){return h.read(t)}}(e,e.io,e.structures,e.lib.jQuery),function(t,e,i,n,s,r,o){e.JSONInterpreter=function(){};let a=e.JSONInterpreter.prototype;a.contentTo=function(t,e){t||(t=[]),e||(e=[]);let i=!0;for(let e=0,n=t.length;e<n;e++){let n=t[e];for(let t=0,e=n.atoms.length;t<e;t++)if(n.atoms[t].pid===o){i=!1;break}if(i)for(let t=0,e=n.bonds.length;t<e;t++)if(n.bonds[t].pid===o){i=!1;break}}let n=0,s=0,r=0;for(let e=0,a=t.length;e<a;e++){let a=t[e],l=o;for(let t=0,e=a.atoms.length;t<e;t++){let e=a.atoms[t];i?(e.tmpid="a"+e.pid,(l===o||l>e.pid)&&(l=e.pid)):e.tmpid="a"+n++}for(let t=0,e=a.bonds.length;t<e;t++){let e=a.bonds[t];e.tmpid=i?"b"+e.pid:"b"+s++}a.tmpid="m"+(l===o?r++:l)}n=0;for(let t=0,i=e.length;t<i;t++)e[t].tmpid="s"+n++;let a={};if(t&&t.length>0){a.m=[];for(let e=0,i=t.length;e<i;e++)a.m.push(this.molTo(t[e]))}if(e&&e.length>0){a.s=[];for(let t=0,i=e.length;t<i;t++)a.s.push(this.shapeTo(e[t]))}for(let e=0,i=t.length;e<i;e++){let i=t[e];for(let t=0,e=i.atoms.length;t<e;t++)i.atoms[t].tmpid=o;for(let t=0,e=i.bonds.length;t<e;t++)i.bonds[t].tmpid=o;i.tmpid=o}for(let t=0,i=e.length;t<i;t++)e[t].tmpid=o;return a},a.contentFrom=function(t){let e={molecules:[],shapes:[]};if(t.m)for(let i=0,n=t.m.length;i<n;i++)e.molecules.push(this.molFrom(t.m[i]));if(t.s)for(let i=0,n=t.s.length;i<n;i++)e.shapes.push(this.shapeFrom(t.s[i],e.molecules));for(let t=0,i=e.molecules.length;t<i;t++){let i=e.molecules[t];for(let t=0,e=i.atoms.length;t<e;t++)i.atoms[t].tmpid=o;for(let t=0,e=i.bonds.length;t<e;t++)i.bonds[t].tmpid=o}for(let t=0,i=e.shapes.length;t<i;t++)e.shapes[t].tmpid=o;return e},a.queryTo=function(t){let e={},n=function(e,i,n,s){i&&(e[n]={v:s?t.outputRange(i.v):i.v,n:i.not})};return t.type===i.Query.TYPE_ATOM?(n(e,t.elements,"as"),n(e,t.chirality,"@"),n(e,t.aromatic,"A"),n(e,t.charge,"C",!0),n(e,t.hydrogens,"H",!0),n(e,t.ringCount,"R",!0),n(e,t.saturation,"S"),n(e,t.connectivity,"X",!0),n(e,t.connectivityNoH,"x",!0)):(n(e,t.orders,"bs"),n(e,t.stereo,"@"),n(e,t.aromatic,"A"),n(e,t.ringCount,"R",!0)),e},a.molTo=function(t){let e={a:[]};t.tmpid&&(e.i=t.tmpid);for(let n=0,s=t.atoms.length;n<s;n++){let s=t.atoms[n],r={x:s.x,y:s.y};s.tmpid&&(r.i=s.tmpid),"C"!==s.label&&(r.l=s.label),0!==s.z&&(r.z=s.z),0!==s.charge&&(r.c=s.charge),-1!==s.mass&&(r.m=s.mass),-1!==s.implicitH&&(r.h=s.implicitH),0!==s.numRadical&&(r.r=s.numRadical),0!==s.numLonePair&&(r.p=s.numLonePair),s.enhancedStereo&&s.enhancedStereo.type!==i.Atom.ESTEREO_ABSOLUTE&&(r.s2={t:s.enhancedStereo.type},s.enhancedStereo.group>1&&(r.s2.g=s.enhancedStereo.group)),s.query&&(r.q=this.queryTo(s.query)),e.a.push(r)}if(t.bonds.length>0){e.b=[];for(let n=0,s=t.bonds.length;n<s;n++){let s=t.bonds[n],r={b:t.atoms.indexOf(s.a1),e:t.atoms.indexOf(s.a2)};s.tmpid&&(r.i=s.tmpid),1!==s.bondOrder&&(r.o=s.bondOrder),s.stereo!==i.Bond.STEREO_NONE&&(r.s=s.stereo),s.query&&(r.q=this.queryTo(s.query)),e.b.push(r)}}return e},a.queryFrom=function(t){let e=new i.Query(t.as?i.Query.TYPE_ATOM:i.Query.TYPE_BOND),n=function(t,e,i,n){e&&(t[i]={},t[i].v=n?t.parseRange(e.v):e.v,e.n&&(t[i].not=!0))};return e.type===i.Query.TYPE_ATOM?(n(e,t.as,"elements"),n(e,t["@"],"chirality"),n(e,t.A,"aromatic"),n(e,t.C,"charge",!0),n(e,t.H,"hydrogens",!0),n(e,t.R,"ringCount",!0),n(e,t.S,"saturation"),n(e,t.X,"connectivity",!0),n(e,t.x,"connectivityNoH",!0)):(n(e,t.bs,"orders"),n(e,t["@"],"stereo"),n(e,t.A,"aromatic"),n(e,t.R,"ringCount",!0)),e},a.molFrom=function(t){let e=new i.Molecule;for(let n=0,s=t.a.length;n<s;n++){let s=t.a[n],r=new i.Atom(s.l?s.l:"C",s.x,s.y);s.i&&(r.tmpid=s.i),s.z&&(r.z=s.z),s.c&&(r.charge=s.c),s.m&&(r.mass=s.m),s.h&&(r.implicitH=s.h),s.r&&(r.numRadical=s.r),s.p&&(r.numLonePair=s.p),s.s2&&(r.enhancedStereo={type:s.s2.t,group:s.s2.g===o?1:s.s2.g}),s.q&&(r.query=this.queryFrom(s.q)),s.p_h!==o&&(r.hetatm=s.p_h),s.p_w!==o&&(r.isWater=s.p_w),s.p_d!==o&&(r.closestDistance=s.p_d),e.atoms.push(r)}if(t.b)for(let n=0,s=t.b.length;n<s;n++){let s=t.b[n],r=new i.Bond(e.atoms[s.b],e.atoms[s.e],s.o===o?1:s.o);s.i&&(r.tmpid=s.i),s.s&&(r.stereo=s.s),s.q&&(r.query=this.queryFrom(s.q)),e.bonds.push(r)}return e},a.shapeTo=function(t){let e={};if(t.tmpid&&(e.i=t.tmpid),t instanceof n.Line)e.t="Line",e.x1=t.p1.x,e.y1=t.p1.y,e.x2=t.p2.x,e.y2=t.p2.y,e.a=t.arrowType;else if(t instanceof n.Pusher)e.t="Pusher",e.o1=t.o1.tmpid,e.o2=t.o2.tmpid,1!==t.numElectron&&(e.e=t.numElectron);else if(t instanceof n.AtomMapping)e.t="AtomMapping",e.a1=t.o1.tmpid,e.a2=t.o2.tmpid;else if(t instanceof n.Bracket)e.t="Bracket",e.x1=t.p1.x,e.y1=t.p1.y,e.x2=t.p2.x,e.y2=t.p2.y,0!==t.charge&&(e.c=t.charge),0!==t.mult&&(e.m=t.mult),0!==t.repeat&&(e.r=t.repeat);else if(t instanceof n.RepeatUnit)e.t="RepeatUnit",e.b1=t.b1.tmpid,e.b2=t.b2.tmpid,e.n1=t.n1,e.n2=t.n2,!0===t.flip&&(e.f=!0);else if(t instanceof n.VAP){e.t="VAP",e.x=t.asterisk.x,e.y=t.asterisk.y,1!==t.bondType&&(e.o=t.bondType),t.substituent&&(e.s=t.substituent.tmpid),e.a=[];for(let i=0,n=t.attachments.length;i<n;i++)e.a.push(t.attachments[i].tmpid)}else if(t instanceof s.Distance)e.t="Distance",e.a1=t.a1.tmpid,e.a2=t.a2.tmpid,t.node&&(e.n=t.node,e.o=t.offset);else if(t instanceof s.Angle)e.t="Angle",e.a1=t.a1.tmpid,e.a2=t.a2.tmpid,e.a3=t.a3.tmpid;else if(t instanceof s.Torsion)e.t="Torsion",e.a1=t.a1.tmpid,e.a2=t.a2.tmpid,e.a3=t.a3.tmpid,e.a4=t.a4.tmpid;else if(t instanceof s._Surface){e.t="Surface",e.a=[];for(let i=0,n=t.atoms.length;i<n;i++)e.a.push(t.atoms[i].tmpid);t instanceof s.VDWSurface||(e.p=t.probeRadius),e.r=t.resolution;let i="vdw";t instanceof s.SASSurface?i="sas":s.SESSurface&&t instanceof s.SESSurface&&(i="ses"),e.f=i}else t instanceof s.UnitCell&&(e.t="UnitCell",e.ls=t.lengths,e.as=t.angles,e.os=t.offset);return e},a.shapeFrom=function(t,e){let r;if("Line"===t.t)r=new n.Line(new i.Point(t.x1,t.y1),new i.Point(t.x2,t.y2)),r.arrowType=t.a;else if("Pusher"===t.t){let i,s;for(let n=0,r=e.length;n<r;n++){let r=e[n];for(let e=0,n=r.atoms.length;e<n;e++){let n=r.atoms[e];n.tmpid===t.o1?i=n:n.tmpid===t.o2&&(s=n)}for(let e=0,n=r.bonds.length;e<n;e++){let n=r.bonds[e];n.tmpid===t.o1?i=n:n.tmpid===t.o2&&(s=n)}}r=new n.Pusher(i,s),t.e&&(r.numElectron=t.e)}else if("AtomMapping"===t.t){let i,s;for(let n=0,r=e.length;n<r;n++){let r=e[n];for(let e=0,n=r.atoms.length;e<n;e++){let n=r.atoms[e];n.tmpid===t.a1?i=n:n.tmpid===t.a2&&(s=n)}}r=new n.AtomMapping(i,s)}else if("Bracket"===t.t)r=new n.Bracket(new i.Point(t.x1,t.y1),new i.Point(t.x2,t.y2)),t.c!==o&&(r.charge=t.c),t.m!==o&&(r.mult=t.m),t.r!==o&&(r.repeat=t.r);else if("RepeatUnit"===t.t||"DynamicBracket"===t.t){let i,s;for(let n=0,r=e.length;n<r;n++){let r=e[n];for(let e=0,n=r.bonds.length;e<n;e++){let n=r.bonds[e];n.tmpid===t.b1?i=n:n.tmpid===t.b2&&(s=n)}}r=new n.RepeatUnit(i,s),r.n1=t.n1,r.n2=t.n2,t.f&&(r.flip=!0)}else if("VAP"===t.t){r=new n.VAP(t.x,t.y),t.o&&(r.bondType=t.o);for(let i=0,n=e.length;i<n;i++){let n=e[i];for(let e=0,i=n.atoms.length;e<i;e++){let i=n.atoms[e];if(i.tmpid===t.s)r.substituent=i;else for(let e=0,n=t.a.length;e<n;e++)i.tmpid===t.a[e]&&r.attachments.push(i)}}}else if("Distance"===t.t){let i,n;for(let s=0,r=e.length;s<r;s++){let r=e[s];for(let e=0,s=r.atoms.length;e<s;e++){let s=r.atoms[e];s.tmpid===t.a1?i=s:s.tmpid===t.a2&&(n=s)}}r=new s.Distance(i,n,t.n,t.o)}else if("Angle"===t.t){let i,n,o;for(let s=0,r=e.length;s<r;s++){let r=e[s];for(let e=0,s=r.atoms.length;e<s;e++){let s=r.atoms[e];s.tmpid===t.a1?i=s:s.tmpid===t.a2?n=s:s.tmpid===t.a3&&(o=s)}}r=new s.Angle(i,n,o)}else if("Torsion"===t.t){let i,n,o,a;for(let s=0,r=e.length;s<r;s++){let r=e[s];for(let e=0,s=r.atoms.length;e<s;e++){let s=r.atoms[e];s.tmpid===t.a1?i=s:s.tmpid===t.a2?n=s:s.tmpid===t.a3?o=s:s.tmpid===t.a4&&(a=s)}}r=new s.Torsion(i,n,o,a)}else if("Surface"===t.t){let i=[];for(let n=0,s=e.length;n<s;n++){let s=e[n];for(let e=0,n=s.atoms.length;e<n;e++){let n=s.atoms[e];for(let e=0,s=t.a.length;e<s;e++)n.tmpid===t.a[e]&&i.push(n)}}let n=t.p?t.p:1.4,o=t.r?t.r:30;"vdw"===t.f?r=new s.VDWSurface(i,o):"sas"===t.f?r=new s.SASSurface(i,n,o):"ses"===t.f&&(r=new s.SESSurface(i,n,o))}else"UnitCell"===t.t&&(r=new s.UnitCell(t.ls,t.as,t.os));return r},a.pdbFrom=function(t){let e=this.molFrom(t.mol);return e.findRings=!1,e.fromJSON=!0,e.chains=this.chainsFrom(t.ribbons),e},a.chainsFrom=function(t){let e=[];for(let n=0,s=t.cs.length;n<s;n++){let s=t.cs[n],r=[];for(let t=0,e=s.length;t<e;t++){let e=s[t],n=new i.Residue;n.name=e.n,n.cp1=new i.Atom("",e.x1,e.y1,e.z1),n.cp2=new i.Atom("",e.x2,e.y2,e.z2),e.x3&&(n.cp3=new i.Atom("",e.x3,e.y3,e.z3),n.cp4=new i.Atom("",e.x4,e.y4,e.z4),n.cp5=new i.Atom("",e.x5,e.y5,e.z5)),n.helix=e.h,n.sheet=e.s,n.arrow=t>0&&s[t-1].a,r.push(n)}e.push(r)}return e};let l=new e.JSONInterpreter;t.readJSON=function(t){let e;try{e=r.parse(t)}catch(t){return o}return e?e.m||e.s?l.contentFrom(e):e.a?{molecules:[l.molFrom(e)],shapes:[]}:{molecules:[],shapes:[]}:o},t.writeJSON=function(t,e){return r.stringify(l.contentTo(t,e))}}(e,e.io,e.structures,e.structures.d2,e.structures.d3,JSON),function(t,e,i,n){e.RXNInterpreter=function(){};let s=e.RXNInterpreter.prototype=new e._Interpreter;s.read=function(e,n){n||(n=t.DEFAULT_STYLES.bondLength_2D);let s,r=[];if(e){let o=e.split("$MOL\n"),a=o[0].split("\n")[4],l=parseInt(a.substring(0,3)),h=parseInt(a.substring(3,6)),u=1,c=0;for(let e=0,i=l+h;e<i;e++){r[e]=t.readMOL(o[u],n);let i=r[e].getBounds();c-=i.maxX-i.minX+40,u++}for(let t=0,e=l;t<e;t++){let e=r[t].getBounds(),i=e.maxX-e.minX,n=r[t].getCenter();for(let e=0,s=r[t].atoms.length;e<s;e++){let s=r[t].atoms[e];s.x+=c+i/2-n.x,s.y-=n.y}c+=i+40}s=new i.d2.Line(new i.Point(c,0),new i.Point(c+40,0)),c+=80;for(let t=l,e=l+h;t<e;t++){let e=r[t].getBounds(),i=e.maxX-e.minX,n=r[t].getCenter();for(let e=0;e<r[t].atoms.length;e++){let s=r[t].atoms[e];s.x+=c+i/2-n.x,s.y-=n.y}c+=i+40}}else r.push(new i.Molecule),s=new i.d2.Line(new i.Point(-20,0),new i.Point(20,0));return s.arrowType=i.d2.Line.ARROW_SYNTHETIC,{molecules:r,shapes:[s]}},s.write=function(e,n){let s;if(!e||!n)return;for(let t=0,e=n.length;t<e;t++)if(n[t]instanceof i.d2.Line){s=n[t];break}if(!s)return"";let r=(new i.Reaction).resolve(s,e),o=[];o.push("$RXN\nReaction from ChemDoodle Web Components\n\nhttp://www.ichemlabs.com\n"),o.push(this.fit(r.reactants.length.toString(),3)),o.push(this.fit(r.products.length.toString(),3)),o.push("\n");for(let e=0,i=r.reactants.length;e<i;e++)o.push("$MOL\n"),o.push(t.writeMOL(r.reactants[e])),o.push("\n");for(let e=0,i=r.products.length;e<i;e++)o.push("$MOL\n"),o.push(t.writeMOL(r.products[e])),o.push("\n");return o.join("")};let r=new e.RXNInterpreter;t.readRXN=function(t,e){return r.read(t,e)},t.writeRXN=function(t,e){return r.write(t,e)}}(e,e.io,e.structures),function(t,e,i,n,s,r,o){n.XYZInterpreter=function(){};let a=n.XYZInterpreter.prototype=new n._Interpreter;a.deduceCovalentBonds=!0,a.read=function(e){let n=new s.Molecule;if(!e)return n;let o=e.split("\n"),a=parseInt(r(o[0]));for(let t=0;t<a;t++){let e=o[t+2].split(/\s+/g);n.atoms[t]=new s.Atom(isNaN(e[0])?e[0]:i[parseInt(e[0])-1],parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))}return this.deduceCovalentBonds&&(new t.informatics.BondDeducer).deduceCovalentBonds(n,1),n};let l=new n.XYZInterpreter;t.readXYZ=function(t){return l.read(t)}}(e,e.ELEMENT,e.SYMBOLS,e.io,e.structures,e.lib.jQuery.trim),e.monitor=function(t,e,i,n){let s={};return s.CANVAS_DRAGGING=n,s.CANVAS_OVER=n,s.ALT=!1,s.SHIFT=!1,s.META=!1,t.supports_touch()||e(i).ready((function(){e(i).mousemove((function(t){s.CANVAS_DRAGGING&&s.CANVAS_DRAGGING.drag&&(s.CANVAS_DRAGGING.prehandleEvent(t),s.CANVAS_DRAGGING.drag(t))})),e(i).mouseup((function(t){s.CANVAS_DRAGGING&&s.CANVAS_DRAGGING!==s.CANVAS_OVER&&s.CANVAS_DRAGGING.mouseup&&(s.CANVAS_DRAGGING.prehandleEvent(t),s.CANVAS_DRAGGING.mouseup(t)),s.CANVAS_DRAGGING=n})),e(i).keydown((function(t){s.SHIFT=t.shiftKey,s.ALT=t.altKey,s.META=t.metaKey||t.ctrlKey;let e=s.CANVAS_OVER;s.CANVAS_DRAGGING&&(e=s.CANVAS_DRAGGING),e&&e.keydown&&(e.prehandleEvent(t),e.keydown(t))})),e(i).keypress((function(t){let e=s.CANVAS_OVER;s.CANVAS_DRAGGING&&(e=s.CANVAS_DRAGGING),e&&e.keypress&&(e.prehandleEvent(t),e.keypress(t))})),e(i).keyup((function(t){s.SHIFT=t.shiftKey,s.ALT=t.altKey,s.META=t.metaKey||t.ctrlKey;let e=s.CANVAS_OVER;s.CANVAS_DRAGGING&&(e=s.CANVAS_DRAGGING),e&&e.keyup&&(e.prehandleEvent(t),e.keyup(t))}))})),s}(e.featureDetection,e.lib.jQuery,document),function(t,e,i,n,s,r,o,a,l,h,u){t._Canvas=function(){};let c=t._Canvas.prototype;c.molecules=u,c.shapes=u,c.emptyMessage=u,c.image=u,c.repaint=function(){if(this.test)return;let t=a.getElementById(this.id);if(t.getContext){let e=t.getContext("2d");if(1!==this.pixelRatio&&t.width===this.width&&(t.width=this.width*this.pixelRatio,t.height=this.height*this.pixelRatio,e.scale(this.pixelRatio,this.pixelRatio)),this.image)e.drawImage(this.image,0,0);else{let i=this.styles.backgroundColor?this.styles.backgroundColor:"transparent";e.clearRect(0,0,this.width,this.height),this.bgCache!==i&&(t.style.backgroundColor=i,this.bgCache=t.style.backgroundColor),"transparent"!==i&&(e.fillStyle=i,e.fillRect(0,0,this.width,this.height))}if(this.innerRepaint)this.innerRepaint(e);else if(0!==this.molecules.length||0!==this.shapes.length){e.save(),e.translate(this.width/2,this.height/2),e.rotate(this.styles.rotateAngle),e.scale(this.styles.scale,this.styles.scale),e.translate(-this.width/2,-this.height/2);for(let t=0,i=this.molecules.length;t<i;t++)this.molecules[t].check(!0),this.molecules[t].draw(e,this.styles);this.checksOnAction&&this.checksOnAction(!0);for(let t=0,i=this.shapes.length;t<i;t++)this.shapes[t].draw(e,this.styles);e.restore()}else this.emptyMessage&&(e.fillStyle="#737683",e.textAlign="center",e.textBaseline="middle",e.font="18px Helvetica, Verdana, Arial, Sans-serif",e.fillText(this.emptyMessage,this.width/2,this.height/2));this.drawChildExtras&&this.drawChildExtras(e,this.styles)}},c.resize=function(e,i){let n=r("#"+this.id);if(n.attr({width:e,height:i}),n.css("width",e),n.css("height",i),this.width=e,this.height=i,t._Canvas3D&&this instanceof t._Canvas3D){let t=e,n=i;1!==this.pixelRatio&&(t*=this.pixelRatio,n*=this.pixelRatio,this.gl.canvas.width=t,this.gl.canvas.height=n),this.gl.viewport(0,0,t,n),this.afterLoadContent()}else if(this.molecules.length>0){this.center();for(let t=0,e=this.molecules.length;t<e;t++)this.molecules[t].check()}this.repaint()},c.setBackgroundImage=function(t){this.image=new Image;let e=this;this.image.onload=function(){e.repaint()},this.image.src=t},c.loadMolecule=function(e){this.clear(),this.molecules.push(e);for(let i=0;i<2;i++)this.center(),t._Canvas3D&&this instanceof t._Canvas3D||e.check(),this.afterLoadContent&&this.afterLoadContent(),this.repaint()},c.loadContent=function(e,i){this.molecules=e||[],this.shapes=i||[];for(let e=0;e<2;e++){if(this.center(),!(t._Canvas3D&&this instanceof t._Canvas3D))for(let t=0,e=this.molecules.length;t<e;t++)this.molecules[t].check();this.afterLoadContent&&this.afterLoadContent(),this.repaint()}},c.addMolecule=function(e){this.molecules.push(e),t._Canvas3D&&this instanceof t._Canvas3D||e.check(),this.repaint()},c.removeMolecule=function(t){this.molecules=r.grep(this.molecules,(function(e){return e!==t})),this.repaint()},c.getMolecule=function(){return this.molecules.length>0?this.molecules[0]:u},c.getMolecules=function(){return this.molecules},c.addShape=function(t){this.shapes.push(t),this.repaint()},c.removeShape=function(t){this.shapes=r.grep(this.shapes,(function(e){return e!==t})),this.repaint()},c.getShapes=function(){return this.shapes},c.clear=function(){this.molecules=[],this.shapes=[],this.styles.scale=1,this.repaint()},c.center=function(){let t=this.getContentBounds(),e=new s.Point((this.width-t.minX-t.maxX)/2,(this.height-t.minY-t.maxY)/2);for(let t=0,i=this.molecules.length;t<i;t++){let i=this.molecules[t];for(let t=0,n=i.atoms.length;t<n;t++)i.atoms[t].add(e)}for(let t=0,i=this.shapes.length;t<i;t++){let i=this.shapes[t].getPoints();for(let t=0,n=i.length;t<n;t++)i[t].add(e)}this.styles.scale=1;let i=t.maxX-t.minX,n=t.maxY-t.minY;(i>this.width-20||n>this.height-20)&&(this.styles.scale=.85*o.min(this.width/i,this.height/n))},c.bondExists=function(t,e){for(let i=0,n=this.molecules.length;i<n;i++){let n=this.molecules[i];for(let i=0,s=n.bonds.length;i<s;i++){let s=n.bonds[i];if(s.contains(t)&&s.contains(e))return!0}}return!1},c.getBond=function(t,e){for(let i=0,n=this.molecules.length;i<n;i++){let n=this.molecules[i];for(let i=0,s=n.bonds.length;i<s;i++){let s=n.bonds[i];if(s.contains(t)&&s.contains(e))return s}}return u},c.getMoleculeByAtom=function(t){for(let e=0,i=this.molecules.length;e<i;e++){let i=this.molecules[e];if(-1!==i.atoms.indexOf(t))return i}return l.undefined},c.getAllAtoms=function(){let t=[];for(let e=0,i=this.molecules.length;e<i;e++)t=t.concat(this.molecules[e].atoms);return t},c.getAllBonds=function(){let t=[];for(let e=0,i=this.molecules.length;e<i;e++)t=t.concat(this.molecules[e].bonds);return t},c.getAllPoints=function(){let t=[];for(let e=0,i=this.molecules.length;e<i;e++)t=t.concat(this.molecules[e].atoms);for(let e=0,i=this.shapes.length;e<i;e++)t=t.concat(this.shapes[e].getPoints());return t},c.getContentBounds=function(){let t=new i.Bounds;for(let e=0,i=this.molecules.length;e<i;e++)t.expand(this.molecules[e].getBounds());for(let e=0,i=this.shapes.length;e<i;e++)t.expand(this.shapes[e].getBounds());return t},c.create=function(i,c,f){if(this.id=i,this.width=c,this.height=f,this.molecules=[],this.shapes=[],a.getElementById(i)){let t=r("#"+i);c?t.attr("width",c):this.width=parseInt(t.attr("width")),f?t.attr("height",f):this.height=parseInt(t.attr("height")),t.attr("class","ChemDoodleWebComponent")}else{if(!t.featureDetection.supports_canvas_text()&&-1!=h.indexOf("MSIE"))return void a.writeln('<div style="border: 1px solid black;" width="'+c+'" height="'+f+'">Please install <a href="http://code.google.com/chrome/chromeframe/">Google Chrome Frame</a>, then restart Internet Explorer.</div>');a.writeln('<canvas class="ChemDoodleWebComponent" id="'+i+'" width="'+c+'" height="'+f+'" alt="ChemDoodle Web Component">This browser does not support HTML5/Canvas.</canvas>')}let d=r("#"+i);d.css("width",this.width),d.css("height",this.height),this.pixelRatio=l.devicePixelRatio?l.devicePixelRatio:1,this.styles=new s.Styles;let m=this;e.supports_touch()?(d.bind("touchstart",(function(t){let i=(new Date).getTime();if(!e.supports_gesture()&&2===t.originalEvent.touches.length){let e=t.originalEvent.touches,i=new s.Point(e[0].pageX,e[0].pageY),n=new s.Point(e[1].pageX,e[1].pageY);m.implementedGestureDist=i.distance(n),m.implementedGestureAngle=i.angle(n),m.gesturestart&&(m.prehandleEvent(t),m.gesturestart(t))}m.lastTouch&&1===t.originalEvent.touches.length&&i-m.lastTouch<500?m.dbltap?(m.prehandleEvent(t),m.dbltap(t)):m.dblclick?(m.prehandleEvent(t),m.dblclick(t)):m.touchstart?(m.prehandleEvent(t),m.touchstart(t)):m.mousedown&&(m.prehandleEvent(t),m.mousedown(t)):m.touchstart?(m.prehandleEvent(t),m.touchstart(t),this.hold&&clearTimeout(this.hold),this.touchhold&&(this.hold=setTimeout((function(){m.touchhold(t)}),1e3))):m.mousedown&&(m.prehandleEvent(t),m.mousedown(t)),m.lastTouch=i})),d.bind("touchmove",(function(t){if(this.hold&&(clearTimeout(this.hold),this.hold=u),!e.supports_gesture()&&2===t.originalEvent.touches.length&&m.gesturechange){let e=t.originalEvent.touches,i=new s.Point(e[0].pageX,e[0].pageY),n=new s.Point(e[1].pageX,e[1].pageY),r=i.distance(n),a=i.angle(n);t.originalEvent.scale=r/m.implementedGestureDist,t.originalEvent.rotation=180*(m.implementedGestureAngle-a)/o.PI,m.prehandleEvent(t),m.gesturechange(t)}if(t.originalEvent.touches.length>1&&m.multitouchmove){let e=t.originalEvent.touches.length;m.prehandleEvent(t);let i=new s.Point(-t.offset.left*e,-t.offset.top*e);for(let n=0;n<e;n++)i.x+=t.originalEvent.changedTouches[n].pageX,i.y+=t.originalEvent.changedTouches[n].pageY;i.x/=e,i.y/=e,t.p=i,m.multitouchmove(t,e)}else m.touchmove?(m.prehandleEvent(t),m.touchmove(t)):m.drag&&(m.prehandleEvent(t),m.drag(t))})),d.bind("touchend",(function(t){this.hold&&(clearTimeout(this.hold),this.hold=u),!e.supports_gesture()&&m.implementedGestureDist&&(m.implementedGestureDist=u,m.implementedGestureAngle=u,m.gestureend&&(m.prehandleEvent(t),m.gestureend(t))),m.touchend?(m.prehandleEvent(t),m.touchend(t)):m.mouseup&&(m.prehandleEvent(t),m.mouseup(t)),(new Date).getTime()-m.lastTouch<250&&(m.tap?(m.prehandleEvent(t),m.tap(t)):m.click&&(m.prehandleEvent(t),m.click(t)))})),d.bind("gesturestart",(function(t){m.gesturestart&&(m.prehandleEvent(t),m.gesturestart(t))})),d.bind("gesturechange",(function(t){m.gesturechange&&(m.prehandleEvent(t),m.gesturechange(t))})),d.bind("gestureend",(function(t){m.gestureend&&(m.prehandleEvent(t),m.gestureend(t))}))):(d.click((function(t){switch(t.which){case 1:m.click&&(m.prehandleEvent(t),m.click(t));break;case 2:m.middleclick&&(m.prehandleEvent(t),m.middleclick(t));break;case 3:m.rightclick&&(m.prehandleEvent(t),m.rightclick(t))}})),d.dblclick((function(t){m.dblclick&&(m.prehandleEvent(t),m.dblclick(t))})),d.mousedown((function(t){switch(t.which){case 1:n.CANVAS_DRAGGING=m,m.mousedown&&(m.prehandleEvent(t),m.mousedown(t));break;case 2:m.middlemousedown&&(m.prehandleEvent(t),m.middlemousedown(t));break;case 3:m.rightmousedown&&(m.prehandleEvent(t),m.rightmousedown(t))}})),d.mousemove((function(t){!n.CANVAS_DRAGGING&&m.mousemove&&(m.prehandleEvent(t),m.mousemove(t))})),d.mouseout((function(t){n.CANVAS_OVER=u,m.mouseout&&(m.prehandleEvent(t),m.mouseout(t))})),d.mouseover((function(t){n.CANVAS_OVER=m,m.mouseover&&(m.prehandleEvent(t),m.mouseover(t))})),d.mouseup((function(t){switch(t.which){case 1:m.mouseup&&(m.prehandleEvent(t),m.mouseup(t));break;case 2:m.middlemouseup&&(m.prehandleEvent(t),m.middlemouseup(t));break;case 3:m.rightmouseup&&(m.prehandleEvent(t),m.rightmouseup(t))}})),d.mousewheel((function(t,e){m.mousewheel&&(m.prehandleEvent(t),m.mousewheel(t,e))}))),this.subCreate&&this.subCreate()},c.prehandleEvent=function(t){t.originalEvent.changedTouches&&(t.pageX=t.originalEvent.changedTouches[0].pageX,t.pageY=t.originalEvent.changedTouches[0].pageY),t.offset=r("#"+this.id).offset(),t.p=new s.Point(t.pageX-t.offset.left,t.pageY-t.offset.top),this.doEventDefault||(t.preventDefault(),t.returnValue=!1)}}(e,e.featureDetection,e.math,e.monitor,e.structures,e.lib.jQuery,Math,document,window,navigator.userAgent),function(t,e,i){t._AnimatorCanvas=function(t,e,i){t&&this.create(t,e,i)};let n=t._AnimatorCanvas.prototype=new t._Canvas;n.timeout=33,n.startAnimation=function(){this.stopAnimation(),this.lastTime=(new Date).getTime();let t=this;this.nextFrame&&(this.handle=e.requestInterval((function(){let e=(new Date).getTime();t.nextFrame(e-t.lastTime),t.repaint(),t.lastTime=e}),this.timeout))},n.stopAnimation=function(){this.handle&&(e.clearRequestInterval(this.handle),this.handle=i)},n.isRunning=function(){return this.handle!==i}}(e,e.animations),function(t,e,i){t.FileCanvas=function(t,i,n,s){t&&this.create(t,i,n);let r='<br><form name="FileForm" enctype="multipart/form-data" method="POST" action="'+s+'" target="HiddenFileFrame"><input type="file" name="f" /><input type="submit" name="submitbutton" value="Show File" /></form><iframe id="HFF-'+t+'" name="HiddenFileFrame" height="0" width="0" style="display:none;" onLoad="GetMolFromFrame(\'HFF-'+t+"', "+t+')"></iframe>';e.writeln(r),this.emptyMessage="Click below to load file",this.repaint()},t.FileCanvas.prototype=new t._Canvas}(e,document),function(t,e){t.HyperlinkCanvas=function(t,e,i,n,s,r){t&&this.create(t,e,i),this.urlOrFunction=n,this.color=s||"blue",this.size=r||2};let i=t.HyperlinkCanvas.prototype=new t._Canvas;i.openInNewWindow=!0,i.hoverImage=e,i.drawChildExtras=function(t){this.e&&(this.hoverImage?t.drawImage(this.hoverImage,0,0):(t.strokeStyle=this.color,t.lineWidth=2*this.size,t.strokeRect(0,0,this.width,this.height)))},i.setHoverImage=function(t){this.hoverImage=new Image,this.hoverImage.src=t},i.click=function(t){this.e=e,this.repaint(),this.urlOrFunction instanceof Function?this.urlOrFunction():this.openInNewWindow?window.open(this.urlOrFunction):location.href=this.urlOrFunction},i.mouseout=function(t){this.e=e,this.repaint()},i.mouseover=function(t){this.e=t,this.repaint()}}(e),function(t,e,i,n,s){t.MolGrabberCanvas=function(t,e,s){t&&this.create(t,e,s);let r=[];r.push('<br><input type="text" id="'),r.push(t),r.push('_query" size="32" value="" />'),r.push(this.getInputFields()),n.getElementById(t),i("#"+t).after(r.join(""));let o=this;i("#"+t+"_submit").click((function(){o.search()})),i("#"+t+"_query").keypress((function(t){13===t.which&&o.search()})),this.emptyMessage="Enter search term below",this.repaint()};let r=t.MolGrabberCanvas.prototype=new t._Canvas;r.setSearchTerm=function(t){i("#"+this.id+"_query").val(t),this.search()},r.getInputFields=function(){let t=[];return t.push("<br><nobr>"),t.push('<select id="'),t.push(this.id),t.push('_select">'),t.push('<option value="chemexper">ChemExper'),t.push('<option value="chemspider">ChemSpider'),t.push('<option value="pubchem" selected>PubChem'),t.push("</select>"),t.push('<button type="button" id="'),t.push(this.id),t.push('_submit">Show Molecule</button>'),t.push("</nobr>"),t.join("")},r.search=function(){this.emptyMessage="Searching...",this.clear();let t=this;e.getMoleculeFromDatabase(i("#"+this.id+"_query").val(),{database:i("#"+this.id+"_select").val()},(function(e){t.loadMolecule(e)}))}}(e,e.iChemLabs,e.lib.jQuery,document),function(t,e,i,n){let s=[],r=[1,0,0],o=[0,1,0],a=[0,0,1];t.RotatorCanvas=function(t,e,i,n){t&&this.create(t,e,i),this.rotate3D=n};let l=t.RotatorCanvas.prototype=new t._AnimatorCanvas,h=e.PI/15;l.xIncrement=h,l.yIncrement=h,l.zIncrement=h,l.nextFrame=function(t){if(0===this.molecules.length&&0===this.shapes.length)return void this.stopAnimation();let e=t/1e3;if(this.rotate3D){i.identity(s),i.rotate(s,this.xIncrement*e,r),i.rotate(s,this.yIncrement*e,o),i.rotate(s,this.zIncrement*e,a);for(let t=0,e=this.molecules.length;t<e;t++){let e=this.molecules[t];for(let t=0,n=e.atoms.length;t<n;t++){let n=e.atoms[t],r=[n.x-this.width/2,n.y-this.height/2,n.z];i.multiplyVec3(s,r),n.x=r[0]+this.width/2,n.y=r[1]+this.height/2,n.z=r[2]}for(let t=0,i=e.rings.length;t<i;t++)e.rings[t].center=e.rings[t].getCenter();this.styles.atoms_display&&this.styles.atoms_circles_2D&&e.sortAtomsByZ(),this.styles.bonds_display&&this.styles.bonds_clearOverlaps_2D&&e.sortBondsByZ()}for(let t=0,e=this.shapes.length;t<e;t++){let e=this.shapes[t].getPoints();for(let t=0,n=e.length;t<n;t++){let n=e[t],r=[n.x-this.width/2,n.y-this.height/2,0];i.multiplyVec3(s,r),n.x=r[0]+this.width/2,n.y=r[1]+this.height/2}}}else this.styles.rotateAngle+=this.zIncrement*e},l.dblclick=function(t){this.isRunning()?this.stopAnimation():this.startAnimation()}}(e,Math,e.lib.mat4),function(t,e,i,n){t.SlideshowCanvas=function(t,e,i){t&&this.create(t,e,i)};let s=t.SlideshowCanvas.prototype=new t._AnimatorCanvas;s.frames=[],s.curIndex=0,s.timeout=5e3,s.alpha=0,s.innerHandle=n,s.phase=0,s.drawChildExtras=function(t){let e=i.getRGB(this.styles.backgroundColor,255);t.fillStyle="rgba("+e[0]+", "+e[1]+", "+e[2]+", "+this.alpha+")",t.fillRect(0,0,this.width,this.height)},s.nextFrame=function(t){if(0===this.frames.length)return void this.stopAnimation();this.phase=0;let e=this,i=1;this.innerHandle=setInterval((function(){e.alpha=i/15,e.repaint(),15===i&&e.breakInnerHandle(),i++}),33)},s.breakInnerHandle=function(){if(this.innerHandle&&(clearInterval(this.innerHandle),this.innerHandle=n),0===this.phase){this.curIndex++,this.curIndex>this.frames.length-1&&(this.curIndex=0),this.alpha=1;let t=this.frames[this.curIndex];this.loadContent(t.mols,t.shapes),this.phase=1;let e=this,i=1;this.innerHandle=setInterval((function(){e.alpha=(15-i)/15,e.repaint(),15===i&&e.breakInnerHandle(),i++}),33)}else 1===this.phase&&(this.alpha=0,this.repaint())},s.addFrame=function(t,e){0===this.frames.length&&this.loadContent(t,e),this.frames.push({mols:t,shapes:e})}}(e,e.animations,e.math),function(t,e,i,n,s,r){t.TransformCanvas=function(t,e,i,n){t&&this.create(t,e,i),this.rotate3D=n};let o=t.TransformCanvas.prototype=new t._Canvas;o.lastPoint=void 0,o.rotationMultMod=1.3,o.lastPinchScale=1,o.lastGestureRotate=0,o.mousedown=function(t){this.lastPoint=t.p},o.dblclick=function(t){this.center(),this.repaint()},o.drag=function(t){if(!this.lastPoint.multi)if(e.ALT){let e=new i.Point(t.p.x,t.p.y);e.sub(this.lastPoint);for(let t=0,i=this.molecules.length;t<i;t++){let i=this.molecules[t];for(let t=0,n=i.atoms.length;t<n;t++)i.atoms[t].add(e);i.check()}for(let t=0,i=this.shapes.length;t<i;t++){let i=this.shapes[t].getPoints();for(let t=0,n=i.length;t<n;t++)i[t].add(e)}this.lastPoint=t.p,this.repaint()}else if(!0===this.rotate3D){let e=n.max(this.width/4,this.height/4),i=t.p.x-this.lastPoint.x,r=t.p.y-this.lastPoint.y,o=i/e*this.rotationMultMod,a=-r/e*this.rotationMultMod,l=[];s.identity(l),s.rotate(l,a,[1,0,0]),s.rotate(l,o,[0,1,0]);for(let e=0,i=this.molecules.length;e<i;e++){let i=this.molecules[e];for(let t=0,e=i.atoms.length;t<e;t++){let e=i.atoms[t],n=[e.x-this.width/2,e.y-this.height/2,e.z];s.multiplyVec3(l,n),e.x=n[0]+this.width/2,e.y=n[1]+this.height/2,e.z=n[2]}for(let t=0,e=i.rings.length;t<e;t++)i.rings[t].center=i.rings[t].getCenter();this.lastPoint=t.p,this.styles.atoms_display&&this.styles.atoms_circles_2D&&i.sortAtomsByZ(),this.styles.bonds_display&&this.styles.bonds_clearOverlaps_2D&&i.sortBondsByZ()}this.repaint()}else{let e=new i.Point(this.width/2,this.height/2),n=e.angle(this.lastPoint),s=e.angle(t.p);this.styles.rotateAngle-=s-n,this.lastPoint=t.p,this.repaint()}},o.mousewheel=function(t,e){this.styles.scale+=e/50,this.styles.scale<.01&&(this.styles.scale=.01),this.repaint()},o.multitouchmove=function(t,e){if(2===e)if(this.lastPoint.multi){let e=new i.Point(t.p.x,t.p.y);e.sub(this.lastPoint);for(let t=0,i=this.molecules.length;t<i;t++){let i=this.molecules[t];for(let t=0,n=i.atoms.length;t<n;t++)i.atoms[t].add(e);i.check()}for(let t=0,i=this.shapes.length;t<i;t++){let i=this.shapes[t].getPoints();for(let t=0,n=i.length;t<n;t++)i[t].add(e)}this.lastPoint=t.p,this.lastPoint.multi=!0,this.repaint()}else this.lastPoint=t.p,this.lastPoint.multi=!0},o.gesturechange=function(t){if(t.originalEvent.scale-this.lastPinchScale!=0&&(this.styles.scale*=t.originalEvent.scale/this.lastPinchScale,this.styles.scale<.01&&(this.styles.scale=.01),this.lastPinchScale=t.originalEvent.scale),this.lastGestureRotate-t.originalEvent.rotation!=0){let e=(this.lastGestureRotate-t.originalEvent.rotation)/180*n.PI,s=new i.Point(this.width/2,this.height/2);for(let t=0,i=this.molecules.length;t<i;t++){let i=this.molecules[t];for(let t=0,r=i.atoms.length;t<r;t++){let r=i.atoms[t],o=s.distance(r),a=s.angle(r)+e;r.x=s.x+o*n.cos(a),r.y=s.y-o*n.sin(a)}i.check()}this.lastGestureRotate=t.originalEvent.rotation}this.repaint()},o.gestureend=function(t){this.lastPinchScale=1,this.lastGestureRotate=0}}(e,e.monitor,e.structures,Math,e.lib.mat4),(d=e).ViewerCanvas=function(t,e,i){t&&this.create(t,e,i)},d.ViewerCanvas.prototype=new d._Canvas,function(t,e,i){t._SpectrumCanvas=function(t,e,i){t&&this.create(t,e,i)};let n=t._SpectrumCanvas.prototype=new t._Canvas;n.spectrum=i,n.emptyMessage="No Spectrum Loaded or Recognized",n.loadMolecule=i,n.getMolecule=i,n.innerRepaint=function(t){this.spectrum&&this.spectrum.data.length>0?this.spectrum.draw(t,this.styles,this.width,this.height):this.emptyMessage&&(t.fillStyle="#737683",t.textAlign="center",t.textBaseline="middle",t.font="18px Helvetica, Verdana, Arial, Sans-serif",t.fillText(this.emptyMessage,this.width/2,this.height/2))},n.loadSpectrum=function(t){this.spectrum=t,this.repaint()},n.getSpectrum=function(){return this.spectrum},n.getSpectrumCoordinates=function(t,e){return spectrum.getInternalCoordinates(t,e,this.width,this.height)}}(e,document),function(t,e){t.ObserverCanvas=function(t,e,i){t&&this.create(t,e,i)},t.ObserverCanvas.prototype=new t._SpectrumCanvas}(e),function(t,e){t.OverlayCanvas=function(t,e,i){t&&this.create(t,e,i)};let i=t.OverlayCanvas.prototype=new t._SpectrumCanvas;i.overlaySpectra=[],i.superRepaint=i.innerRepaint,i.innerRepaint=function(t){if(this.superRepaint(t),this.spectrum&&this.spectrum.data.length>0)for(let e=0,i=this.overlaySpectra.length;e<i;e++){let i=this.overlaySpectra[e];i&&i.data.length>0&&(i.minX=this.spectrum.minX,i.maxX=this.spectrum.maxX,i.drawPlot(t,this.styles,this.width,this.height,this.spectrum.memory.offsetTop,this.spectrum.memory.offsetLeft,this.spectrum.memory.offsetBottom))}},i.addSpectrum=function(t){this.spectrum?this.overlaySpectra.push(t):this.spectrum=t}}(e),function(t,e,i,n){t.PerspectiveCanvas=function(t,e,i){t&&this.create(t,e,i)};let s=t.PerspectiveCanvas.prototype=new t._SpectrumCanvas;s.dragRange=n,s.rescaleYAxisOnZoom=!0,s.lastPinchScale=1,s.mousedown=function(e){this.dragRange=new t.structures.Point(e.p.x,e.p.x)},s.mouseup=function(t){if(this.dragRange&&this.dragRange.x!==this.dragRange.y){if(!this.dragRange.multi){let e=this.spectrum.zoom(this.dragRange.x,t.p.x,this.width,this.rescaleYAxisOnZoom);this.rescaleYAxisOnZoom&&(this.styles.scale=e)}this.dragRange=n,this.repaint()}},s.drag=function(t){this.dragRange&&(this.dragRange.multi?this.dragRange=n:e.SHIFT?(this.spectrum.translate(t.p.x-this.dragRange.x,this.width),this.dragRange.x=t.p.x,this.dragRange.y=t.p.x):this.dragRange.y=t.p.x,this.repaint())},s.drawChildExtras=function(t){if(this.dragRange){let e=i.min(this.dragRange.x,this.dragRange.y),n=i.max(this.dragRange.x,this.dragRange.y);t.strokeStyle="gray",t.lineStyle=1,t.beginPath(),t.moveTo(e,this.height/2);for(let s=e;s<=n;s++)s%10<5?t.lineTo(s,i.round(this.height/2)):t.moveTo(s,i.round(this.height/2));t.stroke()}},s.mousewheel=function(t,e){this.styles.scale-=e/10,this.styles.scale<.01&&(this.styles.scale=.01),this.repaint()},s.dblclick=function(t){this.spectrum.setup(),this.styles.scale=1,this.repaint()},s.multitouchmove=function(e,i){2===i&&(this.dragRange&&this.dragRange.multi?(this.spectrum.translate(e.p.x-this.dragRange.x,this.width),this.dragRange.x=e.p.x,this.dragRange.y=e.p.x,this.repaint()):(this.dragRange=new t.structures.Point(e.p.x,e.p.x),this.dragRange.multi=!0))},s.gesturechange=function(t){this.styles.scale*=t.originalEvent.scale/this.lastPinchScale,this.styles.scale<.01&&(this.styles.scale=.01),this.lastPinchScale=t.originalEvent.scale,this.repaint()},s.gestureend=function(t){this.lastPinchScale=1}}(e,e.monitor,Math),function(t,e,i,n){t.SeekerCanvas=function(t,e,i,n){t&&this.create(t,e,i),this.seekType=n};let s=t.SeekerCanvas.prototype=new t._SpectrumCanvas;s.superRepaint=s.innerRepaint,s.innerRepaint=function(n){if(this.superRepaint(n),this.spectrum&&this.spectrum.data.length>0&&this.p){let s,r;if(this.seekType===t.SeekerCanvas.SEEK_POINTER)s=this.p,r=this.spectrum.getInternalCoordinates(s.x,s.y);else if(this.seekType===t.SeekerCanvas.SEEK_PLOT||this.seekType===t.SeekerCanvas.SEEK_PEAK){if(r=this.seekType===t.SeekerCanvas.SEEK_PLOT?this.spectrum.getClosestPlotInternalCoordinates(this.p.x):this.spectrum.getClosestPeakInternalCoordinates(this.p.x),!r)return;s={x:this.spectrum.getTransformedX(r.x,this.styles,this.width,this.spectrum.memory.offsetLeft),y:this.spectrum.getTransformedY(r.y/100,this.styles,this.height,this.spectrum.memory.offsetBottom,this.spectrum.memory.offsetTop)}}n.fillStyle="white",n.strokeStyle=this.styles.plots_color,n.lineWidth=this.styles.plots_width,n.beginPath(),n.arc(s.x,s.y,3,0,2*i.PI,!1),n.fill(),n.stroke(),n.font=e.getFontString(this.styles.text_font_size,this.styles.text_font_families),n.textAlign="left",n.textBaseline="bottom";let o="x:"+r.x.toFixed(3)+", y:"+r.y.toFixed(3),a=s.x+3,l=n.measureText(o).width;a+l>this.width-2&&(a-=6+l);let h=s.y;h-this.styles.text_font_size-2<0&&(h+=this.styles.text_font_size),n.fillRect(a,h-this.styles.text_font_size,l,this.styles.text_font_size),n.fillStyle="black",n.fillText(o,a,h)}},s.mouseout=function(t){this.p=void 0,this.repaint()},s.mousemove=function(t){this.p={x:t.p.x-2,y:t.p.y-3},this.repaint()},s.touchstart=function(t){this.mousemove(t)},s.touchmove=function(t){this.mousemove(t)},s.touchend=function(t){this.mouseout(t)},t.SeekerCanvas.SEEK_POINTER="pointer",t.SeekerCanvas.SEEK_PLOT="plot",t.SeekerCanvas.SEEK_PEAK="peak"}(e,e.extensions,Math),function(t,e,i,n,s,r,o,a,l,h,u,c,f,d){t._Canvas3D=function(t,e,i){t&&this.create(t,e,i)},t._Canvas3D.PRESERVE_DRAWING_BUFFER=!1;let m=t._Canvas3D.prototype=new t._Canvas,p=t._Canvas.prototype;m.rotationMatrix=d,m.contentCenter=d,m.lastPoint=d,m.emptyMessage="WebGL is Unavailable!",m.lastPinchScale=1,m.lastGestureRotate=0,m.afterLoadContent=function(){let t=new i.Bounds;for(let e=0,i=this.molecules.length;e<i;e++)t.expand(this.molecules[e].getBounds3D());let e=u.dist([t.maxX,t.maxY,t.maxZ],[t.minX,t.minY,t.minZ])/2+1.5;e===1/0&&(e=10),this.maxDimension=o.max(t.maxX-t.minX,t.maxY-t.minY);let n=o.min(179.9,o.max(this.styles.projectionPerspectiveVerticalFieldOfView_3D,.1)),s=n/360*o.PI,r=e,a=r/(o.tan(s)/.8),h=a-r,c=a+r,f=this.width/this.height;this.camera.fieldOfView=n,this.camera.near=h,this.camera.far=c,this.camera.aspect=f,l.translate(l.identity(this.camera.viewMatrix),[0,0,-a]);let d=r/o.tan(s);this.lighting.camera.fieldOfView=n,this.lighting.camera.near=d-r,this.lighting.camera.far=d+r,this.lighting.updateView(),this.setupScene()},m.renderDepthMap=function(){if(this.styles.shadow_3D&&s.DepthShader){let t=this.gl.isEnabled(this.gl.CULL_FACE);t||this.gl.enable(this.gl.CULL_FACE),this.depthShader.useShaderProgram(this.gl);let e=this.gl.getParameter(this.gl.COLOR_CLEAR_VALUE);this.gl.clearColor(1,1,1,0),this.lightDepthMapFramebuffer.bind(this.gl,this.shadowTextureSize,this.shadowTextureSize),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.depthShader.setProjectionMatrix(this.gl,this.lighting.camera.projectionMatrix),this.depthShader.enableAttribsArray(this.gl);for(let t=0,e=this.molecules.length;t<e;t++)this.molecules[t].render(this.gl,this.styles);this.gl.flush(),this.depthShader.disableAttribsArray(this.gl),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clearColor(e[0],e[1],e[2],e[3]),t||this.gl.disable(this.gl.CULL_FACE)}},m.renderExtras=function(){this.phongShader.useShaderProgram(this.gl),this.phongShader.enableAttribsArray(this.gl);let t=[];for(let e=0,i=this.shapes.length;e<i;e++){let i=this.shapes[e];i instanceof s._Surface&&(!i.styles&&1!==this.styles.surfaces_alpha||i.styles&&1!==i.styles.surfaces_alpha)?t.push(i):i.render(this.gl,this.styles)}if(0!==t.length){this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enable(this.gl.BLEND),this.gl.depthMask(!1);for(let e=0,i=t.length;e<i;e++)t[e].render(this.gl,this.styles);this.gl.depthMask(!0),this.gl.disable(this.gl.BLEND),this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA)}if(this.phongShader.setShadow(this.gl,!1),this.phongShader.setFogMode(this.gl,0),this.phongShader.setFlatColor(this.gl,!1),this.styles.compass_display&&(this.phongShader.setLightDirection(this.gl,[0,0,-1]),this.compass.render(this.gl,this.styles)),this.phongShader.disableAttribsArray(this.gl),this.gl.flush(),this.gl.enable(this.gl.BLEND),this.gl.depthMask(!1),this.labelShader.useShaderProgram(this.gl),this.labelShader.setMatrixUniforms(this.gl,this.gl.modelViewMatrix),this.labelShader.setProjectionMatrix(this.gl,this.camera.projectionMatrix),this.labelShader.setDimension(this.gl,this.gl.canvas.clientWidth,this.gl.canvas.clientHeight),this.labelShader.enableAttribsArray(this.gl),this.styles.atoms_displayLabels_3D&&this.label3D.render(this.gl,this.styles,this.getMolecules()),this.styles.measurement_displayText_3D)for(let t=0,e=this.shapes.length;t<e;t++){let e=this.shapes[t];e.renderText&&e.renderText(this.gl,this.styles)}this.styles.compass_display&&this.styles.compass_displayText_3D&&this.compass.renderAxis(this.gl),this.labelShader.disableAttribsArray(this.gl),this.gl.disable(this.gl.BLEND),this.gl.depthMask(!0),this.gl.flush(),this.drawChildExtras&&this.drawChildExtras(this.gl),this.gl.flush()},m.renderColor=function(){this.phongShader.useShaderProgram(this.gl),this.gl.uniform1i(this.phongShader.shadowDepthSampleUniform,0),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.lightDepthMapTexture.texture),this.phongShader.setProjectionMatrix(this.gl,this.camera.projectionMatrix),this.phongShader.setShadow(this.gl,this.styles.shadow_3D),this.phongShader.setFlatColor(this.gl,this.styles.flat_color_3D),this.phongShader.setGammaCorrection(this.gl,this.styles.gammaCorrection_3D),this.phongShader.setShadowTextureSize(this.gl,this.shadowTextureSize,this.shadowTextureSize),this.phongShader.setShadowIntensity(this.gl,this.styles.shadow_intensity_3D),this.phongShader.setFogMode(this.gl,this.styles.fog_mode_3D),this.phongShader.setFogColor(this.gl,this.fogging.colorRGB),this.phongShader.setFogStart(this.gl,this.fogging.fogStart),this.phongShader.setFogEnd(this.gl,this.fogging.fogEnd),this.phongShader.setFogDensity(this.gl,this.fogging.density),this.phongShader.setLightProjectionMatrix(this.gl,this.lighting.camera.projectionMatrix),this.phongShader.setLightDiffuseColor(this.gl,this.lighting.diffuseRGB),this.phongShader.setLightSpecularColor(this.gl,this.lighting.specularRGB),this.phongShader.setLightDirection(this.gl,this.lighting.direction),this.phongShader.enableAttribsArray(this.gl);for(let t=0,e=this.molecules.length;t<e;t++)this.molecules[t].render(this.gl,this.styles);this.phongShader.disableAttribsArray(this.gl),this.gl.flush()},m.renderPosition=function(){this.positionShader.useShaderProgram(this.gl),this.positionShader.setProjectionMatrix(this.gl,this.camera.projectionMatrix),this.positionShader.enableAttribsArray(this.gl);for(let t=0,e=this.molecules.length;t<e;t++)this.molecules[t].render(this.gl,this.styles);this.positionShader.disableAttribsArray(this.gl),this.gl.flush()},m.renderNormal=function(){this.normalShader.useShaderProgram(this.gl),this.normalShader.setProjectionMatrix(this.gl,this.camera.projectionMatrix),this.normalShader.enableAttribsArray(this.gl);for(let t=0,e=this.molecules.length;t<e;t++)this.molecules[t].render(this.gl,this.styles);this.normalShader.disableAttribsArray(this.gl),this.gl.flush()},m.renderSSAO=function(){this.ssaoShader.useShaderProgram(this.gl),this.ssaoShader.setProjectionMatrix(this.gl,this.camera.projectionMatrix),this.ssaoShader.setSampleKernel(this.gl,this.ssao.sampleKernel),this.ssaoShader.setKernelRadius(this.gl,this.styles.ssao_kernel_radius),this.ssaoShader.setPower(this.gl,this.styles.ssao_power),this.ssaoShader.setGbufferTextureSize(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.uniform1i(this.ssaoShader.positionSampleUniform,0),this.gl.uniform1i(this.ssaoShader.normalSampleUniform,1),this.gl.uniform1i(this.ssaoShader.noiseSampleUniform,2),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.positionTexture.texture),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.normalTexture.texture),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.ssao.noiseTexture),this.gl.activeTexture(this.gl.TEXTURE0),this.ssaoShader.enableAttribsArray(this.gl),this.gl.quadBuffer.bindBuffers(this.gl),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,this.gl.quadBuffer.vertexPositionBuffer.numItems),this.ssaoShader.disableAttribsArray(this.gl),this.gl.flush(),this.ssaoFramebuffer.bind(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.ssaoBlurShader.useShaderProgram(this.gl),this.ssaoBlurShader.setGbufferTextureSize(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.uniform1i(this.ssaoBlurShader.aoSampleUniform,0),this.gl.uniform1i(this.ssaoBlurShader.depthSampleUniform,1),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.imageTexture.texture),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.depthTexture.texture),this.gl.activeTexture(this.gl.TEXTURE0),this.ssaoBlurShader.enableAttribsArray(this.gl),this.gl.quadBuffer.bindBuffers(this.gl),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,this.gl.quadBuffer.vertexPositionBuffer.numItems),this.ssaoBlurShader.disableAttribsArray(this.gl),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.flush()},m.renderOutline=function(){this.outlineShader.useShaderProgram(this.gl),this.outlineShader.setGbufferTextureSize(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.outlineShader.setNormalThreshold(this.gl,this.styles.outline_normal_threshold),this.outlineShader.setDepthThreshold(this.gl,this.styles.outline_depth_threshold),this.outlineShader.setThickness(this.gl,this.styles.outline_thickness),this.gl.uniform1i(this.outlineShader.normalSampleUniform,0),this.gl.uniform1i(this.outlineShader.depthSampleUniform,1),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.normalTexture.texture),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.depthTexture.texture),this.gl.activeTexture(this.gl.TEXTURE0),this.outlineShader.enableAttribsArray(this.gl),this.gl.quadBuffer.bindBuffers(this.gl),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,this.gl.quadBuffer.vertexPositionBuffer.numItems),this.outlineShader.disableAttribsArray(this.gl),this.gl.flush()},m.deferredRender=function(){let t=this.gl.getParameter(this.gl.COLOR_CLEAR_VALUE);this.gl.clearColor(0,0,0,0),this.colorFramebuffer.bind(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.renderColor(),this.positionFramebuffer.bind(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.renderPosition(),this.normalFramebuffer.bind(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.renderNormal(),this.styles.ssao_3D&&s.SSAOShader?(this.quadFramebuffer.bind(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.renderSSAO()):(this.ssaoFramebuffer.bind(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT)),this.outlineFramebuffer.bind(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.styles.outline_3D&&this.renderOutline(),this.gl.clearColor(t[0],t[1],t[2],t[3]),this.quadFramebuffer.bind(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.lightingShader.useShaderProgram(this.gl),this.gl.uniform1i(this.lightingShader.positionSampleUniform,0),this.gl.uniform1i(this.lightingShader.colorSampleUniform,1),this.gl.uniform1i(this.lightingShader.ssaoSampleUniform,2),this.gl.uniform1i(this.lightingShader.outlineSampleUniform,3),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this.positionTexture.texture),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this.colorTexture.texture),this.gl.activeTexture(this.gl.TEXTURE2),this.gl.bindTexture(this.gl.TEXTURE_2D,this.ssaoTexture.texture),this.gl.activeTexture(this.gl.TEXTURE3),this.gl.bindTexture(this.gl.TEXTURE_2D,this.outlineTexture.texture),this.gl.activeTexture(this.gl.TEXTURE0),this.lightingShader.enableAttribsArray(this.gl),this.gl.quadBuffer.bindBuffers(this.gl),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,this.gl.quadBuffer.vertexPositionBuffer.numItems),this.lightingShader.disableAttribsArray(this.gl),this.gl.flush(),this.fxaaFramebuffer.bind(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.bindTexture(this.gl.TEXTURE_2D,this.imageTexture.texture),this.fxaaShader.useShaderProgram(this.gl),this.fxaaShader.setBuffersize(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.fxaaShader.setAntialias(this.gl,this.styles.antialias_3D),this.fxaaShader.setEdgeThreshold(this.gl,this.styles.fxaa_edgeThreshold),this.fxaaShader.setEdgeThresholdMin(this.gl,this.styles.fxaa_edgeThresholdMin),this.fxaaShader.setSearchSteps(this.gl,this.styles.fxaa_searchSteps),this.fxaaShader.setSearchThreshold(this.gl,this.styles.fxaa_searchThreshold),this.fxaaShader.setSubpixCap(this.gl,this.styles.fxaa_subpixCap),this.fxaaShader.setSubpixTrim(this.gl,this.styles.fxaa_subpixTrim),this.fxaaShader.enableAttribsArray(this.gl),this.gl.quadBuffer.bindBuffers(this.gl),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,this.gl.quadBuffer.vertexPositionBuffer.numItems),this.fxaaShader.disableAttribsArray(this.gl),this.gl.flush(),this.finalFramebuffer.bind(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.renderExtras(),this.gl.clearColor(t[0],t[1],t[2],t[3]),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.bindTexture(this.gl.TEXTURE_2D,this.fxaaTexture.texture),this.quadShader.useShaderProgram(this.gl),this.quadShader.enableAttribsArray(this.gl),this.gl.quadBuffer.bindBuffers(this.gl),this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,this.gl.quadBuffer.vertexPositionBuffer.numItems),this.quadShader.disableAttribsArray(this.gl),this.gl.flush()},m.forwardRender=function(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.renderColor(),this.renderExtras()},m.repaint=function(){this.gl&&(this.gl.lightViewMatrix=l.multiply(this.lighting.camera.viewMatrix,this.rotationMatrix,[]),this.gl.rotationMatrix=this.rotationMatrix,this.gl.modelViewMatrix=this.gl.lightViewMatrix,this.renderDepthMap(),this.gl.modelViewMatrix=l.multiply(this.camera.viewMatrix,this.rotationMatrix,[]),l.translate(this.gl.modelViewMatrix,this.contentCenter),this.isSupportDeferred()&&(this.styles.ssao_3D||this.styles.outline_3D)?this.deferredRender():this.forwardRender())},m.pick=function(t,e,i,n){if(this.gl){let s=t,r=this.height-e;1!==this.pixelRatio&&(s*=this.pixelRatio,r*=this.pixelRatio),l.multiply(this.camera.viewMatrix,this.rotationMatrix,this.gl.modelViewMatrix),l.translate(this.gl.modelViewMatrix,this.contentCenter),this.gl.rotationMatrix=this.rotationMatrix,this.pickShader.useShaderProgram(this.gl);let o=this.gl.getParameter(this.gl.COLOR_CLEAR_VALUE);this.gl.clearColor(1,1,1,0),this.pickerFramebuffer.bind(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.pickShader.setProjectionMatrix(this.gl,this.camera.projectionMatrix),this.pickShader.enableAttribsArray(this.gl);let a=[];for(let t=0,e=this.molecules.length;t<e;t++)this.molecules[t].renderPickFrame(this.gl,this.styles,a,i,n);this.pickShader.disableAttribsArray(this.gl),this.gl.flush();let h=new Uint8Array(4);this.gl.readPixels(s-2,r+2,1,1,this.gl.RGBA,this.gl.UNSIGNED_BYTE,h);let u=d;return h[3]>0&&(u=a[h[2]|h[1]<<8|h[0]<<16]),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.clearColor(o[0],o[1],o[2],o[3]),u}return d},m.center=function(){let t=new n.Atom,e=this.molecules.length;for(let i=0,n=e;i<n;i++){let e=this.molecules[i];t.add3D(e.getCenter3D())}t.x/=e,t.y/=e,t.z/=e,this.contentCenter=[-t.x,-t.y,-t.z]},m.isSupportDeferred=function(){return this.gl.textureFloatExt&&this.gl.depthTextureExt},m.create=function(e,i,n){p.create.call(this,e,i,n);try{let e=a.getElementById(this.id);this.gl=e.getContext("webgl",{preserveDrawingBuffer:t._Canvas3D.PRESERVE_DRAWING_BUFFER}),this.gl||(this.gl=e.getContext("experimental-webgl"))}catch(t){}this.gl?(1!==this.pixelRatio&&this.gl.canvas.width===this.width&&(this.gl.canvas.style.width=this.width+"px",this.gl.canvas.style.height=this.height+"px",this.gl.canvas.width=this.width*this.pixelRatio,this.gl.canvas.height=this.height*this.pixelRatio),this.gl.enable(this.gl.DEPTH_TEST),this.gl.depthFunc(this.gl.LEQUAL),this.gl.blendFuncSeparate(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA,this.gl.ONE,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.clearDepth(1),this.shadowTextureSize=1024,this.rotationMatrix=l.identity([]),this.contentCenter=[0,0,0],this.camera=new s.Camera,this.label3D=new s.Label,this.lighting=new s.Light(this.styles.lightDiffuseColor_3D,this.styles.lightSpecularColor_3D,this.styles.lightDirection_3D),this.fogging=new s.Fog(this.styles.fog_color_3D||this.styles.backgroundColor,this.styles.fog_start_3D,this.styles.fog_end_3D,this.styles.fog_density_3D),this.gl.depthTextureExt=this.gl.getExtension("WEBGL_depth_texture")||this.gl.getExtension("WEBKIT_WEBGL_depth_texture")||this.gl.getExtension("MOZ_WEBGL_depth_texture"),this.gl.textureFloatExt=this.gl.getExtension("OES_texture_float")||this.gl.getExtension("WEBKIT_OES_texture_float")||this.gl.getExtension("MOZ_OES_texture_float"),this.ssao=new s.SSAO,this.pickerColorTexture=new s.Texture,this.pickerColorTexture.init(this.gl,this.gl.UNSIGNED_BYTE,this.gl.RGBA,this.gl.RGBA),this.pickerDepthRenderbuffer=new s.Renderbuffer,this.pickerDepthRenderbuffer.init(this.gl,this.gl.DEPTH_COMPONENT16),this.pickerFramebuffer=new s.Framebuffer,this.pickerFramebuffer.init(this.gl),this.pickerFramebuffer.setColorTexture(this.gl,this.pickerColorTexture.texture),this.pickerFramebuffer.setDepthRenderbuffer(this.gl,this.pickerDepthRenderbuffer.renderbuffer),this.lightDepthMapTexture=new s.Texture,this.lightDepthMapRenderbuffer=new s.Renderbuffer,this.lightDepthMapFramebuffer=new s.Framebuffer,this.lightDepthMapFramebuffer.init(this.gl),this.gl.depthTextureExt?(this.lightDepthMapTexture.init(this.gl,this.gl.UNSIGNED_SHORT,this.gl.DEPTH_COMPONENT),this.lightDepthMapRenderbuffer.init(this.gl,this.gl.RGBA4),this.lightDepthMapFramebuffer.setColorRenderbuffer(this.gl,this.lightDepthMapRenderbuffer.renderbuffer),this.lightDepthMapFramebuffer.setDepthTexture(this.gl,this.lightDepthMapTexture.texture)):(this.lightDepthMapTexture.init(this.gl,this.gl.UNSIGNED_BYTE,this.gl.RGBA,this.gl.RGBA),this.lightDepthMapRenderbuffer.init(this.gl,this.gl.DEPTH_COMPONENT16),this.lightDepthMapFramebuffer.setColorTexture(this.gl,this.lightDepthMapTexture.texture),this.lightDepthMapFramebuffer.setDepthRenderbuffer(this.gl,this.lightDepthMapRenderbuffer.renderbuffer)),this.isSupportDeferred()&&(this.depthTexture=new s.Texture,this.depthTexture.init(this.gl,this.gl.UNSIGNED_SHORT,this.gl.DEPTH_COMPONENT),this.colorTexture=new s.Texture,this.colorTexture.init(this.gl,this.gl.UNSIGNED_BYTE,this.gl.RGBA),this.positionTexture=new s.Texture,this.positionTexture.init(this.gl,this.gl.FLOAT,this.gl.RGBA),this.normalTexture=new s.Texture,this.normalTexture.init(this.gl,this.gl.FLOAT,this.gl.RGBA),this.ssaoTexture=new s.Texture,this.ssaoTexture.init(this.gl,this.gl.FLOAT,this.gl.RGBA),this.outlineTexture=new s.Texture,this.outlineTexture.init(this.gl,this.gl.UNSIGNED_BYTE,this.gl.RGBA),this.fxaaTexture=new s.Texture,this.fxaaTexture.init(this.gl,this.gl.FLOAT,this.gl.RGBA),this.imageTexture=new s.Texture,this.imageTexture.init(this.gl,this.gl.FLOAT,this.gl.RGBA),this.colorFramebuffer=new s.Framebuffer,this.colorFramebuffer.init(this.gl),this.colorFramebuffer.setColorTexture(this.gl,this.colorTexture.texture),this.colorFramebuffer.setDepthTexture(this.gl,this.depthTexture.texture),this.normalFramebuffer=new s.Framebuffer,this.normalFramebuffer.init(this.gl),this.normalFramebuffer.setColorTexture(this.gl,this.normalTexture.texture),this.normalFramebuffer.setDepthTexture(this.gl,this.depthTexture.texture),this.positionFramebuffer=new s.Framebuffer,this.positionFramebuffer.init(this.gl),this.positionFramebuffer.setColorTexture(this.gl,this.positionTexture.texture),this.positionFramebuffer.setDepthTexture(this.gl,this.depthTexture.texture),this.ssaoFramebuffer=new s.Framebuffer,this.ssaoFramebuffer.init(this.gl),this.ssaoFramebuffer.setColorTexture(this.gl,this.ssaoTexture.texture),this.outlineFramebuffer=new s.Framebuffer,this.outlineFramebuffer.init(this.gl),this.outlineFramebuffer.setColorTexture(this.gl,this.outlineTexture.texture),this.fxaaFramebuffer=new s.Framebuffer,this.fxaaFramebuffer.init(this.gl),this.fxaaFramebuffer.setColorTexture(this.gl,this.fxaaTexture.texture),this.quadFramebuffer=new s.Framebuffer,this.quadFramebuffer.init(this.gl),this.quadFramebuffer.setColorTexture(this.gl,this.imageTexture.texture),this.finalFramebuffer=new s.Framebuffer,this.finalFramebuffer.init(this.gl),this.finalFramebuffer.setColorTexture(this.gl,this.fxaaTexture.texture),this.finalFramebuffer.setDepthTexture(this.gl,this.depthTexture.texture),this.normalShader=new s.NormalShader,this.normalShader.init(this.gl),this.positionShader=new s.PositionShader,this.positionShader.init(this.gl),s.SSAOShader&&(this.ssaoShader=new s.SSAOShader,this.ssaoShader.init(this.gl),this.ssaoBlurShader=new s.SSAOBlurShader,this.ssaoBlurShader.init(this.gl)),this.outlineShader=new s.OutlineShader,this.outlineShader.init(this.gl),this.lightingShader=new s.LightingShader,this.lightingShader.init(this.gl),this.fxaaShader=new s.FXAAShader,this.fxaaShader.init(this.gl),this.quadShader=new s.QuadShader,this.quadShader.init(this.gl)),this.labelShader=new s.LabelShader,this.labelShader.init(this.gl),this.pickShader=new s.PickShader,this.pickShader.init(this.gl),this.phongShader=new s.PhongShader,this.phongShader.init(this.gl),s.DepthShader&&(this.depthShader=new s.DepthShader,this.depthShader.init(this.gl)),this.textTextImage=new s.TextImage,this.textTextImage.init(this.gl),this.gl.textImage=new s.TextImage,this.gl.textImage.init(this.gl),this.gl.textMesh=new s.TextMesh,this.gl.textMesh.init(this.gl),this.gl.material=new s.Material,this.setupScene()):this.displayMessage()},m.displayMessage=function(){let t=a.getElementById(this.id);if(t.getContext){let e=t.getContext("2d");this.styles.backgroundColor&&(e.fillStyle=this.styles.backgroundColor,e.fillRect(0,0,this.width,this.height)),this.emptyMessage&&(e.fillStyle="#737683",e.textAlign="center",e.textBaseline="middle",e.font="18px Helvetica, Verdana, Arial, Sans-serif",e.fillText(this.emptyMessage,this.width/2,this.height/2))}},m.renderText=function(t,e){let i={position:[],texCoord:[],translation:[]};this.textTextImage.pushVertexData(t,e,0,i),this.gl.textMesh.storeData(this.gl,i.position,i.texCoord,i.translation),this.textTextImage.useTexture(this.gl),this.gl.textMesh.render(this.gl)},m.setupScene=function(){if(this.gl){let a=c("#"+this.id),l=this.styles.backgroundColor?this.styles.backgroundColor:"transparent";a.css("background-color",l);let h="transparent"===l?[0,0,0,0]:i.getRGB(l,1);this.gl.clearColor(h[0],h[1],h[2],4==h.length?h[3]:1),this.styles.cullBackFace_3D?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.sphereBuffer=new s.Sphere(1,this.styles.atoms_resolution_3D,this.styles.atoms_resolution_3D),this.gl.starBuffer=new s.Star,this.gl.cylinderBuffer=new s.Cylinder(1,1,this.styles.bonds_resolution_3D),this.gl.cylinderClosedBuffer=new s.Cylinder(1,1,this.styles.bonds_resolution_3D,!0),this.gl.boxBuffer=new s.Box(1,1,1),this.gl.pillBuffer=new s.Pill(this.styles.bonds_pillDiameter_3D/2,this.styles.bonds_pillHeight_3D,this.styles.bonds_pillLatitudeResolution_3D,this.styles.bonds_pillLongitudeResolution_3D),this.gl.lineBuffer=new s.Line,this.gl.lineArrowBuffer=new s.LineArrow,this.gl.arrowBuffer=new s.Arrow(.3,this.styles.compass_resolution_3D),this.gl.quadBuffer=new s.Quad,this.gl.textImage.updateFont(this.gl,this.styles.text_font_size,this.styles.text_font_families,this.styles.text_font_bold,this.styles.text_font_italic,this.styles.text_font_stroke_3D),this.lighting.lightScene(this.styles.lightDiffuseColor_3D,this.styles.lightSpecularColor_3D,this.styles.lightDirection_3D),this.fogging.fogScene(this.styles.fog_color_3D||this.styles.backgroundColor,this.styles.fog_start_3D,this.styles.fog_end_3D,this.styles.fog_density_3D),this.compass=new s.Compass(this.gl,this.styles),this.lightDepthMapTexture.setParameter(this.gl,this.shadowTextureSize,this.shadowTextureSize),this.lightDepthMapRenderbuffer.setParameter(this.gl,this.shadowTextureSize,this.shadowTextureSize),this.pickerColorTexture.setParameter(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.pickerDepthRenderbuffer.setParameter(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.isSupportDeferred()&&(this.depthTexture.setParameter(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.colorTexture.setParameter(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.imageTexture.setParameter(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.positionTexture.setParameter(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.normalTexture.setParameter(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.ssaoTexture.setParameter(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.outlineTexture.setParameter(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.fxaaTexture.setParameter(this.gl,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.ssao.initSampleKernel(this.styles.ssao_kernel_samples),this.ssao.initNoiseTexture(this.gl)),this.camera.updateProjectionMatrix(this.styles.projectionPerspective_3D);for(let t=0,n=this.molecules.length;t<n;t++){let n=this.molecules[t];if(n.labelMesh instanceof s.TextMesh||(n.labelMesh=new s.TextMesh,n.labelMesh.init(this.gl)),n.chains){n.ribbons=[],n.cartoons=[],n.tubes=[],n.pipePlanks=[];for(let t=0,a=n.chains.length;t<a;t++){let l=n.chains[t];for(let t=0,e=l.length-1;t<e;t++)l[t].Test=t;let h=l.length>3&&r[l[3].name]&&"#BEA06E"===r[l[3].name].aminoColor;if(l.length>0&&!l[0].lineSegments){for(let t=0,e=l.length-1;t<e;t++)l[t].setup(l[t+1].cp1,h?1:this.styles.proteins_horizontalResolution);if(!h)for(let t=1,i=l.length-1;t<i;t++)e.vec3AngleFrom(l[t-1].D,l[t].D)>o.PI/2&&(l[t].guidePointsSmall.reverse(),l[t].guidePointsLarge.reverse(),u.scale(l[t].D,-1));for(let t=2,e=l.length-3;t<e;t++)l[t].computeLineSegments(l[t-2],l[t-1],l[t+1],!h,h?this.styles.nucleics_verticalResolution:this.styles.proteins_verticalResolution);l.pop(),l.pop(),l.pop(),l.shift(),l.shift()}let c=i.hsl2rgb(1===a?.5:t/a,1,.5),f="rgb("+c[0]+","+c[1]+","+c[2]+")";if(l.chainColor=f,h){let t=new s.Tube(l,this.styles.nucleics_tubeThickness,this.styles.nucleics_tubeResolution_3D);t.chainColor=f,n.tubes.push(t)}else{let t=new s.PipePlank(l,this.styles);n.pipePlanks.push(t);let e=l.shift(),i={front:new s.Ribbon(l,this.styles.proteins_ribbonThickness,!1),back:new s.Ribbon(l,-this.styles.proteins_ribbonThickness,!1)};i.front.chainColor=f,i.back.chainColor=f,n.ribbons.push(i);let r={front:new s.Ribbon(l,this.styles.proteins_ribbonThickness,!0),back:new s.Ribbon(l,-this.styles.proteins_ribbonThickness,!0)};r.front.chainColor=f,r.back.chainColor=f,n.cartoons.push(r),l.unshift(e)}}}}if(this.label3D.updateVerticesBuffer(this.gl,this.getMolecules(),this.styles),this instanceof t.MovieCanvas3D&&this.frames)for(let t=0,e=this.frames.length;t<e;t++){let e=this.frames[t];for(let t=0,i=e.mols.length;t<i;t++){let i=e.mols[t];i.labelMesh instanceof n.d3.TextMesh||(i.labelMesh=new n.d3.TextMesh,i.labelMesh.init(this.gl))}this.label3D.updateVerticesBuffer(this.gl,e.mols,this.styles)}}},m.updateScene=function(){this.camera.updateProjectionMatrix(this.styles.projectionPerspective_3D),this.lighting.lightScene(this.styles.lightDiffuseColor_3D,this.styles.lightSpecularColor_3D,this.styles.lightDirection_3D),this.fogging.fogScene(this.styles.fog_color_3D||this.styles.backgroundColor,this.styles.fog_start_3D,this.styles.fog_end_3D,this.styles.fog_density_3D),this.repaint()},m.mousedown=function(t){this.lastPoint=t.p},m.mouseup=function(t){this.lastPoint=d},m.rightmousedown=function(t){this.lastPoint=t.p},m.drag=function(e){if(this.lastPoint){if(t.monitor.ALT){let t=new n.Point(e.p.x,e.p.y);t.sub(this.lastPoint);let i=this.camera.fieldOfView/360*o.PI,s=o.tan(i),r=this.height/2/this.camera.zoom/s,a=this.camera.focalLength()/r;l.translate(this.camera.viewMatrix,[t.x*a,-t.y*a,0])}else{let t=e.p.x-this.lastPoint.x,i=e.p.y-this.lastPoint.y,n=l.rotate(l.identity([]),t*o.PI/180,[0,1,0]);l.rotate(n,i*o.PI/180,[1,0,0]),this.rotationMatrix=l.multiply(n,this.rotationMatrix)}this.lastPoint=e.p,this.repaint()}},m.mousewheel=function(t,e){e>0?this.camera.zoomIn():this.camera.zoomOut(),this.updateScene()},m.multitouchmove=function(t,e){if(2===e)if(this.lastPoint&&this.lastPoint.multi){let e=new n.Point(t.p.x,t.p.y);e.sub(this.lastPoint);let i=this.camera.fieldOfView/360*o.PI,s=o.tan(i),r=this.height/2/this.camera.zoom/s,a=this.camera.focalLength()/r;l.translate(this.camera.viewMatrix,[e.x*a,-e.y*a,0]),this.lastPoint=t.p,this.repaint()}else this.lastPoint=t.p,this.lastPoint.multi=!0},m.gesturechange=function(t){if(t.originalEvent.scale-this.lastPinchScale!=0){let e=30*-(t.originalEvent.scale/this.lastPinchScale-1);if(isNaN(e))return;e>0?this.camera.zoomOut():this.camera.zoomIn(),this.updateScene(),this.lastPinchScale=t.originalEvent.scale}this.repaint()},m.gestureend=function(t){this.lastPinchScale=1,this.lastGestureRotate=0}}(e,e.extensions,e.math,e.structures,e.structures.d3,e.RESIDUE,Math,document,e.lib.mat4,e.lib.mat3,e.lib.vec3,e.lib.jQuery,window),function(t,e,i,n,s){t.MolGrabberCanvas3D=function(t,e,s){t&&this.create(t,e,s);let r=[];r.push('<br><input type="text" id="'),r.push(t),r.push('_query" size="32" value="" />'),r.push("<br><nobr>"),r.push('<select id="'),r.push(t),r.push('_select">'),r.push('<option value="pubchem" selected>PubChem'),r.push("</select>"),r.push('<button type="button" id="'),r.push(t),r.push('_submit">Show Molecule</button>'),r.push("</nobr>"),n.writeln(r.join(""));let o=this;i("#"+t+"_submit").click((function(){o.search()})),i("#"+t+"_query").keypress((function(t){13===t.which&&o.search()}))};let r=t.MolGrabberCanvas3D.prototype=new t._Canvas3D;r.setSearchTerm=function(t){i("#"+this.id+"_query").val(t),this.search()},r.search=function(){let t=this;e.getMoleculeFromDatabase(i("#"+this.id+"_query").val(),{database:i("#"+this.id+"_select").val(),dimension:3},(function(e){t.loadMolecule(e)}))}}(e,e.iChemLabs,e.lib.jQuery,document),function(t,e,i){t.MovieCanvas3D=function(t,e,i){t&&this.create(t,e,i),this.frames=[]},t.MovieCanvas3D.PLAY_ONCE=0,t.MovieCanvas3D.PLAY_LOOP=1,t.MovieCanvas3D.PLAY_SPRING=2;let n=t.MovieCanvas3D.prototype=new t._Canvas3D;n.timeout=50,n.frameNumber=0,n.playMode=2,n.reverse=!1,n.startAnimation=t._AnimatorCanvas.prototype.startAnimation,n.stopAnimation=t._AnimatorCanvas.prototype.stopAnimation,n.isRunning=t._AnimatorCanvas.prototype.isRunning,n.dblclick=t.RotatorCanvas.prototype.dblclick,n.nextFrame=function(t){let e=this.frames[this.frameNumber];this.molecules=e.mols,this.shapes=e.shapes,2===this.playMode&&this.reverse?(this.frameNumber--,this.frameNumber<0&&(this.frameNumber=1,this.reverse=!1)):(this.frameNumber++,this.frameNumber>=this.frames.length&&(2===this.playMode?(this.frameNumber-=2,this.reverse=!0):(this.frameNumber=0,0===this.playMode&&this.stopAnimation())))},n.center=function(){let t=new e.Atom,i=this.frames[0];for(let e=0,n=i.mols.length;e<n;e++)t.add3D(i.mols[e].getCenter3D());t.x/=i.mols.length,t.y/=i.mols.length;let n=new e.Atom;n.sub3D(t);for(let t=0,e=this.frames.length;t<e;t++){let e=this.frames[t];for(let t=0,i=e.mols.length;t<i;t++){let i=e.mols[t];for(let t=0,e=i.atoms.length;t<e;t++)i.atoms[t].add3D(n)}}},n.addFrame=function(t,e){this.frames.push({mols:t,shapes:e})}}(e,e.structures),function(t,e,i,n){let s=[],r=[1,0,0],o=[0,1,0],a=[0,0,1];t.RotatorCanvas3D=function(t,e,i){t&&this.create(t,e,i)};let l=t.RotatorCanvas3D.prototype=new t._Canvas3D;l.timeout=33;let h=e.PI/15;l.xIncrement=h,l.yIncrement=h,l.zIncrement=h,l.startAnimation=t._AnimatorCanvas.prototype.startAnimation,l.stopAnimation=t._AnimatorCanvas.prototype.stopAnimation,l.isRunning=t._AnimatorCanvas.prototype.isRunning,l.dblclick=t.RotatorCanvas.prototype.dblclick,l.mousedown=n,l.rightmousedown=n,l.drag=n,l.mousewheel=n,l.nextFrame=function(t){if(0===this.molecules.length&&0===this.shapes.length)return void this.stopAnimation();i.identity(s);let e=t/1e3;i.rotate(s,this.xIncrement*e,r),i.rotate(s,this.yIncrement*e,o),i.rotate(s,this.zIncrement*e,a),i.multiply(this.rotationMatrix,s)}}(e,Math,e.lib.mat4),function(t,e){t.TransformCanvas3D=function(t,e,i){t&&this.create(t,e,i)},t.TransformCanvas3D.prototype=new t._Canvas3D}(e),function(t,e){t.ViewerCanvas3D=function(t,e,i){t&&this.create(t,e,i)};let i=t.ViewerCanvas3D.prototype=new t._Canvas3D;i.mousedown=e,i.rightmousedown=e,i.drag=e,i.mousewheel=e}(e),function(t,e,i,n,s){function r(t,e,i,n){this.element=t,this.x=e,this.y=i,this.dimension=n,this.allowMultipleSelections=!1}t.PeriodicTableCanvas=function(t,e){this.padding=5,t&&this.create(t,18*e+2*this.padding,10*e+2*this.padding),this.cellDimension=e||20,this.setupTable(),this.repaint()};let o=t.PeriodicTableCanvas.prototype=new t._Canvas;o.loadMolecule=s,o.getMolecule=s,o.getHoveredElement=function(){return this.hovered?this.hovered.element:s},o.innerRepaint=function(t){for(let e=0,i=this.cells.length;e<i;e++)this.drawCell(t,this.styles,this.cells[e]);this.hovered&&this.drawCell(t,this.styles,this.hovered),this.selected&&this.drawCell(t,this.styles,this.selected)},o.setupTable=function(){this.cells=[];let e=this.padding,i=this.padding,n=0;for(let s=0,o=t.SYMBOLS.length;s<o;s++){18===n&&(n=0,i+=this.cellDimension,e=this.padding);let o=t.ELEMENT[t.SYMBOLS[s]];2===o.atomicNumber?(e+=16*this.cellDimension,n+=16):5!==o.atomicNumber&&13!==o.atomicNumber||(e+=10*this.cellDimension,n+=10),(o.atomicNumber<58||o.atomicNumber>71&&o.atomicNumber<90||o.atomicNumber>103)&&o.atomicNumber<=118&&(this.cells.push(new r(o,e,i,this.cellDimension)),e+=this.cellDimension,n++)}i+=2*this.cellDimension,e=3*this.cellDimension+this.padding;for(let n=57;n<104;n++){let s=t.ELEMENT[t.SYMBOLS[n]];90===s.atomicNumber&&(i+=this.cellDimension,e=3*this.cellDimension+this.padding),(s.atomicNumber>=58&&s.atomicNumber<=71||s.atomicNumber>=90&&s.atomicNumber<=103)&&(this.cells.push(new r(s,e,i,this.cellDimension)),e+=this.cellDimension)}},o.drawCell=function(t,i,n){let s=t.createRadialGradient(n.x+n.dimension/3,n.y+n.dimension/3,1.5*n.dimension,n.x+n.dimension/3,n.y+n.dimension/3,n.dimension/10);s.addColorStop(0,"#000000"),s.addColorStop(.7,n.element.jmolColor),s.addColorStop(1,"#FFFFFF"),t.fillStyle=s,e.contextRoundRect(t,n.x,n.y,n.dimension,n.dimension,n.dimension/8),(n===this.hovered||n===this.selected||n.selected)&&(t.lineWidth=2,t.strokeStyle="#c10000",t.stroke(),t.fillStyle="white"),t.fill(),t.font=e.getFontString(i.text_font_size,i.text_font_families),t.fillStyle=i.text_color,t.textAlign="center",t.textBaseline="middle",t.fillText(n.element.symbol,n.x+n.dimension/2,n.y+n.dimension/2)},o.click=function(t){this.hovered&&(this.allowMultipleSelections?this.hovered.selected=!this.hovered.selected:this.selected=this.hovered,this.repaint())},o.touchstart=function(t){this.mousemove(t)},o.mousemove=function(t){let e=t.p.x,n=t.p.y;this.hovered=s;for(let t=0,s=this.cells.length;t<s;t++){let s=this.cells[t];if(i.isBetween(e,s.x,s.x+s.dimension)&&i.isBetween(n,s.y,s.y+s.dimension)){this.hovered=s;break}}this.repaint()},o.mouseout=function(t){this.hovered=s,this.repaint()}}(e,e.extensions,e.math,document),function(t,e,i,n,s){e.png={},e.png.string=function(e){if(e instanceof t._Canvas3D&&!e.gl.getContextAttributes().preserveDrawingBuffer)throw Error("PNG data cannot be created from a Canvas3D component unless the ChemDoodle._Canvas3D.PRESERVE_DRAWING_BUFFER boolean is set to true before the Canvas3D component is initialized.");return i.getElementById(e.id).toDataURL("image/png")},e.png.download=function(t,e){void 0===e&&(e="unnamed");let n=i.createElement("a");n.href=this.string(t),n.download=e,n.click()},e.png.open=function(t){let e=n.open();e.document.open(),e.document.write('<iframe src="'+this.string(t)+'" frameborder="0" style="border:0; top:0px; left:0px; bottom:0px; right:0px; width:100%; height:100%;" allowfullscreen></iframe>'),e.document.close()}}(e,e.io,document,window),function(t,e,i){t.file={},t.file.content=function(t,i){e.get(t,"",i)}}(e.io,e.lib.jQuery),function(t,i,n,s,r,o,a){i.SERVER_URL="https://ichemlabs.cloud.chemdoodle.com/icl_cdc_v090000/WebHQ",i.inRelay=!1,i.asynchronous=!0,i.INFO={userAgent:navigator.userAgent,platform:navigator.platform,v_cwc:t.getVersion(),v_jQuery:r.fn.jquery,v_jQuery_ui:"N/A"};let l=new n.JSONInterpreter,h=new s.Queue;i._contactServer=function(t,n,s,o,a){if(this.inRelay)h.enqueue({call:t,content:n,options:s,callback:o,errorback:a});else{i.inRelay=!0;let l=n instanceof FormData,u=JSON.stringify({call:t,content:l?{}:n,options:s,info:e.iChemLabs.INFO});l&&n.append("jsonData",JSON.stringify(u));let c={dataType:"text",type:"POST",data:l?n:u,url:this.SERVER_URL,success:function(t){let e=JSON.parse(t);if(e.message&&alert(e.message),i.inRelay=!1,o&&e.content&&!e.stop&&o(e.content),e.stop&&a&&a(),!h.isEmpty()){let t=h.dequeue();i._contactServer(t.call,t.content,t.options,t.callback,t.errorback)}},error:function(t,e,n){if(i.inRelay=!1,a&&a(),!h.isEmpty()){let t=h.dequeue();i._contactServer(t.call,t.content,t.options,t.callback,t.errorback)}},xhrFields:{withCredentials:!0},async:i.asynchronous};l&&(c.processData=!1,c.contentType=!1),r.ajax(c)}},i.authenticate=function(t,e,i,n){this._contactServer("authenticate",{credential:t},e,(function(t){i(t)}),n)},i.balanceReaction=function(t,e,i,n){let s={};"string"==typeof t||t instanceof String?s.equation=t:s.reaction=l.contentTo(t.molecules,t.shapes),this._contactServer("balanceReaction",s,e,(function(t){i(t.result,t.message)}),n)},i.calculate=function(t,e,i,n){this._contactServer("calculate",{mol:l.molTo(t)},e,(function(t){i(t)}),n)},i.createLewisDotStructure=function(t,e,i,n){this._contactServer("createLewisDot",{mol:l.molTo(t)},e,(function(t){i(l.molFrom(t.mol))}),n)},i.cir=function(t,e,i,n){this._contactServer("cir",t,e,(function(t){i(l.contentFrom(t.data),t.preview)}),n)},i.elementalAnalysis=function(t,i,n,s){this._contactServer("elementalAnalysis",{mol:(new e.io.JSONInterpreter).molTo(t)},i,(function(t){n(t)}),s)},i.fileToImage=function(t,e,i,n){this._contactServer("fileToImage",t,e,(function(t){i(t.imgsrc,t.width,t.height)}),n)},i.generateImage=function(t,e,i,n){this._contactServer("generateImage",{mol:l.molTo(t)},e,(function(t){i(t.link)}),n)},i.generateIUPACName=function(t,e,i,n){this._contactServer("generateIUPACName",{mol:l.molTo(t)},e,(function(t){i(t.iupac,t.attemptedPIN)}),n)},i.getMoleculeFromContent=function(t,e,i,n){this._contactServer("getMoleculeFromContent",{content:t},e,(function(t){let e=!1;for(let i=0,n=t.mol.a.length;i<n;i++)if(0!==t.mol.a[i].z){e=!0;break}if(e)for(let e=0,i=t.mol.a.length;e<i;e++)t.mol.a[e].x/=20,t.mol.a[e].y/=20,t.mol.a[e].z/=20;i(l.molFrom(t.mol))}),n)},i.getMoleculeFromDatabase=function(t,e,i,n){this._contactServer("getMoleculeFromDatabase",{query:t},e,(function(t){if(3===e.dimension)for(let e=0,i=t.mol.a.length;e<i;e++)t.mol.a[e].x/=20,t.mol.a[e].y/=-20,t.mol.a[e].z/=20;i(l.molFrom(t.mol))}),n)},i.getOptimizedPDBStructure=function(t,e,i,n){this._contactServer("getOptimizedPDBStructure",{id:t},e,(function(t){let e;e=t.mol?l.molFrom(t.mol):new s.Molecule,e.chains=l.chainsFrom(t.ribbons);for(let t=0,i=e.chains.length;t<i;t++){let i=e.chains[t];for(let t=0,e=i.length-1;t<e;t++)i[t],i[t+1].arrow&&(i[t+1].arrow=!1,i[t].arrow=!0)}e.fromJSON=!0,i(e)}),n)},i.getZeoliteFromIZA=function(t,i,n,s){this._contactServer("getZeoliteFromIZA",{query:t},i,(function(t){n(e.readCIF(t.cif,i.xSuper,i.ySuper,i.zSuper))}),s)},i.isGraphIsomorphism=function(t,e,i,n,s){this._contactServer("isGraphIsomorphism",{arrow:l.molTo(t),target:l.molTo(e)},i,(function(t){n(t.value)}),s)},i.isSubgraphIsomorphism=function(t,e,i,n,s){this._contactServer("isSubgraphIsomorphism",{arrow:l.molTo(t),target:l.molTo(e)},i,(function(t){n(t.value)}),s)},i.isSupergraphIsomorphism=function(t,e,i,n,s){this._contactServer("isSupergraphIsomorphism",{arrow:l.molTo(t),target:l.molTo(e)},i,(function(t){n(t.value)}),s)},i.getSimilarityMeasure=function(t,e,i,n,s){this._contactServer("getSimilarityMeasure",{first:l.molTo(t),second:l.molTo(e)},i,(function(t){n(t.value)}),s)},i.kekulize=function(t,e,i,n){this._contactServer("kekulize",{mol:l.molTo(t)},e,(function(t){i(l.molFrom(t.mol))}),n)},i.maximumCommonSubstructure=function(t,e,i,n,s){this._contactServer("maximumCommonSubstructure",{m1:l.molTo(t),m2:l.molTo(e)},i,(function(t){n(t.map)}),s)},i.mechanismMatch=function(t,e,i,n,s){this._contactServer("matchMechanism",{arrow:t,targets:e},i,(function(t){n(t)}),s)},i.optimize=function(t,e,i,n){this._contactServer("optimize",{mol:l.molTo(t)},e,(function(n){let s=l.molFrom(n.mol);if(2===e.dimension){for(let e=0,i=s.atoms.length;e<i;e++)t.atoms[e].x=s.atoms[e].x,t.atoms[e].y=s.atoms[e].y;i()}else if(3===e.dimension){for(let t=0,e=s.atoms.length;t<e;t++)s.atoms[t].x/=20,s.atoms[t].y/=-20,s.atoms[t].z/=20;i(s)}}),n)},i.readIUPACName=function(t,e,i,n){this._contactServer("readIUPACName",{iupac:t},e,(function(t){let e=[];for(let i=0,n=t.mols.length;i<n;i++)e.push(l.molFrom(t.mols[i]));i(e,t.warning)}),n)},i.readSMILES=function(t,e,i,n){this._contactServer("readSMILES",{smiles:t},e,(function(t){i(l.contentFrom(t.content))}),n)},i.readWLN=function(t,e,i,n){this._contactServer("readWLN",{wln:t},e,(function(t){i(l.contentFrom(t.content))}),n)},i.resolveCIP=function(t,e,i,n){this._contactServer("resolveCIP",{mol:l.molTo(t)},e,(function(t){i(t.atoms,t.bonds)}),n)},i.saveFile=function(t,e,i,n){this._contactServer("saveFile",{mol:l.molTo(t)},e,(function(t){i(t.link)}),n)},i.simulate13CNMR=function(e,i,n,s){i.nucleus="C",i.isotope=13,this._contactServer("simulateNMR",{mol:l.molTo(e)},i,(function(e){n(t.readJCAMP(e.jcamp))}),s)},i.simulate1HNMR=function(e,i,n,s){i.nucleus="H",i.isotope=1,this._contactServer("simulateNMR",{mol:l.molTo(e)},i,(function(e){n(t.readJCAMP(e.jcamp))}),s)},i.simulateMassParentPeak=function(e,i,n,s){this._contactServer("simulateMassParentPeak",{mol:l.molTo(e)},i,(function(e){n(t.readJCAMP(e.jcamp))}),s)},i.stoichiometry=function(t,e,i,n){let s={};"string"==typeof t||t instanceof String?s.equation=t:t.molecules!==a?s.reaction=l.contentTo(t.molecules,t.shapes):t.table!==a&&(s.table=t.table),this._contactServer("stoichiometry",s,e,(function(t){i(t.table,t.message)}),n)},i.writeSMILES=function(t,e,i,n,s){this._contactServer("writeSMILES",{content:l.contentTo(t,e)},i,(function(t){n(t.smiles)}),s)},i.version=function(t,e,i){this._contactServer("version",{},t,(function(t){e(t.value)}),i)},i.checkForUpdates=function(t){this._contactServer("checkForUpdates",{value:o.href},t,(function(t){}),(function(){}))}}(e,e.iChemLabs,e.io,e.structures,e.lib.jQuery,location)})();